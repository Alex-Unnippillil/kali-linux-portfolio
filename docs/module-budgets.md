# Module bundle budgets

This project tracks JavaScript bundle sizes produced by the Next.js analyzer to prevent regressions in
load time and runtime performance. Budgets are enforced by `scripts/module-report.mjs`, which reads the
JSON output generated by `@next/bundle-analyzer` and fails the build when thresholds are exceeded.

## Running the report locally

1. Generate analyzer output in JSON mode:

   ```bash
   ANALYZE=true BUNDLE_ANALYZER_MODE=json yarn build
   ```

2. Produce the report and optional markdown summary:

   ```bash
   node scripts/module-report.mjs --markdown module-report.md --json module-report.json
   ```

   The command prints the report to the console, writes the markdown summary to `module-report.md`, and
   exports the structured data to `module-report.json`.

## Budget thresholds

The following limits are defined in `scripts/module-budgets.json` and represent parsed (uncompressed) and
compressed sizes in bytes.

| Target | Total parsed | Total gzip | Initial parsed | Initial gzip |
| --- | --- | --- | --- | --- |
| client | ≤ 12,500,000 | ≤ 3,500,000 | ≤ 3,200,000 | ≤ 950,000 |
| edge | ≤ 150,000 | ≤ 50,000 | ≤ 150,000 | ≤ 50,000 |
| nodejs | ≤ 4,600,000 | ≤ 1,500,000 | ≤ 2,100,000 | ≤ 650,000 |

> **Tip:** Keep a small safety margin when updating budgets so that normal dependency noise does not break the
> pipeline, but large feature additions still require conscious updates to the thresholds.

## Updating budgets

1. Run the analyzer on the branch that introduces new code.
2. Generate the module report and review the sizes of the largest assets.
3. If the change is intentional, update `scripts/module-budgets.json` to include the new ceiling and commit a
   short rationale in the PR description.
4. Update this document whenever thresholds change so future contributors understand the expected limits.
