# Internationalization (i18n)

This project uses [i18next](https://www.i18next.com/) with dynamic JSON imports so that each locale only loads the namespaces it
needs. The runtime auto-detects the user's locale from the URL, cookies, or `Accept-Language` headers and keeps the default
English pages un-prefixed (e.g. `/about`).

## Adding a new locale

1. **Create translation files**
   - Copy the `locales/en` directory to a new folder named after the locale code (for example `locales/es`).
   - Keep the folder structure (`<locale>/<namespace>.json`). The default namespace is `common.json`.

2. **Register the locale**
   - Update `lib/i18n/constants.ts` so that `SUPPORTED_LOCALES` includes the new locale code. The first entry should remain the
     default locale (`en`).

3. **Optional: preload extra namespaces**
   - If a page needs namespaces beyond `common`, export an array named `namespaces` from the page component or set
     `pageProps.namespaces` in its data loader (`getStaticProps`, `getServerSideProps`, or `getInitialProps`). The `_app` logic
     will preload those namespaces automatically.

4. **Verify translations**
   - Run `yarn dev` and visit the localized route (e.g. `/es`). Navigating between locales updates the path and loads the
     translated JSON bundles. If you serve the app behind HTTPS, the locale cookie is marked as `Secure` automatically.

## Locale detection flow

1. Inspect the pathname. If the first segment is a supported locale (other than the default), use it.
2. Otherwise, check the `NEXT_LOCALE` cookie.
3. Finally, evaluate the `Accept-Language` header or `navigator.language`.
4. Fallback to the default locale (`en`).

Users visiting `/en/...` are redirected to the un-prefixed path to avoid duplicate routes.

## Testing

Basic detection tests live in `__tests__/i18n/detector.test.ts` and run with the standard Jest command:

```bash
yarn test
```

Add extra unit tests when you modify detection logic or cookie handling. The helper utilities expose pure functions so they can
be tested without a browser.
