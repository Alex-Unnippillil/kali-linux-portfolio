<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Offline</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; text-align: center; }
    ul { list-style: none; padding: 0; }
  </style>
</head>
<body>
  <main>
    <h1>Offline</h1>
    <p>You appear to be offline. Please check your connection.</p>
    <button id="retry">Retry</button>
    <section>
      <h2>Cached Apps</h2>
      <ul id="apps"></ul>
    </section>
  </main>
  <script>
    document.getElementById('retry').addEventListener('click', () => {
      window.location.reload();
    });

    (async () => {
      const list = document.getElementById('apps');
      try {
        const names = await caches.keys();
        const urls = new Set();
        for (const name of names) {
          const cache = await caches.open(name);
          const keys = await cache.keys();
          for (const request of keys) {
            const url = new URL(request.url);
            if (url.pathname.startsWith('/apps/') && !url.pathname.endsWith('.js')) {
              urls.add(url.pathname);
            }
          }
        }
        if (urls.size === 0) {
          list.innerHTML = '<li>No apps available offline.</li>';
        } else {
          urls.forEach((path) => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = path;
            a.textContent = path.replace('/apps/', '');
            li.appendChild(a);
            list.appendChild(li);
          });
        }
      } catch (err) {
        list.innerHTML = '<li>Unable to access cached apps.</li>';
      }
    })();
  </script>
</body>
</html>
