<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>BeEF Demo Target</title>
    <style>
      :root {
        color-scheme: dark;
        font-family: "Fira Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #121212;
        color: #f5f5f5;
      }
      body {
        margin: 0;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      h1 {
        font-size: 18px;
        margin: 0;
      }
      p {
        margin: 0;
        font-size: 14px;
        line-height: 1.4;
      }
      dl {
        margin: 0;
        display: grid;
        grid-template-columns: minmax(120px, 1fr) 2fr;
        gap: 6px 12px;
        font-size: 13px;
      }
      dt {
        font-weight: 600;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-size: 11px;
      }
      dd {
        margin: 0;
        word-break: break-all;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 11px;
        padding: 4px 8px;
        border-radius: 9999px;
        background: rgba(56, 189, 248, 0.15);
        color: #38bdf8;
      }
    </style>
  </head>
  <body>
    <div class="badge" id="status">Awaiting profile…</div>
    <h1>Sandboxed Target Page</h1>
    <p>
      This page never leaves your browser. It mirrors emulator preferences and reports them back to the
      desktop over <code>postMessage</code> so you can observe how the control channel works.
    </p>
    <dl>
      <dt>User agent</dt>
      <dd id="fingerprint-userAgent">Loading…</dd>
      <dt>Language</dt>
      <dd id="fingerprint-language">Loading…</dd>
      <dt>Timezone</dt>
      <dd id="fingerprint-timezone">Loading…</dd>
    </dl>
    <script>
      (function () {
        var state = {
          userAgent: navigator.userAgent || '',
          language: navigator.language || (navigator.languages && navigator.languages[0]) || 'en-US',
          timezone: (Intl.DateTimeFormat().resolvedOptions().timeZone) || 'UTC',
        };

        var statusEl = document.getElementById('status');
        var userAgentEl = document.getElementById('fingerprint-userAgent');
        var languageEl = document.getElementById('fingerprint-language');
        var timezoneEl = document.getElementById('fingerprint-timezone');

        function updateDisplay() {
          if (statusEl) {
            statusEl.textContent = 'Profile active';
          }
          if (userAgentEl) {
            userAgentEl.textContent = state.userAgent || '—';
          }
          if (languageEl) {
            languageEl.textContent = state.language || '—';
          }
          if (timezoneEl) {
            timezoneEl.textContent = state.timezone || '—';
          }
        }

        function sendFingerprint() {
          if (window.parent && window.parent !== window) {
            window.parent.postMessage(
              {
                source: 'beef-demo',
                type: 'beef:fingerprint',
                payload: {
                  userAgent: state.userAgent,
                  language: state.language,
                  timezone: state.timezone,
                },
              },
              '*'
            );
          }
        }

        function applySettings(payload) {
          if (!payload || typeof payload !== 'object') {
            return;
          }
          if (typeof payload.userAgent === 'string') {
            state.userAgent = payload.userAgent;
          }
          if (typeof payload.language === 'string') {
            state.language = payload.language;
          }
          if (typeof payload.timezone === 'string') {
            state.timezone = payload.timezone;
          }
          updateDisplay();
          sendFingerprint();
        }

        window.addEventListener('message', function (event) {
          var data = event.data;
          if (!data || typeof data !== 'object') {
            return;
          }
          if (data.type === 'beef:apply-emulator') {
            applySettings(data.payload);
          } else if (data.type === 'beef:request-fingerprint') {
            sendFingerprint();
          }
        });

        document.addEventListener('DOMContentLoaded', function () {
          updateDisplay();
          sendFingerprint();
        });
      })();
    </script>
  </body>
</html>
