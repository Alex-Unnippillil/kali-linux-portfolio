"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[162],{10162:(e,r,o)=>{o.r(r),o.d(r,{default:()=>E});var l=o(37876),t=o(14232),a=o(72082),s=o(65422);function n(e){let r=[],o=[];return e.split(/\r?\n/).forEach(e=>{""===e.trim()||e.trim().startsWith(";")?o.length&&(r.push(o),o=[]):o.push(e)}),o.length&&r.push(o),r}let i=[{name:"Tutorial",difficulty:"Easy",levels:n("\n; Simple tutorial level\n#####\n#@$.#\n#####\n\n; Two box level\n######\n#@ $.#\n######\n")},{name:"Classic",difficulty:"Medium",levels:n("\n; Small puzzle\n######\n# .@ #\n# $$ #\n# .  #\n######\n\n; Room\n#######\n#  .  #\n# $#$ #\n# .@  #\n#######\n")}];i[0].levels;let c=e=>"".concat(e.x,",").concat(e.y);function u(e){let r=new Set,o=new Set,l=new Set,t={x:0,y:0};e.forEach((e,a)=>{e.split("").forEach((e,s)=>{let n=c({x:s,y:a});switch(e){case"#":r.add(n);break;case".":o.add(n);break;case"$":l.add(n);break;case"*":l.add(n),o.add(n);break;case"@":t={x:s,y:a};break;case"+":t={x:s,y:a},o.add(n)}})});let a={width:Math.max(...e.map(e=>e.length)),height:e.length,walls:r,targets:o,boxes:l,player:t,pushes:0,moves:0,history:[],future:[],deadlocks:new Set};return a.deadlocks=p(a),a}function d(e){return{player:{...e.player},boxes:Array.from(e.boxes),pushes:e.pushes,moves:e.moves}}let f={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}},b=Object.keys(f);function x(e,r){let o=c(r);return r.x<0||r.y<0||r.x>=e.width||r.y>=e.height||e.walls.has(o)||e.boxes.has(o)}function v(e,r){let o=c(r);if(e.targets.has(o))return!1;let l=x(e,{x:r.x,y:r.y-1}),t=x(e,{x:r.x,y:r.y+1}),a=x(e,{x:r.x-1,y:r.y}),s=x(e,{x:r.x+1,y:r.y});return l&&a||l&&s||t&&a||t&&s}function p(e){let r=new Set;return e.boxes.forEach(o=>{let[l,t]=o.split(",").map(Number);v(e,{x:l,y:t})&&r.add(o)}),r}function h(e,r){let o=f[r];if(!o)return e;let l={x:e.player.x+o.x,y:e.player.y+o.y},t=c(l);if(e.walls.has(t))return e;let a={...e,player:{...e.player},boxes:new Set(e.boxes),history:[...e.history],future:[]};if(a.history.push(d(e)),a.boxes.has(t)){let r={x:l.x+o.x,y:l.y+o.y},s=c(r);if(x(e,r))return a.history.pop(),e;a.boxes.delete(t),a.boxes.add(s),a.pushes+=1}return a.player=l,a.moves+=1,a.deadlocks=p(a),a}function m(e){let r=new Set,o=[e.player];for(r.add(c(e.player));o.length;){let l=o.shift();Object.values(f).forEach(t=>{let a={x:l.x+t.x,y:l.y+t.y},s=c(a);!(r.has(s)||x(e,a))&&(e.boxes.has(s)||(r.add(s),o.push(a)))})}return r}function g(e){let r=!0;return e.boxes.forEach(o=>{e.targets.has(o)||(r=!1)}),r}function y(e,r,o){let l=c(o);return o.x<0||o.y<0||o.x>=e.width||o.y>=e.height||e.walls.has(l)||r.has(l)}function k(e,r,o){let l=c(o);if(e.targets.has(l))return!1;let t=y(e,r,{x:o.x,y:o.y-1}),a=y(e,r,{x:o.x,y:o.y+1}),s=y(e,r,{x:o.x-1,y:o.y}),n=y(e,r,{x:o.x+1,y:o.y});return t&&s||t&&n||a&&s||a&&n}let w=(e,r)=>{let o=Array.from(r).sort().join(";");return"".concat(e.x,",").concat(e.y,"|").concat(o)};function j(e){let r=new Set(e.boxes),o=new Set([w(e.player,r)]),l=[{player:{...e.player},boxes:r,path:[]}];for(;l.length;){let r=l.shift(),t=!0;if(r.boxes.forEach(r=>{e.targets.has(r)||(t=!1)}),t)return r.path;for(let t of b){let a=f[t],s={x:r.player.x+a.x,y:r.player.y+a.y},n=c(s);if(e.walls.has(n))continue;let i=new Set(r.boxes);if(i.has(n)){let r={x:s.x+a.x,y:s.y+a.y},o=c(r);if(e.walls.has(o)||i.has(o)||(i.delete(n),i.add(o),k(e,i,r)))continue}let u=w(s,i);o.has(u)||(o.add(u),l.push({player:s,boxes:i,path:[...r.path,t]}))}}return null}function N(e){let r=new Set(e.boxes),o=new Map([[w(e.player,r),0]]),l=[{player:{...e.player},boxes:r,pushes:0,moves:0}];for(;l.length;){l.sort((e,r)=>e.pushes-r.pushes||e.moves-r.moves);let r=l.shift(),t=!0;if(r.boxes.forEach(r=>{e.targets.has(r)||(t=!1)}),t)return r.pushes;for(let t of b){let a=f[t],s={x:r.player.x+a.x,y:r.player.y+a.y},n=c(s);if(e.walls.has(n))continue;let i=new Set(r.boxes),u=r.pushes;if(i.has(n)){let r={x:s.x+a.x,y:s.y+a.y},o=c(r);if(e.walls.has(o)||i.has(o)||(i.delete(n),i.add(o),k(e,i,r)))continue;u+=1}let d=w(s,i),b=o.get(d);void 0!==b&&b<=u||(o.set(d,u),l.push({player:s,boxes:i,pushes:u,moves:r.moves+1}))}}return null}let _=e=>{let{level:r}=e,o=Math.max(...r.map(e=>e.length)),t=r.length,a={width:8,height:8};return(0,l.jsxs)("div",{className:"relative rounded border border-[color:var(--kali-panel-border)] bg-[var(--kali-panel)] shadow-md",style:{width:8*o,height:8*t},children:[r.map((e,r)=>e.split("").map((e,o)=>{let t="".concat(o,",").concat(r);return(0,l.jsx)("div",{className:"absolute border ".concat("#"===e?"border-[color:var(--kali-panel-border)] bg-[var(--kali-panel)]":"border-[color:color-mix(in_srgb,var(--kali-control)_20%,transparent)] bg-[color:var(--kali-control-surface)]"," ").concat("."===e||"+"===e||"*"===e?"ring-1 ring-[color:color-mix(in_srgb,var(--kali-control)_70%,transparent)]":""," shadow-inner"),style:{...a,left:8*o,top:8*r}},"t-".concat(t))})),r.map((e,r)=>e.split("").map((e,o)=>{let t="".concat(o,",").concat(r);return"$"===e||"*"===e?(0,l.jsx)("div",{className:"absolute bg-[color:var(--color-warning)]",style:{...a,left:8*o,top:8*r}},"b-".concat(t)):"@"===e||"+"===e?(0,l.jsx)("div",{className:"absolute bg-[color:var(--kali-control)]",style:{...a,left:8*o,top:8*r}},"p-".concat(t)):null}))]})},S=(e,r)=>"sokoban-progress-".concat(e,"-").concat(r),C=e=>!!e&&"object"==typeof e&&void 0!==e.player&&"number"==typeof e.player.x&&"number"==typeof e.player.y&&Array.isArray(e.boxes)&&e.boxes.every(e=>"string"==typeof e)&&"number"==typeof e.moves&&"number"==typeof e.pushes,E=e=>{var r;let{getDailySeed:o,windowMeta:E}=e,A=null==(r=null==E?void 0:E.isFocused)||r,[R,P]=(0,t.useState)(i),[M,L]=(0,t.useState)(0),[G,T]=(0,t.useState)(0),I=R[M],[H,K]=(0,t.useState)(()=>u(I.levels[0])),[U,z]=(0,t.useState)(m(u(I.levels[0]))),[D,$]=(0,t.useState)(null),[O,F]=(0,t.useState)(""),[B,W]=(0,t.useState)(""),[J,Y]=(0,t.useState)(new Set),[Z,X]=(0,t.useState)(new Set),[q,Q]=(0,t.useState)([]),V=t.useRef(0),[ee,er]=(0,t.useState)(null),[eo,el]=(0,t.useState)(!1),[et,ea]=(0,t.useState)(null),[es,en]=(0,t.useState)(!1),[ei,ec]=(0,t.useState)({moves:0,pushes:0}),[eu,ed]=(0,t.useState)(null),ef=(0,t.useRef)(null),eb=(0,t.useRef)(null),[ex,ev]=(0,t.useState)(1),ep=(0,t.useRef)(!1),eh=(0,t.useRef)(!1),em=(0,t.useRef)(H),eg=(0,t.useRef)(M),ey=(0,t.useRef)(G),ek=(0,t.useRef)(R),ew=(0,t.useRef)(null),ej=(0,t.useRef)(null);(0,t.useEffect)(()=>{em.current=H},[H]),(0,t.useEffect)(()=>{eg.current=M},[M]),(0,t.useEffect)(()=>{ey.current=G},[G]),(0,t.useEffect)(()=>{ek.current=R},[R]),(0,t.useEffect)(()=>{var e,r,o,l;eh.current=null!=(l=null==(r=(o=window).matchMedia)||null==(e=r.call(o,"(prefers-reduced-motion: reduce)"))?void 0:e.matches)&&l},[]);let eN=(0,t.useCallback)(()=>{let e=ej.current;return!!e&&(e.timer&&window.clearTimeout(e.timer),ej.current=null,ed(null),W(""),!0)},[]),e_=(0,t.useCallback)(function(e,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ek.current,l=u(o[r].levels[e]);try{let o=localStorage.getItem(S(r,e));if(o){let e=JSON.parse(o);if(e&&"object"==typeof e&&void 0!==e.player&&"number"==typeof e.player.x&&"number"==typeof e.player.y&&Array.isArray(e.boxes)&&e.boxes.every(e=>"string"==typeof e)&&"number"==typeof e.moves&&"number"==typeof e.pushes&&Array.isArray(e.history)&&e.history.every(C)&&Array.isArray(e.future)&&e.future.every(C)){let r={...l,player:{...e.player},boxes:new Set(e.boxes),moves:e.moves,pushes:e.pushes,history:e.history.map(e=>({player:{...e.player},boxes:[...e.boxes],moves:e.moves,pushes:e.pushes})),future:e.future.map(e=>({player:{...e.player},boxes:[...e.boxes],moves:e.moves,pushes:e.pushes})),deadlocks:new Set},o=new Set;return r.boxes.forEach(e=>{let[l,t]=e.split(",").map(Number);v(r,{x:l,y:t})&&o.add(e)}),r.deadlocks=o,r}}}catch(e){}return l},[]),eS=(0,t.useCallback)(e=>{if(!g(e))try{let r=S(eg.current,ey.current);localStorage.setItem(r,JSON.stringify((e=>({player:e.player,boxes:Array.from(e.boxes),moves:e.moves,pushes:e.pushes,history:e.history.map(e=>({player:e.player,boxes:e.boxes,moves:e.moves,pushes:e.pushes})),future:e.future.map(e=>({player:e.player,boxes:e.boxes,moves:e.moves,pushes:e.pushes}))}))(e)))}catch(e){}},[]),eC=(0,t.useCallback)(()=>{try{let e=S(eg.current,ey.current);localStorage.removeItem(e)}catch(e){}},[]),eE=(0,t.useCallback)((e,r)=>{if(r.pushes<=e.pushes)return;let o=Array.from(e.boxes).find(e=>!r.boxes.has(e)),l=Array.from(r.boxes).find(r=>!e.boxes.has(r));if(o){let[e,r]=o.split(",").map(Number),l=V.current++;Q(o=>[...o,{id:l,x:e,y:r}]),setTimeout(()=>Q(e=>e.filter(e=>e.id!==l)),300)}l&&(er(l),setTimeout(()=>er(null),200)),(0,a.logEvent)({category:"sokoban",action:"push"})},[]),eA=(0,t.useCallback)(e=>{(0,a.logGameEnd)("sokoban","level_complete"),(0,a.logEvent)({category:"sokoban",action:"level_complete",value:e.pushes});let r="sokoban-best-".concat(eg.current,"-").concat(ey.current),o=localStorage.getItem(r);(!o||e.pushes<Number(o))&&(localStorage.setItem(r,String(e.pushes)),$(e.pushes)),eC(),ec({moves:e.moves,pushes:e.pushes}),en(!0),eN()},[eN,eC]),eR=(0,t.useCallback)((e,r)=>{K(r),z(m(r)),F(""),W(r.deadlocks.size?"Deadlock!":""),Y(new Set),X(new Set),en(!1),ew.current=null,eE(e,r),g(r)&&(W(""),eA(r))},[eA,eE]),eP=(0,t.useCallback)(()=>{eN();let e=ek.current[eg.current],r=ey.current,o=u(e.levels[r]);K(o),z(m(o)),F(""),W(""),Y(new Set),X(new Set),en(!1),ea(null),setTimeout(()=>ea(N(o)),0),ew.current=null},[eN]),eM=(0,t.useCallback)(()=>{eN();let e=em.current,r=function(e){if(!e.history.length)return e;let r=e.history[e.history.length-1],o=new Set(r.boxes),l={...e,player:{...r.player},boxes:o,pushes:r.pushes,moves:r.moves,history:e.history.slice(0,-1),future:[...e.future,d(e)]};return l.deadlocks=p(l),l}(e);r!==e&&(K(r),z(m(r)),F(""),W(r.deadlocks.size?"Deadlock!":""),Y(new Set),X(new Set),en(!1),ew.current=null,(0,a.logEvent)({category:"sokoban",action:"undo"}))},[eN]),eL=(0,t.useCallback)(()=>{eN();let e=em.current,r=function(e){if(!e.future.length)return e;let r=e.future[e.future.length-1],o=new Set(r.boxes),l={...e,player:{...r.player},boxes:o,pushes:r.pushes,moves:r.moves,history:[...e.history,d(e)],future:e.future.slice(0,-1)};return l.deadlocks=p(l),l}(e);r!==e&&(K(r),z(m(r)),F(""),W(r.deadlocks.size?"Deadlock!":""),Y(new Set),X(new Set),en(!1),ew.current=null,(0,a.logEvent)({category:"sokoban",action:"redo"}))},[eN]),eG=(0,t.useCallback)(function(e){let{suppressWarning:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=em.current;if(r)ew.current=null;else if(ew.current&&ew.current!==e&&(ew.current=null,W("")),ew.current===e)ew.current=null,W("");else if(function(e,r){let o=f[r];if(!o)return!1;let l={x:e.player.x+o.x,y:e.player.y+o.y},t=c(l);if(!e.boxes.has(t))return!1;let a={x:l.x+o.x,y:l.y+o.y},s=c(a);if(x(e,a))return!1;let n=new Set(e.boxes);return n.delete(t),n.add(s),k(e,n,a)||function(e,r,o){let l=c(o);if(e.targets.has(l))return!1;let t=y(e,r,{x:o.x-1,y:o.y}),a=y(e,r,{x:o.x+1,y:o.y});if(t||a){let r=!1;for(let l=o.x;l>=0;l--){let t="".concat(l,",").concat(o.y);if(e.walls.has(t))break;if(e.targets.has(t)){r=!0;break}}for(let l=o.x;l<e.width;l++){let t="".concat(l,",").concat(o.y);if(e.walls.has(t))break;if(e.targets.has(t)){r=!0;break}}if(!r)return!0}let s=y(e,r,{x:o.x,y:o.y-1}),n=y(e,r,{x:o.x,y:o.y+1});if(s||n){let r=!1;for(let l=o.y;l>=0;l--){let t="".concat(o.x,",").concat(l);if(e.walls.has(t))break;if(e.targets.has(t)){r=!0;break}}for(let l=o.y;l<e.height;l++){let t="".concat(o.x,",").concat(l);if(e.walls.has(t))break;if(e.targets.has(t)){r=!0;break}}if(!r)return!0}return!1}(e,n,a)}(o,e)){W("Deadlock ahead! Press again to confirm."),ew.current=e;return}let l=h(o,e);l!==o&&eR(o,l)},[eR]),eT=(0,t.useCallback)((e,r)=>0===e&&-1===r?"ArrowUp":0===e&&1===r?"ArrowDown":-1===e&&0===r?"ArrowLeft":1===e&&0===r?"ArrowRight":null,[]),eI=(0,t.useCallback)((e,r)=>{if(eN(),!e.length)return;ej.current={mode:r,moves:e,index:0,timer:null},ed(r),W("solve"===r?"Solving...":"Walking...");let o=()=>{let e=ej.current;if(!e)return;let r=em.current,l=e.moves[e.index];if(!l)return void eN();let t=h(r,l);if(t===r||"walk"===e.mode&&t.pushes>r.pushes)return void eN();if(eR(r,t),!ej.current)return;if(e.index+=1,e.index>=e.moves.length)return void eN();let a=eh.current?120:60;e.timer=window.setTimeout(o,a)};o()},[eR,eN]),eH=(0,t.useCallback)(function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R;o[r],eN();let l=e_(e,r,o);L(r),T(e),K(l),z(m(l)),F(""),W(""),Y(new Set),X(new Set),en(!1),ea(null),setTimeout(()=>ea(N(l)),0),ew.current=null,(0,a.logGameStart)("sokoban"),(0,a.logEvent)({category:"sokoban",action:"level_select",value:e})},[eN,e_,M,R]),eK=(0,t.useCallback)(e=>{eH(0,e)},[eH]),eU=(0,t.useCallback)(()=>{eM()},[eM]),ez=(0,t.useCallback)(()=>{eL()},[eL]),eD=(0,t.useCallback)(()=>{eP()},[eP]),e$=(0,t.useCallback)(async e=>{try{var r;let o=null==(r=e.target.files)?void 0:r[0];if(!o)return;eN();let l=await o.text(),t=n(l);if(t.length){let e={name:o.name||"Custom",difficulty:"Custom",levels:t},r=[...i,e];P(r),eH(0,r.length-1,r)}}catch(e){(0,a.logGameError)("sokoban",e instanceof Error?e.message:String(e))}},[eN,eH]);(0,t.useEffect)(()=>{if(!ep.current){ep.current=!0,(0,a.logGameStart)("sokoban");try{let e=new URLSearchParams(window.location.search).get("code");if(e){let r=decodeURIComponent(e),o=n(r);if(!o.length)try{o=n(atob(r))}catch(e){o=[]}if(o.length){let e={name:"Custom",difficulty:"Custom",levels:o},r=[...i,e];P(r);let l=e_(0,r.length-1,r);L(r.length-1),T(0),K(l),z(m(l)),ea(null),setTimeout(()=>ea(N(l)),0)}}if(!e){let e=e_(ey.current,eg.current);K(e),z(m(e)),ea(null),setTimeout(()=>ea(N(e)),0)}}catch(e){(0,a.logGameError)("sokoban",e instanceof Error?e.message:String(e))}}},[e_]),(0,t.useEffect)(()=>{let e="sokoban-best-".concat(M,"-").concat(G),r=localStorage.getItem(e);$(r?Number(r):null)},[G,M]),(0,t.useEffect)(()=>{eS(H)},[eS,H]);let eO=(0,t.useCallback)(()=>{eN(),F("..."),setTimeout(()=>{let e=function(e){let r=new Set(e.boxes),o=new Set([w(e.player,r)]),l=[{player:{...e.player},boxes:r,path:[]}];for(;l.length;){var t;let r=l.shift(),a=!0;if(r.boxes.forEach(r=>{e.targets.has(r)||(a=!1)}),a)return null!=(t=r.path[0])?t:null;for(let t of b){let a=f[t],s={x:r.player.x+a.x,y:r.player.y+a.y},n=c(s);if(e.walls.has(n))continue;let i=new Set(r.boxes);if(i.has(n)){let r={x:s.x+a.x,y:s.y+a.y},o=c(r);if(e.walls.has(o)||i.has(o)||(i.delete(n),i.add(o),k(e,i,r)))continue}let u=w(s,i);o.has(u)||(o.add(u),l.push({player:s,boxes:i,path:[...r.path,t]}))}}return null}(em.current);F(e?e.replace("Arrow",""):"No hint")},0)},[eN]),eF=(0,t.useCallback)(e=>"".concat(e.x,",").concat(e.y),[]),eB=(0,t.useCallback)(()=>{eN(),X(new Set),W("..."),setTimeout(()=>{let e=j(em.current);if(!e)return void W("No solution");let r=[],o=em.current;e.forEach(e=>{o=h(o,e),r.push(eF(o.player))}),X(new Set(r)),W("")},0)},[eN,eF]),eW=(0,t.useCallback)(()=>{eN(),X(new Set);let e=j(em.current);if(!e||!e.length)return void W("No solution");eI(e,"solve")},[eN,eI]);(0,t.useEffect)(()=>{let e=e=>{if((0,s.shouldHandleGameKey)(e,{isFocused:A})){if("Escape"===e.key){eN()&&(0,s.consumeGameKey)(e);return}if("r"===e.key||"R"===e.key){(0,s.consumeGameKey)(e),eD();return}if(["u","U","z","Z","Backspace"].includes(e.key)){(0,s.consumeGameKey)(e),eU();return}if(["y","Y"].includes(e.key)){(0,s.consumeGameKey)(e),ez();return}if(["h","H"].includes(e.key)){(0,s.consumeGameKey)(e),eO();return}if(["p","P"].includes(e.key)){(0,s.consumeGameKey)(e),eB();return}b.includes(e.key)&&((0,s.consumeGameKey)(e),eN(),eG(e.key))}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eN,eG,eO,eB,ez,eD,eU,A]);let eJ=(0,t.useMemo)(()=>({width:32,height:32}),[]);(0,t.useEffect)(()=>{if(!ef.current)return;let e=()=>{let e=ef.current;if(!e)return;let r=32*H.width,o=32*H.height;if(!r||!o)return void ev(1);let l=e.clientWidth,t=l?Math.min(1,l/r):1;{let r=e.getBoundingClientRect(),l=window.innerHeight-r.top-160;l>0&&(t=Math.min(t,l/o))}ev(t>0&&Number.isFinite(t)?t:1)};e();let r="undefined"!=typeof ResizeObserver?ResizeObserver:null,o=r?new r(e):null;o&&ef.current&&o.observe(ef.current);let l=()=>e();return window.addEventListener("resize",l),()=>{null==o||o.disconnect(),window.removeEventListener("resize",l)}},[H.width,H.height]);let eY=(0,t.useCallback)((e,r)=>{let o=r.player,l=[o],t=new Map;for(t.set(eF(o),null);l.length;){let o=l.shift();if(o.x===e.x&&o.y===e.y){let e=[],r=eF(o);for(;t.get(r);)e.push(r),r=t.get(r);return e.reverse()}for(let e of[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}]){let a={x:o.x+e.x,y:o.y+e.y},s=eF(a);!t.has(s)&&(a.x<0||a.y<0||a.x>=r.width||a.y>=r.height||r.walls.has(s)||r.boxes.has(s)||(t.set(s,eF(o)),l.push(a)))}}return[]},[eF]),eZ=(0,t.useCallback)((e,r)=>{let o="".concat(e,",").concat(r);if(!U.has(o)||H.walls.has(o)||H.boxes.has(o))return void Y(new Set);Y(new Set(eY({x:e,y:r},H)))},[eY,U,H]),eX=(0,t.useCallback)((e,r)=>{let o=em.current,l="".concat(e,",").concat(r);if(!U.has(l)||o.walls.has(l)||o.boxes.has(l))return;let t=eY({x:e,y:r},o);if(!t.length)return;let a=[],s=o.player;t.forEach(e=>{let[r,o]=e.split(",").map(Number),l=eT(r-s.x,o-s.y);l&&a.push(l),s={x:r,y:o}}),a.length&&eI(a,"walk")},[eT,eY,U,eI]),eq=32*H.width,eQ=32*H.height,eV=Math.round(eq*ex),e0=Math.round(eQ*ex),e1=t.useId(),e2=t.useId(),e3=t.useId(),e8=H.history.length>0,e5=H.future.length>0,e6=G>0,e7=G+1<I.levels.length;return(0,l.jsxs)("div",{className:"select-none space-y-4 p-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-end lg:justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-end gap-3",children:[(0,l.jsxs)("label",{htmlFor:e1,className:"flex flex-col text-xs text-[color:color-mix(in_srgb,var(--kali-text)_72%,transparent)]",children:[(0,l.jsx)("span",{className:"font-semibold uppercase tracking-wide text-[color:var(--kali-text)]",children:"Pack"}),(0,l.jsx)("select",{id:e1,value:M,onChange:e=>eK(Number(e.target.value)),className:"mt-1 rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-surface)] px-2 py-1 text-sm text-[color:var(--kali-text)] shadow-sm transition focus:border-[color:var(--kali-control)] focus:outline-none focus:ring-2 focus:ring-[color:var(--kali-control)] focus:ring-offset-2 focus:ring-offset-[var(--kali-bg)]",children:R.map((e,r)=>(0,l.jsx)("option",{value:r,children:"".concat(e.name," (").concat(e.difficulty,")")},e.name))})]}),(0,l.jsxs)("div",{className:"flex flex-col text-xs text-[color:color-mix(in_srgb,var(--kali-text)_72%,transparent)]",children:[(0,l.jsx)("span",{className:"font-semibold uppercase tracking-wide text-[color:var(--kali-text)]",children:"Level"}),(0,l.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>eH(G-1),disabled:!e6,"aria-label":"Previous level",className:"rounded border border-[color:var(--kali-panel-border)] px-2 py-1 text-xs font-semibold text-[color:var(--kali-control)] shadow transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat(e6?"bg-[color:var(--kali-control-overlay)] hover:bg-[color:var(--kali-control-surface)]":"cursor-not-allowed bg-[color:var(--kali-panel)] text-[color:color-mix(in_srgb,var(--kali-text)_50%,transparent)]"),children:"◀"}),(0,l.jsxs)("label",{htmlFor:e2,className:"flex flex-col text-xs text-[color:color-mix(in_srgb,var(--kali-text)_72%,transparent)]",children:[(0,l.jsx)("span",{className:"sr-only",children:"Level"}),(0,l.jsx)("select",{id:e2,value:G,onChange:e=>eH(Number(e.target.value)),className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-surface)] px-2 py-1 text-sm text-[color:var(--kali-text)] shadow-sm transition focus:border-[color:var(--kali-control)] focus:outline-none focus:ring-2 focus:ring-[color:var(--kali-control)] focus:ring-offset-2 focus:ring-offset-[var(--kali-bg)]",children:I.levels.map((e,r)=>(0,l.jsx)("option",{value:r,children:"Level ".concat(r+1)},r))})]}),(0,l.jsx)("button",{type:"button",onClick:()=>eH(G+1),disabled:!e7,"aria-label":"Next level",className:"rounded border border-[color:var(--kali-panel-border)] px-2 py-1 text-xs font-semibold text-[color:var(--kali-control)] shadow transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat(e7?"bg-[color:var(--kali-control-overlay)] hover:bg-[color:var(--kali-control-surface)]":"cursor-not-allowed bg-[color:var(--kali-panel)] text-[color:color-mix(in_srgb,var(--kali-text)_50%,transparent)]"),children:"▶"})]})]}),(0,l.jsxs)("label",{htmlFor:e3,className:"flex flex-col text-xs text-[color:color-mix(in_srgb,var(--kali-text)_72%,transparent)]",children:[(0,l.jsx)("span",{className:"font-semibold uppercase tracking-wide text-[color:var(--kali-text)]",children:"Import"}),(0,l.jsx)("input",{id:e3,type:"file",accept:".txt,.sas",onChange:e$,"aria-label":"Import custom levels",className:"mt-1 cursor-pointer text-sm text-[color:color-mix(in_srgb,var(--kali-text)_85%,transparent)]"})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>el(!0),className:"rounded bg-kali-control px-3 py-1 text-sm font-semibold text-slate-900 shadow transition hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_85%,#000000)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Levels"}),(0,l.jsx)("button",{type:"button",onClick:eO,"aria-label":"Hint",className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-3 py-1 text-sm font-semibold text-[color:var(--kali-control)] shadow transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Hint"}),(0,l.jsx)("button",{type:"button",onClick:eB,"aria-label":"Preview solution path",className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-3 py-1 text-sm font-semibold text-[color:var(--kali-control)] shadow transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Preview"}),(0,l.jsx)("button",{type:"button",onClick:eW,"aria-label":"Solve level",disabled:"solve"===eu,className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-3 py-1 text-sm font-semibold text-[color:var(--kali-control)] shadow transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat("solve"===eu?"cursor-not-allowed opacity-60":""),children:"solve"===eu?"Solving...":"Solve"}),eu&&(0,l.jsx)("button",{type:"button",onClick:()=>eN(),"aria-label":"Cancel autoplay",className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-3 py-1 text-sm font-semibold text-[color:var(--color-error)] shadow transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-error)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Cancel"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-start gap-2 text-sm text-[color:var(--kali-text)]",children:[(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsxs)("span",{className:"rounded border border-[color:var(--kali-panel-border)]/60 bg-[color:color-mix(in_srgb,var(--kali-panel)_70%,transparent)] px-3 py-1 shadow-sm",children:["Moves: ",H.moves]}),(0,l.jsxs)("span",{className:"rounded border border-[color:var(--kali-panel-border)]/60 bg-[color:color-mix(in_srgb,var(--kali-panel)_70%,transparent)] px-3 py-1 shadow-sm",children:["Pushes: ",H.pushes]}),(0,l.jsxs)("span",{className:"rounded border border-[color:var(--kali-panel-border)]/60 bg-[color:color-mix(in_srgb,var(--kali-panel)_70%,transparent)] px-3 py-1 shadow-sm",children:["Best: ",null!=D?D:"-"]}),(0,l.jsxs)("span",{className:"rounded border border-[color:var(--kali-panel-border)]/60 bg-[color:color-mix(in_srgb,var(--kali-panel)_70%,transparent)] px-3 py-1 shadow-sm",children:["Min: ",null!=et?et:"-"]})]}),O&&(0,l.jsxs)("div",{className:"text-xs text-[color:var(--color-info)]",children:["Hint: ",O]}),B&&(0,l.jsx)("div",{className:"text-xs text-[color:var(--color-error)]",children:B})]})]}),(0,l.jsx)("div",{ref:ef,className:"w-full",children:(0,l.jsx)("div",{className:"mx-auto flex justify-center",children:(0,l.jsx)("div",{className:"relative",style:{width:eV,height:e0},children:(0,l.jsxs)("div",{className:"relative rounded-md border border-[color:var(--kali-panel-border)] bg-[var(--kali-panel)] shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",style:{width:eq,height:eQ,transform:"scale(".concat(ex,")"),transformOrigin:"top left"},ref:eb,tabIndex:0,onMouseLeave:()=>Y(new Set),onPointerDown:()=>{var e;return null==(e=eb.current)?void 0:e.focus()},children:[Array.from({length:H.height}).map((e,r)=>Array.from({length:H.width}).map((e,o)=>{let a="".concat(o,",").concat(r),s=H.walls.has(a),n=H.targets.has(a),i=n&&H.boxes.has(a),c=U.has(a),u=J.has(a),d=Z.has(a),f=["absolute border shadow-inner transition-colors duration-150",s?"border-[color:var(--kali-panel-border)] bg-[var(--kali-panel)]":"border-[color:color-mix(in_srgb,var(--kali-control)_22%,transparent)] bg-[color:var(--kali-control-surface)]"];return n&&f.push(i?"bg-[color:color-mix(in_srgb,var(--color-success)_18%,var(--kali-control-surface))] ring-2 ring-[color:var(--color-success)]":"bg-[color:color-mix(in_srgb,var(--kali-control)_24%,var(--kali-control-surface))] ring-2 ring-[color:var(--kali-control)]"),(0,l.jsxs)(t.Fragment,{children:[(0,l.jsx)("div",{className:f.join(" "),style:{...eJ,left:32*o,top:32*r},onMouseEnter:()=>eZ(o,r),onClick:()=>eX(o,r)}),c&&!s&&(0,l.jsx)("div",{className:"absolute bg-[color:color-mix(in_srgb,var(--kali-control)_30%,transparent)]",style:{...eJ,left:32*o,top:32*r}}),u&&(0,l.jsx)("div",{className:"absolute bg-[color:color-mix(in_srgb,var(--color-info)_38%,transparent)]",style:{...eJ,left:32*o,top:32*r}}),d&&(0,l.jsx)("div",{className:"absolute bg-[color:color-mix(in_srgb,var(--color-accent)_38%,transparent)]",style:{...eJ,left:32*o,top:32*r}})]},a)})),Array.from(H.boxes).map(e=>{let[r,o]=e.split(",").map(Number),t=H.deadlocks.has(e),a=H.targets.has(e);return(0,l.jsx)("div",{className:"absolute transition-transform duration-100 ".concat(t?"bg-[color:var(--color-severity-critical)]":a?"bg-[color:var(--color-success)] ring-2 ring-[color:color-mix(in_srgb,var(--color-success)_65%,transparent)]":"bg-[color:var(--kali-control)]"," shadow-lg"),style:{...eJ,transform:"translate(".concat(32*r,"px, ").concat(32*o,"px) scale(").concat(e===ee?1.1:1,")")}},e)}),q.map(e=>(0,l.jsx)("div",{className:"absolute h-4 w-4 animate-ping rounded-full bg-[color:var(--kali-text)]/70",style:{left:32*e.x+16-8,top:32*e.y+16-8}},e.id)),(0,l.jsx)("div",{className:"absolute bg-[color:var(--kali-control)] transition-transform duration-100",style:{...eJ,transform:"translate(".concat(32*H.player.x,"px, ").concat(32*H.player.y,"px)")}})]})})})}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-center gap-3",children:[(0,l.jsx)("button",{type:"button",onClick:eU,"aria-label":"Undo move",disabled:!e8,className:"rounded bg-kali-control px-3 py-1 text-sm font-semibold text-slate-900 shadow transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat(e8?"hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_85%,#000000)]":"cursor-not-allowed opacity-60"),children:"Undo"}),(0,l.jsx)("button",{type:"button",onClick:ez,"aria-label":"Redo move",disabled:!e5,className:"rounded bg-kali-control px-3 py-1 text-sm font-semibold text-slate-900 shadow transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat(e5?"hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_85%,#000000)]":"cursor-not-allowed opacity-60"),children:"Redo"}),(0,l.jsx)("button",{type:"button",onClick:eD,"aria-label":"Reset level",className:"rounded bg-kali-control px-3 py-1 text-sm font-semibold text-slate-900 shadow transition hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_85%,#000000)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Reset"})]}),(0,l.jsxs)("details",{className:"mx-auto w-full max-w-xl rounded border border-[color:var(--kali-panel-border)]/70 bg-[color:color-mix(in_srgb,var(--kali-panel)_70%,transparent)] px-3 py-2 text-xs text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:[(0,l.jsx)("summary",{className:"cursor-pointer text-sm font-semibold text-[color:var(--kali-text)]",children:"Help & controls"}),(0,l.jsxs)("div",{className:"mt-2 grid gap-1 sm:grid-cols-2",children:[(0,l.jsx)("span",{children:"Arrow keys: Move/push"}),(0,l.jsx)("span",{children:"Z: Undo"}),(0,l.jsx)("span",{children:"Y: Redo"}),(0,l.jsx)("span",{children:"R: Reset"}),(0,l.jsx)("span",{children:"H: Hint"}),(0,l.jsx)("span",{children:"P: Preview"}),(0,l.jsx)("span",{children:"Esc: Cancel autoplay/solve"})]})]}),es&&(0,l.jsx)("div",{className:"fixed inset-0 flex bg-[color:var(--kali-overlay)]/85 backdrop-blur-sm",onClick:()=>en(!1),children:(0,l.jsxs)("div",{className:"space-y-2 rounded-xl border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-surface)]/95 p-4 text-[color:var(--kali-text)] shadow-kali-panel",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("div",{className:"font-bold",children:"Level Complete!"}),(0,l.jsxs)("div",{children:["Moves: ",ei.moves]}),(0,l.jsxs)("div",{children:["Pushes: ",ei.pushes]}),null!==et&&(0,l.jsxs)("div",{children:["Minimal pushes: ",et]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{eD(),en(!1)},className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-2 py-1 text-sm font-semibold text-[color:var(--kali-control)] transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Replay"}),(0,l.jsx)("button",{type:"button",onClick:()=>{e7&&(eH(G+1),en(!1))},disabled:!e7,className:"rounded bg-kali-control px-2 py-1 text-sm font-semibold text-slate-900 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)] ".concat(e7?"hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_85%,#000000)]":"cursor-not-allowed opacity-60"),children:e7?"Next level":"Pack complete"}),(0,l.jsx)("button",{type:"button",onClick:()=>en(!1),className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-control-overlay)] px-2 py-1 text-sm font-semibold text-[color:var(--kali-text)] transition hover:bg-[color:var(--kali-control-surface)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--kali-control)] focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-bg)]",children:"Close"})]})]})}),eo&&(0,l.jsx)("div",{className:"fixed inset-0 flex bg-[color:var(--kali-overlay)]/85 backdrop-blur-sm",onClick:()=>el(!1),children:(0,l.jsxs)("div",{className:"w-[640px] max-w-full space-y-4 rounded-2xl border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-surface)]/95 p-4 text-[color:var(--kali-text)] shadow-kali-panel",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[color:var(--kali-text)]",children:"Choose a level"}),(0,l.jsxs)("div",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:["Pack: ",(0,l.jsx)("span",{className:"font-medium text-[color:var(--kali-text)]",children:R[M].name})]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:gap-6",children:[(0,l.jsxs)("div",{className:"sm:w-1/3",children:[(0,l.jsx)("h3",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Packs"}),(0,l.jsx)("div",{className:"max-h-80 overflow-y-auto rounded border border-[color:var(--kali-panel-border)]/70",children:R.map((e,r)=>(0,l.jsxs)("button",{type:"button",className:"flex w-full justify-between gap-2 px-3 py-2 text-left text-sm ".concat(r===M?"bg-[color:var(--kali-control-surface)] font-semibold text-[color:var(--kali-text)] shadow-[0_0_0_1px_color-mix(in_srgb,var(--kali-control)_45%,transparent)]":"bg-[color:var(--kali-surface)] text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)] hover:bg-[color:var(--kali-control-overlay)]"),onClick:()=>eK(r),children:[(0,l.jsx)("span",{children:e.name}),(0,l.jsx)("span",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)]",children:e.difficulty})]},e.name))})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("h3",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:["Levels in ",R[M].name]}),(0,l.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3",children:R[M].levels.map((e,r)=>(0,l.jsxs)("button",{type:"button",className:"flex flex-col items-center gap-2 rounded border px-2 py-2 transition-colors ".concat(r===G?"border-[color:var(--kali-control)] bg-[color:var(--kali-control-surface)]":"border-transparent bg-[color:var(--kali-surface)] hover:border-[color:var(--kali-control)]/40 hover:bg-[color:var(--kali-control-overlay)]"),onClick:()=>{eH(r),el(!1)},children:[(0,l.jsx)(_,{level:e}),(0,l.jsxs)("span",{className:"text-xs font-medium text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)]",children:["Level ",r+1]})]},r))})})]})]})]})})]})}},65422:(e,r,o)=>{o.d(r,{consumeGameKey:()=>t,formatGameKey:()=>a,shouldHandleGameKey:()=>l});let l=function(e){let{isFocused:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(!r||(e=>{if(!e||!(e instanceof HTMLElement))return!1;let r=e.tagName;return"INPUT"===r||"TEXTAREA"===r||e.isContentEditable})(e.target))},t=e=>{(null==e?void 0:e.cancelable)&&e.preventDefault(),(null==e?void 0:e.stopPropagation)&&e.stopPropagation()},a=e=>{if(!e)return"";if(" "===e)return"Space";let r=e.toLowerCase();return"escape"===r?"Esc":"arrowup"===r?"ArrowUp":"arrowdown"===r?"ArrowDown":"arrowleft"===r?"ArrowLeft":"arrowright"===r?"ArrowRight":1===e.length?e.toUpperCase():e}}}]);