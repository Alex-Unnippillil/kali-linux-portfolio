"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9053],{9053:(e,r,t)=>{t.r(r),t.d(r,{default:()=>y});var a=t(37876),l=t(14232),n=t(95220);let o=e=>e&&"string"==typeof e.date&&"number"==typeof e.temp&&"number"==typeof e.condition,i=e=>Array.isArray(e)&&e.every(e=>"number"==typeof e),s=e=>e&&"string"==typeof e.id&&"string"==typeof e.name&&"number"==typeof e.lat&&"number"==typeof e.lon&&(void 0===e.region||"string"==typeof e.region)&&(void 0===e.countryCode||"string"==typeof e.countryCode)&&(void 0===e.timezone||"string"==typeof e.timezone)&&(void 0===e.lastReading||(e=>e&&"number"==typeof e.temp&&"number"==typeof e.condition&&"number"==typeof e.time)(e.lastReading))&&(void 0===e.lastReadingStale||"boolean"==typeof e.lastReadingStale)&&(void 0===e.forecast||(e=>Array.isArray(e)&&e.every(o))(e.forecast))&&(void 0===e.hourly||(e=>e&&i(e.temps)&&(void 0===e.times||(e=>Array.isArray(e)&&e.every(e=>"string"==typeof e))(e.times))&&(void 0===e.precipProbability||i(e.precipProbability))&&"number"==typeof e.updatedAt)(e.hourly))&&(void 0===e.hourlyStale||"boolean"==typeof e.hourlyStale)&&(void 0===e.lastError||"string"==typeof e.lastError),c=e=>Array.isArray(e)&&e.every(s),d=e=>e&&"string"==typeof e.name&&c(e.cities),u=e=>Array.isArray(e)&&e.every(d),x=e=>null===e||"string"==typeof e;var p=t(18040);function m(e){let{days:r}=e;return(0,a.jsx)("div",{className:"flex flex-wrap gap-2 text-[color:var(--kali-text)]",children:r.map(e=>(0,a.jsxs)("div",{className:"flex min-w-[84px] flex-1 flex-col items-center gap-2 rounded-md border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] p-2 text-center shadow-[0_1px_0_rgba(255,255,255,0.04)]",children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:(e=>{let r=new Date(e);return Number.isNaN(r.getTime())?e:r.toLocaleDateString(void 0,{weekday:"short"})})(e.date)}),(0,a.jsx)(p.default,{code:e.condition,className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"text-sm font-medium text-[color:var(--kali-text)]",children:[Math.round(e.temp),"\xb0"]})]},e.date))})}var b=t(74273),v=t(69432);function g(e){var r;let{city:n,onClose:o,onUpdateCity:i}=e,{allowNetwork:s}=(0,b.useSettings)(),c=(0,l.useId)(),d=(0,l.useId)(),[u,x]=(0,l.useState)("C"),[p,m]=(0,l.useState)(null!=(r=n.hourly)?r:null),[g,f]=(0,l.useState)("idle"),[h,y]=(0,l.useState)(null),[k,_]=(0,l.useState)({points:"",min:null,max:null}),w=(0,l.useRef)(null),j=(0,l.useRef)(null),N=(0,l.useRef)(0),S=(0,l.useRef)(null),E=(0,l.useRef)(null),C=(0,l.useRef)(null),R=(0,l.useRef)(null),A="undefined"!=typeof navigator&&!navigator.onLine,D=(0,l.useMemo)(()=>p?"C"===u?p.temps:p.temps.map(e=>1.8*e+32):[],[p,u]),M=(0,l.useMemo)(()=>{var e;if(!(null==p||null==(e=p.precipProbability)?void 0:e.length))return null;let r=p.precipProbability.filter(e=>Number.isFinite(e));return 0===r.length?null:Math.round(Math.max(...r))},[p]);(0,l.useEffect)(()=>{var e;return R.current=document.activeElement,null==(e=C.current)||e.focus(),()=>{var e;null==(e=R.current)||e.focus()}},[]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(e.preventDefault(),o())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o]),(0,l.useEffect)(()=>{let e=e=>{if("Tab"!==e.key)return;let r=E.current;if(!r)return;let t=r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;let a=t[0],l=t[t.length-1],n=document.activeElement;e.shiftKey&&n===a?(e.preventDefault(),l.focus()):e.shiftKey||n!==l||(e.preventDefault(),a.focus())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,l.useEffect)(()=>{if("undefined"==typeof Worker)return;let e=new Worker(t.tu(new URL(t.p+t.u(416),t.b)));return j.current=e,()=>{e.terminate(),j.current=null}},[]),(0,l.useEffect)(()=>{if(!j.current)return;let e="".concat(n.id,"-").concat(N.current++);j.current.onmessage=r=>{var t,a,l;r.data&&r.data.id===e&&_({points:null!=(t=r.data.points)?t:"",min:null!=(a=r.data.min)?a:null,max:null!=(l=r.data.max)?l:null})},j.current.postMessage({id:e,temps:D,width:260,height:90,padding:8})},[n.id,D]),(0,l.useEffect)(()=>{var e;m(null!=(e=n.hourly)?e:null)},[n.hourly,n.id]),(0,l.useEffect)(()=>{var e,r;null==(e=w.current)||e.abort();let t=new AbortController;w.current=t,f("loading"),y(null);let a=s?"cache-first":"cache-only";return(0,v.fetchWeather)("openMeteo",{lat:n.lat,lon:n.lon,timezone:null!=(r=n.timezone)?r:"auto",hourly:"temperature_2m,precipitation_probability",forecast_days:1,strategy:a,allowNetwork:s,signal:t.signal,revalidate:s&&!A}).then(e=>{var r,a,l,o,s,c,d;if(w.current!==t)return;let u=null!=(c=null==e?void 0:e.data)?c:e,x=Array.isArray(null==u||null==(r=u.hourly)?void 0:r.temperature_2m)?u.hourly.temperature_2m.filter(e=>"number"==typeof e&&Number.isFinite(e)):[],p={temps:x,times:Array.isArray(null==u||null==(a=u.hourly)?void 0:a.time)?u.hourly.time.filter(e=>"string"==typeof e):[],precipProbability:Array.isArray(null==u||null==(l=u.hourly)?void 0:l.precipitation_probability)?u.hourly.precipitation_probability.filter(e=>"number"==typeof e&&Number.isFinite(e)):[],updatedAt:null!=(d=null==e||null==(o=e.meta)?void 0:o.timestamp)?d:Date.now()};m(p),i(n.id,{hourly:p,hourlyStale:!!(null==e||null==(s=e.meta)?void 0:s.stale)}),f("idle"),(null==e?void 0:e.revalidate)&&e.revalidate.then(e=>{var r,a,l,o,s,c;if(!e||w.current!==t)return;let d=e.data,u=Array.isArray(null==d||null==(r=d.hourly)?void 0:r.temperature_2m)?d.hourly.temperature_2m.filter(e=>"number"==typeof e&&Number.isFinite(e)):[],x={temps:u,times:Array.isArray(null==d||null==(a=d.hourly)?void 0:a.time)?d.hourly.time.filter(e=>"string"==typeof e):[],precipProbability:Array.isArray(null==d||null==(l=d.hourly)?void 0:l.precipitation_probability)?d.hourly.precipitation_probability.filter(e=>"number"==typeof e&&Number.isFinite(e)):[],updatedAt:null!=(c=null==(o=e.meta)?void 0:o.timestamp)?c:Date.now()};m(x),i(n.id,{hourly:x,hourlyStale:!!(null==(s=e.meta)?void 0:s.stale)})})}).catch(e=>{t.signal.aborted||(f("error"),e instanceof v.WeatherFetchError?"network-disabled"===e.type?y("Network access is disabled in Settings."):"offline"===e.type?y("You are offline."):y(e.message):y(e instanceof Error?e.message:"Unable to fetch hourly forecast."))}),()=>{t.abort()}},[s,n.id,n.lat,n.lon,n.timezone,A,i]);let L=(0,l.useMemo)(()=>{var e;return(null==p||null==(e=p.times)?void 0:e.length)?p.times.slice(0,24).map(e=>{let r=new Date(e);return Number.isNaN(r.getTime())?e:r.toLocaleTimeString([],{hour:"2-digit"})}):[]},[p]),z=(null==p?void 0:p.updatedAt)?new Date(p.updatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):null,F=z?"".concat(n.hourlyStale?"Cached":"Updated"," ").concat(z):null,U=D.length>0,T=!s||A;return(0,a.jsx)("div",{ref:S,className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:e=>{e.target===S.current&&o()},children:(0,a.jsxs)("div",{role:"dialog","aria-modal":"true","aria-labelledby":c,"aria-describedby":d,ref:E,className:"w-full max-w-lg rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-panel)] p-4 text-[color:var(--kali-text)] shadow-[0_20px_60px_rgba(0,0,0,0.6)]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{id:c,className:"text-lg font-semibold text-[color:var(--kali-text)]",children:n.name}),(0,a.jsx)("div",{id:d,className:"text-xs uppercase tracking-wider text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Hourly forecast"})]}),(0,a.jsx)("button",{ref:C,onClick:o,className:"rounded bg-[color:color-mix(in_srgb,var(--kali-panel)_80%,transparent)] px-2 py-1 text-xs uppercase tracking-wider text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70",children:"Close"})]}),T&&(0,a.jsx)("div",{className:"mt-3 rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] p-2 text-xs text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:s?"You are offline. Showing cached hourly data when available.":"Network access is disabled in Settings. Showing cached hourly data when available."}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2 text-xs",children:[(0,a.jsx)("button",{className:"rounded px-2 py-1 font-semibold uppercase tracking-wide ".concat("C"===u?"bg-kali-control text-black":"bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]"),onClick:()=>x("C"),children:"\xb0C"}),(0,a.jsx)("button",{className:"rounded px-2 py-1 font-semibold uppercase tracking-wide ".concat("F"===u?"bg-kali-control text-black":"bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]"),onClick:()=>x("F"),children:"\xb0F"}),F&&(0,a.jsx)("div",{className:"ml-auto text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:F})]}),(0,a.jsx)("div",{className:"mt-4 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] p-3",children:U?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("svg",{viewBox:"0 0 ".concat(260," ").concat(90),className:"h-32 w-full",children:(0,a.jsx)("polyline",{points:k.points,fill:"none",stroke:"currentColor",strokeWidth:"1.5"})}),null!==k.min&&null!==k.max&&(0,a.jsxs)("div",{className:"mt-2 flex justify-between text-xs text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:[(0,a.jsxs)("span",{children:["Low ",Math.round(k.min),"\xb0"]}),(0,a.jsxs)("span",{children:["High ",Math.round(k.max),"\xb0"]})]})]}):(0,a.jsx)("div",{className:"flex h-24 items-center justify-center text-sm text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Hourly data is unavailable."})}),L.length>0&&(0,a.jsx)("div",{className:"mt-2 grid grid-cols-4 gap-2 text-[11px] uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)]",children:L.filter((e,r)=>r%6==0).slice(0,4).map(e=>(0,a.jsx)("span",{children:e},e))}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap items-center gap-3 text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:[null!==M&&(0,a.jsxs)("div",{children:["Precipitation chance: ",M,"%"]}),"loading"===g&&(0,a.jsx)("div",{className:"text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Fetching hourly data…"}),"error"===g&&(0,a.jsx)("div",{className:"text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:null!=h?h:"Unable to load hourly forecast."})]})]})})}function f(e){var r;let{city:t,loading:l,statusLabel:n,onOpen:o,onRefresh:i,onRemove:s,onEdit:c,onMoveUp:d,onMoveDown:u,onClearError:x,onDragStart:b,onDragEnd:v,canMoveUp:g,canMoveDown:f,canFetch:h}=e,y=t.lastReading,k=!!y,_=k?"".concat(Math.round(y.temp),"\xb0C"):"—",w=null!=(r=null==y?void 0:y.condition)?r:3;return(0,a.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("button",{type:"button",onClick:o,className:"flex-1 text-left focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70","aria-label":"Open ".concat(t.name," details"),children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Current"}),(0,a.jsx)("div",{className:"mt-1 text-xl font-semibold text-[color:var(--kali-text)]",children:t.name}),(0,a.jsx)("div",{className:"mt-2 text-4xl font-bold ".concat(k?"text-[color:var(--kali-text)]":"text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]"),children:_}),n&&(0,a.jsx)("div",{className:"mt-2 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:n})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[(0,a.jsx)("button",{type:"button",draggable:!0,onDragStart:b,onDragEnd:v,className:"cursor-grab rounded border border-[color:var(--kali-panel-border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70 active:cursor-grabbing","aria-label":"Drag ".concat(t.name),title:"Drag to reorder",children:"Drag"}),(0,a.jsx)("button",{type:"button",onClick:i,disabled:!h||l,className:"rounded border border-[color:var(--kali-panel-border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70 disabled:cursor-not-allowed disabled:opacity-50","aria-label":"Refresh ".concat(t.name),children:"Refresh"}),(0,a.jsx)("button",{type:"button",onClick:c,className:"rounded border border-[color:var(--kali-panel-border)] px-2 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70","aria-label":"Edit ".concat(t.name),children:"Edit"}),(0,a.jsx)("button",{type:"button",onClick:s,className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] px-2 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70","aria-label":"Remove ".concat(t.name),children:"Remove"}),l&&(0,a.jsx)("span",{className:"text-[10px] uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Updating…"})]}),(0,a.jsx)(p.default,{code:w,className:"h-16 w-16 sm:h-20 sm:w-20"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-2 text-xs uppercase tracking-wider text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Next 5 days"}),l&&!t.forecast?(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2",children:Array.from({length:5}).map((e,r)=>(0,a.jsx)("div",{className:"h-16 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] animate-pulse"},"forecast-skel-".concat(t.id,"-").concat(r)))}):t.forecast?(0,a.jsx)(m,{days:t.forecast.slice(0,5)}):(0,a.jsx)("div",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Forecast data will appear once the city is refreshed."})]}),t.lastError&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] p-2 text-xs text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsx)("span",{children:t.lastError}),(0,a.jsx)("button",{type:"button",onClick:x,className:"rounded px-2 py-1 text-[10px] uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)] hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)]",children:"Dismiss"})]})}),(0,a.jsxs)("div",{className:"mt-auto flex items-center justify-between text-xs text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:[(0,a.jsx)("span",{children:((e,r)=>{if(!e)return"No cached data";let t=new Date(e);return Number.isNaN(t.getTime())?"No cached data":"".concat(r?"Cached":"Updated"," ").concat(t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))})(null==y?void 0:y.time,t.lastReadingStale)}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("button",{type:"button",onClick:d,disabled:!g,className:"rounded px-2 py-1 uppercase tracking-wide transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70 disabled:cursor-not-allowed disabled:opacity-40","aria-label":"Move ".concat(t.name," up"),children:"Up"}),(0,a.jsx)("button",{type:"button",onClick:u,disabled:!f,className:"rounded px-2 py-1 uppercase tracking-wide transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/70 disabled:cursor-not-allowed disabled:opacity-40","aria-label":"Move ".concat(t.name," down"),children:"Down"})]})]})]})}function h(e){let{city:r,onClose:t,onSave:n}=e,[o,i]=(0,l.useState)(r.name),[s,c]=(0,l.useState)(String(r.lat)),[d,u]=(0,l.useState)(String(r.lon)),[x,p]=(0,l.useState)(null),m=(0,l.useRef)(null),b=(0,l.useRef)(null),v=(0,l.useRef)(null),g=(0,l.useRef)(null),f=(0,l.useRef)("edit-city-desc-".concat(r.id));return(0,l.useEffect)(()=>{var e;return g.current=document.activeElement,null==(e=v.current)||e.focus(),()=>{var e;return null==(e=g.current)?void 0:e.focus()}},[]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(e.preventDefault(),t())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t]),(0,l.useEffect)(()=>{let e=e=>{if("Tab"!==e.key)return;let r=b.current;if(!r)return;let t=r.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return;let a=t[0],l=t[t.length-1],n=document.activeElement;e.shiftKey&&n===a?(e.preventDefault(),l.focus()):e.shiftKey||n!==l||(e.preventDefault(),a.focus())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,a.jsx)("div",{ref:m,className:"fixed inset-0 z-40 flex items-center justify-center bg-black/70 p-4",onClick:e=>{e.target===m.current&&t()},children:(0,a.jsxs)("div",{role:"dialog","aria-modal":"true","aria-labelledby":"edit-city-title","aria-describedby":f.current,ref:b,className:"w-full max-w-md rounded border border-[color:var(--kali-panel-border)] bg-[color:var(--kali-panel)] p-4 text-[color:var(--kali-text)]",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,a.jsx)("div",{id:"edit-city-title",className:"text-lg font-semibold",children:"Edit city"}),(0,a.jsx)("button",{type:"button",onClick:t,className:"rounded px-2 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)] hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)]",children:"Close"})]}),(0,a.jsx)("p",{id:f.current,className:"text-xs text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Update the city name or coordinates. Changes to coordinates will refresh cached data."}),(0,a.jsxs)("form",{className:"space-y-3",onSubmit:e=>{e.preventDefault();let r=Number.parseFloat(s),t=Number.parseFloat(d);return o.trim()?Number.isNaN(r)||Number.isNaN(t)?void p("Latitude and longitude must be valid numbers."):void(p(null),n({name:o.trim(),lat:r,lon:t})):void p("City name is required.")},children:[(0,a.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,a.jsx)("span",{className:"text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Name"}),(0,a.jsx)("input",{ref:v,value:o,onChange:e=>i(e.target.value),className:"w-full rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)]"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,a.jsx)("span",{className:"text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Latitude"}),(0,a.jsx)("input",{value:s,onChange:e=>c(e.target.value),className:"w-full rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)]"})]}),(0,a.jsxs)("label",{className:"space-y-1 text-sm",children:[(0,a.jsx)("span",{className:"text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Longitude"}),(0,a.jsx)("input",{value:d,onChange:e=>u(e.target.value),className:"w-full rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)]"})]})]}),x&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] p-2 text-xs text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:x}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"rounded border border-[color:var(--kali-panel-border)] px-3 py-1 text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",className:"rounded bg-kali-control px-3 py-1 text-xs font-semibold uppercase tracking-wide text-black shadow-[0_0_12px_rgba(15,148,210,0.35)]",children:"Save"})]})]})]})})}function y(){var e;let[r,t]=(0,n.default)("weather-cities",[],c),[o,i]=(0,n.default)("weather-city-groups",[],u),[s,d]=(0,n.default)("weather-current-group",null,x),{allowNetwork:p}=(0,b.useSettings)(),[m,y]=(0,l.useState)(""),[k,_]=(0,l.useState)(""),[w,j]=(0,l.useState)([]),[N,S]=(0,l.useState)("idle"),[E,C]=(0,l.useState)(null),[R,A]=(0,l.useState)("idle"),[D,M]=(0,l.useState)(null),[L,z]=(0,l.useState)(!1),[F,U]=(0,l.useState)(""),[T,W]=(0,l.useState)(""),[H,P]=(0,l.useState)(""),[I,O]=(0,l.useState)(null),[G,K]=(0,l.useState)(null),[Y,Z]=(0,l.useState)("undefined"!=typeof navigator&&!navigator.onLine),[q,B]=(0,l.useState)({}),J=(0,l.useRef)(null),Q=(0,l.useRef)(new Map),V=(0,l.useRef)(null),X=(0,l.useRef)(null),$=(0,l.useRef)(""),ee=(0,l.useMemo)(()=>Object.keys(q).length>0,[q]),er=(0,l.useMemo)(()=>r.map(e=>"".concat(e.id,":").concat(e.lat,":").concat(e.lon)).join("|"),[r]);(0,l.useEffect)(()=>{if(!s)return;let e=o.find(e=>e.name===s);e&&(t(e.cities),m||y(e.name))},[s,m,o,t]),(0,l.useEffect)(()=>{let e=()=>Z(!1),r=()=>Z(!0);return window.addEventListener("online",e),window.addEventListener("offline",r),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}},[]),(0,l.useEffect)(()=>{Q.current.forEach(e=>e.abort()),Q.current.clear()},[er]),(0,l.useEffect)(()=>()=>{Q.current.forEach(e=>e.abort()),Q.current.clear()},[]),(0,l.useEffect)(()=>()=>{var e;null==(e=V.current)||e.abort()},[]);let et=(0,l.useCallback)((e,r)=>{t(t=>t.map(t=>t.id===e?{...t,...r}:t))},[t]),ea=(0,l.useCallback)(async function(e){let{force:r=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=Date.now(),a=e.lastReading&&t-e.lastReading.time<6e5;if(!r&&a&&!e.lastReadingStale)return;let l=Q.current.get(e.id);l&&l.abort();let n=new AbortController;Q.current.set(e.id,n),B(r=>({...r,[e.id]:!0})),et(e.id,{lastError:void 0});try{var o,i,s,c,d,u,x,m;let t=p?r&&!Y?"network-first":"cache-first":"cache-only",a=await (0,v.fetchWeather)("openMeteo",{lat:e.lat,lon:e.lon,timezone:null!=(c=e.timezone)?c:"auto",hourly:"apparent_temperature",daily:"weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset",forecast_days:5,signal:n.signal,strategy:t,allowNetwork:p,revalidate:p&&!Y&&!r,ttl:6e5});if(Q.current.get(e.id)!==n)return;let l=null!=(d=null==a?void 0:a.data)?d:a,b=null!=(u=null==l?void 0:l.current_weather)?u:{},g=null!=(x=null==a||null==(o=a.meta)?void 0:o.timestamp)?x:Date.now(),f="number"==typeof b.temperature&&"number"==typeof b.weathercode?{temp:b.temperature,condition:b.weathercode,time:g}:e.lastReading,h=Array.isArray(null==l||null==(i=l.daily)?void 0:i.time)?l.daily.time.reduce((e,r,t)=>{var a,n;let o=null==(a=l.daily.temperature_2m_max)?void 0:a[t],i=null==(n=l.daily.weathercode)?void 0:n[t];return"number"==typeof o&&"number"==typeof i&&e.push({date:r,temp:o,condition:i}),e},[]):[];et(e.id,{lastReading:f,lastReadingStale:!!(null==a||null==(s=a.meta)?void 0:s.stale),forecast:h.length?h:e.forecast,timezone:null!=(m=null==l?void 0:l.timezone)?m:e.timezone,lastError:void 0}),(null==a?void 0:a.revalidate)&&a.revalidate.then(r=>{var t,a,l,o,i,s;if(!r||Q.current.get(e.id)!==n)return;let c=r.data,d=null!=(o=null==c?void 0:c.current_weather)?o:{},u="number"==typeof d.temperature&&"number"==typeof d.weathercode?{temp:d.temperature,condition:d.weathercode,time:null!=(i=null==(t=r.meta)?void 0:t.timestamp)?i:Date.now()}:e.lastReading,x=Array.isArray(null==c||null==(a=c.daily)?void 0:a.time)?c.daily.time.reduce((e,r,t)=>{var a,l;let n=null==(a=c.daily.temperature_2m_max)?void 0:a[t],o=null==(l=c.daily.weathercode)?void 0:l[t];return"number"==typeof n&&"number"==typeof o&&e.push({date:r,temp:n,condition:o}),e},[]):[];et(e.id,{lastReading:u,lastReadingStale:!!(null==(l=r.meta)?void 0:l.stale),forecast:x.length?x:e.forecast,timezone:null!=(s=null==c?void 0:c.timezone)?s:e.timezone,lastError:void 0})})}catch(r){if(n.signal.aborted)return;if(r instanceof v.WeatherFetchError){let t="network-disabled"===r.type?"Network access is disabled in Settings.":"offline"===r.type?"You are offline.":r.message;et(e.id,{lastError:t})}else et(e.id,{lastError:r instanceof Error?r.message:"Unable to update this city right now."})}finally{Q.current.get(e.id)===n&&(Q.current.delete(e.id),B(r=>{let t={...r};return delete t[e.id],t}))}},[p,Y,et]);(0,l.useEffect)(()=>(r.forEach(e=>{(!e.lastReading||Date.now()-e.lastReading.time>6e5||e.lastReadingStale)&&ea(e)}),()=>{Q.current.forEach(e=>e.abort()),Q.current.clear()}),[r,ea]);let el=(0,l.useCallback)(e=>{t(r=>r.some(r=>r.id===e.id)?r:[...r,e])},[t]),en=(0,l.useCallback)(async function(e){var r,t;let{immediate:a=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=e.trim();if(!l)return;let n=p?Y?"cache-first":"network-first":"cache-only";if(!p&&"cache-only"===n&&!a){C("Network access is disabled in Settings."),S("error");return}null==(r=V.current)||r.abort();let o=new AbortController;V.current=o,S("loading"),C(null);try{let e=await (0,v.fetchWeather)("openMeteoGeo",{name:l,count:6,language:"en",format:"json",signal:o.signal,allowNetwork:p,strategy:n});if(V.current!==o)return;let r=null!=(t=null==e?void 0:e.data)?t:e,a=Array.isArray(null==r?void 0:r.results)?r.results:[],i=new Set,s=a.filter(e=>"string"==typeof(null==e?void 0:e.name)&&"number"==typeof(null==e?void 0:e.latitude)&&"number"==typeof(null==e?void 0:e.longitude)).filter(e=>{let r="".concat(e.name,"-").concat(e.latitude,"-").concat(e.longitude);return!i.has(r)&&(i.add(r),!0)}).slice(0,6);j(s),S("idle")}catch(e){if(o.signal.aborted)return;S("error"),e instanceof v.WeatherFetchError?C("network-disabled"===e.type?"Network access is disabled in Settings.":"offline"===e.type?"You are offline. Connect to fetch city suggestions.":e.message):C(e instanceof Error?e.message:"Unable to find matching cities.")}},[p,Y]);(0,l.useEffect)(()=>{if(!k.trim()){j([]),S("idle"),C(null),$.current="",null!==X.current&&(window.clearTimeout(X.current),X.current=null);return}return null!==X.current&&window.clearTimeout(X.current),X.current=window.setTimeout(()=>{$.current!==k.trim()&&($.current=k.trim(),en(k))},350),()=>{null!==X.current&&(window.clearTimeout(X.current),X.current=null)}},[k,en]);let eo=()=>{J.current=null},ei=I&&null!=(e=r.find(e=>e.id===I))?e:null;return(0,l.useEffect)(()=>{I&&!ei&&O(null)},[ei,I]),(0,a.jsxs)("div",{className:"flex h-full flex-col bg-[color:var(--kali-panel)] text-[color:var(--kali-text)]",children:[(0,a.jsxs)("header",{className:"sticky top-0 z-10 space-y-4 border-b border-[color:var(--kali-panel-border)] bg-[color:var(--kali-panel)] p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Weather"}),(0,a.jsx)("div",{className:"text-xs uppercase tracking-wider text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Kali desktop forecast center"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>r.forEach(e=>ea(e,{force:!0})),disabled:0===r.length||ee,className:"rounded bg-kali-control px-3 py-1 text-xs font-semibold uppercase tracking-wide text-black shadow-[0_0_12px_rgba(15,148,210,0.35)] transition disabled:cursor-not-allowed disabled:opacity-50",children:ee?"Refreshing…":"Refresh all"})]}),!p&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] p-2 text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Network access is disabled in Settings. Showing cached data when available."}),p&&Y&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] p-2 text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"You are offline. Showing cached data when available."}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("input",{className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)] placeholder:text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)] focus:outline-none focus:ring-2 focus:ring-kali-control/60",placeholder:"Group",value:m,"aria-label":"Group name",onChange:e=>y(e.target.value)}),(0,a.jsx)("button",{className:"rounded bg-kali-control px-3 py-1 text-sm font-medium text-black shadow-[0_0_12px_rgba(15,148,210,0.35)] transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-panel)] hover:bg-kali-control/90",onClick:()=>{if(!m.trim())return;let e=o.findIndex(e=>e.name===m.trim()),t=[...o],a={name:m.trim(),cities:r};e>=0?t[e]=a:t.push(a),i(t),d(m.trim())},children:"Save Group"}),o.map(e=>(0,a.jsx)("button",{className:"rounded px-3 py-1 text-sm font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-panel)] ".concat(s===e.name?"bg-kali-control text-black shadow-[0_0_12px_rgba(15,148,210,0.35)]":"bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] text-[color:color-mix(in_srgb,var(--kali-text)_85%,transparent)] hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)]"),onClick:()=>(e=>{let r=o.find(r=>r.name===e);r&&(t(r.cities),d(e),y(e))})(e.name),children:e.name},e.name))]}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),k.trim()&&en(k,{immediate:!0})},className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,a.jsx)("input",{className:"flex-1 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)] placeholder:text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)] focus:outline-none focus:ring-2 focus:ring-kali-control/60",placeholder:"Search city",value:k,"aria-label":"Search city",onChange:e=>_(e.target.value)}),(0,a.jsx)("button",{type:"submit",className:"rounded bg-kali-control px-3 py-1 text-sm font-medium text-black shadow-[0_0_12px_rgba(15,148,210,0.35)] transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-panel)] hover:bg-kali-control/90 disabled:opacity-60",disabled:!k.trim(),children:"Search"}),(0,a.jsx)("button",{type:"button",onClick:()=>{if("undefined"==typeof navigator||!navigator.geolocation){A("error"),M("Geolocation is not supported in this browser.");return}A("loading"),M(null),navigator.geolocation.getCurrentPosition(e=>{let r={id:"my-location",name:"My location",lat:Number(e.coords.latitude.toFixed(4)),lon:Number(e.coords.longitude.toFixed(4))};t(e=>{let t=e.findIndex(e=>"my-location"===e.id);if(t>=0){let a=[...e];return a[t]={...a[t],...r},a}return[...e,r]}),ea(r,{force:!0}),A("idle")},e=>{A("error"),e.code===e.PERMISSION_DENIED?M("Location permission was denied."):e.code===e.TIMEOUT?M("Location request timed out."):M("Unable to access your location.")},{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e5})},disabled:"loading"===R,className:"rounded border border-[color:var(--kali-panel-border)] px-3 py-1 text-sm font-medium text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60 disabled:cursor-not-allowed disabled:opacity-60","aria-label":"Use my location",children:"loading"===R?"Locating…":"Use my location"}),(0,a.jsx)("button",{type:"button",onClick:()=>z(e=>!e),className:"rounded border border-[color:var(--kali-panel-border)] px-3 py-1 text-sm font-medium text-[color:color-mix(in_srgb,var(--kali-text)_75%,transparent)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)]",children:L?"Hide advanced":"Advanced"})]}),"loading"===N&&(0,a.jsx)("div",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Searching for cities…"}),E&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] p-2 text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:E}),D&&(0,a.jsx)("div",{className:"rounded border border-[color:color-mix(in_srgb,var(--kali-panel-border)_60%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] p-2 text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:D}),w.length>0&&(0,a.jsx)("div",{className:"grid gap-2 sm:grid-cols-2",children:w.map(e=>{let r=[e.name,e.admin1,e.country_code].filter(e=>"string"==typeof e).map(e=>e.trim()).filter(e=>e.length>0).join(", ");return(0,a.jsxs)("button",{type:"button",onClick:()=>{el({id:"geo:".concat(e.latitude,":").concat(e.longitude),name:r,lat:e.latitude,lon:e.longitude,region:e.admin1,countryCode:e.country_code,timezone:e.timezone})},className:"flex items-center justify-between rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] px-3 py-2 text-left text-sm text-[color:var(--kali-text)] transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold",children:r}),(0,a.jsxs)("div",{className:"text-xs text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:[e.latitude.toFixed(2),", ",e.longitude.toFixed(2)]})]}),(0,a.jsx)("span",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Add"})]},"".concat(e.latitude,"-").concat(e.longitude))})}),L&&(0,a.jsxs)("div",{className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] p-3",children:[(0,a.jsx)("div",{className:"mb-2 text-xs uppercase tracking-wider text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Advanced manual entry"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)("input",{className:"min-w-[180px] flex-1 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)] placeholder:text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)] focus:outline-none focus:ring-2 focus:ring-kali-control/60",placeholder:"Name",value:F,"aria-label":"City name",onChange:e=>U(e.target.value)}),(0,a.jsx)("input",{className:"w-24 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)] placeholder:text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)] focus:outline-none focus:ring-2 focus:ring-kali-control/60",placeholder:"Lat",value:T,"aria-label":"Latitude",onChange:e=>W(e.target.value)}),(0,a.jsx)("input",{className:"w-24 rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,transparent)] px-2 py-1 text-[color:var(--kali-text)] placeholder:text-[color:color-mix(in_srgb,var(--kali-text)_55%,transparent)] focus:outline-none focus:ring-2 focus:ring-kali-control/60",placeholder:"Lon",value:H,"aria-label":"Longitude",onChange:e=>P(e.target.value)}),(0,a.jsx)("button",{type:"button",className:"rounded bg-kali-control px-3 py-1 text-sm font-medium text-black shadow-[0_0_12px_rgba(15,148,210,0.35)] transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-kali-control/60 focus-visible:ring-offset-2 focus-visible:ring-offset-[var(--kali-panel)] hover:bg-kali-control/90",onClick:()=>{let e=Number.parseFloat(T),r=Number.parseFloat(H);!F.trim()||Number.isNaN(e)||Number.isNaN(r)||(el({id:"manual:".concat(e,":").concat(r),name:F.trim(),lat:e,lon:r}),U(""),W(""),P(""))},children:"Add"})]})]})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===r.length?(0,a.jsx)("div",{className:"flex h-full items-center justify-center rounded border border-dashed border-[color:var(--kali-panel-border)] p-8 text-center text-sm text-[color:color-mix(in_srgb,var(--kali-text)_65%,transparent)]",children:"Search for a city above to start building your weather desk."}):(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:r.map((e,l)=>(0,a.jsx)("div",{onDragOver:e=>e.preventDefault(),onDrop:()=>(e=>{let r=J.current;J.current=null,null!==r&&r!==e&&t(t=>{let a=[...t],[l]=a.splice(r,1);return a.splice(e,0,l),a})})(l),className:"rounded border border-[color:var(--kali-panel-border)] bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] p-4 transition hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_94%,transparent)] focus-within:bg-[color:color-mix(in_srgb,var(--kali-panel)_94%,transparent)]",children:(0,a.jsx)(f,{city:e,loading:!!q[e.id],statusLabel:p?Y?"Offline":e.lastReadingStale?"Cached":void 0:"Network disabled",canFetch:!q[e.id],onOpen:()=>O(e.id),onRefresh:()=>ea(e,{force:!0}),onEdit:()=>K(e),onRemove:()=>t(r=>r.filter(r=>r.id!==e.id)),onClearError:()=>et(e.id,{lastError:void 0}),onMoveUp:()=>t(e=>{if(0===l)return e;let r=[...e],[t]=r.splice(l,1);return r.splice(l-1,0,t),r}),onMoveDown:()=>t(e=>{if(l>=e.length-1)return e;let r=[...e],[t]=r.splice(l,1);return r.splice(l+1,0,t),r}),onDragStart:e=>{J.current=l,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","move")},onDragEnd:eo,canMoveUp:l>0,canMoveDown:l<r.length-1})},e.id))})}),ei&&(0,a.jsx)(g,{city:ei,onClose:()=>O(null),onUpdateCity:et}),G&&(0,a.jsx)(h,{city:G,onClose:()=>K(null),onSave:e=>{t(r=>r.map(r=>{if(r.id!==G.id)return r;let t=r.lat!==e.lat||r.lon!==e.lon,a=t?"geo:".concat(e.lat,":").concat(e.lon):r.id;return I===r.id&&O(a),{...r,id:a,name:e.name,lat:e.lat,lon:e.lon,lastReading:t?void 0:r.lastReading,forecast:t?void 0:r.forecast,hourly:t?void 0:r.hourly,lastError:void 0}})),K(null)}})]})}},18040:(e,r,t)=>{t.d(r,{default:()=>n});var a=t(37876);let l={clear:"var(--kali-control)",partly:"color-mix(in_srgb,var(--kali-control)_70%,var(--kali-text))",overcast:"color-mix(in_srgb,var(--kali-text)_85%,transparent)",fog:"color-mix(in_srgb,var(--kali-text)_70%,transparent)",drizzle:"color-mix(in_srgb,var(--kali-control)_60%,var(--kali-text))",rain:"color-mix(in_srgb,var(--kali-control)_75%,var(--kali-text))",snow:"color-mix(in_srgb,var(--kali-text)_90%,white)",thunder:"color-mix(in_srgb,var(--kali-control)_85%,var(--kali-text))"};function n(e){var r;let{code:t,className:n="w-16 h-16",tone:o}=e,i=null!=o?o:0===t?"clear":1===t||2===t?"partly":3===t?"overcast":45===t||48===t?"fog":t>=51&&t<=57?"drizzle":t>=61&&t<=67||t>=80&&t<=82?"rain":t>=71&&t<=77||t>=85&&t<=86?"snow":t>=95?"thunder":"overcast",s={viewBox:"0 0 24 24",className:n,fill:"currentColor","aria-hidden":!0,focusable:"false",style:{color:null!=(r=l[i])?r:"var(--kali-text)"}};return"clear"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"5"}),(0,a.jsxs)("g",{stroke:"currentColor",strokeWidth:"2",fill:"none",children:[(0,a.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"4"}),(0,a.jsx)("line",{x1:"12",y1:"20",x2:"12",y2:"23"}),(0,a.jsx)("line",{x1:"4.22",y1:"4.22",x2:"6.34",y2:"6.34"}),(0,a.jsx)("line",{x1:"17.66",y1:"17.66",x2:"19.78",y2:"19.78"}),(0,a.jsx)("line",{x1:"1",y1:"12",x2:"4",y2:"12"}),(0,a.jsx)("line",{x1:"20",y1:"12",x2:"23",y2:"12"}),(0,a.jsx)("line",{x1:"4.22",y1:"19.78",x2:"6.34",y2:"17.66"}),(0,a.jsx)("line",{x1:"17.66",y1:"6.34",x2:"19.78",y2:"4.22"})]})]}):"drizzle"===i||"rain"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("path",{d:"M7 16a5 5 0 1 1 10 0H7Z"}),(0,a.jsxs)("g",{stroke:"currentColor",strokeWidth:"2",fill:"none",strokeLinecap:"round",children:[(0,a.jsx)("line",{x1:"9",y1:"18.5",x2:"9",y2:"22"}),(0,a.jsx)("line",{x1:"12",y1:"18.5",x2:"12",y2:"22"}),(0,a.jsx)("line",{x1:"15",y1:"18.5",x2:"15",y2:"22"})]})]}):"snow"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("path",{d:"M12 2v20M2 12h20",stroke:"currentColor",strokeWidth:"2"}),(0,a.jsx)("path",{d:"M5 5l14 14M19 5L5 19",stroke:"currentColor",strokeWidth:"2"})]}):"thunder"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("path",{d:"M7 14a5 5 0 1 1 10 0H7Z"}),(0,a.jsx)("polygon",{points:"13 14 9 21 13 21 11 24 15 17 11 17 13 14"})]}):"fog"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("path",{d:"M5 14a7 7 0 0 1 14 0H5Z"}),(0,a.jsxs)("g",{stroke:"currentColor",strokeWidth:"1.5",fill:"none",children:[(0,a.jsx)("line",{x1:"4",y1:"18",x2:"20",y2:"18"}),(0,a.jsx)("line",{x1:"6",y1:"21",x2:"18",y2:"21"})]})]}):"partly"===i?(0,a.jsxs)("svg",{...s,children:[(0,a.jsx)("circle",{cx:"8",cy:"9",r:"4"}),(0,a.jsx)("path",{d:"M8 17a5 5 0 1 1 10 0H8Z"})]}):(0,a.jsx)("svg",{...s,children:(0,a.jsx)("path",{d:"M5 16a7 7 0 0 1 14 0H5Z"})})}}}]);