(()=>{"use strict";let e=(e,t,s,l)=>{let r=e[s],a=t.filter(e=>e.offset!==s),f="string"==typeof l?l.trim().slice(0,2).toLowerCase():"";return void 0!==r&&/^[0-9a-f]{2}$/i.test(f)&&r.toLowerCase()!==f&&a.push({offset:s,original:r,value:f}),a},t=!1,s=[],l=[],r=[],a=[],f=(e,t)=>e.length===t.length&&e.every((e,s)=>e.offset===t[s].offset&&e.value===t[s].value&&e.original===t[s].original),i=()=>{postMessage({type:"bytes",bytes:((e,t)=>{let s=[...e];return t.forEach(e=>{let{offset:t,value:l}=e;t>=0&&t<s.length&&(s[t]=l)}),s})(s,l),patches:l,canUndo:r.length>0,canRedo:a.length>0})};self.onmessage=p=>{let o=p.data||{};if("pause"===o.type){t=!0;return}if("resume"===o.type){t=!1;return}if(!t)if("hex"===o.type)s=(o.hex||"").replace(/[^0-9a-fA-F]/g,"").match(/.{1,2}/g)||[],l=[],r=[],a=[],i();else if("patch"===o.type){let{offset:t,value:p}=o,y=e(s,l,t,p);f(y,l)||(r=[...r,l],l=y,a=[]),i()}else if("revert"===o.type){let e=l.filter(e=>e.offset!==o.offset);f(e,l)||(r=[...r,l],l=e,a=[]),i()}else if("clear"===o.type)l.length>0&&(r=[...r,l],l=[],a=[]),i();else if("load"===o.type)l=(Array.isArray(o.patches)?o.patches:[]).reduce((t,l)=>e(s,t,l.offset,l.value),[]),r=[],a=[],i();else if("import"===o.type){let t=(Array.isArray(o.patches)?o.patches:[]).reduce((t,l)=>e(s,t,l.offset,l.value),[]);f(t,l)||(r=[...r,l],l=t,a=[]),i()}else if("undo"===o.type){let e=r[r.length-1];e&&(r=r.slice(0,-1),a=[l,...a],l=e,i())}else if("redo"===o.type){let e=a[0];e&&(a=a.slice(1),r=[...r,l],l=e,i())}else"export"===o.type&&postMessage({type:"export",patches:l})}})(),_N_E={};