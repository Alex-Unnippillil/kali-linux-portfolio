(()=>{"use strict";let e=(e,t)=>{for(let r=5;r>=0;r--)if(!e[r][t])return r;return -1},t=(e,t)=>{let r=[{dr:0,dc:1},{dr:1,dc:0},{dr:1,dc:1},{dr:1,dc:-1}];for(let l=0;l<6;l++)for(let o=0;o<7;o++)if(e[l][o]===t)for(let{dr:f,dc:n}of r){let r=0;for(let a=0;a<4;a++){let c=l+f*a,s=o+n*a;if(c<0||c>=6||s<0||s>=7||e[c][s]!==t)break;r++}if(4===r)return!0}return!1},r=(e,t)=>{let r="red"===t?"yellow":"red",l=0,o=e.filter(e=>e===t).length,f=e.filter(e=>e===r).length,n=e.filter(e=>null===e).length;return 4===o?l+=100:3===o&&1===n?l+=5:2===o&&2===n&&(l+=2),3===f&&1===n&&(l-=4),l},l=e=>{let t=[];for(let r=0;r<7;r++)e[0][r]||t.push(r);return t},o=e=>{let t=Math.floor(3.5);return[...e].sort((e,r)=>Math.abs(e-t)-Math.abs(r-t)||e-r)},f=function(n,a,c,s,u){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Map,d="".concat(u?"M":"m",":").concat(a,":").concat(n.map(e=>e.map(e=>"red"===e?"r":"yellow"===e?"y":"_").join("")).join("|")),h=i.get(d);if(h&&h.depth>=a)return{column:h.column,score:h.score};let m=l(n),p=t(n,"red")||t(n,"yellow")||0===m.length;if(0===a||p){let e=((e,t)=>{let l,o=Math.floor(3.5);l=0+3*e.map(e=>e[o]).filter(e=>e===t).length;for(let o=0;o<6;o++)for(let f=0;f<4;f++)l+=r(e[o].slice(f,f+4),t);for(let o=0;o<7;o++)for(let f=0;f<3;f++)l+=r([e[f][o],e[f+1][o],e[f+2][o],e[f+3][o]],t);for(let o=0;o<3;o++)for(let f=0;f<4;f++)l+=r([e[o][f],e[o+1][f+1],e[o+2][f+2],e[o+3][f+3]],t);for(let o=3;o<6;o++)for(let f=0;f<4;f++)l+=r([e[o][f],e[o-1][f+1],e[o-2][f+2],e[o-3][f+3]],t);return l})(n,"red");return t(n,"red")&&(e=1e6),t(n,"yellow")&&(e=-1e6),i.set(d,{depth:a,score:e}),{score:e}}if(u){let t=-1/0,r=m[0];for(let l of o(m)){let o=e(n,l),u=n.map(e=>[...e]);u[o][l]="red";let d=f(u,a-1,c,s,!1,i).score;if(d>t&&(t=d,r=l),(c=Math.max(c,t))>=s)break}let l={column:r,score:t};return i.set(d,{depth:a,score:t,column:r}),l}let M=1/0,g=m[0];for(let t of o(m)){let r=e(n,t),l=n.map(e=>[...e]);l[r][t]="yellow";let o=f(l,a-1,c,s,!0,i).score;if(o<M&&(M=o,g=t),c>=(s=Math.min(s,M)))break}let y={column:g,score:M};return i.set(d,{depth:a,score:M,column:g}),y};onmessage=t=>{let{taskId:r,board:n,depth:a,player:c}=t.data||{};if(!n||"number"!=typeof a||!c)return;let{column:s,scores:u}=((t,r,n)=>{var a;let c=o(l(t)),s=Array(7).fill(null),u=null!=(a=c[0])?a:0,i="red"===n?-1/0:1/0,d=new Map;for(let l of c){let o=e(t,l),a=t.map(e=>[...e]);a[o][l]=n;let c=f(a,r-1,-1/0,1/0,"yellow"===n,d).score;s[l]=c,"red"===n?c>i&&(i=c,u=l):c<i&&(i=c,u=l)}return{column:u,scores:s}})(n,a,c);postMessage({taskId:r,column:s,scores:u})}})(),_N_E={};