"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3175],{33175:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var s=r(37876),o=r(14232),i=r(88362),l=r.n(i);class a{setCheckpoint(e){this.checkpoint={...e}}addCoin(){return this.coins++,this.coins}getRespawnPoint(){return this.checkpoint?{...this.checkpoint}:{...this.spawn}}respawnIfOutOfBounds(e,t){return e.y>t?this.getRespawnPoint():e}constructor(e){this.coins=0,this.spawn={...e}}}var n=r(33840),c=r(90209);let u=e=>{let{getDailySeed:t}=e,r=(0,o.useRef)(null),i=(0,o.useRef)(null),u=(0,c.default)(),d=(0,o.useRef)(u);(0,o.useEffect)(()=>{if(d.current=u,!i.current)return;let e=i.current.scene.getScene("level");u?(e.scene.pause(),e.matter.world.pause()):(e.scene.resume(),e.matter.world.resume())},[u]);let h=(0,o.useRef)({left:!1,right:!1,jumpHeld:!1,jumpPressed:!1}),[f,p]=(0,n.default)("phaser-keys",{left:"ArrowLeft",right:"ArrowRight",jump:"Space"}),[m,b]=(0,n.default)("phaser-pad",{left:14,right:15,jump:0}),[v,g]=(0,n.default)("phaser-buffer",100),x=(0,o.useRef)(v);(0,o.useEffect)(()=>{x.current=v},[v]);let y=(0,o.useRef)(f);(0,o.useEffect)(()=>{y.current=f},[f]);let w=(0,o.useRef)(m);(0,o.useEffect)(()=>{w.current=m},[m]);let[k,j]=(0,o.useState)(null),E=[{action:"left",label:"Left"},{action:"right",label:"Right"},{action:"jump",label:"Jump"}];(0,o.useEffect)(()=>{var e;null==(e=r.current)||e.focus()},[]),(0,o.useEffect)(()=>{if(!r.current)return;let e=r.current,t=e=>{if((null==k?void 0:k.device)==="key"&&"keydown"===e.type){p(t=>({...t,[k.action]:e.code})),j(null);return}let t="keydown"===e.type,r=Object.keys(y.current).find(t=>y.current[t]===e.code);r&&("jump"===r?(t&&!h.current.jumpHeld&&(h.current.jumpPressed=!0),h.current.jumpHeld=t):h.current[r]=t)};return e.addEventListener("keydown",t),e.addEventListener("keyup",t),()=>{e.removeEventListener("keydown",t),e.removeEventListener("keyup",t)}},[k,p]),(0,o.useEffect)(()=>{if(!k||"pad"!==k.device)return;let e=setInterval(()=>{for(let e of navigator.getGamepads?navigator.getGamepads():[])if(e){for(let t=0;t<e.buttons.length;t++)if(e.buttons[t].pressed){b(e=>({...e,[k.action]:t})),j(null);return}}},100);return()=>clearInterval(e)},[k,b]),(0,o.useEffect)(()=>{if(!r.current)return;class e extends l().Scene{preload(){this.load.json("level","apps/phaser_matter/level1.json"),this.load.image("player","apps/phaser_matter/player.svg")}create(){var e,t;let r=this.cache.json.get("level");this.gameState=new a(r.spawn),null==(e=r.parallaxLayers)||e.forEach(e=>{let t=l().Display.Color.HexStringToColor(e.color).color,s=this.add.rectangle(r.bounds.width/2,r.bounds.height/2,r.bounds.width,r.bounds.height,t).setScrollFactor(e.scrollFactor).setDepth(-100);this.parallax.push(s)}),r.platforms.forEach(e=>{this.matter.add.rectangle(e.x,e.y,e.width,e.height,{isStatic:!0,collisionFilter:{category:2,mask:1}})}),r.hazards.forEach(e=>{this.matter.add.rectangle(e.x,e.y,e.width,e.height,{isStatic:!0,label:"hazard",collisionFilter:{category:4,mask:1}})}),null==(t=r.coins)||t.forEach(e=>{let t=this.matter.add.rectangle(e.x,e.y,e.width,e.height,{isStatic:!0,isSensor:!0,label:"coin",collisionFilter:{category:4,mask:1}}),r=this.add.rectangle(e.x,e.y,e.width,e.height,0xffd700).setOrigin(.5);this.coins.push({body:t,sprite:r})}),r.checkpoints.forEach(e=>{let t=this.matter.add.rectangle(e.x,e.y,e.width,e.height,{isStatic:!0,isSensor:!0,label:"checkpoint",collisionFilter:{category:4,mask:1}}),r=this.add.rectangle(e.x,e.y-e.height/2,10,30,0xff0000).setOrigin(.5,1);this.checkpointFlags.push({body:t,flag:r})}),this.player=this.matter.add.image(r.spawn.x,r.spawn.y,"player",void 0,{shape:{type:"rectangle",width:32,height:32},collisionFilter:{category:1,mask:6}}),this.coinText=this.add.text(16,16,"Coins: 0",{color:"#ffffff"}).setScrollFactor(0),this.cameras.main.setBounds(0,0,r.bounds.width,r.bounds.height),this.cameras.main.setDeadzone(r.bounds.deadZoneWidth,r.bounds.deadZoneHeight),this.cameras.main.startFollow(this.player);let s=new Set(["checkpoint","hazard","coin"]);this.matter.world.on("collisionstart",(e,t,r)=>{if(!s.has(t.label)&&!s.has(r.label))return;let o=performance.now();[t,r].forEach(e=>{if("checkpoint"===e.label){let t=this.checkpointFlags.find(t=>t.body===e);t&&t.flag.setFillStyle(65280),this.gameState.setCheckpoint({x:e.position.x,y:e.position.y})}if("hazard"===e.label){let e=this.gameState.getRespawnPoint();this.player.setPosition(e.x,e.y),this.player.setVelocity(0,0)}if("coin"===e.label){let t=this.coins.findIndex(t=>t.body===e);if(t>=0){let[r]=this.coins.splice(t,1);r.sprite.destroy(),this.matter.world.remove(e);let s=this.gameState.addCoin();this.coinText.setText("Coins: ".concat(s))}}});let i=performance.now()-o,l=this.matter.world.engine.world.bodies.length;(l>200||i>1)&&console.debug("collision handler: ".concat(i.toFixed(2),"ms with ").concat(l," bodies"))})}update(e,t){let r=h.current,s=Math.min(t,1e3/60),o=this.input.gamepad;if(o&&o.total>0){var i,l,a;let e=o.getPad(0),t=w.current;r.left=null==(i=e.buttons[t.left])?void 0:i.pressed,r.right=null==(l=e.buttons[t.right])?void 0:l.pressed;let s=null==(a=e.buttons[t.jump])?void 0:a.pressed;s&&!this.padJumpWasPressed?(r.jumpPressed=!0,r.jumpHeld=!0):s||(r.jumpHeld=!1),this.padJumpWasPressed=s}r.left?this.player.setVelocityX(-5):r.right?this.player.setVelocityX(5):this.player.setVelocityX(0);let n=.01>Math.abs(this.player.body.velocity.y);if(n&&(this.lastGrounded=e),r.jumpPressed){this.jumpBufferTimer=x.current;let t=n||e-this.lastGrounded<this.coyoteTime;this.buffered=!t,r.jumpPressed=!1,t&&(this.player.setVelocityY(-10),r.jumpHeld=!1,this.buffered=!1)}this.jumpBufferTimer>0&&(this.jumpBufferTimer-=s),(n||e-this.lastGrounded<this.coyoteTime)&&this.jumpBufferTimer>0&&(this.player.setVelocityY(-10),this.jumpBufferTimer=0,r.jumpHeld=!1,this.buffered&&(this.player.setTintFill(0xffff00),this.time.delayedCall(100,()=>this.player.clearTint())),this.buffered=!1);let c=this.cache.json.get("level"),u=this.gameState.respawnIfOutOfBounds({x:this.player.x,y:this.player.y},c.bounds.fallY);u!==this.player&&(this.player.setPosition(u.x,u.y),this.player.setVelocity(0,0))}constructor(){super("level"),this.lastGrounded=0,this.coyoteTime=100,this.jumpBufferTimer=0,this.buffered=!1,this.padJumpWasPressed=!1,this.parallax=[],this.checkpointFlags=[],this.coins=[]}}let t=new(l()).Game({type:l().AUTO,width:800,height:600,parent:r.current,physics:{default:"matter",matter:{gravity:{y:1},positionIterations:4,velocityIterations:3,constraintIterations:2}},scene:e});i.current=t;let s=()=>{let e=t.scene.getScene("level");"hidden"===document.visibilityState||d.current?(e.scene.pause(),e.matter.world.pause()):(e.scene.resume(),e.matter.world.resume())};return document.addEventListener("visibilitychange",s),window.addEventListener("focus",s),s(),()=>{document.removeEventListener("visibilitychange",s),window.removeEventListener("focus",s),t.destroy(!0),i.current=null}},[]);let S=e=>"jump"===e?{onMouseDown:()=>{h.current.jumpPressed=!0,h.current.jumpHeld=!0},onMouseUp:()=>h.current.jumpHeld=!1,onTouchStart:()=>{h.current.jumpPressed=!0,h.current.jumpHeld=!0},onTouchEnd:()=>h.current.jumpHeld=!1}:{onMouseDown:()=>h.current[e]=!0,onMouseUp:()=>h.current[e]=!1,onTouchStart:()=>h.current[e]=!0,onTouchEnd:()=>h.current[e]=!1};return(0,s.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start",children:[(0,s.jsxs)("div",{ref:r,className:"relative flex-1 min-h-[420px] overflow-hidden rounded-2xl border border-kali-border/80 bg-kali-surface/95 shadow-lg backdrop-blur focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",tabIndex:0,children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 rounded-2xl border border-kali-border/60","aria-hidden":"true"}),(0,s.jsxs)("div",{className:"absolute inset-x-6 bottom-6 flex items-center justify-between gap-4 pointer-events-none",children:[(0,s.jsx)("button",{type:"button","aria-label":"Move left",className:"pointer-events-auto rounded-full border border-[color:var(--kali-border)] bg-kali-surface/85 px-4 py-3 text-xl font-semibold text-[color:var(--kali-text)] shadow transition-colors hover:border-[color:var(--color-control-accent)] hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_22%,var(--kali-surface))] hover:text-[color:var(--color-inverse)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",...S("left"),children:"◀"}),(0,s.jsx)("button",{type:"button","aria-label":"Move right",className:"pointer-events-auto rounded-full border border-[color:var(--kali-border)] bg-kali-surface/85 px-4 py-3 text-xl font-semibold text-[color:var(--kali-text)] shadow transition-colors hover:border-[color:var(--color-control-accent)] hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_22%,var(--kali-surface))] hover:text-[color:var(--color-inverse)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",...S("right"),children:"▶"}),(0,s.jsx)("button",{type:"button","aria-label":"Jump",className:"pointer-events-auto rounded-full border border-[color:var(--kali-border)] bg-kali-surface/85 px-4 py-3 text-xl font-semibold text-[color:var(--kali-text)] shadow transition-colors hover:border-[color:var(--color-control-accent)] hover:bg-[color:color-mix(in_srgb,var(--color-control-accent)_22%,var(--kali-surface))] hover:text-[color:var(--color-inverse)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",...S("jump"),children:"⇧"})]})]}),(0,s.jsxs)("aside",{className:"w-full space-y-4 rounded-2xl border border-kali-border/80 bg-kali-surface/95 p-4 text-sm leading-relaxed text-white shadow-lg backdrop-blur lg:w-72",children:[k&&(0,s.jsxs)("div",{className:"rounded-lg border border-kali-control/50 bg-kali-control/10 px-3 py-2 text-xs font-semibold uppercase tracking-wide text-kali-control",children:["Press a ","key"===k.device?"key":"button","..."]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-kali-control/80",children:"Keyboard"}),(0,s.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("button",{type:"button",onClick:()=>j({device:"key",action:e.action}),className:"rounded-md border border-kali-border/70 bg-kali-background/40 px-2 py-1 text-xs font-medium text-white transition hover:border-kali-control hover:text-kali-control focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",children:f[e.action]})]},"key-".concat(e.action)))})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-kali-control/80",children:"Gamepad"}),(0,s.jsx)("div",{className:"space-y-2",children:E.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("button",{type:"button",onClick:()=>j({device:"pad",action:e.action}),className:"rounded-md border border-kali-border/70 bg-kali-background/40 px-2 py-1 text-xs font-medium text-white transition hover:border-kali-control hover:text-kali-control focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-focus-ring)]",children:m[e.action]})]},"pad-".concat(e.action)))})]}),(0,s.jsxs)("section",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-sm font-semibold uppercase tracking-wide text-kali-control/80",children:"Jump Buffer"}),(0,s.jsxs)("label",{htmlFor:"jump-buffer",className:"block space-y-2 text-xs text-white/70",children:[(0,s.jsx)("span",{children:"Control how long a jump input remains buffered after pressing the button."}),(0,s.jsx)("input",{id:"jump-buffer",type:"range",min:0,max:300,value:v,onChange:e=>g(Number(e.target.value)),"aria-label":"Jump buffer window",className:"w-full accent-kali-control"})]}),(0,s.jsxs)("div",{className:"text-right text-xs font-semibold text-kali-control",children:[v,"ms"]})]})]})]})}},33840:(e,t,r)=>{r.d(t,{default:()=>o});var s=r(14232);function o(e,t){let[r,o]=(0,s.useState)(()=>{try{let r=window.localStorage.getItem(e);return r?JSON.parse(r):t}catch(e){return t}});return(0,s.useEffect)(()=>{try{window.localStorage.setItem(e,JSON.stringify(r))}catch(e){}},[e,r]),[r,o]}},90209:(e,t,r)=>{r.d(t,{default:()=>i});var s=r(14232),o=r(74273);function i(){let{reducedMotion:e}=(0,o.useSettings)(),[t,r]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=()=>r(e.matches);return(t(),"function"==typeof e.addEventListener)?(e.addEventListener("change",t),()=>e.removeEventListener("change",t)):(e.addListener(t),()=>e.removeListener(t))},[]),e||t}}}]);