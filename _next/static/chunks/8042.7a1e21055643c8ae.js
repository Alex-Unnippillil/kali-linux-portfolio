"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8042],{68042:(e,r,t)=>{t.r(r),t.d(r,{default:()=>a});var l=t(37876),o=t(14232);function a(){let[e,r]=(0,o.useState)([]),[t,a]=(0,o.useState)(()=>{try{return JSON.parse(localStorage.getItem("installedPlugins")||"{}")}catch(e){return{}}}),[s,i]=(0,o.useState)(()=>{try{let e=JSON.parse(localStorage.getItem("lastPluginRun")||"null");if(!e)return null;let r={id:e.id,output:Array.isArray(e.output)?e.output:[],timestamp:"string"==typeof e.timestamp?e.timestamp:new Date().toISOString(),error:!!e.error};if("string"!=typeof e.timestamp)try{localStorage.setItem("lastPluginRun",JSON.stringify(r))}catch(e){}return r}catch(e){return null}});(0,o.useEffect)(()=>{fetch("/api/plugins").then(e=>e.json()).then(r).catch(()=>r([]))},[]);let n=async e=>{let r=await fetch("/api/plugins/".concat(e.file)),l=await r.json(),o={...t,[e.id]:l};a(o),localStorage.setItem("installedPlugins",JSON.stringify(o))},[c,d]=(0,o.useState)("all"),[x,u]=(0,o.useState)("alpha"),m=e.filter(e=>{let r=void 0!==t[e.id];return"installed"===c?r:"available"!==c||!r}).sort((e,r)=>"size"===x?e.size-r.size:e.id.localeCompare(r.id));return(0,l.jsxs)("div",{className:"p-4 text-[color:var(--color-text)]",children:[(0,l.jsxs)("div",{className:"mb-6 flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"mb-1 text-2xl font-semibold",children:"Plugin Catalog"}),(0,l.jsx)("p",{className:"text-sm text-[color:color-mix(in_srgb,var(--color-text)_70%,transparent)]",children:"Discover sandboxed utilities and keep installed plugins up to date."})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4",role:"group","aria-label":"Plugin filters",children:[(0,l.jsxs)("label",{className:"flex flex-col text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--color-text)_65%,transparent)]",children:["Show",(0,l.jsxs)("select",{className:"mt-1 min-w-[10rem] rounded border border-[color:var(--kali-border)] bg-[var(--kali-panel)] px-3 py-2 text-sm text-[color:var(--color-text)] shadow-sm transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-accent)]",value:c,onChange:e=>d(e.target.value),children:[(0,l.jsx)("option",{value:"all",children:"All plugins"}),(0,l.jsx)("option",{value:"installed",children:"Installed only"}),(0,l.jsx)("option",{value:"available",children:"Available to install"})]})]}),(0,l.jsxs)("label",{className:"flex flex-col text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--color-text)_65%,transparent)]",children:["Sort by",(0,l.jsxs)("select",{className:"mt-1 min-w-[10rem] rounded border border-[color:var(--kali-border)] bg-[var(--kali-panel)] px-3 py-2 text-sm text-[color:var(--color-text)] shadow-sm transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-accent)]",value:x,onChange:e=>u(e.target.value),children:[(0,l.jsx)("option",{value:"alpha",children:"Name (Aâ€“Z)"}),(0,l.jsx)("option",{value:"size",children:"Package size"})]})]})]})]}),(0,l.jsxs)("ul",{className:"grid gap-4","aria-live":"polite",children:[m.map(e=>{let r=void 0!==t[e.id];return(0,l.jsx)("li",{className:"list-none",title:e.description||void 0,children:(0,l.jsxs)("article",{className:"flex flex-col gap-4 rounded-xl border border-[color:var(--kali-border)] bg-[var(--kali-panel)] p-5 shadow-kali-panel transition hover:border-[color:var(--color-accent)] focus-within:border-[color:var(--color-accent)]",children:[(0,l.jsxs)("header",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold leading-tight",children:e.id}),e.description&&(0,l.jsx)("p",{className:"mt-1 text-sm text-[color:color-mix(in_srgb,var(--color-text)_72%,transparent)]",children:e.description})]}),(0,l.jsx)("span",{className:"inline-flex items-center gap-1 self-start rounded-full border px-3 py-1 text-xs font-semibold uppercase tracking-wide ".concat(r?"border-[color:color-mix(in_srgb,var(--color-accent)_55%,transparent)] bg-[color:color-mix(in_srgb,var(--color-accent)_18%,transparent)] text-[color:var(--color-accent)]":"border-[color:var(--kali-border)] bg-[var(--kali-panel-highlight)] text-[color:color-mix(in_srgb,var(--color-text)_75%,transparent)]"),"aria-label":r?"Plugin installed":"Plugin not installed",children:r?"Installed":"Not installed"})]}),(0,l.jsxs)("dl",{className:"grid grid-cols-1 gap-2 text-sm text-[color:color-mix(in_srgb,var(--color-text)_70%,transparent)] sm:grid-cols-2",children:[(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("dt",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--color-text)_55%,transparent)]",children:"Sandbox"}),(0,l.jsxs)("dd",{className:"text-[color:var(--color-text)]",children:["worker"===e.sandbox?"Worker":"Iframe",(0,l.jsx)("span",{className:"sr-only",children:"Sandbox: ".concat("worker"===e.sandbox?"Worker":"Iframe")})]})]}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("dt",{className:"text-xs uppercase tracking-wide text-[color:color-mix(in_srgb,var(--color-text)_55%,transparent)]",children:"Package size"}),(0,l.jsx)("dd",{className:"text-[color:var(--color-text)]",children:(e=>{if(!Number.isFinite(e)||e<=0)return"0 B";let r=["B","KB","MB","GB"],t=Math.min(Math.floor(Math.log(e)/Math.log(1024)),r.length-1),l=e/1024**t;return"".concat(l<10&&t>0?l.toFixed(1):Math.round(l)," ").concat(r[t])})(e.size)})]})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)("button",{className:"rounded-full px-4 py-2 text-sm font-semibold text-kali-inverse transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-accent)] ".concat("bg-kali-accent hover:bg-[color:color-mix(in_srgb,var(--color-accent)_85%,#000000)]"),onClick:()=>n(e),disabled:r,children:r?"Installed":"Install"}),(0,l.jsx)("button",{className:"rounded-full border border-[color:var(--kali-border)] px-4 py-2 text-sm font-semibold text-[color:var(--color-text)] transition hover:border-[color:var(--color-accent)] hover:text-[color:var(--color-accent)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-accent)] disabled:cursor-not-allowed disabled:border-[color:color-mix(in_srgb,var(--kali-border)_70%,transparent)] disabled:text-[color:color-mix(in_srgb,var(--color-text)_45%,transparent)]",onClick:()=>(e=>{let r=t[e.id];if(!r)return;let l=[],o=!1,a=()=>{let r={id:e.id,output:l,timestamp:new Date().toISOString(),error:o};i(r);try{localStorage.setItem("lastPluginRun",JSON.stringify(r))}catch(e){}};if("worker"===r.sandbox){let e=new Blob([r.code],{type:"text/javascript"}),t=URL.createObjectURL(e),s=new Worker(t);s.onmessage=e=>{l.push(String(e.data))},s.onerror=()=>{l.push("error"),o=!0},setTimeout(()=>{s.terminate(),URL.revokeObjectURL(t),a()},10)}else{let e=new Blob(["<!DOCTYPE html><html><head><meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; script-src 'unsafe-inline'; connect-src 'none';\"></head><body><script>".concat(r.code,"<\/script></body></html>")],{type:"text/html"}),t=URL.createObjectURL(e),s=document.createElement("iframe");s.sandbox.add("allow-scripts");let i=()=>{l.push("error"),o=!0},n=e=>{e.source===s.contentWindow&&l.push(String(e.data))};window.addEventListener("message",n),s.addEventListener("error",i),s.src=t,document.body.appendChild(s),setTimeout(()=>{window.removeEventListener("message",n),s.removeEventListener("error",i),document.body.removeChild(s),URL.revokeObjectURL(t),a()},10)}})(e),disabled:!r,"aria-disabled":!r,"aria-label":r?"Run ".concat(e.id):"Run ".concat(e.id," (install required)"),children:"Run"})]})]})},e.id)}),0===m.length&&(0,l.jsx)("li",{className:"list-none rounded-xl border border-[color:var(--kali-border)] bg-[var(--kali-panel)] p-6 text-center text-sm text-[color:color-mix(in_srgb,var(--color-text)_60%,transparent)]",children:"No plugins match the current filters."})]}),s&&(0,l.jsx)("div",{className:"mt-4 max-w-xl",children:(0,l.jsxs)("div",{className:"rounded-lg border border-[color:var(--kali-border)] bg-[var(--kali-panel)] p-4 shadow-kali-panel",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-baseline justify-between gap-3",children:[(0,l.jsxs)("h2",{className:"text-lg font-semibold",children:["Last Run: ",s.id]}),(0,l.jsx)("time",{className:"text-xs text-[color:color-mix(in_srgb,var(--color-text)_65%,transparent)]",children:(e=>{try{return new Date(e).toLocaleString()}catch(r){return e}})(s.timestamp)})]}),s.error&&(0,l.jsx)("div",{className:"mb-3 rounded border border-[color:color-mix(in_srgb,var(--color-error)_65%,transparent)] bg-[color:color-mix(in_srgb,var(--color-error)_18%,var(--kali-panel))] px-3 py-2 text-sm text-[color:var(--color-error)]",role:"alert",children:"The last run reported an error. Review the output below for details."}),(0,l.jsx)("pre",{className:"mb-3 max-h-48 overflow-auto rounded bg-[color:var(--color-dark)] p-3 text-xs",children:s.output.join("\n")}),(0,l.jsx)("button",{onClick:()=>{if(!s)return;let e=new Blob([["result",...s.output.map(e=>JSON.stringify(e))].join("\n")],{type:"text/csv"}),r=URL.createObjectURL(e),t=document.createElement("a");t.href=r,t.download="".concat(s.id,".csv"),t.click(),URL.revokeObjectURL(r)},className:"rounded bg-kali-accent px-3 py-1 text-sm font-semibold text-kali-inverse transition hover:bg-[color:color-mix(in_srgb,var(--color-accent)_85%,#000000)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[color:var(--color-accent)]",children:"Export CSV"})]})})]})}}}]);