(()=>{let l,e={car:{lane:1,y:340},carColor:"#ef4444",obstacles:[],roadside:{near:[],far:[]},background:{near:[],far:[]},lineOffsetNear:0,lineOffsetFar:0,ghost:null};self.onmessage=a=>{let{type:t}=a.data||{};"init"===t?(l=a.data.canvas.getContext("2d"))&&(l.imageSmoothingEnabled=!1):"state"===t&&(Object.assign(e,a.data.diff),function(){if(!l)return;l.fillStyle="#333",l.fillRect(0,0,300,400),e.background&&(l.fillStyle="#111",e.background.far.forEach(e=>{let{x:a,y:t}=e;l.fillRect(a,t,2,2)}),l.fillStyle="#555",e.background.near.forEach(e=>{let{x:a,y:t}=e;l.fillRect(a,t,3,3)})),e.roadside&&(l.fillStyle="#999",e.roadside.far.forEach(e=>{l.fillRect(2,e,6,20),l.fillRect(292,e,6,20)}),l.fillStyle="#ccc",e.roadside.near.forEach(e=>{l.fillRect(0,e,10,30),l.fillRect(290,e,10,30)})),l.strokeStyle="#fff",l.setLineDash([20,20]),l.globalAlpha=.6,l.lineWidth=2,l.lineDashOffset=-(e.lineOffsetFar||0);for(let e=1;e<3;e+=1)l.beginPath(),l.moveTo(100*e,0),l.lineTo(100*e,400),l.stroke();l.globalAlpha=1,l.lineWidth=4,l.lineDashOffset=-(e.lineOffsetNear||0);for(let e=1;e<3;e+=1)l.beginPath(),l.moveTo(100*e,0),l.lineTo(100*e,400),l.stroke();if(l.setLineDash([]),e.ghost){let a=100*e.ghost.lane+20;l.globalAlpha=.5,l.fillStyle="white",l.fillRect(a,e.ghost.y,60,50),l.globalAlpha=1}let a=100*e.car.lane+20;l.fillStyle=e.carColor||"red",l.fillRect(a,e.car.y,60,50),l.fillStyle="blue",e.obstacles.forEach(e=>{let a=100*e.lane+20;l.fillRect(a,e.y,60,40)})}())},_N_E={}})();