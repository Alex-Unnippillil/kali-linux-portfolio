"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2822],{2822:(e,r,t)=>{t.r(r),t.d(r,{default:()=>f});var o=t(37876),a=t(14232),n=t(72082),l=t(90209),i=t(31240);let c=e=>()=>{let r=e+=0x6d2b79f5;return r=Math.imul(r^r>>>15,1|r),(((r^=r+Math.imul(r^r>>>7,61|r))^r>>>14)>>>0)/0x100000000},s=e=>{let r=e.filter(e=>0!==e),t=[];for(let e=0;e<r.length-1;e+=1)r[e]===r[e+1]&&(r[e]*=2,r[e+1]=0,t.push(e));let o=r.filter(e=>0!==e);for(;o.length<4;)o.push(0);return{row:o,merges:t}},u=e=>e[0].map((r,t)=>e.map(e=>e[t])),d=e=>{let r=0;return e.forEach(e=>e.forEach(e=>{e>r&&(r=e)})),r},g=(e,r)=>{let t=[];if(e.forEach((e,r)=>e.forEach((e,o)=>{0===e&&t.push([r,o])})),0===t.length)return null;let[o,a]=t[Math.floor(r()*t.length)];return e[o][a]=.9>r()?2:4,[o,a]},v={2:"bg-[color:color-mix(in_srgb,var(--kali-panel)_92%,var(--kali-control)_8%)] text-[var(--kali-text)]",4:"bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,var(--kali-control)_12%)] text-[var(--kali-text)]",8:"bg-[color:color-mix(in_srgb,var(--color-warning)_45%,var(--kali-panel))] text-[var(--kali-text)]",16:"bg-[color:color-mix(in_srgb,var(--color-warning)_55%,var(--kali-panel))] text-[var(--kali-text)]",32:"bg-[color:color-mix(in_srgb,var(--color-warning)_65%,var(--kali-panel))] text-[var(--kali-text)]",64:"bg-[color:color-mix(in_srgb,var(--color-warning)_75%,var(--kali-panel))] text-[var(--kali-text)]",128:"bg-[color:color-mix(in_srgb,var(--color-info)_55%,var(--kali-panel))] text-[var(--kali-text)]",256:"bg-[color:color-mix(in_srgb,var(--color-info)_65%,var(--kali-panel))] text-[var(--kali-text)]",512:"bg-[color:color-mix(in_srgb,var(--color-info)_75%,var(--kali-panel))] text-[var(--kali-text)]",1024:"bg-[color:color-mix(in_srgb,var(--game-color-success)_60%,var(--kali-panel))] text-[var(--kali-text)]",2048:"bg-[color:color-mix(in_srgb,var(--game-color-success)_72%,var(--kali-panel))] text-[var(--kali-text)]",4096:"bg-[color:color-mix(in_srgb,var(--color-control-accent)_75%,var(--kali-panel))] text-[var(--kali-text)]"},x="replays",m=e=>{if("undefined"==typeof indexedDB)return;let r=indexedDB.open("2048",1);r.onupgradeneeded=()=>{let e=r.result;e.objectStoreNames.contains(x)||e.createObjectStore(x,{keyPath:"id",autoIncrement:!0})},r.onsuccess=()=>{r.result.transaction(x,"readwrite").objectStore(x).add(e)}},f=()=>{let e=(0,l.default)(),r=(0,a.useRef)(c(0)),t=(0,a.useRef)(0),[x,f]=(0,a.useState)(Array.from({length:4},()=>[,,,,].fill(0))),[p,b]=(0,a.useState)(!1),[h,k]=(0,a.useState)(3),_=(0,a.useRef)(null),[w,y]=(0,a.useState)([]),[j,N]=(0,a.useState)(0),[E,S]=(0,a.useState)("classic"),[D,I]=(0,a.useState)(!1),[B,C]=(0,a.useState)(!1),[L,T]=(0,a.useState)([]),[M,A]=(0,a.useState)([]),O=(0,a.useRef)(null),[R,P]=(0,a.useState)(null),W=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{let o=(e=>{let r=0;for(let t=0;t<e.length;t+=1)r=Math.imul(31,r)+e.charCodeAt(t);return r>>>0})(await (0,i.getDailySeed)("2048")),a=c(o),n=Array.from({length:4},()=>[,,,,].fill(0));g(n,a),g(n,a),e&&(f(n),r.current=a,t.current=o)})(),()=>{e=!1}},[]);let V=(0,a.useCallback)(()=>{p&&k(3)},[p]);(0,a.useEffect)(()=>{if(p)return _.current&&clearInterval(_.current),_.current=setInterval(()=>{k(e=>e<=1?(_.current&&clearInterval(_.current),C(!0),m({date:new Date().toISOString(),moves:w,boardType:E,hard:p}),0):e-1)},1e3),()=>{_.current&&clearInterval(_.current)}},[p,w,E]);let U=(0,a.useCallback)(t=>{if(D||B)return;let{board:o,merges:a}=((e,r)=>{let t=[];if("ArrowLeft"===r)return{board:e.map((e,r)=>{let{row:o,merges:a}=s(e);return a.forEach(e=>t.push("".concat(r,"-").concat(e))),o}),merges:t};if("ArrowRight"===r)return{board:e.map((e,r)=>{let{row:o,merges:a}=s([...e].reverse());return a.forEach(e=>t.push("".concat(r,"-").concat(3-e))),[...o].reverse()}),merges:t};if("ArrowUp"===r){let r=u(e).map((e,r)=>{let{row:o,merges:a}=s(e);return a.forEach(e=>t.push("".concat(e,"-").concat(r))),o});return{board:u(r),merges:t}}let o=u(e).map((e,r)=>{let{row:o,merges:a}=s([...e].reverse());return a.forEach(e=>t.push("".concat(3-e,"-").concat(r))),[...o].reverse()});return{board:u(o),merges:t}})(x,t);if(!o||x.every((e,r)=>e.every((e,t)=>e===o[r][t])))return;T(e=>[...e,x.map(e=>[...e])]);let l=g(o,r.current),i=d(o);(2048===i||4096===i)&&i>j&&(0,n.logEvent)({category:"2048",action:"post_score",value:i,label:E}),N(i),f(o),y(e=>[...e,t]),O.current&&(clearTimeout(O.current),O.current=null),A(a),O.current=setTimeout(()=>A([]),e?600:350),W.current&&(clearTimeout(W.current),W.current=null),P(l?"".concat(l[0],"-").concat(l[1]):null),l&&(W.current=setTimeout(()=>P(null),e?600:350)),V(),i>=2048?I(!0):(e=>{for(let r=0;r<4;r+=1)for(let t=0;t<4;t+=1)if(0===e[r][t]||t<3&&e[r][t]===e[r][t+1]||r<3&&e[r][t]===e[r+1][t])return!0;return!1})(o)||C(!0)},[x,D,B,j,E,V,e]),K=(0,a.useCallback)(()=>{T(e=>{if(!e.length)return e;let r=e[e.length-1];return f(r.map(e=>[...e])),y(e=>e.slice(0,-1)),N(d(r)),I(!1),C(!1),O.current&&(clearTimeout(O.current),O.current=null),A([]),W.current&&(clearTimeout(W.current),W.current=null),P(null),V(),e.slice(0,-1)})},[V]),H=(0,a.useCallback)(()=>{let e=c(t.current);r.current=e;let o=Array.from({length:4},()=>[,,,,].fill(0));g(o,e),g(o,e),f(o),y([]),T([]),I(!1),C(!1),N(0),O.current&&(clearTimeout(O.current),O.current=null),A([]),W.current&&(clearTimeout(W.current),W.current=null),P(null),V()},[V]);(0,a.useEffect)(()=>{let e=e=>{if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(e.key))return void U(e.key);if("r"===e.key||"R"===e.key){e.preventDefault(),H();return}["u","U","Backspace"].includes(e.key)&&(e.preventDefault(),K())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[U,H,K]),(0,a.useEffect)(()=>()=>{O.current&&clearTimeout(O.current),W.current&&clearTimeout(W.current),O.current=null,W.current=null},[]);let q=(0,a.useMemo)(()=>x.flat().reduce((e,r)=>e+r,0),[x]);return(0,a.useEffect)(()=>{(D||B)&&(m({date:new Date().toISOString(),moves:w,boardType:E,hard:p}),fetch("/api/leaderboard/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({game:"2048",username:"Anonymous",score:j})}).catch(()=>{}))},[D,B,w,E,p,j]),(0,o.jsx)("div",{className:"h-full w-full overflow-auto bg-[var(--kali-bg)] text-[var(--kali-text)]",children:(0,o.jsxs)("main",{className:"mx-auto flex h-full max-w-3xl flex-col gap-6 p-6",children:[(0,o.jsxs)("header",{className:"flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between",children:[(0,o.jsxs)("div",{className:"space-y-1",children:[(0,o.jsx)("h1",{className:"text-3xl font-semibold tracking-tight text-[var(--kali-text)]",children:"2048"}),(0,o.jsx)("p",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-text)_70%,transparent)]",children:"Merge tiles to hit 2048. Hard mode adds a countdown after each move."})]}),(0,o.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,o.jsxs)("div",{className:"rounded-lg bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] px-3 py-2 text-right",children:[(0,o.jsx)("div",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Best Tile"}),(0,o.jsx)("div",{className:"text-lg font-semibold text-[var(--kali-text)]",children:j||0})]}),(0,o.jsxs)("div",{className:"rounded-lg bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] px-3 py-2 text-right",children:[(0,o.jsx)("div",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Score"}),(0,o.jsx)("div",{className:"text-lg font-semibold text-[var(--kali-text)]",children:q})]}),(0,o.jsxs)("div",{className:"rounded-lg bg-[color:color-mix(in_srgb,var(--kali-panel)_88%,transparent)] px-3 py-2 text-right",children:[(0,o.jsx)("div",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[color:color-mix(in_srgb,var(--kali-text)_60%,transparent)]",children:"Moves"}),(0,o.jsx)("div",{className:"text-lg font-semibold text-[var(--kali-text)]",children:w.length})]}),p&&(0,o.jsxs)("div",{className:"rounded-lg bg-[color:color-mix(in_srgb,var(--color-warning)_35%,var(--kali-panel))] px-3 py-2 text-right",children:[(0,o.jsx)("div",{className:"text-[0.65rem] uppercase tracking-[0.2em] text-[color:color-mix(in_srgb,var(--color-warning)_70%,var(--kali-text))]",children:"Countdown"}),(0,o.jsx)("div",{className:"text-lg font-semibold text-[color:color-mix(in_srgb,var(--color-warning)_80%,var(--kali-text))]",children:h})]})]})]}),(0,o.jsxs)("section",{"aria-label":"Game controls",className:"flex flex-wrap gap-2",children:[(0,o.jsx)("button",{className:"rounded-md bg-[color:color-mix(in_srgb,var(--kali-control)_24%,var(--kali-panel))] px-4 py-2 text-sm font-medium text-[var(--kali-text)] transition-colors hover:bg-[color:color-mix(in_srgb,var(--kali-control)_32%,var(--kali-panel))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg)]",onClick:H,children:"Restart"}),(0,o.jsx)("button",{className:"rounded-md bg-[color:color-mix(in_srgb,var(--kali-control)_24%,var(--kali-panel))] px-4 py-2 text-sm font-medium text-[var(--kali-text)] transition-colors hover:bg-[color:color-mix(in_srgb,var(--kali-control)_32%,var(--kali-panel))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg)]",onClick:K,children:"Undo"}),(0,o.jsxs)("div",{className:"flex items-center gap-2 rounded-md bg-[color:color-mix(in_srgb,var(--kali-panel)_80%,transparent)] px-3 py-2 text-sm text-[var(--kali-text)]",children:[(0,o.jsx)("input",{type:"checkbox",checked:p,onChange:e=>b(e.target.checked),className:"h-4 w-4 rounded border-[color:color-mix(in_srgb,var(--kali-control)_35%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_65%,transparent)] text-[color:var(--color-control-accent)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg)]",id:"hard-mode-toggle","aria-label":"Enable hard mode"}),(0,o.jsx)("label",{htmlFor:"hard-mode-toggle",className:"cursor-pointer select-none",children:"Hard mode"})]}),(0,o.jsxs)("select",{className:"rounded-md border border-[color:color-mix(in_srgb,var(--kali-control)_35%,transparent)] bg-[color:color-mix(in_srgb,var(--kali-panel)_85%,transparent)] px-3 py-2 text-sm font-medium text-[var(--kali-text)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg)]",value:E,onChange:e=>S(e.target.value),"aria-label":"Tile notation",children:[(0,o.jsx)("option",{value:"classic",children:"Classic"}),(0,o.jsx)("option",{value:"hex",children:"Hex 2048"})]}),(0,o.jsx)("button",{className:"rounded-md bg-[color:color-mix(in_srgb,var(--kali-control)_24%,var(--kali-panel))] px-4 py-2 text-sm font-medium text-[var(--kali-text)] transition-colors hover:bg-[color:color-mix(in_srgb,var(--kali-control)_32%,var(--kali-panel))] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg)]",onClick:()=>{if("undefined"!=typeof document){var e;null==(e=document.getElementById("close-2048"))||e.click()}},children:"Close"})]}),(0,o.jsx)("section",{"aria-label":"2048 board",className:"mx-auto w-full max-w-lg rounded-2xl bg-[color:color-mix(in_srgb,var(--kali-panel)_90%,transparent)] p-3 shadow-inner",children:(0,o.jsx)("div",{className:"grid grid-cols-4 gap-3",children:x.map((r,t)=>r.map((r,a)=>{let n="".concat(t,"-").concat(a),l=((r,t)=>{let o=M.includes(r),a=R===r,n=e?"":o?"scale-105":a?"scale-110":"";return["h-full w-full rounded-lg font-semibold flex items-center justify-center text-2xl md:text-3xl transition-colors",e?"":"transition-transform duration-200 ease-out",o?"ring-2 ring-[color:color-mix(in_srgb,var(--color-warning)_70%,transparent)] ring-offset-2 ring-offset-[color:var(--kali-bg)]":a?"ring-2 ring-[color:color-mix(in_srgb,var(--color-control-accent)_70%,transparent)] ring-offset-2 ring-offset-[color:var(--kali-bg)]":"",n,t?"":"text-[color:color-mix(in_srgb,var(--kali-text)_45%,transparent)]"].filter(Boolean).join(" ")})(n,!!r);return(0,o.jsx)("div",{className:"aspect-square w-full rounded-xl bg-[color:color-mix(in_srgb,var(--kali-panel)_55%,transparent)] p-1 ".concat(e?"":"transition-colors"),children:(0,o.jsx)("div",{className:"".concat(l," ").concat(r?v[r]||"bg-[color:color-mix(in_srgb,var(--kali-panel)_82%,var(--kali-control)_18%)] text-[var(--kali-text)]":"bg-[color:color-mix(in_srgb,var(--kali-panel)_35%,transparent)]"),children:(e=>0===e?"":"hex"===E?e.toString(16).toUpperCase():e)(r)})},n)}))})}),(D||B)&&(0,o.jsx)("div",{className:"rounded-xl border px-4 py-3 text-base font-semibold shadow-lg ".concat(D?"border-[color:color-mix(in_srgb,var(--game-color-success)_65%,transparent)] bg-[color:color-mix(in_srgb,var(--game-color-success)_22%,var(--kali-panel))] text-[color:color-mix(in_srgb,var(--game-color-success)_75%,var(--kali-text))]":"border-[color:color-mix(in_srgb,var(--game-color-danger)_65%,transparent)] bg-[color:color-mix(in_srgb,var(--game-color-danger)_22%,var(--kali-panel))] text-[color:color-mix(in_srgb,var(--game-color-danger)_75%,var(--kali-text))]"),role:"status","aria-live":"polite",children:D?"You win! Keep playing to chase a higher tile.":"Game over. Restart to try the daily board again."})]})})}},31240:(e,r,t)=>{t.d(r,{getDailySeed:()=>u});var o=t(35326);let a="seeds",n="replays",l=null;function i(){return l||(l=(0,o.getDb)("kali-games",1,{upgrade(e){e.objectStoreNames.contains(a)||e.createObjectStore(a),e.objectStoreNames.contains(n)||e.createObjectStore(n)}})),l}async function c(e,r){try{let t=i();if(!t)return;let o=await t;return await o.get(a,"".concat(e,"-").concat(r))}catch(e){return}}async function s(e,r,t){try{let o=i();if(!o)return;let n=await o;await n.put(a,t,"".concat(e,"-").concat(r))}catch(e){}}async function u(e){let r=new Date().toISOString().split("T")[0];if("serviceWorker"in navigator&&navigator.serviceWorker.controller){let t=new MessageChannel,o=navigator.serviceWorker.controller;return new Promise(a=>{t.port1.onmessage=e=>{a(e.data.seed)},o.postMessage({type:"seed",game:e,date:r},[t.port2])})}let t=await c(e,r);return t||(t=Math.random().toString(36).slice(2,10),await s(e,r,t)),t}},31730:(e,r,t)=>{t.d(r,{hasIndexedDB:()=>a,isBrowser:()=>o});let o="undefined"!=typeof document,a=o&&"undefined"!=typeof indexedDB},35326:(e,r,t)=>{let o,a;t.d(r,{getDb:()=>b});let n=new WeakMap,l=new WeakMap,i=new WeakMap,c=new WeakMap,s=new WeakMap,u={get(e,r,t){if(e instanceof IDBTransaction){if("done"===r)return l.get(e);if("objectStoreNames"===r)return e.objectStoreNames||i.get(e);if("store"===r)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return d(e[r])},set:(e,r,t)=>(e[r]=t,!0),has:(e,r)=>e instanceof IDBTransaction&&("done"===r||"store"===r)||r in e};function d(e){if(e instanceof IDBRequest){let r=new Promise((r,t)=>{let o=()=>{e.removeEventListener("success",a),e.removeEventListener("error",n)},a=()=>{r(d(e.result)),o()},n=()=>{t(e.error),o()};e.addEventListener("success",a),e.addEventListener("error",n)});return r.then(r=>{r instanceof IDBCursor&&n.set(r,e)}).catch(()=>{}),s.set(r,e),r}if(c.has(e))return c.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...r){return e.apply(g(this),r),d(n.get(this))}:function(...r){return d(e.apply(g(this),r))}:function(r,...t){let o=e.call(g(this),r,...t);return i.set(o,r.sort?r.sort():[r]),d(o)};return e instanceof IDBTransaction&&function(e){if(l.has(e))return;let r=new Promise((r,t)=>{let o=()=>{e.removeEventListener("complete",a),e.removeEventListener("error",n),e.removeEventListener("abort",n)},a=()=>{r(),o()},n=()=>{t(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",a),e.addEventListener("error",n),e.addEventListener("abort",n)});l.set(e,r)}(e),(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(r=>e instanceof r)?new Proxy(e,u):e}(e);return r!==e&&(c.set(e,r),s.set(r,e)),r}let g=e=>s.get(e),v=["get","getKey","getAll","getAllKeys","count"],x=["put","add","delete","clear"],m=new Map;function f(e,r){if(!(e instanceof IDBDatabase&&!(r in e)&&"string"==typeof r))return;if(m.get(r))return m.get(r);let t=r.replace(/FromIndex$/,""),o=r!==t,a=x.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(a||v.includes(t)))return;let n=async function(e,...r){let n=this.transaction(e,a?"readwrite":"readonly"),l=n.store;return o&&(l=l.index(r.shift())),(await Promise.all([l[t](...r),a&&n.done]))[0]};return m.set(r,n),n}u=(e=>({...e,get:(r,t,o)=>f(r,t)||e.get(r,t,o),has:(r,t)=>!!f(r,t)||e.has(r,t)}))(u);var p=t(31730);function b(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2?arguments[2]:void 0;return p.hasIndexedDB?function(e,r,{blocked:t,upgrade:o,blocking:a,terminated:n}={}){let l=indexedDB.open(e,r),i=d(l);return o&&l.addEventListener("upgradeneeded",e=>{o(d(l.result),e.oldVersion,e.newVersion,d(l.transaction),e)}),t&&l.addEventListener("blocked",e=>t(e.oldVersion,e.newVersion,e)),i.then(e=>{n&&e.addEventListener("close",()=>n()),a&&e.addEventListener("versionchange",e=>a(e.oldVersion,e.newVersion,e))}).catch(()=>{}),i}(e,r,t):null}},90209:(e,r,t)=>{t.d(r,{default:()=>n});var o=t(14232),a=t(74273);function n(){let{reducedMotion:e}=(0,a.useSettings)(),[r,t]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>t(e.matches);return(r(),"function"==typeof e.addEventListener)?(e.addEventListener("change",r),()=>e.removeEventListener("change",r)):(e.addListener(r),()=>e.removeListener(r))},[]),e||r}}}]);