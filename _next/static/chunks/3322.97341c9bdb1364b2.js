(()=>{"use strict";async function*e(){}async function*t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:65536;for(let n=0;n<e.length;n+=t)yield e.slice(n,n+t)}async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1048576,n="";for await(let i of e)if((n+=i).length>t)return null;return n}let i={cat:(e,n,i)=>{if(e[0]){let n=i.files[e[0]];return"string"==typeof n?t(n):t("cat: ".concat(e[0],": No such file\n"))}return n},grep:(e,n,i)=>{let{pattern:l,file:s,flags:r}=(e=>{var t,n;let i={caseInsensitive:!1,lineNumbers:!1},l=[...e];for(;l[0]&&l[0].startsWith("-");){let e=null!=(t=l.shift())?t:"";e.includes("i")&&(i.caseInsensitive=!0),e.includes("n")&&(i.lineNumbers=!0)}return{pattern:null!=(n=l.shift())?n:"",file:l.shift(),flags:i}})(e),o=new RegExp(l,r.caseInsensitive?"i":""),f=s?i.files[s]:null,a=s?f?t(f):t("grep: ".concat(s,": No such file or directory\n")):n;return async function*(){let e="",t=0;for await(let n of a){let i=(e+=n).split("\n");for(let n of(e=i.pop()||"",i))if(t+=1,o.test(n)){let e=r.lineNumbers?"".concat(t,":"):"";yield e+n+"\n"}}if(e&&(t+=1,o.test(e))){let n=r.lineNumbers?"".concat(t,":"):"";yield n+e+"\n"}}()},jq:(e,t,i)=>(async function*(){var l;let s=null!=(l=e[0])?l:".",r=e[1],o=r?i.files[r]:await n(t);if(r&&"string"!=typeof i.files[r])return void(yield"jq: ".concat(r,": No such file or directory\n"));if(null===o)return void(yield"jq: data limit exceeded\n");try{let e=JSON.parse(o),t=((e,t)=>{if(!t.startsWith("."))return e;let n=t.replace(/^\./,"").split(".").map(e=>e.trim()).filter(Boolean),i=e;for(let e of n)if(!i||"object"!=typeof i||!(e in i))return null;else i=i[e];return i})(e,s);yield JSON.stringify(t,null,2)+"\n"}catch(e){yield"jq: invalid JSON input\n"}})(),sort:(e,i)=>(async function*(){let e=await n(i);if(null===e)return void(yield"sort: data limit exceeded\n");let l=e.split("\n").filter(e=>e.length>0);l.sort(),yield*t(l.join("\n")+"\n")})(),uniq:(e,i)=>(async function*(){let e,l=await n(i);if(null===l)return void(yield"uniq: data limit exceeded\n");let s=l.split("\n"),r=[];for(let t of s)t!==e&&r.push(t),e=t;yield*t(r.join("\n")+"\n")})()};self.onmessage=async n=>{let{data:l}=n;if("run"===l.action){let n={files:l.files||{}};for await(let s of function(n,l){let s=n.split("|").map(e=>e.trim()).filter(Boolean),r=e();for(let e of s){let[n,...s]=e.split(/\s+/),o=i[n];if(o)r=o(s,r,l);else{r=t("command not found: ".concat(n,"\n"));break}}return r}(l.command,n))self.postMessage({type:"data",chunk:s,id:l.id});self.postMessage({type:"end",id:l.id})}}})(),_N_E={};