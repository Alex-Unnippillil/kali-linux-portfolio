"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6329],{26329:(e,r,t)=>{t.r(r),t.d(r,{default:()=>j});var l=t(37876),a=t(14232);class o{diff(e,r,t={}){let l;"function"==typeof t?(l=t,t={}):"callback"in t&&(l=t.callback);let a=this.castInput(e,t),o=this.castInput(r,t),s=this.removeEmpty(this.tokenize(a,t)),i=this.removeEmpty(this.tokenize(o,t));return this.diffWithOptionsObj(s,i,t,l)}diffWithOptionsObj(e,r,t,l){var a;let o=e=>(e=this.postProcess(e,t),l)?void setTimeout(function(){l(e)},0):e,s=r.length,i=e.length,n=1,c=s+i;null!=t.maxEditLength&&(c=Math.min(c,t.maxEditLength));let d=null!=(a=t.timeout)?a:1/0,u=Date.now()+d,p=[{oldPos:-1,lastComponent:void 0}],m=this.extractCommon(p[0],r,e,0,t);if(p[0].oldPos+1>=i&&m+1>=s)return o(this.buildValues(p[0].lastComponent,r,e));let x=-1/0,h=1/0,b=()=>{for(let l=Math.max(x,-n);l<=Math.min(h,n);l+=2){let a,n=p[l-1],c=p[l+1];n&&(p[l-1]=void 0);let d=!1;if(c){let e=c.oldPos-l;d=c&&0<=e&&e<s}let u=n&&n.oldPos+1<i;if(!d&&!u){p[l]=void 0;continue}if(a=!u||d&&n.oldPos<c.oldPos?this.addToPath(c,!0,!1,0,t):this.addToPath(n,!1,!0,1,t),m=this.extractCommon(a,r,e,l,t),a.oldPos+1>=i&&m+1>=s)return o(this.buildValues(a.lastComponent,r,e))||!0;p[l]=a,a.oldPos+1>=i&&(h=Math.min(h,l-1)),m+1>=s&&(x=Math.max(x,l+1))}n++};if(l)!function e(){setTimeout(function(){if(n>c||Date.now()>u)return l(void 0);b()||e()},0)}();else for(;n<=c&&Date.now()<=u;){let e=b();if(e)return e}}addToPath(e,r,t,l,a){let o=e.lastComponent;return o&&!a.oneChangePerToken&&o.added===r&&o.removed===t?{oldPos:e.oldPos+l,lastComponent:{count:o.count+1,added:r,removed:t,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+l,lastComponent:{count:1,added:r,removed:t,previousComponent:o}}}extractCommon(e,r,t,l,a){let o=r.length,s=t.length,i=e.oldPos,n=i-l,c=0;for(;n+1<o&&i+1<s&&this.equals(t[i+1],r[n+1],a);)n++,i++,c++,a.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!a.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=i,n}equals(e,r,t){return t.comparator?t.comparator(e,r):e===r||!!t.ignoreCase&&e.toLowerCase()===r.toLowerCase()}removeEmpty(e){let r=[];for(let t=0;t<e.length;t++)e[t]&&r.push(e[t]);return r}castInput(e,r){return e}tokenize(e,r){return Array.from(e)}join(e){return e.join("")}postProcess(e,r){return e}get useLongestToken(){return!1}buildValues(e,r,t){let l,a=[];for(;e;)a.push(e),l=e.previousComponent,delete e.previousComponent,e=l;a.reverse();let o=a.length,s=0,i=0,n=0;for(;s<o;s++){let e=a[s];if(e.removed)e.value=this.join(t.slice(n,n+e.count)),n+=e.count;else{if(!e.added&&this.useLongestToken){let l=r.slice(i,i+e.count);l=l.map(function(e,r){let l=t[n+r];return l.length>e.length?l:e}),e.value=this.join(l)}else e.value=this.join(r.slice(i,i+e.count));i+=e.count,e.added||(n+=e.count)}}return a}}class s extends o{constructor(){super(...arguments),this.tokenize=n}equals(e,r,t){return t.ignoreWhitespace?(t.newlineIsToken&&e.includes("\n")||(e=e.trim()),t.newlineIsToken&&r.includes("\n")||(r=r.trim())):t.ignoreNewlineAtEof&&!t.newlineIsToken&&(e.endsWith("\n")&&(e=e.slice(0,-1)),r.endsWith("\n")&&(r=r.slice(0,-1))),super.equals(e,r,t)}}let i=new s;function n(e,r){r.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));let t=[],l=e.split(/(\n|\r\n)/);l[l.length-1]||l.pop();for(let e=0;e<l.length;e++){let a=l[e];e%2&&!r.newlineIsToken?t[t.length-1]+=a:t.push(a)}return t}var c=t(51802),d=t(81645),u=t(95220);let p=c.object({selector:c.string().min(1,"Selector is required"),action:c.enum(["remove","replaceText"]),value:c.string().optional()}).superRefine((e,r)=>{var t;"replaceText"!==e.action||(null==(t=e.value)?void 0:t.trim())||r.addIssue({code:d.ZodIssueCode.custom,message:"Replacement value is required",path:["value"]})}),m=[{selector:"script",action:"remove"},{selector:"h1",action:"replaceText",value:"Rewritten Title"}],x='<h1>Hello</h1>\n<p>Sample <strong>content</strong>.</p>\n<script>alert("xss")<\/script>',h=[{id:"landing-cleanup",name:"Landing cleanup",description:"Remove scripts and normalize hero copy for a marketing page.",rules:[{selector:"script",action:"remove"},{selector:".hero h1",action:"replaceText",value:"Secure your roadmap"},{selector:".cta",action:"replaceText",value:"Request a demo"}],html:'<main class="hero">\n  <h1>Launch fast</h1>\n  <p>Ship updates in minutes.</p>\n  <a class="cta" href="#demo">Contact sales</a>\n  <script>console.log(\'track\')<\/script>\n</main>'},{id:"newsroom",name:"Newsroom scrub",description:"Strip banners and annotate outbound links for a press feed.",rules:[{selector:".ad",action:"remove"},{selector:'a[rel="sponsored"]',action:"replaceText",value:"[sponsored link removed]"},{selector:"header h2",action:"replaceText",value:"Headlines you can trust"}],html:'<article>\n  <header>\n    <h2>Breaking news</h2>\n  </header>\n  <div class="ad">Buy now</div>\n  <p>Read more at <a rel="sponsored" href="/promo">Promo</a>.</p>\n</article>'},{id:"gallery",name:"Gallery placeholders",description:"Replace images with safe captions for a static preview.",rules:[{selector:"img",action:"replaceText",value:"[image removed]"},{selector:".caption",action:"replaceText",value:"Gallery item (preview)"}],html:'<section class="gallery">\n  <figure>\n    <img src="/photo.jpg" alt="Sunset" />\n    <figcaption class="caption">Sunset</figcaption>\n  </figure>\n</section>'},{id:"docs",name:"Docs cleanup",description:"Remove inline scripts and update headings in docs pages.",rules:[{selector:"script",action:"remove"},{selector:"h2",action:"replaceText",value:"Updated section"},{selector:"code",action:"replaceText",value:"[code sample]"}],html:"<section>\n  <h2>Getting started</h2>\n  <p>Install with <code>npm install</code>.</p>\n  <script>console.log('docs')<\/script>\n</section>"}],b=[{id:"selectors",label:"Selectors"},{id:"actions",label:"Actions"},{id:"payloads",label:"Sample payloads"}],v=[{id:"output",label:"Rewritten HTML"},{id:"diff",label:"Diff"},{id:"preview",label:"Safe preview"}],g=e=>JSON.stringify(e,null,2),f=(e,r)=>{if("undefined"==typeof DOMParser)return{html:e,diagnostics:[]};let t=[],l=new DOMParser().parseFromString(e,"text/html");return r.forEach((e,r)=>{let a=[];try{a=Array.from(l.querySelectorAll(e.selector))}catch(a){let l=a instanceof Error?a.message:"Invalid selector: ".concat(e.selector);t.push({id:"selector-".concat(r),message:l,ruleIndex:r,type:"selector"});return}if("remove"===e.action)return void a.forEach(e=>e.remove());a.forEach(r=>{var t;r.textContent=null!=(t=e.value)?t:""})}),{html:l.body.innerHTML,diagnostics:t}},k="focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--color-focus-ring)] focus-visible:ring-offset-2 focus-visible:ring-offset-[color:var(--kali-bg-solid)]",w="rounded border border-[color:var(--kali-border)] px-3 py-1 text-sm font-semibold uppercase tracking-wide transition-colors duration-[var(--motion-fast)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-kali-focus",_="".concat(w," bg-[color:var(--color-primary)] text-[color:var(--color-inverse)] hover:bg-[color:color-mix(in_srgb,var(--color-primary)_85%,var(--kali-panel))]"),y="".concat(w," bg-[color:color-mix(in_srgb,var(--kali-panel)_82%,var(--kali-panel-highlight))] text-[color:var(--kali-text)] hover:bg-[color:color-mix(in_srgb,var(--kali-panel)_68%,rgba(15,148,210,0.22))]"),j=()=>{let[e,r]=(0,u.default)("html-rewriter-rules",g(m),e=>"string"==typeof e),[o,s]=(0,u.default)("html-rewriter-html",x,e=>"string"==typeof e),[n,c]=(0,a.useReducer)((e,r)=>{switch(r.type){case"setDraftRules":return{...e,draftRules:r.value};case"setDraftHtml":return{...e,draftHtml:r.value};case"setValidation":return{...e,validatedRules:r.rules,validationDiagnostics:r.diagnostics};case"setRewrite":return{...e,resultHtml:r.resultHtml,rewriteDiagnostics:r.diagnostics};case"setDiff":return{...e,diff:r.diff};default:return e}},{draftRules:e,draftHtml:o,validatedRules:m,validationDiagnostics:[],rewriteDiagnostics:[],resultHtml:x,diff:[]}),[d,w]=(0,a.useState)(!1),[j,N]=(0,a.useState)("selectors"),[R,T]=(0,a.useState)("output"),[C,D]=(0,a.useState)(""),H=(0,a.useId)(),L=(0,a.useId)(),S=(0,a.useRef)(null),E=(0,a.useRef)(null),P=(0,a.useRef)([]),I=(0,a.useRef)([]),M=(0,a.useRef)(null),O=(0,a.useRef)(null),A=(0,a.useRef)(null),q=(0,a.useRef)(0),U=(0,a.useRef)(null),z=(0,a.useMemo)(()=>f(x,m).html,[]),J=(0,a.useMemo)(()=>[...n.validationDiagnostics,...n.rewriteDiagnostics],[n.validationDiagnostics,n.rewriteDiagnostics]);(0,a.useEffect)(()=>{r(n.draftRules)},[r,n.draftRules]),(0,a.useEffect)(()=>{s(n.draftHtml)},[s,n.draftHtml]),(0,a.useEffect)(()=>{let{rules:e,diagnostics:r}=(e=>{try{let r=JSON.parse(e);if(!Array.isArray(r))return{rules:[],diagnostics:[{id:"parse-not-array",message:"Rules JSON must be an array of rule objects.",type:"parse"}]};let t=[],l=[];return r.forEach((e,r)=>{let a=p.safeParse(e);if(a.success)return void l.push(a.data);a.error.issues.forEach((e,l)=>{let a=e.path.filter(e=>"string"==typeof e).join(".");t.push({id:"validation-".concat(r,"-").concat(l),message:"".concat(e.message).concat(a?" (".concat(a,")"):""),ruleIndex:r,type:"validation"})})}),{rules:l,diagnostics:t}}catch(e){return{rules:[],diagnostics:[{id:"parse-error",message:e instanceof Error?e.message:"Rules JSON is malformed.",type:"parse"}]}}})(n.draftRules);c({type:"setValidation",rules:e,diagnostics:r})},[n.draftRules]),(0,a.useEffect)(()=>(M.current&&window.clearTimeout(M.current),M.current=window.setTimeout(()=>{let{html:e,diagnostics:r}=f(n.draftHtml,n.validatedRules);c({type:"setRewrite",resultHtml:e,diagnostics:r})},120),()=>{M.current&&window.clearTimeout(M.current)}),[n.draftHtml,n.validatedRules]),(0,a.useEffect)(()=>{if("function"==typeof Worker)return A.current=new Worker(t.tu(new URL(t.p+t.u(1748),t.b))),A.current.onmessage=e=>{var r;(null==(r=e.data)?void 0:r.type)==="diff"&&e.data.id===q.current&&c({type:"setDiff",diff:e.data.diff})},()=>{var e;null==(e=A.current)||e.terminate(),A.current=null}},[]),(0,a.useEffect)(()=>(O.current&&window.clearTimeout(O.current),O.current=window.setTimeout(()=>{if(!A.current){var e,r;return void c({type:"setDiff",diff:(e=n.draftHtml,r=n.resultHtml,i.diff(e,r,void 0))})}q.current+=1,A.current.postMessage({type:"diff",id:q.current,original:n.draftHtml,updated:n.resultHtml})},120),()=>{O.current&&window.clearTimeout(O.current)}),[n.draftHtml,n.resultHtml]),(0,a.useEffect)(()=>{var e,r;if(!d)return;let t=E.current,l=S.current;if(!t)return;let a=Array.from(t.querySelectorAll('button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])')).filter(e=>!e.hasAttribute("disabled")),o=null!=(e=a[0])?e:t,s=null!=(r=a[a.length-1])?r:t;o.focus();let i=e=>{if("Escape"===e.key){e.preventDefault(),w(!1);return}if("Tab"===e.key&&0!==a.length){if(e.shiftKey&&document.activeElement===o){e.preventDefault(),s.focus();return}e.shiftKey||document.activeElement!==s||(e.preventDefault(),o.focus())}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i),null==l||l.focus()}},[d]),(0,a.useEffect)(()=>()=>{U.current&&window.clearTimeout(U.current)},[]);let W=(0,a.useCallback)(e=>{D(e),U.current&&window.clearTimeout(U.current),U.current=window.setTimeout(()=>D(""),2e3)},[]),F=(0,a.useCallback)(async()=>{try{await navigator.clipboard.writeText(n.resultHtml),W("Rewritten HTML copied to clipboard.")}catch(e){W("Unable to copy output.")}},[n.resultHtml,W]),V=(0,a.useCallback)(function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain",l=new Blob([r],{type:t}),a=URL.createObjectURL(l),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(a),W("".concat(e," downloaded."))},[W]),K=(0,a.useCallback)(e=>{let r=b.findIndex(e=>e.id===j);if(-1===r)return;let t=e=>{let r=b[e];r&&(N(r.id),requestAnimationFrame(()=>{var r;return null==(r=P.current[e])?void 0:r.focus()}))};"ArrowRight"===e.key&&(e.preventDefault(),t((r+1)%b.length)),"ArrowLeft"===e.key&&(e.preventDefault(),t((r-1+b.length)%b.length)),"Home"===e.key&&(e.preventDefault(),t(0)),"End"===e.key&&(e.preventDefault(),t(b.length-1))},[j]),B=(0,a.useCallback)(e=>{let r=v.findIndex(e=>e.id===R);if(-1===r)return;let t=e=>{let r=v[e];r&&(T(r.id),requestAnimationFrame(()=>{var r;return null==(r=I.current[e])?void 0:r.focus()}))};"ArrowRight"===e.key&&(e.preventDefault(),t((r+1)%v.length)),"ArrowLeft"===e.key&&(e.preventDefault(),t((r-1+v.length)%v.length)),"Home"===e.key&&(e.preventDefault(),t(0)),"End"===e.key&&(e.preventDefault(),t(v.length-1))},[R]),G=(0,a.useCallback)(e=>{c({type:"setDraftRules",value:g(e.rules)}),c({type:"setDraftHtml",value:e.html}),T("output")},[]);return(0,l.jsxs)("div",{className:"h-full w-full overflow-auto bg-[var(--kali-bg)] p-6 text-[var(--kali-text)] space-y-6",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h1",{className:"text-3xl font-semibold",children:"HTML Rewriter"}),(0,l.jsx)("p",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_70%,transparent)] max-w-3xl",children:"Transform markup with CSS selectors and structured rule actions. Edit the rule JSON and watch the rewritten output update instantly."})]}),(0,l.jsx)("button",{type:"button",ref:S,className:"ml-auto inline-flex h-10 w-10 items-center justify-center rounded-full border border-[color:var(--kali-border)] bg-[color:var(--kali-panel)] text-xl text-[color:var(--color-ubt-blue)] transition hover:bg-[color:color-mix(in_srgb,_var(--kali-panel)_88%,_var(--color-ubt-blue)_12%)] focus-visible:border-[color:var(--color-focus-ring)] ".concat(k),"aria-label":"Open rewrite help",title:"Open rewrite help",onClick:()=>{N("selectors"),w(!0)},children:(0,l.jsx)("span",{"aria-hidden":"true",children:"❓"})})]}),(0,l.jsx)("div",{className:"sr-only",role:"status","aria-live":"polite",children:C}),(0,l.jsxs)("section",{className:"space-y-4 rounded-lg border border-[color:var(--kali-border)] bg-[color:var(--kali-panel)] p-6 shadow-lg",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-[color:var(--kali-text)]",children:"Quick start"}),(0,l.jsx)("p",{className:"text-sm text-gray-300 max-w-3xl",children:"Try the default rules below to remove inline scripts and overwrite headings before experimenting with your own selectors."}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-gray-200",children:"Rules"}),(0,l.jsx)("pre",{tabIndex:0,className:"mt-2 whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:g(m)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-gray-200",children:"Original HTML"}),(0,l.jsx)("pre",{tabIndex:0,className:"mt-2 whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:x})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-gray-200",children:"Rewritten HTML"}),(0,l.jsx)("pre",{tabIndex:0,className:"mt-2 whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:z})]})]})]}),(0,l.jsxs)("section",{className:"space-y-3 rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-100",children:"Presets"}),(0,l.jsx)("p",{className:"text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_70%,transparent)]",children:"Load a full ruleset and HTML sample with one click."})]}),(0,l.jsxs)("p",{className:"text-xs text-[color:color-mix(in_srgb,var(--kali-terminal-text)_60%,transparent)]",children:[n.validatedRules.length," validated rule",1===n.validatedRules.length?"":"s"]})]}),(0,l.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:h.map(e=>(0,l.jsxs)("button",{type:"button",className:"w-full rounded-md border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_94%,_transparent)] p-4 text-left transition hover:border-[color:color-mix(in_srgb,_var(--color-ubt-blue)_35%,_var(--kali-border)_65%)] hover:bg-[color:color-mix(in_srgb,_var(--kali-panel)_88%,_var(--color-ubt-blue)_12%)] focus-visible:border-[color:var(--color-focus-ring)] ".concat(k),onClick:()=>G(e),"aria-label":"Apply preset ".concat(e.name),children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-gray-100",children:e.name}),(0,l.jsx)("div",{className:"mt-1 text-xs text-[color:color-mix(in_srgb,var(--kali-terminal-text)_70%,transparent)]",children:e.description})]},e.id))})]}),(0,l.jsxs)("section",{className:"space-y-3",children:[(0,l.jsxs)("details",{className:"rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow",children:[(0,l.jsx)("summary",{className:"cursor-pointer text-sm font-semibold text-gray-100",children:"Remove elements"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_72%,transparent)]",children:[(0,l.jsxs)("p",{children:["Use the"," ",(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:"remove"})," ","action to strip matching nodes from the document entirely."]}),(0,l.jsx)("pre",{tabIndex:0,className:"whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:'{\n  "selector": "script",\n  "action": "remove"\n}'})]})]}),(0,l.jsxs)("details",{className:"rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow",children:[(0,l.jsx)("summary",{className:"cursor-pointer text-sm font-semibold text-gray-100",children:"Replace text content"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_72%,transparent)]",children:[(0,l.jsxs)("p",{children:["Swap the text content of the selected elements by providing a"," ",(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:"value"})," ","alongside the"," ",(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:"replaceText"})," ","action."]}),(0,l.jsx)("pre",{tabIndex:0,className:"whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:'{\n  "selector": "h1",\n  "action": "replaceText",\n  "value": "Rewritten Title"\n}'})]})]})]}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsxs)("div",{className:"flex flex-col rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow-lg",children:[(0,l.jsx)("label",{className:"mb-2 text-sm font-semibold text-gray-200",htmlFor:"html-rewriter-rules",children:"Rewrite Rules (JSON)"}),(0,l.jsx)("textarea",{id:"html-rewriter-rules",className:"flex-1 resize-y rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 font-mono text-sm text-[color:var(--kali-text)] shadow-inner focus-visible:border-[color:var(--color-focus-ring)] ".concat(k),value:n.draftRules,onChange:e=>c({type:"setDraftRules",value:e.target.value}),"aria-label":"Rewrite rules in JSON"}),J.length>0&&(0,l.jsxs)("div",{className:"mt-3 rounded-md border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_90%,_transparent)] p-3 text-sm text-red-200",children:[(0,l.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wide text-red-300",children:"Diagnostics"}),(0,l.jsx)("ul",{className:"mt-2 space-y-1 text-xs",children:J.map(e=>(0,l.jsxs)("li",{children:[void 0!==e.ruleIndex?"Rule ".concat(e.ruleIndex+1,": "):"",e.message]},e.id))})]})]}),(0,l.jsxs)("div",{className:"flex flex-col rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow-lg",children:[(0,l.jsx)("label",{className:"mb-2 text-sm font-semibold text-gray-200",htmlFor:"html-rewriter-sample",children:"Sample HTML"}),(0,l.jsx)("textarea",{id:"html-rewriter-sample",className:"flex-1 resize-y rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 font-mono text-sm text-[color:var(--kali-text)] shadow-inner focus-visible:border-[color:var(--color-focus-ring)] ".concat(k),value:n.draftHtml,onChange:e=>c({type:"setDraftHtml",value:e.target.value}),"aria-label":"Sample HTML"})]})]}),(0,l.jsxs)("section",{className:"space-y-3 rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow-lg",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-gray-100",children:"Output"}),(0,l.jsx)("p",{className:"text-xs text-[color:color-mix(in_srgb,var(--kali-terminal-text)_65%,transparent)]",children:"Live rewritten markup, diff view, and safe preview."})]}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",className:_,onClick:F,"aria-label":"Copy rewritten HTML",children:"Copy Output"}),(0,l.jsx)("button",{type:"button",className:y,onClick:()=>V("rewritten.html",n.resultHtml,"text/html"),"aria-label":"Download rewritten HTML",children:"Download HTML"}),(0,l.jsx)("button",{type:"button",className:y,onClick:()=>V("rewrite-rules.json",n.draftRules,"application/json"),"aria-label":"Download rewrite rules",children:"Download Rules"})]})]}),(0,l.jsx)("div",{role:"tablist","aria-label":"Output views",className:"flex flex-wrap gap-2",onKeyDown:B,children:v.map((e,r)=>{let t="html-rewriter-output-tab-".concat(e.id),a="html-rewriter-output-panel-".concat(e.id),o=R===e.id;return(0,l.jsx)("button",{id:t,role:"tab","aria-controls":a,"aria-selected":o,tabIndex:o?0:-1,ref:e=>{I.current[r]=e},className:"rounded border px-4 py-2 text-sm transition focus-visible:border-[color:var(--color-focus-ring)] ".concat(k," ").concat(o?"border-[color:color-mix(in_srgb,_var(--color-ubt-blue)_55%,_var(--kali-border)_45%)] bg-[color:color-mix(in_srgb,_var(--color-ubt-blue)_28%,_var(--kali-panel)_72%)] text-[color:var(--kali-text)] shadow-[0_0_0_1px_color-mix(in_srgb,_var(--color-ubt-blue)_45%,_transparent)]":"border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_94%,_transparent)] text-gray-200 hover:border-[color:color-mix(in_srgb,_var(--color-ubt-blue)_35%,_var(--kali-border)_65%)] hover:bg-[color:color-mix(in_srgb,_var(--kali-panel)_88%,_var(--color-ubt-blue)_12%)]"),onClick:()=>T(e.id),type:"button",children:e.label},e.id)})}),(0,l.jsxs)("div",{className:"rounded-lg border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 shadow-inner",role:"tabpanel",id:"html-rewriter-output-panel-".concat(R),"aria-labelledby":"html-rewriter-output-tab-".concat(R),tabIndex:0,children:["output"===R&&(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm text-[color:var(--kali-text)] ".concat(k),children:n.resultHtml}),"diff"===R&&(0,l.jsx)("pre",{className:"whitespace-pre-wrap text-sm leading-relaxed text-[color:var(--kali-text)] ".concat(k),children:n.diff.map((e,r)=>(0,l.jsx)("span",{className:e.added?"rounded-sm bg-kali-severity-low/20 px-1 text-kali-severity-low":e.removed?"rounded-sm bg-kali-severity-high/15 px-1 text-kali-severity-high line-through":"text-[color:color-mix(in_srgb,var(--kali-terminal-text)_80%,transparent)]",children:e.value},"".concat(r,"-").concat(e.value)))}),"preview"===R&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-xs text-[color:color-mix(in_srgb,var(--kali-terminal-text)_70%,transparent)]",children:"Preview runs in a sandboxed iframe with scripts disabled."}),(0,l.jsx)("iframe",{title:"Safe preview",sandbox:"allow-same-origin",srcDoc:n.resultHtml,className:"h-72 w-full rounded border border-[color:var(--kali-border)] bg-white"})]})]})]}),d&&(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-[rgba(9,15,23,0.88)] p-4",role:"presentation",onClick:()=>w(!1),children:(0,l.jsxs)("div",{role:"dialog","aria-modal":"true","aria-labelledby":H,"aria-describedby":L,className:"relative w-full max-w-2xl space-y-4 rounded border border-[color:var(--kali-border)] bg-[color:var(--kali-panel)] p-6 text-left text-[color:var(--kali-text)] shadow-xl",onClick:e=>e.stopPropagation(),ref:E,children:[(0,l.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{id:H,className:"text-xl font-semibold text-[color:var(--kali-terminal-text)]",children:"HTML Rewriter help"}),(0,l.jsx)("p",{id:L,className:"text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_70%,transparent)]",children:"Learn which selectors and actions are supported, plus copy a ready-to-use rule set."})]}),(0,l.jsx)("button",{type:"button","aria-label":"Close help",className:"inline-flex h-8 w-8 items-center justify-center rounded-full border border-[color:var(--kali-border)] bg-[color:var(--kali-panel)] text-lg text-[color:var(--kali-text)] transition hover:bg-[color:color-mix(in_srgb,_var(--kali-panel)_85%,_var(--color-ubt-blue)_15%)] focus-visible:border-[color:var(--color-focus-ring)] ".concat(k),onClick:()=>w(!1),children:(0,l.jsx)("span",{"aria-hidden":"true",children:"✕"})})]}),(0,l.jsx)("div",{role:"tablist","aria-label":"Help topics",className:"flex flex-wrap gap-2",onKeyDown:K,children:b.map((e,r)=>{let t="html-rewriter-help-tab-".concat(e.id),a="html-rewriter-help-panel-".concat(e.id),o=j===e.id;return(0,l.jsx)("button",{id:t,role:"tab","aria-controls":a,"aria-selected":o,tabIndex:o?0:-1,ref:e=>{P.current[r]=e},className:"rounded border px-4 py-2 text-sm transition focus-visible:border-[color:var(--color-focus-ring)] ".concat(k," ").concat(o?"border-[color:color-mix(in_srgb,_var(--color-ubt-blue)_55%,_var(--kali-border)_45%)] bg-[color:color-mix(in_srgb,_var(--color-ubt-blue)_28%,_var(--kali-panel)_72%)] text-[color:var(--kali-text)] shadow-[0_0_0_1px_color-mix(in_srgb,_var(--color-ubt-blue)_45%,_transparent)]":"border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_94%,_transparent)] text-gray-200 hover:border-[color:color-mix(in_srgb,_var(--color-ubt-blue)_35%,_var(--kali-border)_65%)] hover:bg-[color:color-mix(in_srgb,_var(--kali-panel)_88%,_var(--color-ubt-blue)_12%)]"),onClick:()=>N(e.id),type:"button",children:e.label},e.id)})}),(0,l.jsxs)("div",{className:"rounded-lg border border-[color:var(--kali-border)] bg-[color:color-mix(in_srgb,_var(--kali-panel)_92%,_transparent)] p-4 shadow-inner",role:"tabpanel",id:"html-rewriter-help-panel-".concat(j),"aria-labelledby":"html-rewriter-help-tab-".concat(j),children:["selectors"===j&&(0,l.jsxs)("div",{className:"space-y-2 text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_72%,transparent)]",children:[(0,l.jsx)("p",{children:"Target elements with any valid CSS selector. Combine class, id, or attribute selectors to focus the rewrite."}),(0,l.jsxs)("ul",{className:"list-disc space-y-1 pl-5",children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:"p"})," ","selects every paragraph element."]}),(0,l.jsxs)("li",{children:[(0,l.jsxs)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:["main ",">"," h2"]})," ","scopes to headings in the main area."]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:'[data-track="outbound"]'})," ","matches links tagged for tracking."]})]})]}),"actions"===j&&(0,l.jsxs)("div",{className:"space-y-3 text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_72%,transparent)]",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-semibold text-[color:var(--kali-text)]",children:"remove"}),(0,l.jsx)("p",{children:"Delete the matched node entirely. Useful for scripts, ads, or banners."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-base font-semibold text-[color:var(--kali-text)]",children:"replaceText"}),(0,l.jsxs)("p",{children:["Swap the text content of the target. Provide a"," ",(0,l.jsx)("code",{className:"rounded bg-[color:var(--kali-panel-highlight)] px-1 py-0.5 text-[color:var(--kali-text)]",children:"value"})," ","string to use as the replacement."]})]})]}),"payloads"===j&&(0,l.jsxs)("div",{className:"space-y-3 text-sm text-[color:color-mix(in_srgb,var(--kali-terminal-text)_72%,transparent)]",children:[(0,l.jsx)("p",{children:"Copy these starter rules to clean risky markup and annotate media placeholders."}),(0,l.jsx)("pre",{tabIndex:0,className:"whitespace-pre-wrap rounded-md border border-[color:var(--kali-border)] bg-[color:var(--kali-panel-highlight)] p-3 text-xs text-[color:var(--kali-text)] shadow-inner ".concat(k),children:'[\n  { "selector": "script", "action": "remove" },\n  { "selector": "img", "action": "replaceText", "value": "[image removed]" }\n]'}),(0,l.jsx)("p",{children:"Paste the JSON into the rule editor and adjust selectors or values to match your source HTML."})]})]})]})})]})}}}]);