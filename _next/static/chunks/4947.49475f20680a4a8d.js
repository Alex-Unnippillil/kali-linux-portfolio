"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4947],{16924:(e,r,t)=>{t.d(r,{default:()=>a});var n=t(14232);function a(e,r){let t=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let n=t.current;if(!n)return;let a=n.getContext("2d");if(!a)return;let c=()=>{let t=(()=>{let e=n.parentElement;if(!e)return null;let{clientWidth:r,clientHeight:t}=e;if(r>0&&t>0)return e;let a=e.closest("[data-game-viewport]");if(a)return a;let c=e.closest(".windowMainScreen");return null!=c?c:e})();if(!t)return;let{clientWidth:c,clientHeight:l}=t;if(c<=0||l<=0)return;let s=Math.min(c/e,l/r),u=e*s,o=r*s,i=window.devicePixelRatio||1;n.style.width="".concat(u,"px"),n.style.height="".concat(o,"px"),n.width=Math.floor(u*i),n.height=Math.floor(o*i),a.setTransform(i*s,0,0,i*s,0,0)};c();let l=n.parentElement,s=null==l?void 0:l.closest("[data-game-viewport]"),u=null==l?void 0:l.closest(".windowMainScreen"),o="undefined"!=typeof ResizeObserver?new ResizeObserver(c):null;return l&&o&&o.observe(l),s&&o&&s!==l&&o.observe(s),u&&o&&u!==l&&o.observe(u),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c),null==o||o.disconnect()}},[e,r]),t}},59776:(e,r,t)=>{t.d(r,{hasOffscreenCanvas:()=>n});let n=()=>"OffscreenCanvas"in window&&"undefined"!=typeof HTMLCanvasElement&&"function"==typeof HTMLCanvasElement.prototype.transferControlToOffscreen},94947:(e,r,t)=>{t.r(r),t.d(r,{checkCollision:()=>f,default:()=>h,getMedal:()=>i});var n=t(37876),a=t(14232),c=t(16924);let l=[{key:"red",label:"Red",color:"#ef4444",src:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="50"><rect width="30" height="50" rx="4" ry="4" fill="%23ef4444"/></svg>'},{key:"blue",label:"Blue",color:"#3b82f6",src:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="50"><rect width="30" height="50" rx="4" ry="4" fill="%233b82f6"/></svg>'},{key:"green",label:"Green",color:"#10b981",src:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="50"><rect width="30" height="50" rx="4" ry="4" fill="%2310b981"/></svg>'}];async function s(){return Object.fromEntries(await Promise.all(l.map(e=>new Promise(r=>{let t=new Image;t.onload=()=>r([e.key,t]),t.src=e.src}))))}var u=t(59776);let o=[{name:"bronze",score:500},{name:"silver",score:1e3},{name:"gold",score:1500}],i=e=>{let r=null;for(let{name:t,score:n}of o)e>=n&&(r=t);return r},f=(e,r)=>e.lane===r.lane&&r.y<e.y+e.height&&r.y+r.height>e.y,h=()=>{let e=(0,c.default)(300,400),[r,o]=(0,a.useState)(0),h=(0,a.useRef)(0),[d,g]=(0,a.useState)(0),[m,y]=(0,a.useState)(!0),b=(0,a.useRef)(!0),[x,w]=(0,a.useState)(!0),[p,v]=(0,a.useState)(()=>localStorage.getItem("car_racer_skin")||l[0].key),[k,S]=(0,a.useState)({}),[R,j]=(0,a.useState)(!0),N=(0,a.useRef)(!0),_=(0,a.useRef)(!0),C=(0,a.useRef)([]),E=(0,a.useRef)({lane:1,y:340,height:50}),M=(0,a.useRef)({near:[],far:[]}),O=(0,a.useRef)({near:[],far:[]}),[I,L]=(0,a.useState)(!1),A=(0,a.useRef)(0),z=(0,a.useRef)(!1),T=(0,a.useRef)(null),P=(0,a.useRef)({}),D=(0,a.useRef)({}),[J,F]=(0,a.useState)(!1),W=(0,a.useRef)(!1),[q,B]=(0,a.useState)(0),H=(0,a.useRef)(0),G=(0,a.useRef)(0),U=(0,a.useRef)([]),K=(0,a.useRef)([]),Q=(0,a.useRef)({lane:1,y:340}),V=(0,a.useRef)(0),X=(0,a.useRef)(0),Y=(0,a.useRef)(0),[Z,$]=(0,a.useState)(0),ee=(0,a.useRef)(0),er=l.find(e=>e.key===p)||l[0],et=(0,a.useRef)(null),en=a.useCallback(()=>{if(!N.current)return;et.current||(et.current=new(window.AudioContext||window.webkitAudioContext));let e=et.current,r=e.createOscillator(),t=e.createGain();r.connect(t),t.connect(e.destination),t.gain.value=.1,r.frequency.value=440,r.start(),r.stop(e.currentTime+.1)},[N,et]);(0,a.useEffect)(()=>{let e=localStorage.getItem("car_racer_high");e&&g(parseInt(e,10));try{D.current=JSON.parse(localStorage.getItem("car_racer_medals")||"{}")}catch(e){D.current={}}try{U.current=JSON.parse(localStorage.getItem("car_racer_ghost")||"[]"),X.current=parseInt(localStorage.getItem("car_racer_ghost_score")||"0",10),U.current.length&&(Q.current.lane=U.current[0].lane)}catch(e){U.current=[],X.current=0}{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{z.current=e.matches};return r(),e.addEventListener("change",r),()=>e.removeEventListener("change",r)}},[]),(0,a.useEffect)(()=>{s().then(S)},[]),(0,a.useEffect)(()=>{localStorage.setItem("car_racer_skin",p)},[p]),(0,a.useEffect)(()=>{let r,n,a=e.current;if(!a)return;let c="function"==typeof Worker&&(0,u.hasOffscreenCanvas)();if(c){T.current=r=new Worker(t.tu(new URL(t.p+t.u(6027),t.b)));let e=a.transferControlToOffscreen();r.postMessage({type:"init",canvas:e},[e])}else(n=a.getContext("2d"))&&(n.imageSmoothingEnabled=!1);a.style.imageRendering="pixelated";let l=performance.now(),s=0,i=0,m=0,y=0,x=0,w=0,p=0,v=e=>{let t=(e-l)/1e3;l=e;let u=A.current>0?2:1,k=200*u,S=!b.current&&_.current?k:0;if(ee.current!==S&&(ee.current=S,$(Math.floor(S))),!b.current&&_.current){if(i=(i+k*t)%40,m=(m+.5*k*t)%40,(s+=t)>1){let e=Math.floor(3*Math.random());C.current.push({lane:e,y:-40,height:40}),s=0}if(C.current.forEach(e=>{e.y+=k*t}),C.current=C.current.filter(e=>e.y<440),z.current||(y+=t,x+=t,y>.3&&(M.current.near.push({y:-30}),y=0),x>.5&&(M.current.far.push({y:-20}),x=0),M.current.near.forEach(e=>{e.y+=1.2*k*t}),M.current.far.forEach(e=>{e.y+=.5*k*t}),M.current.near=M.current.near.filter(e=>e.y<430),M.current.far=M.current.far.filter(e=>e.y<420),w+=t,p+=t,w>.5&&(O.current.near.push({x:300*Math.random(),y:-10}),w=0),p>1&&(O.current.far.push({x:300*Math.random(),y:-10}),p=0),O.current.near.forEach(e=>{e.y+=.3*k*t}),O.current.far.forEach(e=>{e.y+=.15*k*t}),O.current.near=O.current.near.filter(e=>e.y<400),O.current.far=O.current.far.filter(e=>e.y<400)),U.current.length){let e=(performance.now()-Y.current)/1e3,r=U.current;for(;V.current<r.length&&r[V.current].t<=e;)Q.current.lane=r[V.current].lane,V.current+=1}for(let e of C.current)if(f(E.current,e)){_.current=!1,en(),ea(h.current),h.current>d&&(g(h.current),localStorage.setItem("car_racer_high","".concat(h.current))),ef(Math.floor(h.current));break}h.current+=100*t*u,o(Math.floor(h.current)),A.current>0&&(A.current-=t,A.current<=0&&L(!1))}if(z.current)a.style.filter="none";else{let e=A.current>0?4*A.current/2:0;a.style.filter=e?"blur(".concat(e,"px)"):"none"}(()=>{let e={car:{lane:E.current.lane,y:E.current.y},carColor:er.color,obstacles:C.current.map(e=>({lane:e.lane,y:e.y})),roadside:z.current?null:{near:M.current.near.map(e=>e.y),far:M.current.far.map(e=>e.y)},background:z.current?null:{near:O.current.near.map(e=>({x:e.x,y:e.y})),far:O.current.far.map(e=>({x:e.x,y:e.y}))},lineOffsetNear:i,lineOffsetFar:m,ghost:U.current.length>0?{lane:Q.current.lane,y:E.current.y}:null};if(c){let t={},n=P.current;Object.keys(e).forEach(r=>{JSON.stringify(e[r])!==JSON.stringify(n[r])&&(t[r]=e[r])}),Object.keys(t).length&&(r.postMessage({type:"state",diff:t}),P.current={...n,...t})}else(e=>{if(!n)return;n.fillStyle="#333",n.fillRect(0,0,300,400),e.background&&(n.fillStyle="#111",e.background.far.forEach(e=>{let{x:r,y:t}=e;n.fillRect(r,t,2,2)}),n.fillStyle="#555",e.background.near.forEach(e=>{let{x:r,y:t}=e;n.fillRect(r,t,3,3)})),e.roadside&&(n.fillStyle="#999",e.roadside.far.forEach(e=>{n.fillRect(2,e,6,20),n.fillRect(292,e,6,20)}),n.fillStyle="#ccc",e.roadside.near.forEach(e=>{n.fillRect(0,e,10,30),n.fillRect(290,e,10,30)})),n.strokeStyle="#fff",n.setLineDash([20,20]),n.globalAlpha=.6,n.lineWidth=2,n.lineDashOffset=-(e.lineOffsetFar||0);for(let e=1;e<3;e+=1)n.beginPath(),n.moveTo(100*e,0),n.lineTo(100*e,400),n.stroke();n.globalAlpha=1,n.lineWidth=4,n.lineDashOffset=-(e.lineOffsetNear||0);for(let e=1;e<3;e+=1)n.beginPath(),n.moveTo(100*e,0),n.lineTo(100*e,400),n.stroke();if(n.setLineDash([]),e.ghost){let r=100*e.ghost.lane+20;n.fillStyle="rgba(255,255,255,0.5)",n.fillRect(r,e.ghost.y,60,50)}let r=100*e.car.lane+20;n.fillStyle=e.carColor||"red",n.fillRect(r,e.car.y,60,50),n.fillStyle="blue",e.obstacles.forEach(e=>{let r=100*e.lane+20;n.fillRect(r,e.y,60,40)})})(e)})(),requestAnimationFrame(v)},k=requestAnimationFrame(v);return()=>{cancelAnimationFrame(k),r&&r.terminate()}},[e,d,en,er.color]);let ea=e=>{K.current.length>1&&e>=X.current&&(localStorage.setItem("car_racer_ghost",JSON.stringify(K.current)),localStorage.setItem("car_racer_ghost_score","".concat(e)),U.current=K.current.map(e=>({...e})),X.current=e)},ec=a.useCallback(()=>{let e=performance.now()/1e3;e-G.current<1?H.current+=1:H.current=1,G.current=e;let r=50*H.current;h.current+=r,o(Math.floor(h.current)),B(H.current),setTimeout(()=>B(0),1e3)},[G,H,h,o,B]),el=a.useCallback(()=>{let e=(performance.now()-Y.current)/1e3;K.current.push({t:e,lane:E.current.lane}),ec()},[ec,Y,E,K]),es=a.useCallback(e=>!W.current||!C.current.some(r=>f({lane:e,y:E.current.y,height:50},r)),[W,C,E]),eu=a.useCallback(()=>{let e=E.current.lane-1;E.current.lane>0&&es(e)&&(E.current.lane=e,en(),el())},[es,en,el,E]),eo=a.useCallback(()=>{let e=E.current.lane+1;E.current.lane<2&&es(e)&&(E.current.lane=e,en(),el())},[es,en,el,E]),ei=a.useCallback(()=>{z.current||(A.current=2,L(!0))},[]);(0,a.useEffect)(()=>{let e=e=>{("ArrowLeft"===e.key||"a"===e.key)&&eu(),("ArrowRight"===e.key||"d"===e.key)&&eo(),("ArrowUp"===e.key||"w"===e.key)&&ei()," "===e.key&&y(e=>(b.current=!e,!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eu,eo,ei]);let ef=e=>{let r=i(e);r&&(D.current[e]=r,localStorage.setItem("car_racer_medals",JSON.stringify(D.current)))};return(0,n.jsxs)("div",{className:"h-full w-full relative text-white select-none",children:[(0,n.jsx)("canvas",{ref:e,className:"h-full w-full bg-black"}),x&&(0,n.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-60 z-20 flex flex-col items-center justify-center space-y-4",children:[(0,n.jsx)("div",{className:"flex space-x-4",children:l.map(e=>{var r;return(0,n.jsx)("button",{onClick:()=>v(e.key),className:"border-2 ".concat(p===e.key?"border-white":"border-transparent"),children:(0,n.jsx)("img",{src:(null==(r=k[e.key])?void 0:r.src)||e.src,alt:e.label,className:"h-12 w-8"})},e.key)})}),(0,n.jsx)("button",{className:"bg-gray-700 px-3 py-1",onClick:()=>{h.current>d&&(g(h.current),localStorage.setItem("car_racer_high","".concat(h.current))),ef(Math.floor(h.current)),C.current=[],E.current.lane=1,h.current=0,o(0),_.current=!0,y(!1),b.current=!1,Y.current=performance.now(),K.current=[{t:0,lane:E.current.lane}],V.current=0;try{U.current=JSON.parse(localStorage.getItem("car_racer_ghost")||"[]"),X.current=parseInt(localStorage.getItem("car_racer_ghost_score")||"0",10)}catch(e){U.current=[],X.current=0}Q.current.lane=U.current.length?U.current[0].lane:E.current.lane,B(0),w(!1)},children:"Start"})]}),(0,n.jsxs)("div",{className:"absolute top-2 left-2 text-sm space-y-1 z-10","aria-live":"polite",role:"status",children:[(0,n.jsxs)("div",{children:["Score: ",r]}),(0,n.jsxs)("div",{children:["High: ",d]}),i(r)&&(0,n.jsxs)("div",{"data-testid":"medal-display",children:["Medal: ",i(r)]}),I&&!z.current&&(0,n.jsx)("div",{children:"Boost!"}),q>1&&(0,n.jsxs)("div",{children:["Drift x",q]})]}),(0,n.jsxs)("div",{className:"absolute bottom-2 left-2 space-x-2 z-10 text-sm",children:[(0,n.jsx)("button",{className:"bg-gray-700 px-2 focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>{b.current=!0,y(!0),w(!0)},children:"Reset"}),(0,n.jsx)("button",{className:"bg-gray-700 px-2 focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>{y(e=>(b.current=!e,!e))},children:m?"Resume":"Pause"}),(0,n.jsx)("button",{className:"bg-gray-700 px-2 focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>{N.current=!N.current,j(N.current)},children:R?"Sound: on":"Sound: off"}),(0,n.jsx)("button",{className:"bg-gray-700 px-2 focus:outline-none focus:ring-2 focus:ring-white",onClick:()=>{W.current=!W.current,F(W.current)},children:J?"Lane Assist: on":"Lane Assist: off"}),(0,n.jsx)("button",{className:"bg-gray-700 px-2 focus:outline-none focus:ring-2 focus:ring-white",onClick:ei,children:"Boost"})]}),(0,n.jsxs)("div",{className:"absolute bottom-2 right-2 z-10 text-sm w-24",children:[(0,n.jsx)("div",{className:"w-full h-2 bg-gray-700",children:(0,n.jsx)("div",{className:"h-full bg-green-500",style:{width:"".concat(Z/400*100,"%")}})}),(0,n.jsx)("div",{className:"text-right mt-1",children:Math.round(Z)})]}),(0,n.jsxs)("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex space-x-4 z-10",children:[(0,n.jsx)("button",{"aria-label":"Steer left",className:"w-12 h-12 bg-gray-700 bg-opacity-70 flex items-center justify-center text-xl rounded",onPointerDown:eu,children:"←"}),(0,n.jsx)("button",{"aria-label":"Steer right",className:"w-12 h-12 bg-gray-700 bg-opacity-70 flex items-center justify-center text-xl rounded",onPointerDown:eo,children:"→"})]}),!_.current&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center z-20",role:"alert",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-2xl mb-2",children:"Crash!"}),(0,n.jsx)("div",{className:"text-sm",children:"Press Reset to play again"})]})})]})}}}]);