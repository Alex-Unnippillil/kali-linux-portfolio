"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9293],{16924:(e,t,r)=>{r.d(t,{default:()=>a});var l=r(14232);function a(e,t){let r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let l=r.current;if(!l)return;let a=l.getContext("2d");if(!a)return;let n=()=>{let r=(()=>{let e=l.parentElement;if(!e)return null;let{clientWidth:t,clientHeight:r}=e;if(t>0&&r>0)return e;let a=e.closest("[data-game-viewport]");if(a)return a;let n=e.closest(".windowMainScreen");return null!=n?n:e})();if(!r)return;let{clientWidth:n,clientHeight:i}=r;if(n<=0||i<=0)return;let s=Math.min(n/e,i/t),o=e*s,c=t*s,u=window.devicePixelRatio||1;l.style.width="".concat(o,"px"),l.style.height="".concat(c,"px"),l.width=Math.floor(o*u),l.height=Math.floor(c*u),a.setTransform(u*s,0,0,u*s,0,0)};n();let i=l.parentElement,s=null==i?void 0:i.closest("[data-game-viewport]"),o=null==i?void 0:i.closest(".windowMainScreen"),c="undefined"!=typeof ResizeObserver?new ResizeObserver(n):null;return i&&c&&c.observe(i),s&&c&&s!==i&&c.observe(s),o&&c&&o!==i&&c.observe(o),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),null==c||c.disconnect()}},[e,t]),r}},39293:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var l=r(37876),a=r(14232),n=r(70994),i=r(16924),s=r(95220),o=r(90209),c=r(66893),u=r(98306);let f={w:20,h:14},d={w:26,h:12},h=[1e3,5e3,1e4],p=(e,t,r)=>Math.min(Math.max(e,t),r),y=(e,t)=>{let r=t-70,l=e/4;return[{x:l-30,y:r,w:50,h:18,hp:12,rows:2,cols:3,segments:Array.from({length:6},()=>2),segmentHp:2},{x:2*l-25,y:r,w:50,h:18,hp:12,rows:2,cols:3,segments:Array.from({length:6},()=>2),segmentHp:2},{x:3*l-20,y:r,w:50,h:18,hp:12,rows:2,cols:3,segments:Array.from({length:6},()=>2),segmentHp:2}]},v=e=>0===e?30:1===e?20:10,x=(e,t)=>{let r=4+(e-1),l=(t-224)/2,a=[];for(let e=0;e<r;e+=1)for(let t=0;t<8;t+=1){let r=v(e);a.push({x:l+32*t,y:40+32*e,w:f.w,h:f.h,alive:!0,phase:(0,u.random)()*Math.PI*2,row:e,column:t,points:r})}return a},m=e=>{var t,r,l;let a=null!=(t=null==e?void 0:e.width)?t:480,n=null!=(r=null==e?void 0:e.height)?r:360,i={x:a/2-d.w/2,y:n-30,w:d.w,h:d.h,speed:160,cooldown:0,rapid:0,shield:!1,shieldHp:0};return{width:a,height:n,stage:1,score:0,lives:3,highScore:null!=(l=null==e?void 0:e.highScore)?l:0,gameOver:!1,player:i,invaders:x(1,a),shields:y(a,n),bullets:[],powerUps:[],ufo:{active:!1,x:0,y:18,dir:1,w:30,h:12},invaderDir:1,invaderStepTimer:0,invaderFrame:0,enemyCooldown:1,ufoTimer:0,waveTime:0,extraLifeIndex:0,frontLine:Array.from({length:8},()=>-1)}},g=(e,t)=>Math.max(e,t),w=(e,t)=>{let r=e.find(e=>!e.active);if(r)return void Object.assign(r,t,{active:!0});e.push({...t,active:!0})},b=(e,t)=>{let r=e.player;"shield"===t?(r.shield=!0,r.shieldHp=3):"rapid"===t?r.rapid=4:"life"===t&&(e.lives+=1)},S=()=>{let e=(0,u.random)();return e<.34?"shield":e<.67?"rapid":"life"},k=(e,t,r,l,a,n,i,s)=>e<a+i&&e+r>a&&t<n+s&&t+l>n,j=(e,t,r)=>{if(e.hp<=0||!k(t.x,t.y,2,6,e.x,e.y,e.w,e.h))return!1;let l=t.x-e.x,a=t.y-e.y,n=p(Math.floor(l/e.w*e.cols),0,e.cols-1),i=p(Math.floor(a/e.h*e.rows),0,e.rows-1)*e.cols+n;return e.segments[i]>0&&(e.segments[i]=Math.max(0,e.segments[i]-1),e.hp=Math.max(0,e.hp-1),t.active=!1,r.push({type:"shield-hit",x:t.x,y:t.y}),!0)},C=()=>{let e=(0,i.default)(480,360),t=(0,a.useRef)(null),r=(0,a.useRef)(null),f=(0,a.useRef)(m({width:480,height:360})),d=(0,a.useRef)({left:!1,right:!1,fire:!1}),v=(0,a.useRef)(null),C=(0,a.useRef)(null),R=(0,a.useRef)({left:!1,right:!1,fire:!1}),E=(0,a.useRef)([]),N=(0,a.useRef)((()=>{let e=(e=>{let t=e%0x7fffffff;return t<=0&&(t+=0x7ffffffe),()=>((t=16807*t%0x7fffffff)-1)/0x7ffffffe})(42);return Array.from({length:48},()=>{let t=Math.floor(3*e()),r=6+12*t+6*e();return{x:480*e(),y:360*e(),size:.8+.4*t,speed:r,alpha:.4+.5*e()}})})()),M=(0,a.useRef)({time:0,intensity:0,phase:0}),[T,L]=(0,a.useState)(1),[A,D]=(0,a.useState)(3),[H,I]=(0,a.useState)(0),[P,z]=(0,s.default)("si_highscore",0,e=>"number"==typeof e),[G,U]=(0,s.default)("space-invaders-difficulty",1,e=>"number"==typeof e),[O,F]=(0,s.default)("space-invaders-sound",!0,e=>"boolean"==typeof e),[K,W]=(0,s.default)("space-invaders-touch",!1,e=>"boolean"==typeof e),[_,B]=(0,s.default)("space-invaders-gamepad",!0,e=>"boolean"==typeof e),[q,V]=(0,s.default)("space-invaders-shake",!0,e=>"boolean"==typeof e),[X,J]=(0,a.useState)(!1),[Q,Y]=(0,a.useState)("ready"),[Z,$]=(0,a.useState)(0),[ee,et]=(0,a.useState)(""),[er,el]=(0,a.useState)(!1),[ea,en]=(0,a.useState)(""),ei=(0,o.default)(),es=(0,c.useGamepad)(),{scores:eo,addScore:ec}=(0,c.useLeaderboard)("space-invaders",5),{record:eu,registerReplay:ef}=(0,n.useInputRecorder)(),ed=(0,a.useRef)(null),eh=(0,a.useRef)(!1),ep=(0,a.useRef)(null),ey=(0,a.useRef)(null),ev=(0,a.useRef)({stage:1,lives:3,score:0,highScore:P}),ex=(0,a.useCallback)(()=>{d.current={left:!1,right:!1,fire:!1},R.current={left:!1,right:!1,fire:!1}},[]),em=(0,a.useCallback)(()=>{$(3),Y("countdown"),J(!1)},[]),eg=(0,a.useCallback)(e=>{f.current=m({width:480,height:360,highScore:P}),L(1),D(3),I(0),el(!1),et(""),ey.current=null,v.current=null,ex(),(null==e?void 0:e.skipCountdown)?($(0),Y("playing")):em()},[em,P,ex]),ew=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.08;if(!O||!eh.current)return;ed.current||(ed.current=new(window.AudioContext||window.webkitAudioContext));let r=ed.current;if(!r)return;let l=r.createOscillator(),a=r.createGain();a.gain.value=.08,l.frequency.value=e,l.connect(a),a.connect(r.destination),l.start(),l.stop(r.currentTime+t)},[O]),eb=(0,a.useCallback)(e=>{!ei&&q&&(M.current.time=.28,M.current.intensity=e,M.current.phase=0)},[ei,q]),eS=(0,a.useCallback)(function(e,t,r){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=ei?Math.min(4,l):l;for(let l=0;l<a&&!(E.current.length>=80);l+=1){let n=2*Math.PI*l/a;E.current.push({x:e,y:t,dx:Math.cos(n)*(30+2*l),dy:Math.sin(n)*(30+2*l),life:.4,maxLife:.4,size:2,color:r})}},[ei]),ek=(0,a.useCallback)(e=>{en(e),window.clearTimeout(ep.current||0),ep.current=window.setTimeout(()=>en(""),1200)},[]),ej=(0,a.useCallback)(()=>{let e=f.current;e.stage!==ev.current.stage&&(ev.current.stage=e.stage,L(e.stage)),e.lives!==ev.current.lives&&(ev.current.lives=e.lives,D(e.lives)),e.score!==ev.current.score&&(ev.current.score=e.score,I(e.score)),e.highScore!==ev.current.highScore&&(e.highScore>ev.current.highScore&&ek("New high score!"),ev.current.highScore=e.highScore,z(e.highScore))},[ek,z]),eC=(0,a.useCallback)(e=>{let t=R.current;(t.left!==e.left||t.right!==e.right||t.fire!==e.fire)&&(R.current={...e},eu({type:"input",...e}))},[eu]),eR=(0,a.useCallback)(()=>{if(v.current)return v.current;let e=d.current,t=e.left,r=e.right,l=e.fire;if(_&&es.connected){var a,n,i,s,o;let e=null!=(a=es.axes[0])?a:0,c=(null!=(n=es.buttons[14])?n:0)>.5,u=(null!=(i=es.buttons[15])?i:0)>.5;t=t||e<-.25||c,r=r||e>.25||u;let f=(null!=(s=es.buttons[0])?s:0)>.5||(null!=(o=es.buttons[1])?o:0)>.5;l=l||f}let c={left:t,right:r,fire:l};return eC(c),c},[_,es,eC]),eE=(0,a.useCallback)(e=>{e.forEach(e=>{if("invader-destroyed"===e.type){var t;ew(640-(null!=(t=e.row)?t:0)*24),void 0!==e.x&&void 0!==e.y&&eS(e.x,e.y,"#a7f3d0",6)}"ufo-destroyed"===e.type&&(ew(900,.12),void 0!==e.x&&void 0!==e.y&&eS(e.x,e.y,"#f472b6",12)),"life-lost"===e.type&&(ew(180,.2),eb(4)),"shield-hit"===e.type&&ew(280,.04),"wave-complete"===e.type&&(Y("wave"),ek("Wave cleared. Get ready."),eb(3)),"game-over"===e.type&&(Y("gameover"),ek("Game over.")),"extra-life"===e.type&&(ek("Extra life awarded."),ew(760,.12)),e.message&&ek(e.message)})},[ek,ew,eS,eb]),eN=(0,a.useCallback)(e=>{N.current.forEach(t=>{t.y+=t.speed*e,t.y>360&&(t.y-=360)})},[]),eM=(0,a.useCallback)(e=>{if(!E.current.length)return;let t=0;for(let r=0;r<E.current.length;r+=1){let l=E.current[r];l.life-=e,l.life<=0||(l.x+=l.dx*e,l.y+=l.dy*e,l.dy+=20*e,E.current[t]=l,t+=1)}E.current.length=t},[]),eT=(0,a.useCallback)(()=>{let t=e.current;if(!t)return;r.current||(r.current=t.getContext("2d"));let l=r.current;if(!l)return;let a=f.current;l.clearRect(0,0,480,360),l.imageSmoothingEnabled=!1,l.save();let n=M.current;if(n.time>0&&q&&!ei){let e=n.time/.28*n.intensity,t=Math.sin(n.phase)*e,r=Math.cos(1.3*n.phase)*e;l.translate(t,r)}let i=l.createLinearGradient(0,0,0,360);i.addColorStop(0,"#020617"),i.addColorStop(1,"#0b1120"),l.fillStyle=i,l.fillRect(0,0,480,360),N.current.forEach(e=>{l.globalAlpha=e.alpha,l.fillStyle="#e2e8f0",l.fillRect(e.x,e.y,e.size,e.size)}),l.globalAlpha=1,l.fillStyle="#f8fafc",l.fillRect(a.player.x,a.player.y,a.player.w,a.player.h),l.fillStyle="#94a3b8",l.fillRect(a.player.x+.35*a.player.w,a.player.y-3,.3*a.player.w,3),a.player.shield&&(l.strokeStyle="#22d3ee",l.lineWidth=2,l.strokeRect(a.player.x-2,a.player.y-2,a.player.w+4,a.player.h+4),l.fillStyle="#22d3ee",l.fillRect(a.player.x-2,a.player.y-6,(a.player.w+4)*a.player.shieldHp/3,3)),a.invaders.forEach(e=>{if(!e.alive)return;l.fillStyle=(e=>e>=30?"#f472b6":e>=20?"#34d399":"#a3e635")(e.points);let t=ei?0:1.5*Math.sin(e.phase);l.fillRect(e.x,e.y+t,e.w,e.h),1===a.invaderFrame?(l.fillRect(e.x+2,e.y+e.h+t,4,2),l.fillRect(e.x+e.w-6,e.y+e.h+t,4,2)):l.fillRect(e.x+4,e.y-2+t,e.w-8,2)}),l.fillStyle="#facc15",a.bullets.forEach(e=>{e.active&&(l.fillStyle="player"===e.owner?"#facc15":"#fb7185",l.fillRect(e.x,e.y,2,6))}),a.shields.forEach(e=>{if(e.hp<=0)return;let t=e.w/e.cols,r=e.h/e.rows;for(let a=0;a<e.rows;a+=1)for(let n=0;n<e.cols;n+=1){let i=a*e.cols+n,s=e.segments[i];if(s<=0)continue;let o=s/e.segmentHp;l.fillStyle=o>.66?"#94a3b8":o>.33?"#64748b":"#475569",l.fillRect(e.x+n*t,e.y+a*r,t-1,r-1)}}),a.powerUps.forEach(e=>{e.active&&(l.fillStyle="shield"===e.type?"#22d3ee":"rapid"===e.type?"#fb923c":"#f472b6",l.fillRect(e.x-5,e.y-5,10,10))}),E.current.forEach(e=>{l.globalAlpha=Math.max(0,e.life/e.maxLife),l.fillStyle=e.color,l.fillRect(e.x,e.y,e.size,e.size)}),l.globalAlpha=1,a.ufo.active&&(l.fillStyle="#f472b6",l.fillRect(a.ufo.x,a.ufo.y,a.ufo.w,a.ufo.h),l.fillStyle="#fbcfe8",l.fillRect(a.ufo.x+4,a.ufo.y+3,a.ufo.w-8,3)),l.restore()},[e,ei,q]);(0,a.useEffect)(()=>{ev.current.highScore=P},[P]),(0,a.useEffect)(()=>{if("countdown"!==Q||X)return;if(Z<=0)return void Y("playing");let e=window.setTimeout(()=>{$(e=>e-1)},1e3);return()=>window.clearTimeout(e)},[Z,X,Q]),(0,a.useEffect)(()=>{var e,t;"countdown"===Q&&_&&es.connected&&((null!=(e=es.buttons[0])?e:0)>.5||(null!=(t=es.buttons[1])?t:0)>.5)&&($(0),Y("playing"))},[_,es,Q]),(0,a.useEffect)(()=>{var e,t;if("gameover"!==Q)return;let r=f.current.score;ey.current=r;let l=null!=(t=null==(e=eo[eo.length-1])?void 0:e.score)?t:-1/0,a=eo.length<5||r>l;el(a),a&&et("")},[eo,Q]),(0,a.useEffect)(()=>{ef((e,t)=>{0===t&&(v.current={left:!1,right:!1,fire:!1},eg({skipCountdown:!0})),e&&"input"===e.type&&(v.current={left:!!e.left,right:!!e.right,fire:!!e.fire},C.current&&window.clearTimeout(C.current),C.current=window.setTimeout(()=>{v.current=null},200))})},[ef,eg]),(0,c.useGameLoop)(e=>{if("playing"!==Q||X)return;let t=eR();eE(((e,t,r,l)=>{var a,n;let i=[];if((null==l?void 0:l.paused)||e.gameOver)return{events:i};let s=Math.min(r,.05),o=null!=(a=null==l?void 0:l.difficulty)?a:1,c=e.player,f=(t.left?-1:0)+ +!!t.right;if(c.x=p(c.x+f*c.speed*s,0,e.width-c.w),c.cooldown=Math.max(0,c.cooldown-s),t.fire&&c.cooldown<=0){let t=c.rapid>0?2:1,r=0;for(let t of e.bullets)t.active&&"player"===t.owner&&(r+=1);r<t&&(w(e.bullets,{x:c.x+c.w/2-1,y:c.y-4,dx:0,dy:-240,owner:"player"}),c.cooldown=c.rapid>0?.18:.45)}c.rapid>0&&(c.rapid=Math.max(0,c.rapid-s)),e.bullets.forEach(t=>{t.active&&(t.x+=t.dx*s,t.y+=t.dy*s*("enemy"===t.owner?o:1),(t.y<-20||t.y>e.height+20||t.x<-20||t.x>e.width+20)&&(t.active=!1))});let d=0;for(let t of e.invaders)t.alive&&(d+=1,t.phase+=2*s);if(e.enemyCooldown-=s,e.enemyCooldown<=0&&d>0){let t=0;for(let r of e.bullets)r.active&&"enemy"===r.owner&&(t+=1);if(t>=3)e.enemyCooldown=Math.min(e.enemyCooldown,.2);else{e.frontLine.fill(-1);for(let t=0;t<e.invaders.length;t+=1){let r=e.invaders[t];if(!r.alive)continue;let l=e.frontLine[r.column];(-1===l||r.y>e.invaders[l].y)&&(e.frontLine[r.column]=t)}let t=-1,r=0;for(let l of e.frontLine)!(l<0)&&(r+=1,(0,u.random)()<1/r&&(t=l));if(t>=0){let r=e.invaders[t];w(e.bullets,{x:r.x+r.w/2,y:r.y+r.h,dx:0,dy:200,owner:"enemy"})}n=d/(e.invaders.length||1),e.enemyCooldown=p(1.15*Math.max(.25,n)/((1+.18*e.stage)*(1+.35*o)),.35,1.2)}}e.waveTime+=s;let v=.65*Math.max(.2,d/(e.invaders.length||1))/(e.stage*o*(1+.04*e.waveTime));if(e.invaderStepTimer+=s,e.invaderStepTimer>=v&&d>0){e.invaderStepTimer-=v,e.invaderFrame=+(0===e.invaderFrame);let t=!1;for(let r of e.invaders)r.alive&&(r.x+=10*e.invaderDir,(r.x<10||r.x+r.w>e.width-10)&&(t=!0));if(t)for(let t of(e.invaderDir*=-1,e.invaders))t.alive&&(t.y+=10)}for(let t of e.invaders)if(t.alive&&t.y+t.h>=c.y)return e.gameOver=!0,e.lives=0,e.highScore=g(e.score,e.highScore),i.push({type:"game-over"}),{events:i};e.ufoTimer+=s,!e.ufo.active&&e.ufoTimer>12&&.02>(0,u.random)()&&(e.ufo={active:!0,x:0,y:18,dir:1,w:30,h:12},e.ufoTimer=0,i.push({type:"ufo-spawn",message:"Saucer approaching"})),e.ufo.active&&(e.ufo.x+=90*e.ufo.dir*s,(e.ufo.x>e.width||e.ufo.x<-e.ufo.w)&&(e.ufo.active=!1));let m=0;for(let t=0;t<e.powerUps.length;t+=1){let r=e.powerUps[t];r.active&&(r.y+=40*s,r.y>e.height+10&&(r.active=!1),k(r.x-5,r.y-5,10,10,c.x,c.y,c.w,c.h)&&(r.active=!1,b(e,r.type),"life"===r.type&&i.push({type:"extra-life",message:"Extra life!"}),i.push({type:"powerup",message:"".concat(r.type," collected")})),r.active&&(e.powerUps[m]=r,m+=1))}for(let t of(e.powerUps.length=m,e.bullets))if(t.active){if("player"===t.owner){for(let r of e.invaders)if(r.alive&&k(t.x,t.y,2,6,r.x,r.y,r.w,r.h)){r.alive=!1,t.active=!1,e.score+=r.points,i.push({type:"invader-destroyed",value:r.points,x:r.x+r.w/2,y:r.y+r.h/2,row:r.row}),.1>(0,u.random)()&&e.powerUps.push({x:r.x+r.w/2,y:r.y+r.h/2,type:S(),active:!0});break}if(t.active&&e.ufo.active&&k(t.x,t.y,2,6,e.ufo.x,e.ufo.y,e.ufo.w,e.ufo.h)&&(t.active=!1,e.ufo.active=!1,e.score+=50,i.push({type:"ufo-destroyed",value:50,x:e.ufo.x+e.ufo.w/2,y:e.ufo.y+e.ufo.h/2})),t.active){for(let r of e.shields)if(j(r,t,i))break}}else if("enemy"===t.owner){if(t.active){for(let r of e.shields)if(j(r,t,i))break}t.active&&k(t.x,t.y,2,6,c.x,c.y,c.w,c.h)&&(t.active=!1,c.shield&&c.shieldHp>0?(c.shieldHp-=1,c.shieldHp<=0&&(c.shield=!1)):(e.lives-=1,i.push({type:"life-lost"}),e.lives<=0&&(e.gameOver=!0,e.highScore=g(e.score,e.highScore),i.push({type:"game-over"}))))}}return e.invaders.every(e=>!e.alive)&&(e.stage+=1,e.invaders=x(e.stage,e.width),e.shields=y(e.width,e.height),e.invaderDir=1,e.invaderStepTimer=0,e.waveTime=0,e.invaderFrame=0,e.ufo.active=!1,e.frontLine.fill(-1),i.push({type:"wave-complete"})),e.extraLifeIndex<h.length&&e.score>=h[e.extraLifeIndex]&&(e.lives+=1,e.extraLifeIndex+=1,i.push({type:"extra-life",message:"Extra life!"})),e.highScore=g(e.score,e.highScore),{events:i}})(f.current,t,e,{difficulty:G}).events),eN(e),eM(e),M.current.time>0&&(M.current.time=Math.max(0,M.current.time-e),M.current.phase+=30*e),ej(),eT(),f.current.gameOver&&Y("gameover")},"playing"===Q&&!X),(0,a.useEffect)(()=>{let e=t.current;e&&e.focus()},[]),(0,a.useEffect)(()=>{eT()},[eT,X,Q]),(0,a.useEffect)(()=>{ex()},[ex,Q]),(0,a.useEffect)(()=>{X?(ek("Paused"),ex()):"playing"===Q&&ek("Resumed")},[ek,X,ex,Q]),(0,a.useEffect)(()=>()=>{ed.current&&ed.current.close(),ep.current&&window.clearTimeout(ep.current),C.current&&window.clearTimeout(C.current)},[]);let eL=(0,a.useCallback)(e=>{if(!(e=>{if(!e||!(e instanceof HTMLElement))return!1;let t=e.tagName;return"INPUT"===t||"TEXTAREA"===t||e.isContentEditable})(e.target)){if(eh.current||(eh.current=!0),!e.repeat){if("ready"===Q&&("Space"===e.code||"Enter"===e.code)){e.preventDefault(),eg();return}if("countdown"===Q&&("Space"===e.code||"Enter"===e.code)){e.preventDefault(),$(0),Y("playing");return}"playing"===Q&&(("ArrowLeft"===e.code||"KeyA"===e.code)&&(d.current.left=!0),("ArrowRight"===e.code||"KeyD"===e.code)&&(d.current.right=!0),("Space"===e.code||"Enter"===e.code)&&(d.current.fire=!0))}}},[eg,Q]),eA=(0,a.useCallback)(e=>{"playing"===Q&&(("ArrowLeft"===e.code||"KeyA"===e.code)&&(d.current.left=!1),("ArrowRight"===e.code||"KeyD"===e.code)&&(d.current.right=!1),("Space"===e.code||"Enter"===e.code)&&(d.current.fire=!1))},[Q]),eD=(0,a.useMemo)(()=>({onDirection:e=>{eh.current||(eh.current=!0),d.current.left=e.x<0,d.current.right=e.x>0},onButton:e=>{if(eh.current||(eh.current=!0),"A"===e){if("countdown"===Q){$(0),Y("playing");return}d.current.fire=!0}},clear:()=>{d.current.left=!1,d.current.right=!1,d.current.fire=!1}}),[Q]),eH=(0,a.useCallback)(e=>{if(e.preventDefault(),null===ey.current)return;let t=ee.trim().slice(0,8).toUpperCase();t&&(ec(t,ey.current),el(!1),ey.current=null)},[ec,ee]),eI=(0,l.jsxs)("div",{className:"space-y-3 text-sm text-slate-100",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"si-difficulty",className:"block text-xs uppercase text-slate-400",children:"Difficulty"}),(0,l.jsx)("input",{id:"si-difficulty",type:"range",min:"1",max:"3",step:"1",value:G,onChange:e=>U(Number(e.target.value)),className:"w-full","aria-label":"Difficulty"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:O,onChange:()=>F(e=>!e),"aria-label":"Sound effects"}),(0,l.jsx)("span",{children:"Sound effects"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:K,onChange:()=>W(e=>!e),"aria-label":"Touch controls"}),(0,l.jsx)("span",{children:"Touch controls"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:_,onChange:()=>B(e=>!e),"aria-label":"Gamepad input"}),(0,l.jsx)("span",{children:"Gamepad input"})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:q,onChange:()=>V(e=>!e),"aria-label":"Screen shake"}),(0,l.jsx)("span",{children:"Screen shake"})]})]}),eP="ready"===Q?"Press Space or Enter to start.":"wave"===Q?"Wave complete!":"gameover"===Q?"Game over.":"countdown"===Q?"Get ready...":"";return(0,l.jsx)(n.default,{gameId:"space-invaders",stage:T,lives:A,score:H,highScore:P,onPauseChange:J,onRestart:eg,pauseHotkeys:["p","escape"],restartHotkeys:["r"],settingsPanel:eI,children:(0,l.jsxs)("div",{ref:t,className:"relative h-full w-full bg-black text-white focus:outline-none focus:ring-2 focus:ring-emerald-400",tabIndex:0,onKeyDown:eL,onKeyUp:eA,onBlur:()=>{ex(),J(!0)},onPointerDown:()=>{var e;eh.current||(eh.current=!0),null==(e=t.current)||e.focus()},children:[(0,l.jsx)("canvas",{ref:e,className:"h-full w-full","aria-label":"Space Invaders game canvas"}),("ready"===Q||"wave"===Q||"gameover"===Q||"countdown"===Q)&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/70 z-20",children:(0,l.jsxs)("div",{className:"text-center space-y-3 px-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"ready"===Q?"Space Invaders":"wave"===Q?"Wave Clear":"countdown"===Q?"Launching...":"Game Over"}),(0,l.jsx)("p",{className:"text-sm text-slate-200",children:eP}),"countdown"===Q&&(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"text-4xl font-bold text-emerald-300",children:Z||"Go!"}),(0,l.jsx)("div",{className:"text-xs text-slate-300",children:"Press fire to skip"})]}),"gameover"===Q&&(0,l.jsxs)("div",{className:"text-left text-xs text-slate-200 space-y-2",children:[(0,l.jsx)("div",{className:"font-semibold text-slate-100",children:"Local Leaderboard"}),0===eo.length?(0,l.jsx)("div",{className:"text-slate-400",children:"No scores yet."}):(0,l.jsx)("ol",{className:"space-y-1",children:eo.map((e,t)=>(0,l.jsxs)("li",{children:[(0,l.jsxs)("span",{className:"w-4 inline-block text-slate-400",children:[t+1,"."]}),(0,l.jsx)("span",{className:"font-semibold text-slate-100",children:e.name}),(0,l.jsx)("span",{className:"ml-2 text-slate-300",children:e.score})]},"".concat(e.name,"-").concat(e.date)))}),er&&(0,l.jsxs)("form",{onSubmit:eH,className:"space-y-2 pt-2",children:[(0,l.jsx)("label",{className:"block text-slate-300",children:"New high score! Enter initials:"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{value:ee,onChange:e=>et(e.target.value),maxLength:8,className:"px-2 py-1 rounded bg-slate-900 border border-slate-600 text-slate-100 w-28",placeholder:"AAA","aria-label":"Initials"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 rounded bg-emerald-500 text-black font-semibold",children:"Save"})]})]})]}),("ready"===Q||"wave"===Q||"gameover"===Q)&&(0,l.jsx)("button",{type:"button",className:"px-4 py-2 rounded bg-emerald-500 text-black font-semibold focus:outline-none focus:ring",onClick:()=>{if("wave"===Q)return void em();eg()},children:"gameover"===Q?"Restart":"wave"===Q?"Next Wave":"Start"})]})}),K&&(0,l.jsx)("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-20",onPointerUp:eD.clear,onPointerCancel:eD.clear,children:(0,l.jsx)(c.VirtualPad,{onDirection:eD.onDirection,onButton:eD.onButton})}),(0,l.jsx)("div",{"aria-live":"polite",className:"sr-only",children:ea})]})})}}}]);