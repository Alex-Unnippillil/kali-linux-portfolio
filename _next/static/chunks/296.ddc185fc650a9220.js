"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{16924:(e,t,r)=>{r.d(t,{default:()=>n});var l=r(14232);function n(e,t){let r=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let l=r.current;if(!l)return;let n=l.getContext("2d");if(!n)return;let a=()=>{let r=(()=>{let e=l.parentElement;if(!e)return null;let{clientWidth:t,clientHeight:r}=e;if(t>0&&r>0)return e;let n=e.closest("[data-game-viewport]");if(n)return n;let a=e.closest(".windowMainScreen");return null!=a?a:e})();if(!r)return;let{clientWidth:a,clientHeight:u}=r;if(a<=0||u<=0)return;let s=Math.min(a/e,u/t),c=e*s,i=t*s,o=window.devicePixelRatio||1;l.style.width="".concat(c,"px"),l.style.height="".concat(i,"px"),l.width=Math.floor(c*o),l.height=Math.floor(i*o),n.setTransform(o*s,0,0,o*s,0,0)};a();let u=l.parentElement,s=null==u?void 0:u.closest("[data-game-viewport]"),c=null==u?void 0:u.closest(".windowMainScreen"),i="undefined"!=typeof ResizeObserver?new ResizeObserver(a):null;return u&&i&&i.observe(u),s&&i&&s!==u&&i.observe(s),c&&i&&c!==u&&i.observe(c),window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a),null==i||i.disconnect()}},[e,t]),r}},80296:(e,t,r)=>{r.r(t),r.d(t,{BALL_RADIUS:()=>b,circleRectCollision:()=>M,computePaddleBounce:()=>T,createBall:()=>L,createBricks:()=>C,createRng:()=>X,default:()=>I,normalizeVelocity:()=>N,pointsForBrick:()=>S,shouldServeFromPointer:()=>A,stepBallPhysics:()=>P});var l=r(37876),n=r(14232),a=r(92629),u=r.n(a),s=r(70994),c=r(16924),i=r(65772),o=r(50603);function d(e){let{onSelect:t,onClose:r}=e,[a,u]=(0,n.useState)([]),s=(0,n.useRef)(null),c=(0,n.useCallback)(()=>{try{u((()=>{let e=[];for(let t=0;t<localStorage.length;t+=1){let r=localStorage.key(t);r&&r.startsWith(o.BREAKOUT_STORAGE_PREFIX)&&e.push(r.slice(o.BREAKOUT_STORAGE_PREFIX.length))}return e.sort()})())}catch(e){u([])}},[]);(0,n.useEffect)(()=>{c()},[c]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(e.preventDefault(),null==r||r())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r]),(0,n.useEffect)(()=>{let e=s.current;if(!e)return;let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],l=t[t.length-1];r&&r.focus();let n=e=>{"Tab"===e.key&&0!==t.length&&(e.shiftKey&&document.activeElement===r?(e.preventDefault(),l.focus()):e.shiftKey||document.activeElement!==l||(e.preventDefault(),r.focus()))};return e.addEventListener("keydown",n),()=>e.removeEventListener("keydown",n)},[a]);let i=(0,n.useCallback)(e=>{null==t||t(e)},[t]),d=(0,n.useCallback)(e=>{if(window.confirm('Delete "'.concat(e,'"?'))){try{localStorage.removeItem("".concat(o.BREAKOUT_STORAGE_PREFIX).concat(e))}catch(e){}c()}},[c]),f=(0,n.useMemo)(()=>o.BREAKOUT_PRESETS.map((e,t)=>(0,l.jsx)("button",{type:"button",onClick:()=>i({layout:e.layout,label:e.name,source:"preset",presetIndex:t}),className:"px-3 py-2 rounded border border-slate-700/70 bg-slate-800/80 hover:bg-slate-700/80 focus:outline-none focus:ring",children:e.name},e.id)),[i]);return(0,l.jsx)("div",{className:"absolute inset-0 z-40 flex items-center justify-center bg-black/80 text-white",role:"dialog","aria-modal":"true","aria-label":"Choose Breakout level",children:(0,l.jsxs)("div",{ref:s,className:"w-[90%] max-w-xl rounded-lg border border-slate-700/70 bg-slate-900/95 p-4 shadow-xl",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-lg font-semibold",children:"Choose a level"}),(0,l.jsx)("button",{type:"button",onClick:()=>null==r?void 0:r(),className:"rounded px-2 py-1 text-sm text-slate-200 hover:bg-slate-800",children:"Esc"})]}),(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Default"}),(0,l.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:(0,l.jsx)("button",{type:"button",onClick:()=>i({layout:o.DEFAULT_LAYOUT,label:"Default",source:"default"}),className:"px-3 py-2 rounded border border-slate-700/70 bg-slate-800/80 hover:bg-slate-700/80 focus:outline-none focus:ring",children:"Default layout"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Built-in presets"}),(0,l.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:f})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Saved"}),0===a.length?(0,l.jsx)("div",{className:"mt-2 text-sm text-slate-400",children:"No saved layouts yet."}):(0,l.jsx)("div",{className:"mt-2 grid gap-2 sm:grid-cols-2",children:a.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 rounded border border-slate-800/80 bg-slate-800/40 px-2 py-1",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{try{let t=localStorage.getItem("".concat(o.BREAKOUT_STORAGE_PREFIX).concat(e));if(!t)return;i({layout:(0,o.normalizeLayout)(JSON.parse(t)),label:e,source:"saved",savedName:e})}catch(e){}},className:"text-left text-sm text-slate-100 hover:text-white",children:e}),(0,l.jsx)("button",{type:"button",onClick:()=>d(e),className:"text-xs text-rose-300 hover:text-rose-200",children:"Delete"})]},e))})]})]})]})})}var f=r(33840),x=r(44716),h=r(90209),v=r(30684),p=r(98306),y=r(65422);let b=5,m=400/o.BREAKOUT_COLS,g=70*Math.PI/180,k=12*Math.PI/180,E={left:"ArrowLeft",right:"ArrowRight",fire:" "},w={highScore:"breakout-highscore",trail:"breakout-trail",speed:"breakout-speed",difficulty:"breakout-difficulty",effects:"breakout-effects",hitbox:"breakout-debug-hitbox"},R=(e,t,r)=>Math.max(t,Math.min(r,e)),S=e=>2===e?50:3===e?75:25,M=(e,t)=>{let r=R(e.x,t.x,t.x+t.w),l=R(e.y,t.y,t.y+t.h),n=e.x-r,a=e.y-l,u=n*n+a*a;if(u>b*b)return null;let s=Math.sqrt(u)||1e-4;return{nx:n/s,ny:a/s,overlap:b-s}},C=e=>{let t=(0,o.normalizeLayout)(e,o.BREAKOUT_ROWS,o.BREAKOUT_COLS),r=[];for(let e=0;e<t.length;e+=1)for(let l=0;l<t[e].length;l+=1){let n=t[e][l];n>0&&r.push({x:l*m,y:22+17*e+6,w:m-2,h:15,type:n,alive:!0})}return r},N=(e,t,r)=>{let l=Math.hypot(e,t)||1e-4;return{vx:e/l*r,vy:t/l*r}},j=(e,t,r)=>{let l=N(e,t,r),n=((e,t)=>{let r=Math.hypot(e,t)||180,l=Math.atan2(t,e);return Math.abs(Math.sin(l))<Math.sin(k)&&(l=(Math.sign(t)||-1)*k),{vx:Math.cos(l)*r,vy:Math.sin(l)*r}})(l.vx,l.vy);return{vx:n.vx,vy:n.vy}},T=(e,t,r,l)=>{let n=-Math.PI/2+R((e-(t+l/2))/(l/2),-1,1)*g;return{vx:Math.cos(n)*r,vy:Math.sin(n)*r}},L=(e,t,r,l)=>{let n=-Math.PI/2+(t()-.5)*(Math.PI/3);return{x:e+r/2,y:276.9-b,vx:Math.cos(n)*l,vy:Math.sin(n)*l,stuck:!0,offset:r/2,trail:[]}},A=(e,t)=>12>Math.abs(e-t),P=e=>{let{ball:t,dt:r,speed:l,paddleX:n,paddleWidth:a,bricks:u}=e,s={...t},c=null,i=null,o=!1;if(s.x+=s.vx*r,s.y+=s.vy*r,s.x<=b){s.x=b;let e=j(-s.vx,s.vy,l);s.vx=e.vx,s.vy=e.vy}if(s.x>=400-b){s.x=400-b;let e=j(-s.vx,s.vy,l);s.vx=e.vx,s.vy=e.vy}if(s.y<=b+22){s.y=b+22;let e=j(s.vx,-s.vy,l);s.vx=e.vx,s.vy=e.vy}let d=M(s,{x:n,y:276.9,w:a,h:10.500000000000002});if(d&&s.vy>0){o=!0,s.x+=d.nx*d.overlap,s.y+=d.ny*d.overlap;let e=T(s.x,n,l,a),t=j(e.vx,e.vy,l);s.vx=t.vx,s.vy=t.vy}for(let e=0;e<u.length;e+=1){let t=u[e];if(!t.alive)continue;let r=M(s,t);if(r){c=e,i=r;break}}if(i&&null!==c){s.x+=i.nx*i.overlap,s.y+=i.ny*i.overlap;let e=((e,t,r,l,n)=>{let a=e*r+t*l;return j(e-2*a*r,t-2*a*l,n)})(s.vx,s.vy,i.nx,i.ny,l);s.vx=e.vx,s.vy=e.vy}return{ball:s,hitBrickIndex:c,paddleHit:o}};function I(){let e=(0,c.default)(400,300),t=(0,x.default)(e,"breakout"),r=(0,n.useRef)(0),a=(0,n.useRef)(0),u=(0,n.useRef)(null),m=(0,n.useRef)(!1),g=(0,n.useRef)(null),k=(0,n.useRef)(!1),M=(0,n.useRef)(!1),N=(0,n.useRef)([]),j=(0,n.useRef)(0),T=(0,n.useRef)(null),I=(0,n.useRef)({inputX:0,pointerX:null,pointerActive:!1}),X=(0,n.useRef)({x:164}),O=(0,n.useRef)(72),B=(0,n.useRef)([]),_=(0,n.useRef)([]),U=(0,n.useRef)(0),D=(0,n.useRef)(0),K=(0,n.useRef)(1),F=(0,n.useRef)(3),z=(0,n.useRef)(0),G=(0,n.useRef)(0),q=(0,n.useRef)({layout:o.DEFAULT_LAYOUT,label:"Default",source:"default",presetIndex:0}),[H,W]=(0,n.useState)(1),[Y,J]=(0,n.useState)(3),[V,Q]=(0,n.useState)(0),[Z,$]=(0,f.default)(w.highScore,0),[ee,et]=(0,n.useState)(!1),[er,el]=(0,n.useState)(!0),[en,ea]=(0,n.useState)(""),[eu,es]=(0,f.default)(w.trail,!0),[ec,ei]=(0,f.default)(w.speed,1),[eo,ed]=(0,f.default)(w.difficulty,"normal"),[ef,ex]=(0,f.default)(w.effects,!0),[eh,ev]=(0,f.default)(w.hitbox,!1),[ep,ey]=(0,n.useState)(!1),eb=(0,n.useRef)(eu),em=(0,n.useRef)(ec),eg=(0,n.useRef)(eo),ek=(0,n.useRef)(ef),eE=(0,h.default)(),{record:ew,registerReplay:eR}=(0,s.useInputRecorder)();(0,n.useEffect)(()=>{G.current=Z},[Z]),(0,n.useEffect)(()=>{eb.current=eu},[eu]),(0,n.useEffect)(()=>{em.current=ec},[ec]),(0,n.useEffect)(()=>{eg.current=eo},[eo]),(0,n.useEffect)(()=>{ek.current=ef},[ef]),(0,n.useEffect)(()=>{eN(),B.current.forEach(e=>{e.stuck&&(e.offset=R(e.offset,b,O.current-b))})},[eo,eN]);let eS=(0,n.useCallback)(()=>{W(K.current),J(F.current),Q(z.current)},[]),eM=(0,n.useCallback)(()=>1+Math.min(.35,Math.max(0,K.current-1)*("hard"===eg.current?.06:.03)),[]),eC=(0,n.useCallback)(()=>180*em.current*eM(),[eM]),eN=(0,n.useCallback)(()=>{let e=Math.max(0,K.current-1);O.current=72*("hard"===eg.current?.92:1)*(1-Math.min(.18,.03*e)),X.current.x=R(X.current.x,0,400-O.current)},[]),ej=(0,n.useCallback)(()=>{let e=eC();B.current=[{...L(X.current.x,p.random,O.current,e),stuck:!0}]},[eC]),eT=(0,n.useCallback)(e=>{let{layout:t,stageNumber:r}=e,l=(0,o.normalizeLayout)(t,o.BREAKOUT_ROWS,o.BREAKOUT_COLS);q.current.layout=l,_.current=C(l),U.current=_.current.filter(e=>e.alive).length,D.current=0,M.current=!1,K.current=null!=r?r:K.current,eN(),X.current.x=200-O.current/2,ej(),eS()},[ej,eS,eN]);(0,n.useEffect)(()=>{eT({layout:q.current.layout,stageNumber:K.current})},[eT]);let eL=(0,n.useCallback)(e=>{ea(e)},[]),eA=(0,n.useCallback)(()=>{if("preset"===q.current.source&&Number.isFinite(q.current.presetIndex)){let e=(Number(q.current.presetIndex)+1)%o.BREAKOUT_PRESETS.length,t=o.BREAKOUT_PRESETS[e];q.current.presetIndex=e,q.current.label=t.name,q.current.layout=t.layout,K.current=e+1}else K.current+=1;eT({layout:q.current.layout,stageNumber:K.current}),eL("Level cleared")},[eL,eT]),eP=(0,n.useCallback)(()=>{let e=eC();B.current.forEach(t=>{if(!t.stuck)return;let r=-Math.PI/2+((0,p.random)()-.5)*(Math.PI/3);t.vx=Math.cos(r)*e,t.vy=Math.sin(r)*e,t.stuck=!1})},[eC]),eI=(0,n.useCallback)(()=>{F.current-=1,F.current<=0?(F.current=0,M.current=!0,eL("Game over")):(eL("Life lost"),j.current=.35,ej()),eS()},[eL,ej,eS]),eX=(0,n.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{resetRng:!0};e.resetRng&&(0,p.reset)(),F.current=3,z.current=0,K.current=1,eL("Game restarted"),eT({layout:q.current.layout,stageNumber:K.current})},[eL,eT]),eO=(0,n.useCallback)(e=>{if(!e)return void el(!1);q.current={layout:(0,o.normalizeLayout)(e.layout),label:e.label,source:e.source,presetIndex:e.presetIndex,savedName:e.savedName},K.current=Number.isFinite(e.presetIndex)?Number(e.presetIndex)+1:1,F.current=3,z.current=0,el(!1),eT({layout:q.current.layout,stageNumber:K.current})},[eT]);(0,n.useEffect)(()=>{if(!en)return;let e=window.setTimeout(()=>ea(""),2e3);return()=>window.clearTimeout(e)},[en]),(0,n.useEffect)(()=>{eR((e,t)=>{0===t&&(T.current=null,el(!1),eX({resetRng:!1})),e&&("input"===e.type&&(T.current=e),"serve"===e.type&&(k.current=!0))})},[eX,eR]),(0,n.useEffect)(()=>{let t=e.current;if(!t)return;let r=e=>{let r=t.getBoundingClientRect();if(!r.width)return;let l=400/r.width;u.current=R((e-r.left)*l-O.current/2,0,400-O.current)},l=e=>{m.current=!0,g.current=e.clientX,r(e.clientX),T.current=null,t.setPointerCapture(e.pointerId)},n=e=>{m.current&&r(e.clientX)},a=e=>{m.current=!1,null!==g.current&&A(g.current,e.clientX)&&B.current.some(e=>e.stuck)&&(k.current=!0),t.releasePointerCapture(e.pointerId),g.current=null},s=()=>{m.current=!1,g.current=null,u.current=null};return t.addEventListener("pointerdown",l),t.addEventListener("pointermove",n),t.addEventListener("pointerup",a),t.addEventListener("pointerleave",s),t.addEventListener("pointercancel",s),()=>{t.removeEventListener("pointerdown",l),t.removeEventListener("pointermove",n),t.removeEventListener("pointerup",a),t.removeEventListener("pointerleave",s),t.removeEventListener("pointercancel",s)}},[e]),(0,n.useEffect)(()=>{if(!t)return;let e=(0,v.getMapping)("breakout",E),r=t=>{(0,y.shouldHandleGameKey)(t,{isFocused:!0})&&t.key===e.fire&&((0,y.consumeGameKey)(t),T.current=null,k.current=!0)};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t]),(0,n.useEffect)(()=>{let l=e.current;if(!l)return;let n=l.getContext("2d");if(!n)return;let s=e=>{n.save(),n.fillStyle="rgba(15, 23, 42, 0.75)",n.fillRect(0,120,400,60),n.fillStyle="#fff",n.font="16px monospace",n.textAlign="center",n.fillText(e,200,146),n.font="12px monospace",n.fillText("Space / Tap to serve",200,166),n.restore()},c=(e,t,r,l,a)=>{let u=Math.min(a,r/2,l/2);n.beginPath(),n.moveTo(e+u,t),n.lineTo(e+r-u,t),n.quadraticCurveTo(e+r,t,e+r,t+u),n.lineTo(e+r,t+l-u),n.quadraticCurveTo(e+r,t+l,e+r-u,t+l),n.lineTo(e+u,t+l),n.quadraticCurveTo(e,t+l,e,t+l-u),n.lineTo(e,t+u),n.quadraticCurveTo(e,t,e+u,t),n.closePath()},i=()=>{if(n.clearRect(0,0,400,300),n.fillStyle="#e2e8f0",n.font="11px monospace",n.textBaseline="top",n.fillText("Stage ".concat(K.current,": ").concat(q.current.label||"Custom"),8,4),n.fillText("Score ".concat(z.current),170,4),n.fillText("Lives ".concat(F.current),330,4),n.fillText("High ".concat(G.current),330,14),D.current>0){let e=R(D.current/6,0,1);n.fillStyle="rgba(16, 185, 129, 0.6)",n.fillRect(8,16,60,3),n.fillStyle="#34d399",n.fillRect(8,16,60*e,3),n.fillStyle="#e2e8f0"}_.current.forEach(e=>{if(e.alive){let t=n.createLinearGradient(e.x,e.y,e.x,e.y+e.h);1===e.type?(t.addColorStop(0,"#cbd5f5"),t.addColorStop(1,"#64748b")):2===e.type?(t.addColorStop(0,"#6ee7b7"),t.addColorStop(1,"#047857")):(t.addColorStop(0,"#fda4af"),t.addColorStop(1,"#be123c")),n.fillStyle=t,c(e.x,e.y,e.w,e.h,3),n.fill(),n.strokeStyle="rgba(15, 23, 42, 0.4)",n.lineWidth=1,n.stroke(),eh&&(n.strokeStyle="rgba(255,255,255,0.2)",n.strokeRect(e.x,e.y,e.w,e.h))}}),n.save(),D.current>0&&(n.shadowColor="#34d399",n.shadowBlur=12);let e=n.createLinearGradient(X.current.x,276.9,X.current.x,287.4);e.addColorStop(0,"#f8fafc"),e.addColorStop(1,"#cbd5f5"),n.fillStyle=e,c(X.current.x,276.9,O.current,10.500000000000002,4),n.fill(),n.restore(),B.current.forEach(e=>{eb.current&&e.trail.forEach((t,r)=>{n.fillStyle="rgba(255,255,255,".concat((r+1)/e.trail.length*.4,")"),n.beginPath(),n.arc(t.x,t.y,b,0,2*Math.PI),n.fill()});let t=n.createRadialGradient(e.x-1,e.y-1,1,e.x,e.y,b+1);t.addColorStop(0,"#fff"),t.addColorStop(1,"#cbd5f5"),n.fillStyle=t,n.beginPath(),n.arc(e.x,e.y,b,0,2*Math.PI),n.fill(),eh&&(n.strokeStyle="rgba(148, 163, 184, 0.6)",n.stroke())}),ek.current&&!eE&&N.current.forEach(e=>{n.fillStyle=e.color,n.beginPath(),n.arc(e.x,e.y,e.size,0,2*Math.PI),n.fill()}),j.current>0&&!eE&&(n.fillStyle="rgba(248, 113, 113, ".concat(j.current,")"),n.fillRect(0,0,400,300)),ee?s("Paused"):M.current?s("Game Over"):B.current.some(e=>e.stuck)&&(n.save(),n.fillStyle="rgba(15, 23, 42, 0.6)",n.fillRect(130,248,140,26),n.fillStyle="#f8fafc",n.font="12px monospace",n.textAlign="center",n.fillText("Ready to launch",200,266),n.restore())};if(er||ee)return void i();let o=(e,t,r)=>{let{ball:l,hitBrickIndex:n,paddleHit:a}=P({ball:e,dt:t,speed:r,paddleX:X.current.x,paddleWidth:O.current,bricks:_.current});if(e.x=l.x,e.y=l.y,e.vx=l.vx,e.vy=l.vy,a&&D.current>0&&(e.stuck=!0,e.offset=R(e.x-X.current.x,b,O.current-b),e.vx=0,e.vy=0,eL("Magnet catch")),null!==n){let t=_.current[n];if(null==t?void 0:t.alive){if(t.alive=!1,U.current-=1,((e,t,r)=>{if(!ek.current||eE)return;let l=2===r?["#6ee7b7","#10b981"]:3===r?["#fda4af","#fb7185"]:["#cbd5f5","#94a3b8"];for(let r=0;r<6;r+=1){let n=Math.random()*Math.PI*2,a=40+60*Math.random();N.current.push({x:e,y:t,vx:Math.cos(n)*a,vy:Math.sin(n)*a,life:.5,size:1.5+1.8*Math.random(),color:l[r%l.length]})}})(e.x,e.y,t.type),2===t.type&&B.current.length<3){let t=Math.atan2(e.vy,e.vx)+((0,p.random)()-.5)*.6,l=2*b;B.current.push({x:e.x+Math.cos(t)*l,y:e.y+Math.sin(t)*l,vx:Math.cos(t)*r,vy:Math.sin(t)*r,stuck:!1,offset:O.current/2,trail:[]}),eL("Multi-ball")}3===t.type&&(D.current=6,eL("Magnet active")),z.current+=S(t.type),z.current>G.current&&(G.current=z.current,$(z.current)),Q(z.current)}}},d=e=>{var l,n,s,c;let f=Math.min(40,e-(a.current||e));a.current=e;let x=f/1e3*em.current,h=eC();D.current=Math.max(0,D.current-x),j.current>0&&(j.current=Math.max(0,j.current-1.2*x));let p=(0,v.getMapping)("breakout",E),y=(null==t||null==(l=t.keys)?void 0:l[p.left])||!1,g=(null==t||null==(n=t.keys)?void 0:n[p.right])||!1,w=null!=(c=null==t||null==(s=t.joystick)?void 0:s.x)?c:0,S={inputX:Math.abs(w)>.2?w:!!g-!!y,pointerActive:m.current,pointerX:u.current};T.current&&(Math.abs(S.inputX)>.1||S.pointerActive)&&(T.current=null);let C=T.current||S;!T.current&&(Math.abs(S.inputX-I.current.inputX)>.01||S.pointerActive!==I.current.pointerActive||null!==S.pointerX&&null===I.current.pointerX||null!==S.pointerX&&null!==I.current.pointerX&&Math.abs(S.pointerX-I.current.pointerX)>2||null===S.pointerX&&null!==I.current.pointerX)&&(ew({type:"input",...S}),I.current=S),C.pointerActive&&null!==C.pointerX?X.current.x=C.pointerX:0!==C.inputX&&(X.current.x=R(X.current.x+260*C.inputX*x,0,400-O.current));let L=B.current.some(e=>e.stuck);(k.current||(null==t?void 0:t.fire))&&(L&&(T.current||ew({type:"serve"}),eP()),k.current=!1),B.current.forEach(e=>{e.stuck&&(e.x=X.current.x+e.offset,e.y=276.9-b,e.trail=[])});for(let e=0;e<3;e+=1){let e=x/3;B.current.forEach(t=>{t.stuck||(t.trail.push({x:t.x,y:t.y}),t.trail.length>10&&t.trail.shift(),o(t,e,h))})}B.current=B.current.filter(e=>e.y<300+b),0!==B.current.length||M.current||eI(),U.current<=0&&!M.current&&eA(),ek.current&&!eE?(N.current.forEach(e=>{e.x+=e.vx*x,e.y+=e.vy*x,e.vy+=30*x,e.life-=x}),N.current=N.current.filter(e=>e.life>0)):N.current=[],i(),r.current=requestAnimationFrame(d)};return r.current=requestAnimationFrame(d),()=>cancelAnimationFrame(r.current)},[eL,e,t,eI,eA,ee,er,eP,$,eC,eE,ew,eh]);let eB=(0,l.jsxs)("div",{className:"text-sm text-white space-y-3",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Ball speed (",ec.toFixed(1),"x)"]}),(0,l.jsx)("input",{type:"range",min:"0.6",max:"1.6",step:"0.1",value:ec,onChange:e=>ei(Number(e.target.value)),className:"w-full","aria-label":"Ball speed"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-xs uppercase tracking-wide text-slate-400",children:"Difficulty"}),(0,l.jsxs)("select",{value:eo,onChange:e=>ed(e.target.value),className:"w-full rounded border border-slate-700 bg-slate-900 px-2 py-1 text-sm text-white","aria-label":"Difficulty",children:[(0,l.jsx)("option",{value:"normal",children:"Normal"}),(0,l.jsx)("option",{value:"hard",children:"Hard"})]})]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:eu,onChange:e=>es(e.target.checked),"aria-label":"Toggle trail"}),"Trail"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:ef,onChange:e=>ex(e.target.checked),"aria-label":"Toggle effects"}),"Effects"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:eh,onChange:e=>ev(e.target.checked),"aria-label":"Toggle hitboxes"}),"Debug hitboxes"]}),(0,l.jsx)("button",{type:"button",onClick:()=>el(!0),className:"w-full rounded bg-slate-700 px-2 py-1 text-white hover:bg-slate-600",children:"Choose Level"}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Controls: Arrow keys, A/D, or gamepad. Tap/click to serve."})]}),e_=(0,l.jsxs)("div",{className:"rounded border border-slate-700/70 bg-slate-900/80 p-2 text-white shadow-lg",children:[(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>el(!0),className:"rounded bg-slate-700 px-2 py-1 text-xs hover:bg-slate-600",children:"Levels"}),(0,l.jsx)("button",{type:"button",onClick:()=>ey(e=>!e),className:"rounded bg-slate-700 px-2 py-1 text-xs hover:bg-slate-600",children:ep?"Hide Editor":"Level Editor"})]}),ep&&(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)(i.default,{onLoad:(e,t)=>eO({layout:e,label:t||"Custom",source:"saved",savedName:t})})})]});return(0,l.jsxs)(s.default,{gameId:"breakout",stage:H,lives:Y,score:V,highScore:Z,onPauseChange:et,onRestart:eX,pauseHotkeys:["p","Escape"],restartHotkeys:["r"],editor:e_,settingsPanel:eB,children:[er&&(0,l.jsx)(d,{onSelect:eO,onClose:()=>el(!1)}),(0,l.jsxs)("div",{className:"relative w-full h-full",children:[(0,l.jsx)("canvas",{ref:e,className:"w-full h-full bg-black",tabIndex:0,role:"img","aria-label":"Breakout game canvas","aria-describedby":"breakout-instructions"}),(0,l.jsx)("div",{id:"breakout-instructions",className:"sr-only",children:"Use arrow keys or gamepad to move the paddle. Press space or tap to serve. Press P to pause, R to restart."}),(0,l.jsx)("div",{className:"sr-only",role:"status","aria-live":"polite",children:en})]})]})}let X=e=>e?u()(e):Math.random}}]);