(()=>{"use strict";let e=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]],t=(e,t)=>e>=0&&e<8&&t>=0&&t<8,n=(n,r,o,l)=>{if(n[r][o])return[];let a="B"===l?"W":"B",c=[],i=new Set;return e.forEach(e=>{let[s,f]=e,h=r+s,d=o+f,u=[];for(;t(h,d)&&n[h][d]===a;)u.push([h,d]),h+=s,d+=f;u.length&&t(h,d)&&n[h][d]===l&&u.forEach(e=>{let[t,n]=e,r="".concat(t,"-").concat(n);i.has(r)||(c.push([t,n]),i.add(r))})}),c},r=(e,t)=>{let r={};for(let o=0;o<8;o+=1)for(let l=0;l<8;l+=1){if(e[o][l])continue;let a=n(e,o,l,t);a.length&&(r["".concat(o,"-").concat(l)]=a)}return r},o=function(e,t,r,o){let l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0,a=null!=l?l:n(e,t,r,o);if(!a.length)throw Error("Illegal move: no flips available");let c=e.map(e=>e.slice());return c[t][r]=o,a.forEach(e=>{let[t,n]=e;c[t][n]=o}),c},l=e=>{let t=0,n=0;return e.forEach(e=>e.forEach(e=>{"B"===e&&(t+=1),"W"===e&&(n+=1)})),{black:t,white:n}},a=[[0,0],[0,7],[7,0],[7,7]],c=[{corner:[0,0],adj:[[0,1],[1,0],[1,1]]},{corner:[0,7],adj:[[0,6],[1,7],[1,6]]},{corner:[7,0],adj:[[6,0],[7,1],[6,1]]},{corner:[7,7],adj:[[6,7],[7,6],[6,6]]}],i=(e,t,n)=>e+(t-e)*n,s={mobilityStart:8,mobilityEnd:2,parityStart:0,parityEnd:12,corners:25,edges:6,cornerAdjPenalty:-10},f=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s,o="B"===t?"W":"B",f=0;a.forEach(n=>{let[r,l]=n;e[r][l]===t?f+=1:e[r][l]===o&&(f-=1)});let h=Object.keys(r(e,t)).length-Object.keys(r(e,o)).length,d=0;for(let n=1;n<7;n+=1)e[0][n]===t?d+=1:e[0][n]===o&&(d-=1),e[7][n]===t?d+=1:e[7][n]===o&&(d-=1),e[n][0]===t?d+=1:e[n][0]===o&&(d-=1),e[n][7]===t?d+=1:e[n][7]===o&&(d-=1);let u=0;c.forEach(n=>{let{corner:r,adj:l}=n,[a,c]=r;l.forEach(n=>{let[r,l]=n;e[r][l]===t&&e[a][c]!==t?u+=1:e[r][l]===o&&e[a][c]!==o&&(u-=1)})});let{black:p,white:m}=l(e),g=(p+m)/64,b="B"===t?p-m:m-p,y=i(n.mobilityStart,n.mobilityEnd,g),E=i(n.parityStart,n.parityEnd,g);return n.corners*f+y*h+n.edges*d+E*b+n.cornerAdjPenalty*u},h=e=>{let t=new Set(a.map(e=>{let[t,n]=e;return"".concat(t,"-").concat(n)})),n=new Set;for(let e=1;e<7;e+=1)n.add("0-".concat(e)),n.add("".concat(7,"-").concat(e)),n.add("".concat(e,"-0")),n.add("".concat(e,"-").concat(7));return e.sort((e,r)=>{let[o]=e,[l]=r,[a,i]=o.split("-").map(Number),[s,f]=l.split("-").map(Number),h=(e,r)=>t.has("".concat(e,"-").concat(r))?3:n.has("".concat(e,"-").concat(r))?2:+!c.some(t=>{let{adj:n}=t;return n.some(t=>{let[n,o]=t;return n===e&&o===r})});return h(s,f)-h(a,i)})},d=function(e,t,n,a,c){let i,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1/0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1/0,p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new Map,m=h(Object.entries(r(e,t))),g="B"===t?"W":"B";if(n<=0||0===m.length){if(0===m.length){if(0!==Object.keys(r(e,g)).length&&n>0)return d(e,g,n-1,a,c,s,u,p);let{black:t,white:o}=l(e);return 1e3*("B"===a?t-o:o-t)}return f(e,a,c)}let b="".concat(e.map(e=>e.map(e=>e||".").join("")).join("/"),"|").concat(t,"|").concat(n);if(p.has(b))return p.get(b);if(t===a)for(let[r,l]of(i=-1/0,m)){let[f,h]=r.split("-").map(Number),m=d(o(e,f,h,t,l),g,n-1,a,c,s,u,p);if(i=Math.max(i,m),(s=Math.max(s,m))>=u)break}else for(let[r,l]of(i=1/0,m)){let[f,h]=r.split("-").map(Number),m=d(o(e,f,h,t,l),g,n-1,a,c,s,u,p);if(i=Math.min(i,m),(u=Math.min(u,m))<=s)break}return p.set(b,i),i},u=function(e,t,n){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c=h(Object.entries(r(e,t)));if(0===c.length)return null;let i="B"===t?"W":"B",f=[],u=null,p=-1/0,m=0,{onProgress:g,randomizeTop:b=0}=a,y=c.length,E=new Map;for(let[r,a]of c){let[c,s]=r.split("-").map(Number),h=d(o(e,c,s,t,a),i,n-1,t,l,-1/0,1/0,E);f.push({move:[c,s],score:h}),h>p&&(p=h,u=[c,s]),m+=1,"function"==typeof g&&g({evaluated:m,total:y,candidate:[c,s],score:h,bestMove:u,bestScore:p,completed:m===y})}if(b>0){let e=f.sort((e,t)=>t.score-e.score),t=e.slice(0,Math.min(b,e.length)),n=Math.random()*t.reduce((e,n,r)=>e+(t.length-r),0);for(let e=0;e<t.length;e+=1)if((n-=t.length-e)<=0)return t[e].move}return u};self.onmessage=e=>{let{board:t,player:n,depth:r,weights:o=s,randomizeTop:l=0,id:a}=e.data,c=0,i=u(t,n,r,o,{onProgress:e=>{let t="undefined"!=typeof performance?performance.now():Date.now();(t-c>=100||e.completed)&&(c=t,self.postMessage({type:"progress",id:a,...e}))},randomizeTop:l});self.postMessage({type:"done",id:a,move:i})}})(),_N_E={};