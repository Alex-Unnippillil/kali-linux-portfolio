"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3259],{17894:(e,t,r)=>{r.d(t,{default:()=>a});var l=r(14232);function a(e,t){let[r,a]=(0,l.useState)(t),[n,s]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let r=!0;return(async()=>{var l;if(!(null==(l=navigator.storage)?void 0:l.getDirectory))return s(!0);try{let l=await navigator.storage.getDirectory();try{let t=await l.getFileHandle(e),n=await t.getFile(),s=await n.text();r&&a(JSON.parse(s))}catch(n){let r=await l.getFileHandle(e,{create:!0}),a=await r.createWritable();await a.write(JSON.stringify(t)),await a.close()}}catch(e){}r&&s(!0)})(),()=>{r=!1}},[e,t]),[r,(0,l.useCallback)(async t=>{var r;if(a(t),null==(r=navigator.storage)?void 0:r.getDirectory)try{let r=await navigator.storage.getDirectory(),l=await r.getFileHandle(e,{create:!0}),a=await l.createWritable();await a.write(JSON.stringify(t)),await a.close()}catch(e){}},[e]),n]}},43259:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});var l=r(37876),a=r(14232);class n{loop(e){if(!this.running)return;let t=e-this.last;for(t<0&&(t=0),t>this.maxDt&&(t=this.maxDt),this.accumulator+=t;this.accumulator>=this.step;)this.tickHandler(this.step),this.accumulator-=this.step;if(this.renderHandler){let e=this.interpolate?this.accumulator/this.step:1;this.renderHandler(e)}this.last=e,this.rafId=requestAnimationFrame(this.loop)}start(){!this.running&&(this.running=!0,this.last=performance.now(),this.accumulator=0,this.rafId=requestAnimationFrame(this.loop),this.inputHandler&&window.addEventListener("keydown",this.onInput))}stop(){this.running=!1,cancelAnimationFrame(this.rafId),this.inputHandler&&window.removeEventListener("keydown",this.onInput)}onInput(e){this.inputHandler&&this.inputHandler(e)}constructor(e,t,r={}){var l;this.running=!1,this.last=0,this.rafId=0,this.accumulator=0,this.tickHandler=e,this.inputHandler=t,this.step=r.fps?1e3/r.fps:16,this.maxDt=null!=(l=r.maxDt)?l:100,this.renderHandler=r.render,this.interpolate=!!r.interpolation,this.loop=this.loop.bind(this),this.onInput=this.onInput.bind(this)}}var s=r(30684),i=r(70994),o=r(98306);let c={SHIELD:"shield",RAPID_FIRE:"rapid-fire",EXTRA_LIFE:"extra-life",SPREAD:"spread"};function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=t+2*r,a=(e+r)%l;return a<0&&(a+=l),a-r}function h(e,t,r){let l=(e-t)%r;return l<-r/2?l+=r:l>=r/2&&(l-=r),l}function d(e,t,r){let l=t,a=l-e;return a>r/2?l-=r:a<-r/2&&(l+=r),l}function f(e,t,r,l){var a,n,s,i;let o=e.r+t.r,c={x:h(null!=(a=e.px)?a:e.x,null!=(n=t.px)?n:t.x,r),y:h(null!=(s=e.py)?s:e.y,null!=(i=t.py)?i:t.y,l)};if(Math.hypot(c.x,c.y)<=o)return{hit:!0,t:0};let u=h(e.x,t.x,r),f=h(e.y,t.y,l),p={x:d(c.x,u,r),y:d(c.y,f,l)},x=function(e,t,r){let l=t.x-e.x,a=t.y-e.y,n=l*l+a*a,s=2*(e.x*l+e.y*a),i=s*s-4*n*(e.x*e.x+e.y*e.y-r*r);if(i<0||0===n)return null;let o=Math.sqrt(i),c=[(-s-o)/(2*n),(-s+o)/(2*n)].filter(e=>e>=0&&e<=1);return c.length?Math.min(...c):null}(c,p,o);return null==x?{hit:!1,t:null}:{hit:!0,t:x}}let p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asteroids";return"asteroids:".concat(e,":").concat(t)},x=(e,t)=>{let r=[];for(let l=0;l<9;l+=1){let a=l/9*Math.PI*2,n=e*(1+(2*t.random()-1)*.35);r.push({x:Math.cos(a)*n,y:Math.sin(a)*n})}return r},y=e=>{e.px=e.x,e.py=e.y},m=(e,t,r)=>{e.x=u(e.x,t,e.r),e.y=u(e.y,r,e.r)},v=e=>{let{ship:t}=e;!(t.hitCooldown>0)&&(t.shield>0?t.shield=0:(e.lives-=1,e.multiplier=1,e.lives>0&&(t.x=e.worldW/2,t.y=e.worldH/2,t.velX=0,t.velY=0,t.angle=0)),t.hitCooldown=60,e.events.push({type:"shipHit",x:t.x,y:t.y}),e.lives<=0&&(e.gameOverTimer=120))},g=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16;if(!e||(e.events.length=0,e.gameOver))return e;let l=r/16,{ship:a}=e;y(a),a.angle+=.05*t.turn*l,t.thrust>0&&(a.velX+=.1*Math.cos(a.angle)*t.thrust*l,a.velY+=.1*Math.sin(a.angle)*t.thrust*l),a.velX*=.99,a.velY*=.99,a.x+=a.velX*l,a.y+=a.velY*l,m(a,e.worldW,e.worldH),a.thrusting=t.thrust>0,e.currentRun.push({x:a.x,y:a.y,angle:a.angle}),a.cooldown=Math.max(0,a.cooldown-l),a.rapidFire=Math.max(0,a.rapidFire-l),a.spreadShot=Math.max(0,a.spreadShot-l),a.shield=Math.max(0,a.shield-l),a.hitCooldown=Math.max(0,a.hitCooldown-l),t.fire&&(e=>{let{ship:t}=e;if(t.cooldown>0)return;let r=[t.angle];t.spreadShot>0&&r.push(t.angle-.2,t.angle+.2);let l=null;return r.forEach(r=>{let a=function(e,t,r,l,a){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:60;for(let s of e)if(!s.active)return s.active=!0,s.x=t,s.y=r,s.dx=l,s.dy=a,s.life=n,s;return null}(e.bullets,t.x+12*Math.cos(r),t.y+12*Math.sin(r),6*Math.cos(r)+t.velX,6*Math.sin(r)+t.velY,60);a&&(a.px=a.x,a.py=a.y,l=a)}),l&&(t.cooldown=t.rapidFire>0?5:15)})(e),t.hyperspace&&(a.x=e.rng.random()*e.worldW,a.y=e.rng.random()*e.worldH,.1>e.rng.random()&&v(e),m(a,e.worldW,e.worldH)),e.multiplierTimer>0?e.multiplierTimer-=l:e.multiplier=1,e.waveBannerTimer>0&&(e.waveBannerTimer-=l),e.gameOverTimer>0&&(e.gameOverTimer-=l,e.gameOverTimer<=0&&(e.events.push({type:"gameOver",score:e.score,startLevel:e.originalStartLevel,ghostData:e.currentRun.slice()}),e.gameOver=!0)),e.bullets.forEach(t=>{t.active&&(y(t),t.x=u(t.x+t.dx*l,e.worldW,t.r),t.y=u(t.y+t.dy*l,e.worldH,t.r),t.life-=l,t.life<=0&&(t.active=!1))}),e.asteroids.forEach(t=>{y(t),t.x=u(t.x+t.dx*l,e.worldW,t.r),t.y=u(t.y+t.dy*l,e.worldH,t.r),t.angle+=t.spin*l});let{ufo:n,rng:s,ship:i}=e;if(n.active){if(y(n),n.x+=n.dx*l,n.y+=n.dy*l,n.cooldown-=l,n.cooldown<=0){let t=Math.atan2(i.y-n.y,i.x-n.x);e.ufoBullets.length<6&&e.ufoBullets.push({x:n.x,y:n.y,px:n.x,py:n.y,dx:3*Math.cos(t),dy:3*Math.sin(t),r:2,life:120}),n.cooldown=90}(n.x<-50||n.x>e.worldW+50)&&(n.active=!1)}else(e.ufoTimer-=l)<=0&&(n.active=!0,n.y=s.random()*e.worldH,n.x=.5>s.random()?-20:e.worldW+20,n.dx=n.x<0?1.5:-1.5,n.dy=0,n.cooldown=90,e.ufoTimer=Math.max(300,900-60*e.level));for(let t=e.ufoBullets.length-1;t>=0;t-=1){let r=e.ufoBullets[t];y(r),r.x+=r.dx*l,r.y+=r.dy*l,r.life-=l,r.life<=0&&e.ufoBullets.splice(t,1)}for(let t=e.floatingTexts.length-1;t>=0;t-=1){let r=e.floatingTexts[t];r.y-=.5*l,r.life-=l,r.life<=0&&e.floatingTexts.splice(t,1)}if(e.ghostShip&&e.ghostIndex<e.ghostData.length){let t=e.ghostData[e.ghostIndex];e.ghostShip.px=e.ghostShip.x,e.ghostShip.py=e.ghostShip.y,e.ghostShip.x=t.x,e.ghostShip.y=t.y,e.ghostShip.angle=t.angle,e.ghostIndex+=1}e.bullets.forEach(t=>{if(!t.active)return;let r=null,l=-1;if(e.asteroids.forEach((a,n)=>{let s=f(t,a,e.worldW,e.worldH);s.hit&&(null==r||s.t<r)&&(r=s.t,l=n)}),e.ufo.active){let l=f(t,e.ufo,e.worldW,e.worldH);if(l.hit&&(null==r||l.t<r)){var a;(a=e).ufo.active=!1,a.score+=500*a.multiplier,a.floatingTexts.push({x:a.ufo.x,y:a.ufo.y,text:"+".concat(500*a.multiplier),life:60,color:"#a78bfa"}),a.multiplier=Math.min(a.multiplier+1,5),a.multiplierTimer=180,a.events.push({type:"ufoDestroyed",x:a.ufo.x,y:a.ufo.y}),t.active=!1;return}}l>=0&&(((e,t)=>{let r=e.asteroids[t];if(e.score+=100*e.multiplier,e.floatingTexts.push({x:r.x,y:r.y,text:"+".concat(100*e.multiplier),life:60,color:"#fbbf24"}),e.multiplier=Math.min(e.multiplier+1,5),e.multiplierTimer=180,r.r>20)for(let t=0;t<2;t+=1){let t=e.rng.random()*Math.PI*2,l=r.r/2;e.asteroids.push({x:r.x,y:r.y,px:r.x,py:r.y,dx:2*Math.cos(t),dy:2*Math.sin(t),r:l,angle:e.rng.random()*Math.PI*2,spin:(2*e.rng.random()-1)*.03,shape:x(l,e.rng)})}e.asteroids.splice(t,1),e.events.push({type:"asteroidDestroyed",x:r.x,y:r.y,r:r.r}),.1>e.rng.random()&&function(e,t,r){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.random,a=Object.values(c),n=a[Math.floor(l()*a.length)];e.push({type:n,x:t,y:r,px:t,py:r,r:12,life:600})}(e.powerUps,r.x,r.y,e.rng.random)})(e,l),t.active=!1)});let{ship:o}=e;if(e.asteroids.forEach(t=>{let{hit:r}=f(o,t,e.worldW,e.worldH);r&&v(e)}),e.ufo.active){let{hit:t}=f(o,e.ufo,e.worldW,e.worldH);t&&v(e)}e.ufoBullets.forEach(t=>{let{hit:r}=f(o,t,e.worldW,e.worldH);r&&v(e)});for(let t=e.powerUps.length-1;t>=0;t-=1){let r=e.powerUps[t];r.life-=1;let{hit:l}=f(e.ship,r,e.worldW,e.worldH);l?(e.inventory.push(r.type),e.events.push({type:"inventory",inventory:[...e.inventory]}),e.powerUps.splice(t,1)):r.life<=0&&e.powerUps.splice(t,1)}if(e.powerUps.forEach(e=>{y(e)}),e.score>=e.extraLifeScore&&(e.lives+=1,e.extraLifeScore+=1e4,e.events.push({type:"lives",lives:e.lives})),e.asteroids.length||(e.level+=1,e.events.push({type:"level",level:e.level}),e.startLevel()),null!=t.useInventory){let r=t.useInventory;e.inventory[r]&&(e.lives=function(e,t,r){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;switch(e.type){case c.SHIELD:t.shield=l;break;case c.RAPID_FIRE:t.rapidFire=a;break;case c.SPREAD:t.spreadShot=a;break;case c.EXTRA_LIFE:r+=1}return r}({type:e.inventory[r]},e.ship,e.lives,600,600),e.inventory.splice(r,1),e.events.push({type:"inventory",inventory:[...e.inventory]}))}let h=e.score!==e._prevScore,d=e.lives!==e._prevLives,p=e.multiplier!==e._prevMultiplier,g=Math.floor(e.multiplierTimer)!==Math.floor(e._prevMultiplierTimer||0);return(h||d||p||g)&&(e.events.push({type:"hud",score:e.score,multiplier:e.multiplier,multiplierTimer:e.multiplierTimer,lives:e.lives}),e._prevScore=e.score,e._prevLives=e.lives,e._prevMultiplier=e.multiplier,e._prevMultiplierTimer=Math.floor(e.multiplierTimer)),e};var w=r(44716),b=r(33840),S=r(17894);let M={thrust:"ArrowUp",left:"ArrowLeft",right:"ArrowRight",fire:" ",hyperspace:"h"},E=[{level:1,name:"Novice"},{level:2,name:"Pilot"},{level:3,name:"Warrior"},{level:4,name:"Commander"},{level:5,name:"Ace"}],I=function(e,t,r,l,a){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];e.beginPath(),e.arc(t,r,l,0,2*Math.PI),n?(e.fillStyle=a,e.fill()):(e.strokeStyle=a,e.stroke())},R=(e,t,r)=>e*(1-r)+t*r,T=()=>{let e=(0,a.useRef)(null),t=(0,a.useRef)((0,w.default)(e,"asteroids")),{muted:r,toggleMute:u,screenShake:h,setScreenShake:d}=(0,w.useGameSettings)("asteroids"),[f,y]=(0,b.default)("game:asteroids:particles",!0),[m,v]=(0,a.useState)(!1),T=(0,a.useRef)(!1),[j,P]=(0,a.useState)(0),[N,D]=(0,a.useState)(""),[k,A]=(0,a.useState)(!0),[H,L]=(0,a.useState)(!1),[W,F]=(0,a.useState)(1),C=(0,a.useRef)(null),_=(0,a.useRef)(null),O=(0,a.useRef)({w:0,h:0}),B=(0,a.useRef)([]),[X,U]=(0,a.useState)([]),[z,Y]=(0,a.useState)({}),[q,G]=(0,a.useState)(0),[J,V]=(0,a.useState)(W),[K,Q]=(0,a.useState)(0),[Z,$]=(0,a.useState)(3),[ee,et]=(0,a.useState)(1),[er,el]=(0,a.useState)(0),ea=(0,a.useRef)({}),en=(0,a.useRef)(0),es=(0,a.useRef)(J),ei=(0,a.useRef)(K),eo=(0,a.useRef)(Z),ec=(0,a.useRef)(ee),eu=(0,a.useRef)(er),[eh,ed,ef]=(0,S.default)("asteroids-save.json",{upgrades:[],ghost:[]}),ep=(0,a.useRef)(eh),ex=(0,a.useRef)(null),ey=window.devicePixelRatio||1,em=(0,a.useRef)([]),ev=(0,a.useRef)([]),eg=(0,a.useRef)(0),ew=(0,a.useRef)(null),eb=(0,a.useRef)(0),eS=(0,a.useRef)(f),eM=(0,a.useRef)(h),eE=(0,a.useRef)(null),eI=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.08,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.12;if(!r&&ew.current&&!T.current)try{let r=ew.current,a=r.createOscillator(),n=r.createGain();a.type="sine",a.frequency.value=e,n.gain.value=.5*l,a.connect(n),n.connect(r.destination),a.start(),a.stop(r.currentTime+t)}catch(e){}},[r]);(0,a.useEffect)(()=>{let e=()=>{if(!ew.current)try{ew.current=new(window.AudioContext||window.webkitAudioContext)}catch(e){}};return window.addEventListener("pointerdown",e,{once:!0}),()=>window.removeEventListener("pointerdown",e)},[]),(0,a.useEffect)(()=>{f||(em.current=[]),eS.current=f},[f]),(0,a.useEffect)(()=>{h||(eg.current=0),eM.current=h},[h]),(0,a.useEffect)(()=>{eE.current=eI},[eI]),(0,a.useEffect)(()=>{let e={};E.forEach(t=>{e[t.level]=Number(localStorage.getItem("asteroids-highscore-".concat(t.level))||0)}),Y(e),ea.current=e;let t=localStorage.getItem("asteroids-highscore");t&&!localStorage.getItem("asteroids-highscore-1")&&(localStorage.setItem("asteroids-highscore-1",t),e[1]=Number(t),Y({...e}));let r=Number(localStorage.getItem("asteroids-lastscore")||0);G(r),en.current=r},[]),(0,a.useEffect)(()=>{ea.current=z},[z]),(0,a.useEffect)(()=>{en.current=q},[q]),(0,a.useEffect)(()=>{es.current=J},[J]),(0,a.useEffect)(()=>{ei.current=K},[K]),(0,a.useEffect)(()=>{eo.current=Z},[Z]),(0,a.useEffect)(()=>{ec.current=ee},[ee]),(0,a.useEffect)(()=>{eu.current=er},[er]),(0,a.useEffect)(()=>{ep.current=eh},[eh]),(0,a.useEffect)(()=>{B.current=X},[X]),(0,a.useEffect)(()=>{if(!ef||k)return;let r=e.current,l=r.getContext("2d"),a=()=>{let e=r.clientWidth,t=r.clientHeight;O.current={w:e,h:t},r.width=Math.floor(e*ey),r.height=Math.floor(t*ey),l.setTransform(ey,0,0,ey,0,0),ev.current=Array.from({length:Math.max(30,Math.floor(e*t/8e3))},()=>({x:Math.random()*e,y:Math.random()*t,size:Math.random()>.8?2:1,alpha:.3+.7*Math.random()})),_.current&&((e,t,r)=>{e.worldW=t,e.worldH=r})(_.current,e,t)};a(),window.addEventListener("resize",a);let i=(e=>{let{worldW:t,worldH:r,seed:l="asteroids",startLevel:a=1,saveData:n}=e,s=(e=>(o.default.reset(e),{random:o.default.random,reset:t=>o.default.reset(null!=t?t:e)}))(p(a,l)),i={rng:s,worldW:t,worldH:r,ship:{x:t/2,y:r/2,px:t/2,py:r/2,angle:0,velX:0,velY:0,r:10,cooldown:0,shield:0,rapidFire:0,spreadShot:0,hitCooldown:0},lives:3,score:0,level:a,gameOver:!1,gameOverTimer:0,extraLifeScore:1e4,bullets:Array.from({length:40},()=>({active:!1,x:0,y:0,dx:0,dy:0,r:2,life:0})).map(e=>({...e,px:0,py:0})),asteroids:[],ufo:{active:!1,x:0,y:0,px:0,py:0,dx:0,dy:0,r:15,cooldown:0},ufoBullets:[],powerUps:[],floatingTexts:[],inventory:[],ufoTimer:600,multiplier:1,multiplierTimer:0,waveBannerText:"",waveBannerTimer:0,ghostData:(null==n?void 0:n.ghost)||[],ghostIndex:0,ghostShip:null,currentRun:[],upgrades:[...(null==n?void 0:n.upgrades)||[]],events:[],runSeed:l};i.ghostShip=i.ghostData.length?{...i.ghostData[0],px:i.ghostData[0].x,py:i.ghostData[0].y}:null;let u=()=>{s.reset(p(i.level,i.runSeed)),i.asteroids.length=0,d(i,3+2*i.level,1+.3*i.level),i.ufoTimer=Math.max(300,900-60*i.level),i.waveBannerText="Wave ".concat(i.level),i.waveBannerTimer=120,i.events.push({type:"banner",text:i.waveBannerText}),h(i)},h=()=>{i.upgrades.forEach(e=>{e===c.SHIELD&&(i.ship.shield=600),e===c.RAPID_FIRE&&(i.ship.rapidFire=600),e===c.SPREAD&&(i.ship.spreadShot=600)})},d=(e,t,r)=>{let{ship:l}=e;for(let a=0;a<t;a+=1){let t=e.rng.random()*Math.PI*2,a=15+25*e.rng.random(),n=e.rng.random()*e.worldW,s=e.rng.random()*e.worldH,i=0;for(;i<25&&Math.hypot(n-l.x,s-l.y)<120+a;)n=e.rng.random()*e.worldW,s=e.rng.random()*e.worldH,i+=1;e.asteroids.push({x:n,y:s,px:n,py:s,dx:Math.cos(t)*r,dy:Math.sin(t)*r,r:a,angle:e.rng.random()*Math.PI*2,spin:(2*e.rng.random()-1)*.02,shape:x(a,e.rng)})}};return i.startLevel=u,i.originalStartLevel=a,u(),i})({worldW:O.current.w,worldH:O.current.h,startLevel:W,saveData:ep.current});_.current=i,B.current=[],U([]),V(i.level),Q(i.score),$(i.lives),et(i.multiplier),el(i.multiplierTimer),L(!1);let u=e=>{e.key>="1"&&e.key<="9"&&(ex.current=Number(e.key)-1)};window.addEventListener("keydown",u);let h=function(e,t,r,l){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(eS.current)for(let n=0;n<l&&!(em.current.length>=180);n+=1){let l=Math.random()*Math.PI*2,n=(.5+.8*Math.random())*a;em.current.push({x:e,y:t,px:e,py:t,dx:Math.cos(l)*n,dy:Math.sin(l)*n,life:30+Math.floor(20*Math.random()),maxLife:50,r:1.5+1.5*Math.random(),color:r})}},d=new n(e=>{var r,l;if(T.current)return;let{keys:a,joystick:n,fire:o,hyperspace:c}=t.current,u=(0,s.getMapping)("asteroids",M),d={turn:(a[u.left]?-1:0)+ +!!a[u.right]+(n.active?n.x:0),thrust:+!!a[u.thrust]+(n.active?-n.y:0),fire:o,hyperspace:c,useInventory:ex.current};if(t.current.fire=!1,t.current.hyperspace=!1,ex.current=null,g(_.current,d,e),i.events.forEach(e=>{if("inventory"===e.type&&U(e.inventory),"banner"===e.type&&D(e.text),"level"===e.type&&(es.current!==e.level&&V(e.level),D("Wave ".concat(e.level))),"lives"===e.type&&(eo.current!==e.lives&&$(e.lives),D("Lives ".concat(Math.max(0,e.lives)))),"hud"===e.type&&(ei.current!==e.score&&Q(e.score),eo.current!==e.lives&&$(e.lives),ec.current!==e.multiplier&&et(e.multiplier),eu.current!==e.multiplierTimer&&el(e.multiplierTimer)),"asteroidDestroyed"===e.type&&(h(e.x,e.y,"#f8fafc",12,1.6),eM.current&&(eg.current=Math.max(eg.current,3)),eE.current&&eE.current(220,.06,.09)),"shipHit"===e.type&&(h(e.x,e.y,"#38bdf8",18,2.2),eM.current&&(eg.current=Math.max(eg.current,6)),eE.current&&eE.current(110,.12,.12)),"ufoDestroyed"===e.type&&(h(e.x,e.y,"#c084fc",16,1.8),eM.current&&(eg.current=Math.max(eg.current,4)),eE.current&&eE.current(160,.1,.1)),"gameOver"===e.type){D("Game over. Score ".concat(e.score)),L(!0);let t=e.startLevel||1,r=ea.current[t]||0,l=Math.max(e.score,r);Y(e=>({...e,[t]:l})),G(e.score);try{localStorage.setItem("asteroids-highscore-".concat(t),String(l)),localStorage.setItem("asteroids-lastscore",String(e.score))}catch(e){}let a={upgrades:ep.current.upgrades,ghost:e.ghostData};ep.current=a,ed(a)}}),(null==(l=_.current)||null==(r=l.ship)?void 0:r.thrusting)&&eS.current)if(eb.current<=0){let e=_.current.ship;h(e.x-12*Math.cos(e.angle),e.y-12*Math.sin(e.angle),"#fbbf24",3,.8),eb.current=2}else eb.current-=e/16;if((e=>{let t=[];em.current.forEach(r=>{r.px=r.x,r.py=r.y,r.x+=r.dx*e,r.y+=r.dy*e,r.life-=e,r.life>0&&t.push(r)}),em.current=t})(e/16),ev.current.length){let e=_.current.ship.velX||0,t=_.current.ship.velY||0;ev.current.forEach(r=>{r.x+=.05*e,r.y+=.05*t,r.x<0&&(r.x+=O.current.w),r.x>O.current.w&&(r.x-=O.current.w),r.y<0&&(r.y+=O.current.h),r.y>O.current.h&&(r.y-=O.current.h)})}eM.current&&(eg.current=Math.max(0,eg.current*Math.pow(.85,e/16)))},void 0,{fps:60,maxDt:32,render:e=>{let t=eM.current?eg.current:0;l.save(),t>.1&&l.translate((2*Math.random()-1)*t,(2*Math.random()-1)*t),((e,t,r,l,a,n)=>{var s;let{stars:i,particles:o,shake:u}=n;if(!t||(e.clearRect(0,0,l,a),(null==i?void 0:i.length)&&(i.forEach(t=>{e.globalAlpha=t.alpha,e.fillStyle="#9fb3ff",e.fillRect(t.x,t.y,t.size,t.size)}),e.globalAlpha=1),t.lives<=0))return;let h=t.ship,d=R(h.px,h.x,r),f=R(h.py,h.y,r),p=h.angle;if(e.save(),e.translate(d,f),e.rotate(p),h.hitCooldown>0&&(e.globalAlpha=.4+.6*Math.abs(Math.sin(.2*h.hitCooldown))),e.fillStyle="#1e293b",e.strokeStyle=h.shield>0?"cyan":"white",e.lineWidth=2,e.beginPath(),e.moveTo(14,0),e.lineTo(-10,-8),e.lineTo(-6,0),e.lineTo(-10,8),e.closePath(),e.fill(),e.stroke(),h.thrusting&&(e.beginPath(),e.moveTo(-6,0),e.lineTo(-10,3),e.lineTo(-16,0),e.lineTo(-10,-3),e.closePath(),e.fillStyle="#fbbf24",e.fill()),h.shield>0&&(e.strokeStyle="cyan",e.globalAlpha=.6,e.beginPath(),e.arc(0,0,h.r+6,0,2*Math.PI),e.stroke(),e.globalAlpha=1),e.restore(),t.asteroids.forEach(t=>{((e,t,r)=>{let l=R(t.px,t.x,r),a=R(t.py,t.y,r);e.save(),e.translate(l,a),e.rotate(t.angle||0),e.fillStyle="#374151",e.strokeStyle="#9ca3af",e.lineWidth=1.5,e.beginPath();let n=t.shape;n&&n.length?(e.moveTo(n[0].x,n[0].y),n.slice(1).forEach(t=>e.lineTo(t.x,t.y))):e.arc(0,0,t.r,0,2*Math.PI),e.closePath(),e.fill(),e.stroke(),e.restore()})(e,t,r)}),t.bullets.forEach(t=>{if(!t.active)return;let l=R(t.px,t.x,r),a=R(t.py,t.y,r);e.fillStyle="#facc15",e.beginPath(),e.arc(l,a,t.r,0,2*Math.PI),e.fill()}),t.ufo.active){let l=R(t.ufo.px,t.ufo.x,r),a=R(t.ufo.py,t.ufo.y,r);e.fillStyle="#7c3aed",e.strokeStyle="#c084fc",e.lineWidth=2,e.beginPath(),e.ellipse(l,a,t.ufo.r,.5*t.ufo.r,0,0,2*Math.PI),e.fill(),e.stroke(),e.fillStyle="#a78bfa",e.beginPath(),e.ellipse(l,a-3,.5*t.ufo.r,.3*t.ufo.r,0,Math.PI,0),e.fill()}t.ufoBullets.forEach(t=>{let l=R(t.px,t.x,r),a=R(t.py,t.y,r);e.fillStyle="#ef4444",e.beginPath(),e.arc(l,a,t.r,0,2*Math.PI),e.fill()}),t.powerUps.forEach(t=>{var l,a;let n=R(null!=(l=t.px)?l:t.x,t.x,r),s=R(null!=(a=t.py)?a:t.y,t.y,r),i=t.type===c.SHIELD?"cyan":t.type===c.RAPID_FIRE?"yellow":t.type===c.SPREAD?"orange":"lime";I(e,n,s,t.r,i),e.save(),e.fillStyle=i,e.globalAlpha=.2,e.beginPath(),e.arc(n,s,t.r,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle="white",e.font="bold 12px sans-serif",e.textAlign="center",e.textBaseline="middle";let o="?";t.type===c.SHIELD&&(o="S"),t.type===c.RAPID_FIRE&&(o="R"),t.type===c.SPREAD&&(o="V"),t.type===c.EXTRA_LIFE&&(o="+"),e.fillText(o,n,s+1),e.restore()});let x=l-80-10;e.save(),e.strokeStyle="#0f0",e.strokeRect(x,10,80,80);let y=80/l,m=80/a;e.fillStyle="#fff",e.fillRect(x+d*y-1,10+f*m-1,3,3),e.fillStyle="#0f0",t.asteroids.forEach(t=>{e.fillRect(x+t.x*y-1,10+t.y*m-1,2,2)}),t.ufo.active&&(e.fillStyle="#f00",e.fillRect(x+t.ufo.x*y-1,10+t.ufo.y*m-1,3,3)),e.restore(),t.inventory.forEach((t,r)=>{e.beginPath(),e.strokeStyle=t===c.SHIELD?"cyan":t===c.RAPID_FIRE?"yellow":t===c.SPREAD?"orange":"lime",e.arc(10+20*r,80,8,0,2*Math.PI),e.stroke()}),t.waveBannerTimer>0&&(e.save(),e.globalAlpha=Math.min(1,t.waveBannerTimer/30),e.fillStyle="white",e.font="24px monospace",e.textAlign="center",e.fillText(t.waveBannerText,l/2,a/2),e.restore()),(null==o?void 0:o.length)&&((e,t,r)=>{t.forEach(t=>{let l=R(t.px,t.x,r),a=R(t.py,t.y,r);e.globalAlpha=Math.max(0,Math.min(1,t.life/t.maxLife)),I(e,l,a,t.r,t.color,!0)}),e.globalAlpha=1})(e,o,r),(null==t||null==(s=t.floatingTexts)?void 0:s.length)&&(e.save(),e.textAlign="center",e.font="bold 16px sans-serif",t.floatingTexts.forEach(t=>{e.globalAlpha=Math.max(0,t.life/60),e.fillStyle=t.color||"#fff";let l=R(t.x,t.x,r),a=R(t.y,t.y,r);e.fillText(t.text,l,a)}),e.restore())})(l,_.current,e,O.current.w,O.current.h,{stars:ev.current,particles:em.current}),l.restore()},interpolation:!0});return C.current=d,d.start(),()=>{d.stop(),window.removeEventListener("resize",a),window.removeEventListener("keydown",u)}},[ey,j,ef,k,W,ed]);let eR=()=>{T.current=!1,v(!1),A(!0),L(!1),P(e=>e+1)},eT=Math.min(1,er/180),ej=e=>{switch(e){case c.SHIELD:return"Shield";case c.RAPID_FIRE:return"Rapid";case c.SPREAD:return"Spread";case c.EXTRA_LIFE:return"Life";default:return"Power-up"}},eP=(0,a.useMemo)(()=>(0,l.jsxs)("div",{className:"space-y-3 text-sm text-slate-100",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:"Particles"}),(0,l.jsx)("button",{type:"button","aria-pressed":f,onClick:()=>y(e=>!e),className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 focus:outline-none focus:ring",children:f?"On":"Off"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:"Screen shake"}),(0,l.jsx)("button",{type:"button","aria-pressed":h,onClick:()=>d(e=>!e),className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 focus:outline-none focus:ring",children:h?"On":"Off"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:"Sound FX"}),(0,l.jsx)("button",{type:"button","aria-pressed":!r,onClick:u,className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 focus:outline-none focus:ring",children:r?"Muted":"On"})]})]}),[r,f,h,y,d,u]);return(0,l.jsxs)(i.default,{gameId:"asteroids",stage:J,lives:Math.max(0,Z),score:K,highScore:z[W],settingsPanel:eP,paused:m,onPauseChange:e=>{T.current=e,v(e);let t=C.current;t&&(e?t.stop():t.start())},onRestart:eR,children:[k&&(0,l.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-80 text-white space-y-3 z-50",children:[(0,l.jsx)("div",{className:"text-3xl font-bold tracking-wide mb-2",children:"\uD83D\uDE80 Asteroids"}),(0,l.jsx)("div",{className:"text-sm text-slate-200",children:"Select Difficulty"}),(0,l.jsx)("div",{className:"flex flex-col gap-2 w-full max-w-xs px-8",children:E.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{F(e.level),A(!1),L(!1),P(e=>e+1)},className:"flex-1 px-3 py-2 bg-gray-700/80 rounded hover:bg-emerald-600/80 focus:outline-none focus:ring transition-colors text-left",children:e.name}),(0,l.jsx)("div",{className:"ml-3 text-xs text-slate-400 tabular-nums w-12 text-right",children:z[e.level]||0})]},e.level))}),q>0&&(0,l.jsxs)("div",{className:"text-xs text-slate-300 mt-2",children:["Last score: ",q]})]}),(0,l.jsx)("canvas",{ref:e,className:"bg-black w-full h-full touch-none","aria-label":"Asteroids game canvas"}),(0,l.jsxs)("div",{className:"absolute bottom-2 left-2 z-30 flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"rounded bg-slate-900/70 border border-slate-700/70 px-3 py-2 text-xs text-slate-200",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsx)("span",{children:"Multiplier"}),(0,l.jsxs)("span",{className:"font-semibold text-emerald-300",children:["x",ee]})]}),(0,l.jsx)("div",{className:"mt-1 h-1.5 w-32 rounded bg-slate-800",children:(0,l.jsx)("div",{className:"h-full rounded bg-emerald-400 transition-[width]",style:{width:"".concat(Math.max(6,100*eT),"%")}})})]}),(0,l.jsxs)("div",{className:"rounded bg-slate-900/70 border border-slate-700/70 px-3 py-2 text-xs text-slate-200",children:[(0,l.jsx)("div",{className:"mb-1 font-semibold",children:"Inventory"}),0===X.length?(0,l.jsx)("div",{className:"text-slate-400",children:"Empty"}):(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:X.map((e,t)=>(0,l.jsxs)("button",{type:"button",onClick:()=>{ex.current=t},className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700 focus:outline-none focus:ring","aria-label":"Use ".concat(ej(e)," power-up in slot ").concat(t+1),children:[t+1,": ",ej(e)]},"".concat(e,"-").concat(t)))})]})]}),H&&!k&&(0,l.jsx)("div",{className:"absolute inset-0 z-40 flex items-center justify-center bg-black/70",children:(0,l.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/95 p-6 text-center text-white shadow-xl max-w-sm",children:[(0,l.jsx)("div",{className:"text-xl font-semibold mb-2",children:"Game Over"}),(0,l.jsxs)("div",{className:"text-sm text-slate-300 mb-4",children:["Score: ",(0,l.jsx)("span",{className:"font-semibold text-emerald-300",children:Math.floor(q)})," \xb7 High:"," ",(0,l.jsx)("span",{className:"font-semibold text-indigo-300",children:z[W]||0})]}),(0,l.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{A(!1),L(!1),P(e=>e+1)},className:"px-3 py-1 rounded bg-emerald-600 hover:bg-emerald-500 focus:outline-none focus:ring",children:"Restart"}),(0,l.jsx)("button",{type:"button",onClick:()=>{A(!0),L(!1)},className:"px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 focus:outline-none focus:ring",children:"Menu"})]})]})}),(0,l.jsx)("div",{"aria-live":"polite",className:"sr-only",children:N}),(0,l.jsx)("div",{className:"absolute bottom-2 right-2 z-40",children:(0,l.jsx)("button",{type:"button",onClick:()=>{let e={upgrades:[],ghost:[]};ep.current=e,ed(e),eR()},className:"px-2 py-1 bg-gray-700 text-white rounded",children:"Reset Progress"})})]})}}}]);