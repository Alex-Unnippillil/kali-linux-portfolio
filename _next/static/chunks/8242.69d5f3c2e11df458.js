"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8242],{75758:(e,a,t)=>{t.d(a,{default:()=>i});var s=t(37876);t(14232);let i=e=>{let{id:a,className:t="",role:i="status",ariaLive:r,children:n}=e;return(0,s.jsx)("p",{id:a,role:i,"aria-live":null!=r?r:"alert"===i?"assertive":"polite",className:"text-red-600 text-sm mt-2 ".concat(t).trim(),children:n})}},78242:(e,a,t)=>{t.r(a),t.d(a,{default:()=>v,displayBleSensor:()=>p});var s=t(37876),i=t(14232),r=t(75758);let n=async()=>{var e;if("undefined"==typeof navigator||!(null==(e=navigator.storage)?void 0:e.getDirectory))throw Error("OPFS not supported");return await navigator.storage.getDirectory()},l=async(e,a)=>{let t=await n(),s=await t.getFileHandle("".concat(e,".json"),{create:!0}),i=await s.createWritable();await i.write(JSON.stringify(a)),await i.close()},c=async e=>{try{let a=await n(),t=await a.getFileHandle("".concat(e,".json")),s=await t.getFile(),i=JSON.parse(await s.text());return{deviceId:e,...i}}catch(e){return null}},o=async()=>{try{let e=await n(),a=[];for await(let[t,s]of e.entries()){if(!t.endsWith(".json"))continue;let e=await s.getFile(),i=JSON.parse(await e.text());a.push({deviceId:t.replace(/\.json$/,""),...i})}return a}catch(e){return[]}},u=async(e,a)=>{let t=await c(e);t&&await l(e,{name:a,services:t.services})},d=async e=>{let a=await n();await a.removeEntry("".concat(e,".json"))},w=e=>new Promise(a=>setTimeout(a,e)),m=()=>{let e="undefined"!=typeof navigator&&"bluetooth"in navigator,[a,t]=(0,i.useState)(""),[n,m]=(0,i.useState)([]),[v,p]=(0,i.useState)(""),[h,f]=(0,i.useState)(!1),[y,b]=(0,i.useState)([]),g=(0,i.useRef)(null),x=async()=>b(await o());(0,i.useEffect)(()=>{if(x(),"BroadcastChannel"in window){let e=new BroadcastChannel("ble-profiles");return e.onmessage=()=>x(),g.current=e,()=>e.close()}},[]);let N=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,t=Error("Unable to connect");for(let s=1;s<=a;s++)try{return await e.gatt.connect()}catch(e){t=e,s<a&&await w(1e3*s)}throw t},j=async()=>{if(e&&!h){if(p(""),f(!0),!window.confirm("This application will request access to nearby Bluetooth devices. Continue?"))return void f(!1);try{var a;let e=await navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["battery_service","device_information"]}),s=await c(e.id);if(s){t(s.name),m(s.services);return}t(e.name||"Unknown device");let i=await N(e);e.addEventListener("gattserverdisconnected",()=>p("Device disconnected."));let r=await i.getPrimaryServices(),n=[];for(let e of r){let a=await e.getCharacteristics(),t=await Promise.all(a.map(async e=>{try{let a=await e.readValue(),t=new TextDecoder;return{uuid:e.uuid,value:t.decode(a.buffer)}}catch(a){return{uuid:e.uuid,value:"[unreadable]"}}}));n.push({uuid:e.uuid,characteristics:t})}m(n),await l(e.id,{name:e.name||"Unknown device",services:n}),null==(a=g.current)||a.postMessage("update"),await x()}catch(e){"NotAllowedError"===e.name?p("Permission to access Bluetooth was denied."):"NotFoundError"===e.name?p("No devices found."):p(e.message||"An unknown error occurred.")}finally{f(!1)}}};return(0,s.jsxs)("div",{className:"h-full w-full bg-black p-4 text-white",children:[!e&&(0,s.jsx)("p",{className:"mb-4 text-sm text-yellow-400",children:"Web Bluetooth is not supported in this browser."}),(0,s.jsx)("button",{onClick:j,disabled:!e||h,className:"mb-4 rounded bg-blue-600 px-3 py-1 disabled:opacity-50",children:"Scan for Devices"}),v&&(0,s.jsx)(r.default,{className:"mt-0 mb-4",children:v}),y.length>0&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"mb-2 font-bold",children:"Saved Profiles"}),(0,s.jsx)("ul",{className:"space-y-1",children:y.map(e=>(0,s.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{defaultValue:e.name,onBlur:async a=>{var t;await u(e.deviceId,a.target.value),null==(t=g.current)||t.postMessage("update"),await x()},className:"w-40 bg-gray-800 px-1"}),(0,s.jsx)("button",{onClick:async()=>{var a;await d(e.deviceId),null==(a=g.current)||a.postMessage("update"),await x()},className:"text-red-400",children:"Delete"})]},e.deviceId))})]}),a&&(0,s.jsxs)("p",{className:"mb-2",children:["Connected to: ",a]}),(0,s.jsx)("ul",{className:"space-y-2 overflow-auto",children:n.map(e=>(0,s.jsxs)("li",{className:"border-b border-gray-700 pb-2",children:[(0,s.jsxs)("p",{className:"font-bold",children:["Service: ",e.uuid]}),(0,s.jsx)("ul",{className:"ml-4 list-disc",children:e.characteristics.map(e=>(0,s.jsxs)("li",{children:[e.uuid,": ",e.value]},e.uuid))})]},e.uuid))})]})},v=m,p=()=>(0,s.jsx)(m,{})}}]);