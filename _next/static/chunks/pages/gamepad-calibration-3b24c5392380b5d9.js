(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5458],{28549:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>r});var n=t(37876),i=t(14232),s=t(84613);function r(){let[e,a]=(0,i.useState)(null),[t,r]=(0,i.useState)([]),[l,o]=(0,i.useState)([]),[d,m]=(0,i.useState)("");return(0,i.useEffect)(()=>{let e=e=>a(e.gamepad),t=()=>a(null);for(let n of(window.addEventListener("gamepadconnected",e),window.addEventListener("gamepaddisconnected",t),navigator.getGamepads?navigator.getGamepads():[]))if(n){a(n);break}return()=>{window.removeEventListener("gamepadconnected",e),window.removeEventListener("gamepaddisconnected",t)}},[]),(0,i.useEffect)(()=>{let a;if(!e)return;let t=(0,s.loadCalibration)(e.id);t?(o(t.axes.map(e=>({...e}))),m(t.vendor||"")):o(e.axes.map(e=>({min:e,max:e})));let n=()=>{let t=(navigator.getGamepads?navigator.getGamepads():[])[e.index];t&&(r(Array.from(t.axes)),o(e=>e.map((e,a)=>({min:Math.min(e.min,t.axes[a]),max:Math.max(e.max,t.axes[a])}))),a=requestAnimationFrame(n))};return a=requestAnimationFrame(n),()=>cancelAnimationFrame(a)},[e]),(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("h1",{className:"text-xl mb-4",children:"Gamepad Calibration"}),!e&&(0,n.jsx)("p",{children:"No controller connected."}),e&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-2",children:["Controller: ",e.id]}),(0,n.jsxs)("label",{className:"block mb-4",children:["Preset:",(0,n.jsxs)("select",{className:"ml-2",value:d,onChange:e=>(e=>{m(e);let a=s.GAMEPAD_PRESETS[e];a&&o(a.axes.map(e=>({...e})))})(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"Custom"}),Object.keys(s.GAMEPAD_PRESETS).map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),t.map((e,a)=>{var t,i;return(0,n.jsxs)("div",{className:"mb-2",children:[(0,n.jsxs)("div",{children:["Axis ",a,": ",e.toFixed(2)]}),(0,n.jsx)("div",{className:"h-2 bg-gray-200",children:(0,n.jsx)("div",{className:"h-2 bg-blue-500",style:{width:"".concat((e+1)/2*100,"%")}})}),(0,n.jsxs)("div",{className:"text-xs",children:["Min: ",null==(t=l[a])?void 0:t.min.toFixed(2)," Max: ",null==(i=l[a])?void 0:i.max.toFixed(2)]})]},a)}),(0,n.jsx)("button",{onClick:()=>{e&&(0,s.saveCalibration)(e.id,{axes:l,vendor:d})},className:"mt-4",children:"Save Calibration"})]})]})}},39528:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/gamepad-calibration",function(){return t(28549)}])},84613:(e,a,t)=>{"use strict";t.d(a,{GAMEPAD_PRESETS:()=>i,loadCalibration:()=>s,pollTwinStick:()=>d,saveCalibration:()=>r});let n="gamepad-calibration-",i={Xbox:{vendor:"Xbox",axes:Array.from({length:4},()=>({min:-1,max:1}))},PlayStation:{vendor:"PlayStation",axes:Array.from({length:4},()=>({min:-1,max:1}))}};function s(e){try{let a=window.localStorage.getItem(n+e);return a?JSON.parse(a):null}catch(e){return null}}function r(e,a){try{window.localStorage.setItem(n+e,JSON.stringify(a))}catch(e){}}function l(e,a){if(!a)return e;let t=a.max-a.min;return 0===t?0:(Math.min(Math.max(e,a.min),a.max)-a.min)/t*2-1}class o{on(e,a){this.listeners[e].add(a)}off(e,a){this.listeners[e].delete(a)}emit(e,a){this.listeners[e].forEach(e=>e(a))}start(){null===this.raf&&this.poll()}stop(){null!==this.raf&&(cancelAnimationFrame(this.raf),this.raf=null)}constructor(e=.1){this.listeners={connected:new Set,disconnected:new Set,button:new Set,axis:new Set},this.prevState=new Map,this.raf=null,this.poll=()=>{for(let e of navigator.getGamepads?navigator.getGamepads():[]){if(!e)continue;let a=this.prevState.get(e.index)||{buttons:[],axes:[]};e.buttons.forEach((t,n)=>{let i=a.buttons[n]||0;if(t.value!==i){var s;let a=t.value>.5,r=i>.5;if(this.emit("button",{gamepad:e,index:n,value:t.value,pressed:a}),a&&!r&&(null==(s=e.vibrationActuator)?void 0:s.playEffect))try{e.vibrationActuator.playEffect("dual-rumble",{duration:30,strongMagnitude:1,weakMagnitude:1})}catch(e){}}}),e.axes.forEach((t,n)=>{let i=a.axes[n]||0,s=Math.abs(t)<this.deadzone?0:t;s!==(Math.abs(i)<this.deadzone?0:i)&&this.emit("axis",{gamepad:e,index:n,value:s})}),this.prevState.set(e.index,{buttons:e.buttons.map(e=>e.value),axes:Array.from(e.axes)})}this.raf=requestAnimationFrame(this.poll)},this.deadzone=e,window.addEventListener("gamepadconnected",e=>this.emit("connected",e.gamepad)),window.addEventListener("gamepaddisconnected",e=>this.emit("disconnected",e.gamepad))}}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.25,a={moveX:0,moveY:0,aimX:0,aimY:0,fire:!1};for(let t of navigator.getGamepads?navigator.getGamepads():[]){if(!t)continue;let n=s(t.id),i=(null==n?void 0:n.axes)||[],[r,o,d,m]=t.axes,c=l(r,i[0]),u=l(o,i[1]),h=l(d,i[2]),x=l(m,i[3]);a.moveX=Math.abs(c)>e?c:0,a.moveY=Math.abs(u)>e?u:0,a.aimX=Math.abs(h)>e?h:0,a.aimY=Math.abs(x)>e?x:0,a.fire=t.buttons.some(e=>e.pressed);break}return a}new o}},e=>{e.O(0,[636,6593,8792],()=>e(e.s=39528)),_N_E=e.O()}]);