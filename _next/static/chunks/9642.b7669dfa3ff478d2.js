"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9642],{99642:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var l=s(37876),a=s(14232);let r=[{pseudo:"int square(int x) {",asm:"square:"},{pseudo:"  return x * x;",asm:"  imul eax, edi, edi"},{pseudo:"}",asm:"  ret"}];function n(){let[e,t]=(0,a.useState)(null),[s,n]=(0,a.useState)(r);(0,a.useEffect)(()=>{fetch("/demo-data/ghidra/pseudocode.json").then(e=>e.json()).then(e=>{e.snippet&&n(e.snippet)}).catch(()=>{})},[]);let c=(a,r,n)=>(0,l.jsx)("pre",{"aria-label":r,"aria-describedby":n,className:"w-1/2 overflow-auto p-2 whitespace-pre-wrap",children:s.map((s,r)=>(0,l.jsx)("div",{onMouseEnter:()=>t(r),onMouseLeave:()=>t(null),onClick:()=>{var e;return e=s[a],void(navigator&&navigator.clipboard&&navigator.clipboard.writeText(e))},className:"cursor-pointer ".concat(e===r?"bg-yellow-700":""),children:s[a]},"".concat(a,"-").concat(r)))});return(0,l.jsxs)("div",{className:"w-full h-48 flex border-t border-gray-700 bg-gray-800 text-sm text-gray-100",children:[(0,l.jsx)("p",{id:"pseudo-desc",className:"sr-only",children:"Pseudocode pane. Lines highlight with matching assembly and copy on click."}),(0,l.jsx)("p",{id:"asm-desc",className:"sr-only",children:"Disassembly pane. Lines highlight with matching pseudocode and copy on click."}),c("pseudo","Pseudocode","pseudo-desc"),c("asm","Disassembly","asm-desc")]})}function c(e){let{func:t,funcMap:s,onSelect:a,selected:r}=e;return(0,l.jsxs)("li",{children:[(0,l.jsx)("button",{onClick:()=>a(t.name),className:"text-left w-full ".concat(r===t.name?"font-bold":""),children:t.name}),t.calls&&t.calls.length>0&&(0,l.jsx)("ul",{className:"ml-4",children:t.calls.map(e=>s[e]?(0,l.jsx)(c,{func:s[e],funcMap:s,onSelect:a,selected:r},e):(0,l.jsx)("li",{children:e},e))})]})}function i(e){let{functions:t,onSelect:s,selected:r}=e,n=a.useMemo(()=>{let e={};return t.forEach(t=>{e[t.name]=t}),e},[t]),i=a.useMemo(()=>{let e=new Set;return t.forEach(t=>t.calls&&t.calls.forEach(t=>e.add(t))),e},[t]),o=t.filter(e=>!i.has(e.name));return(0,l.jsx)("ul",{className:"p-2 text-sm space-y-1",children:o.map(e=>(0,l.jsx)(c,{func:e,funcMap:n,onSelect:s,selected:r},e.name))})}function o(e){let{func:t,callers:s=[],onSelect:a}=e,r=100,n=100,c=Array.from(new Set([...(null==t?void 0:t.calls)||[],...s])),i={};return c.forEach((e,t)=>{let s=2*Math.PI*t/c.length;i[e]={x:r+70*Math.cos(s),y:n+70*Math.sin(s)}}),(0,l.jsxs)("svg",{role:"img","aria-label":"Call graph",viewBox:"0 0 ".concat(200," ").concat(200),className:"w-full h-full bg-black",children:[((null==t?void 0:t.calls)||[]).map(e=>(0,l.jsx)("line",{x1:r,y1:n,x2:i[e].x,y2:i[e].y,stroke:"#4ade80"},"out-".concat(e))),s.map(e=>(0,l.jsx)("line",{x1:i[e].x,y1:i[e].y,x2:r,y2:n,stroke:"#f87171"},"in-".concat(e))),(0,l.jsxs)("g",{children:[(0,l.jsx)("circle",{cx:r,cy:n,r:20,className:"fill-blue-600"}),(0,l.jsx)("text",{x:r,y:n+4,textAnchor:"middle",className:"fill-white text-xs",children:(null==t?void 0:t.name)||"func"})]}),c.map(e=>(0,l.jsxs)("g",{onClick:()=>a&&a(e),className:"cursor-pointer",children:[(0,l.jsx)("circle",{cx:i[e].x,cy:i[e].y,r:15,className:"fill-gray-700"}),(0,l.jsx)("text",{x:i[e].x,y:i[e].y+4,textAnchor:"middle",className:"fill-white text-xs",children:e})]},e))]})}function d(e){let t=[],s="";for(let l=0;l<e.length;l++){let a=e[l];a>=32&&a<=126?s+=String.fromCharCode(a):(s.length>=4&&t.push(s),s="")}return s.length>=4&&t.push(s),t.slice(0,1e3)}function u(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)([]),n=async e=>{var s;let l=null==(s=e.target.files)?void 0:s[0];if(!l)return;let a=new Uint8Array(await l.arrayBuffer()),n={sections:[],strings:[]};77===a[0]&&90===a[1]?n=function(e){let t=new DataView(e.buffer),s=[];if(19802!==t.getUint16(0,!1))return{sections:s,strings:d(e)};let l=t.getUint32(60,!0);if(0x50450000!==t.getUint32(l,!1))return{sections:s,strings:d(e)};let a=t.getUint16(l+6,!0),r=t.getUint16(l+20,!0),n=l+24+r;for(let t=0;t<a;t++){let t=String.fromCharCode(...e.slice(n,n+8)).replace(/\0.*$/,"");s.push(t),n+=40}return{sections:s,strings:d(e)}}(a):127===a[0]&&69===a[1]&&76===a[2]&&70===a[3]&&(n=function(e){let t=new DataView(e.buffer),s=[],l=1===t.getUint8(5),a=1===t.getUint8(4),r=0,n=0,c=0,i=0;a?(r=t.getUint32(32,l),n=t.getUint16(46,l),c=t.getUint16(48,l),i=t.getUint16(50,l)):(r=Number(t.getBigUint64(40,l)),n=t.getUint16(58,l),c=t.getUint16(60,l),i=t.getUint16(62,l));let o=0,u=0,m=r+i*n;a?(o=t.getUint32(m+16,l),u=t.getUint32(m+20,l)):(o=Number(t.getBigUint64(m+24,l)),u=Number(t.getBigUint64(m+32,l)));let h=e.slice(o,o+u);for(let e=0;e<c;e++){let a=r+e*n,c=t.getUint32(a,l),i="";for(let e=c;e<h.length&&0!==h[e];e++)i+=String.fromCharCode(h[e]);s.push(i)}return{sections:s,strings:d(e)}}(a)),t(n.sections),r(n.strings)};return(0,l.jsxs)("div",{className:"text-xs md:text-sm",children:[(0,l.jsx)("label",{className:"block mb-1",children:"Upload PE or ELF file"}),(0,l.jsx)("input",{type:"file",accept:".exe,.dll,.bin,.elf",onChange:n,className:"mb-2"}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-bold",children:"Sections"}),(0,l.jsx)("ul",{className:"list-disc pl-4",children:e.map(e=>(0,l.jsx)("li",{children:e},e))})]}),(0,l.jsxs)("div",{className:"max-h-48 overflow-auto",children:[(0,l.jsx)("h3",{className:"font-bold",children:"Strings"}),(0,l.jsx)("ul",{className:"list-disc pl-4",children:s.map((e,t)=>(0,l.jsx)("li",{children:e},t))})]})]})]})}var m=s(95133),h=s(99742);async function x(){return await (0,m.loadCapstone)(),{Capstone:m.Capstone,Const:m.Const}}function f(e){let{blocks:t,selected:s,onSelect:a,prefersReducedMotion:r}=e;return(0,l.jsxs)("svg",{role:"img","aria-label":"Control flow graph",viewBox:"0 0 300 120",className:"w-full h-full bg-black",children:[t.map(e=>e.edges.map(s=>{let a=t.find(e=>e.id===s);return(0,l.jsx)("line",{x1:e.x+40,y1:e.y,x2:a.x,y2:a.y,stroke:"#9ca3af"},"".concat(e.id,"-").concat(a.id))})),t.map(e=>(0,l.jsxs)("g",{onClick:()=>a(e.id),className:"cursor-pointer",children:[(0,l.jsx)("rect",{x:e.x-30,y:e.y-20,width:60,height:40,className:"".concat(s===e.id?"fill-yellow-600":"fill-gray-700"," stroke-gray-400 ").concat(r?"":"transition-colors duration-300")}),(0,l.jsx)("text",{x:e.x,y:e.y+5,textAnchor:"middle",className:"fill-white text-sm",children:e.label})]},e.id))]})}function p(){var e;let[t,r]=(0,a.useState)("ghidra"),[c,d]=(0,a.useState)([]),[m,p]=(0,a.useState)({}),[g,b]=(0,a.useState)(null),[j,v]=(0,a.useState)({}),[y,N]=(0,a.useState)({}),[w,S]=(0,a.useState)(""),C=(0,a.useRef)(null),k=(0,a.useRef)(null),E=(0,a.useRef)(!1),[U,M]=(0,a.useState)(!1),A=(0,a.useRef)(null),[L,R]=(0,a.useState)(""),[D,_]=(0,a.useState)({}),[B,P]=(0,a.useState)([]),[T,W]=(0,a.useState)(null),[H,q]=(0,a.useState)({}),[F,I]=(0,a.useState)(""),[O,X]=(0,a.useState)({}),G=(0,a.useRef)(null),[V,$]=(0,a.useState)([]),[z,J]=(0,a.useState)("x86"),K=(0,a.useCallback)(async()=>{if(G.current)return G.current;let e=await x();return G.current=e,e},[]);(0,a.useEffect)(()=>{let e=h.env.NEXT_PUBLIC_GHIDRA_WASM||"/wasm/ghidra.wasm";if("undefined"==typeof WebAssembly){r("capstone"),K();return}WebAssembly.instantiateStreaming(fetch(e),{}).catch(()=>{r("capstone"),K()})},[K]);let Q=(0,a.useCallback)(async e=>{e.preventDefault();let t=e.dataTransfer.files[0];if(!t)return;let s=new Uint8Array(await t.arrayBuffer()),{Capstone:l,Const:a}=await K(),[r,n]="arm"===z?[a.ARCH_ARM,a.MODE_ARM]:[a.ARCH_X86,a.MODE_32],c=new l(r,n),i=(performance.now(),c.disasm(s,{address:4096}));c.close(),performance.now(),$(i)},[z,K]),Y=async()=>{let e="ghidra"===t?"capstone":"ghidra";r(e),"capstone"===e&&await K()};if((0,a.useEffect)(()=>{fetch("/demo-data/ghidra/disassembly.json").then(e=>e.json()).then(e=>{var t;let s={},l={};e.functions.forEach(e=>{s[e.name]=e}),e.functions.forEach(e=>{(e.calls||[]).forEach(t=>{l[t]||(l[t]=[]),l[t].push(e.name)})}),d(e.functions),p(s),N(l),b((null==(t=e.functions[0])?void 0:t.name)||null)})},[]),(0,a.useEffect)(()=>{fetch("/demo-data/ghidra/strings.json").then(e=>e.json()).then(e=>{P(e.strings||[]),e.strings&&e.strings[0]&&W(e.strings[0].id)}).catch(()=>{})},[]),(0,a.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),t=e=>M(e.matches);return t(e),e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),(0,a.useEffect)(()=>{if("function"==typeof Worker)return A.current=new Worker(s.tu(new URL(s.p+s.u(9499),s.b))),A.current.onmessage=e=>{v(t=>({...t,[e.data.id]:e.data.hex}))},()=>{var e;return null==(e=A.current)?void 0:e.terminate()}},[]),(0,a.useEffect)(()=>{if(!A.current||!g)return;let e=m[g];e&&!j[e.name]&&A.current.postMessage({id:e.name,code:e.code.join("\n")})},[g,j,m]),(0,a.useEffect)(()=>{g&&S("Selected function ".concat(g))},[g]),(0,a.useEffect)(()=>{let e=C.current,t=k.current,s=(e,t)=>{E.current||(E.current=!0,requestAnimationFrame(()=>{t.scrollTop=e.scrollTop,E.current=!1}))},l=()=>s(e,t),a=()=>s(t,e);return e.addEventListener("scroll",l),t.addEventListener("scroll",a),()=>{e.removeEventListener("scroll",l),t.removeEventListener("scroll",a)}},[]),"capstone"===t)return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-900 text-gray-100",onDragOver:e=>e.preventDefault(),onDrop:Q,children:[(0,l.jsxs)("div",{className:"p-2 flex space-x-2",children:[(0,l.jsx)("button",{onClick:Y,className:"px-2 py-1 bg-gray-700 rounded",children:"Use Ghidra"}),(0,l.jsxs)("select",{value:z,onChange:e=>J(e.target.value),className:"text-black rounded",children:[(0,l.jsx)("option",{value:"x86",children:"x86"}),(0,l.jsx)("option",{value:"arm",children:"ARM"})]})]}),0===V.length?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center m-2 border-2 border-dashed border-gray-600",children:"Drop a binary file here"}):(0,l.jsx)("pre",{className:"flex-1 overflow-auto p-2 whitespace-pre",children:V.map(e=>"".concat(e.address.toString(16).padStart(8,"0"),": ").concat(Array.from(e.bytes).map(e=>e.toString(16).padStart(2,"0")).join(" "),"	").concat(e.mnemonic," ").concat(e.opStr)).join("\n")})]});let Z=m[g]||{code:[],blocks:[],calls:[]},ee=c.filter(e=>e.name.toLowerCase().includes(L.toLowerCase())),et=B.filter(e=>e.value.toLowerCase().includes(F.toLowerCase()));return(0,l.jsxs)("div",{className:"w-full h-full flex flex-col bg-gray-900 text-gray-100",children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)("button",{onClick:Y,className:"px-2 py-1 bg-gray-700 rounded",children:"Use Capstone"})}),(0,l.jsx)("div",{className:"p-2 border-t border-gray-700",children:(0,l.jsx)(u,{})}),(0,l.jsxs)("div",{className:"grid flex-1 grid-cols-1 md:grid-cols-2 lg:grid-cols-4",children:[(0,l.jsxs)("div",{className:"border-b md:border-b-0 md:border-r border-gray-700 overflow-auto min-h-0 last:border-b-0 md:last:border-r-0",children:[(0,l.jsx)("div",{className:"p-2",children:(0,l.jsx)("input",{type:"text",value:L,onChange:e=>R(e.target.value),placeholder:"Search symbols",className:"w-full mb-2 p-1 rounded text-black"})}),L?(0,l.jsx)("ul",{className:"p-2 text-sm space-y-1",children:ee.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{onClick:()=>b(e.name),className:"text-left w-full ".concat(g===e.name?"font-bold":""),children:e.name})},e.name))}):(0,l.jsx)(i,{functions:c,onSelect:b,selected:g})]}),(0,l.jsx)("div",{className:"border-b md:border-b-0 md:border-r border-gray-700 min-h-0 last:border-b-0 md:last:border-r-0",children:(0,l.jsx)(f,{blocks:Z.blocks,selected:null,onSelect:()=>{},prefersReducedMotion:U})}),(0,l.jsxs)("pre",{ref:C,"aria-label":"Decompiled code",className:"overflow-auto p-2 whitespace-pre-wrap border-b md:border-b-0 md:border-r border-gray-700 min-h-0 last:border-b-0 md:last:border-r-0",children:[Z.code.map((e,t)=>{var s;let a,r=e.match(/call\s+(\w+)/);if(r&&m[r[1]]){let t=r[1];a=(0,l.jsx)("div",{onClick:()=>b(t),className:"cursor-pointer text-blue-400 hover:underline",children:e})}else a=(0,l.jsx)("div",{children:e});let n=(null==(s=O[g])?void 0:s[t])||"";return(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"flex-1",children:a}),(0,l.jsx)("input",{value:n,onChange:e=>X({...O,[g]:{...O[g]||{},[t]:e.target.value}}),placeholder:"note",className:"ml-2 w-24 text-xs text-black rounded"})]},t)}),(y[g]||[]).length>0&&(0,l.jsxs)("div",{className:"mt-2 text-xs",children:["XREFS:",y[g].map(e=>(0,l.jsx)("button",{onClick:()=>b(e),className:"ml-2 underline text-blue-400",children:e},e))]})]}),(0,l.jsx)("pre",{ref:k,"aria-label":"Hexadecimal representation",className:"overflow-auto p-2 whitespace-pre-wrap border-b md:border-b-0 border-gray-700 min-h-0 last:border-b-0 md:last:border-r-0",children:j[g]||""})]}),(0,l.jsx)(n,{}),(0,l.jsx)("div",{className:"h-48 border-t border-gray-700",children:(0,l.jsx)(o,{func:Z,callers:y[g]||[],onSelect:b})}),(0,l.jsxs)("div",{className:"border-t border-gray-700 p-2",children:[(0,l.jsxs)("label",{className:"block text-sm mb-1",children:["Notes for ",g||"function"]}),(0,l.jsx)("textarea",{value:D[g]||"",onChange:e=>_({...D,[g]:e.target.value}),className:"w-full h-16 p-1 rounded text-black"})]}),(0,l.jsxs)("div",{className:"grid border-t border-gray-700 grid-cols-1 md:grid-cols-2 md:h-40",children:[(0,l.jsxs)("div",{className:"overflow-auto p-2 border-b md:border-b-0 md:border-r border-gray-700 min-h-0",children:[(0,l.jsx)("input",{type:"text",value:F,onChange:e=>I(e.target.value),placeholder:"Search strings",className:"w-full mb-2 p-1 rounded text-black"}),(0,l.jsx)("ul",{className:"text-sm space-y-1",children:et.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)("button",{onClick:()=>W(e.id),className:"text-left w-full ".concat(T===e.id?"font-bold":""),children:e.value})},e.id))})]}),(0,l.jsxs)("div",{className:"p-2",children:[(0,l.jsxs)("label",{className:"block text-sm mb-1",children:["Notes for ",(null==(e=B.find(e=>e.id===T))?void 0:e.value)||"string"]}),(0,l.jsx)("textarea",{value:H[T]||"",onChange:e=>q({...H,[T]:e.target.value}),className:"w-full h-full p-1 rounded text-black"})]})]}),(0,l.jsx)("div",{"aria-live":"polite",role:"status",className:"sr-only",children:w})]})}}}]);