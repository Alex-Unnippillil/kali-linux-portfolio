"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3286],{16924:(e,t,r)=>{r.d(t,{default:()=>l});var n=r(14232);function l(e,t){let r=(0,n.useRef)(null);return(0,n.useEffect)(()=>{let n=r.current;if(!n)return;let l=n.getContext("2d");if(!l)return;let i=()=>{let r=(()=>{let e=n.parentElement;if(!e)return null;let{clientWidth:t,clientHeight:r}=e;if(t>0&&r>0)return e;let l=e.closest("[data-game-viewport]");if(l)return l;let i=e.closest(".windowMainScreen");return null!=i?i:e})();if(!r)return;let{clientWidth:i,clientHeight:a}=r;if(i<=0||a<=0)return;let s=Math.min(i/e,a/t),c=e*s,o=t*s,u=window.devicePixelRatio||1;n.style.width="".concat(c,"px"),n.style.height="".concat(o,"px"),n.width=Math.floor(c*u),n.height=Math.floor(o*u),l.setTransform(u*s,0,0,u*s,0,0)};i();let a=n.parentElement,s=null==a?void 0:a.closest("[data-game-viewport]"),c=null==a?void 0:a.closest(".windowMainScreen"),o="undefined"!=typeof ResizeObserver?new ResizeObserver(i):null;return a&&o&&o.observe(a),s&&o&&s!==a&&o.observe(s),c&&o&&c!==a&&o.observe(c),window.addEventListener("resize",i),()=>{window.removeEventListener("resize",i),null==o||o.disconnect()}},[e,t]),r}},83286:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var n=r(37876),l=r(14232),i=r(63452),a=r.n(i),s=r(16924),c=r(95220);let o={bumpers:[]},u={classic:{name:"Classic",layout:{bumpers:[{x:200,y:200,r:20},{x:400/3,y:300,r:20},{x:800/3,y:300,r:20}]}},spread:{name:"Spread",layout:{bumpers:[{x:80,y:150,r:20},{x:320,y:150,r:20},{x:200,y:250,r:25},{x:80,y:350,r:20},{x:320,y:350,r:20}]}},empty:{name:"Empty",layout:o}},d=Object.fromEntries(Object.entries(u).map(e=>{let[t,r]=e;return[t,r.layout]})),f=()=>{let e=(0,s.default)(400,500),[t,r]=(0,c.default)("pinball-table","classic"),[i,f]=(0,c.default)("pinball-layouts",d),p=i[t]||o,[y,g]=(0,l.useState)(!1),[h,b]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!0),[v,w]=(0,l.useState)(!1),[S,k]=(0,l.useState)(0),[E,R]=(0,c.default)("pinball-highscores",{}),A=E[t]||0,[j,C]=(0,l.useState)(1),[L,N]=(0,l.useState)(1),T=(0,l.useRef)([]),U=(0,l.useRef)([]),M=(0,l.useRef)([]),P=(0,l.useRef)({active:!1,pos:0}),I=(0,l.useRef)(0),O=(0,l.useRef)(),V=(0,l.useRef)(!0),z=(0,l.useRef)(1),B=(0,l.useRef)(1),F=(0,l.useRef)(),_=(0,l.useRef)(),G=(0,l.useRef)(0);return(0,l.useEffect)(()=>{G.current=A},[A]),(0,l.useEffect)(()=>{k(0),z.current=1,C(1),B.current=1,N(1)},[t]),(0,l.useEffect)(()=>{w(window.matchMedia("(prefers-reduced-motion: reduce)").matches)},[]),(0,l.useEffect)(()=>{V.current=m,U.current.forEach(e=>{e.body.render.fillStyle=m?e.lit?"#ffd700":"#444":"#222"})},[m]),(0,l.useEffect)(()=>{if(!e.current||y)return;let{Engine:r,Render:n,Runner:l,Bodies:i,Composite:s,Body:c,Constraint:o,Events:u}=a(),d=r.create();d.positionIterations=8,d.velocityIterations=6;let f=d.world,g=[i.rectangle(200,-10,400,20,{isStatic:!0,restitution:1,friction:0,slop:0}),i.rectangle(200,510,400,20,{isStatic:!0,restitution:1,friction:0,slop:0}),i.rectangle(-10,250,20,500,{isStatic:!0,restitution:1,friction:0,slop:0}),i.rectangle(410,250,20,500,{isStatic:!0,restitution:1,friction:0,slop:0})];s.add(f,g);let m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=i.circle(e,t,8,{restitution:.95,friction:0,frictionAir:.01,slop:.01,label:"ball",render:{fillStyle:"#fff"}});return s.add(f,r),M.current.push({body:r,trail:[]}),r};m();let x=i.rectangle(110,460,80,20,{friction:0,density:1,restitution:1}),w=i.rectangle(290,460,80,20,{friction:0,density:1,restitution:1});c.setInertia(x,1/0),c.setInertia(w,1/0);let S=o.create({bodyA:x,pointB:{x:70,y:460},length:0,stiffness:1}),E=o.create({bodyA:w,pointB:{x:330,y:460},length:0,stiffness:1});s.add(f,[x,w,S,E]);let A=[i.rectangle(100,80,60,10,{isStatic:!0,isSensor:!0,label:"lane",render:{fillStyle:"#222"}}),i.rectangle(200,80,60,10,{isStatic:!0,isSensor:!0,label:"lane",render:{fillStyle:"#222"}}),i.rectangle(300,80,60,10,{isStatic:!0,isSensor:!0,label:"lane",render:{fillStyle:"#222"}})];s.add(f,A),U.current=p.bumpers.map((e,t)=>{let r=i.circle(e.x,e.y,e.r,{isStatic:!0,restitution:1.7,render:{fillStyle:V.current?"#444":"#222"}});return r.plugin={index:t},s.add(f,r),{body:r,lit:!1,flashUntil:0,flashState:!1}});let j=e=>e.plugin&&null!=e.plugin.index?U.current[e.plugin.index]:null;u.on(d,"collisionStart",e=>{e.pairs.forEach(e=>{let{bodyA:r,bodyB:n}=e,l=j(r)||j(n);if(l&&V.current){B.current+=1,N(B.current),clearTimeout(_.current),_.current=setTimeout(()=>{B.current=1,N(1)},3e3),l.lit=!l.lit,v?l.body.render.fillStyle=l.lit?"#ffd700":"#444":(l.flashUntil=performance.now()+300,l.flashState=!0);let e=10*z.current*B.current;k(r=>{let n=r+e;return n>G.current&&R(e=>({...e,[t]:n})),n}),U.current.length&&U.current.every(e=>e.lit)&&(P.current.active=!0,P.current.pos=-20)}("lane"===r.label||"lane"===n.label)&&(z.current=Math.min(z.current+1,5),C(z.current),B.current=1,N(1),clearTimeout(F.current),F.current=setTimeout(()=>{z.current=1,C(1)},5e3))})}),u.on(d,"beforeUpdate",()=>{x.angle<-.5?(c.setAngularVelocity(x,0),c.setAngle(x,-.5)):x.angle>0&&(c.setAngularVelocity(x,0),c.setAngle(x,0)),w.angle>.5?(c.setAngularVelocity(w,0),c.setAngle(w,.5)):w.angle<0&&(c.setAngularVelocity(w,0),c.setAngle(w,0))});let L=n.create({canvas:e.current,engine:d,options:{width:400,height:500,background:"#000",wireframes:!1}});n.run(L);let q=l.create();l.run(q,d),u.on(L,"afterRender",()=>{let e=L.context;if(e.save(),M.current.forEach(t=>{e.fillStyle="rgba(0,0,0,0.3)",e.beginPath(),e.ellipse(t.body.position.x+4,t.body.position.y+4,t.body.circleRadius,.6*t.body.circleRadius,0,0,2*Math.PI),e.fill(),t.trail.forEach((r,n)=>{let l=(n+1)/t.trail.length;e.fillStyle="rgba(255,255,255,".concat(.5*l,")"),e.beginPath(),e.arc(r.x,r.y,t.body.circleRadius,0,2*Math.PI),e.fill()})}),P.current.active){let t=P.current.pos,r=e.createLinearGradient(t-20,0,t+20,0);r.addColorStop(0,"rgba(255,215,0,0)"),r.addColorStop(.5,"rgba(255,215,0,0.7)"),r.addColorStop(1,"rgba(255,215,0,0)"),e.fillStyle=r,e.fillRect(t-20,0,40,500)}e.restore()});let D=()=>{let e=Date.now();T.current=T.current.filter(t=>e-t<3e3),T.current.push(e),M.current.forEach(e=>{let{body:t}=e;return c.applyForce(t,t.position,{x:.01,y:0})}),T.current.length>3&&b(!0)},H=e=>{U.current.forEach(t=>{t.flashUntil&&e<t.flashUntil?(t.body.render.fillStyle=t.flashState?"#fff":"#ffd700",t.flashState=!t.flashState):t.flashUntil&&e>=t.flashUntil&&(t.flashUntil=0,t.body.render.fillStyle=t.lit?"#ffd700":"#444")}),M.current.forEach(e=>{e.trail.push({x:e.body.position.x,y:e.body.position.y}),e.trail.length>8&&e.trail.shift()}),P.current.active&&(P.current.pos+=5,P.current.pos>420&&(P.current.active=!1,U.current.forEach(e=>{e.lit=!1,e.body.render.fillStyle="#444"}))),(()=>{var e;let t=navigator.getGamepads?navigator.getGamepads():[],r=t&&t[0];r&&((null==(e=r.buttons[5])?void 0:e.pressed)||r.axes[1]<-.8)&&performance.now()-I.current>300&&(D(),I.current=performance.now())})(),O.current=requestAnimationFrame(H)};O.current=requestAnimationFrame(H);let J=e=>{h||("ArrowLeft"===e.key&&c.setAngularVelocity(x,-.25),"ArrowRight"===e.key&&c.setAngularVelocity(w,.25),("ArrowUp"===e.key||"n"===e.key.toLowerCase())&&D(),"m"===e.key.toLowerCase()&&m())},X=e=>{"ArrowLeft"===e.key&&c.setAngularVelocity(x,.25),"ArrowRight"===e.key&&c.setAngularVelocity(w,-.25)};return window.addEventListener("keydown",J),window.addEventListener("keyup",X),()=>{window.removeEventListener("keydown",J),window.removeEventListener("keyup",X),n.stop(L),l.stop(q),r.clear(d),cancelAnimationFrame(O.current),clearTimeout(F.current),clearTimeout(_.current)}},[e,p,y,h,v,t,R]),(0,n.jsxs)("div",{className:"relative h-full w-full flex flex-col items-center justify-start bg-ub-cool-grey text-white",children:[(0,n.jsxs)("div",{className:"p-1 space-x-2",children:[(0,n.jsx)("select",{className:"px-2 bg-ub-grey text-black",value:t,onChange:e=>r(e.target.value),children:Object.entries(u).map(e=>{let[t,r]=e;return(0,n.jsx)("option",{value:t,children:r.name},t)})}),(0,n.jsx)("button",{className:"px-2 bg-ub-orange text-black",onClick:()=>g(!y),children:y?"Play":"Edit"}),(0,n.jsx)("button",{className:"px-2 bg-ub-orange text-black",onClick:()=>{let e=JSON.stringify(p);navigator.clipboard&&(navigator.clipboard.writeText(e),alert("Layout copied to clipboard"))},children:"Save/Share"}),(0,n.jsx)("button",{className:"px-2 bg-ub-orange text-black",onClick:()=>x(!m),"aria-pressed":m,children:m?"Lights On":"Lights Off"}),h&&(0,n.jsxs)("span",{className:"ml-2 text-red-500 motion-safe:animate-pulse","aria-live":"polite",role:"status",children:["TILT ",(0,n.jsx)("button",{onClick:()=>{b(!1),T.current=[]},children:"Reset"})]})]}),(0,n.jsxs)("div",{className:"p-1 text-xs",children:["Score: ",S," ",j>1&&"x".concat(j)," ",L>1&&"Combo x".concat(L)," | High: ",A]}),(0,n.jsx)("canvas",{ref:e,onClick:r=>{let n;if(!y||!e.current)return;let l=e.current.getBoundingClientRect(),i=r.clientX-l.left,a=r.clientY-l.top;n={...p,bumpers:[...p.bumpers,{x:i,y:a,r:20}]},f(e=>({...e,[t]:n}))},className:"bg-black",width:400,height:500}),h&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-red-900 bg-opacity-70 pointer-events-none animate-pulse",role:"status","aria-live":"polite",children:"TILT"}),y&&(0,n.jsx)("div",{className:"text-xs p-1",children:"Click to add bumpers. Press Play when done."}),(0,n.jsx)("div",{className:"text-xs p-1",children:"Press ArrowUp/N or gamepad RB to nudge. Three nudges in 3s causes tilt."})]})}}}]);