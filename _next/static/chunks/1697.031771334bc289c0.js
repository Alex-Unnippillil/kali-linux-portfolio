"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1697],{16924:(e,t,l)=>{l.d(t,{default:()=>r});var a=l(14232);function r(e,t){let l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let a=l.current;if(!a)return;let r=a.getContext("2d");if(!r)return;let n=()=>{let l=(()=>{let e=a.parentElement;if(!e)return null;let{clientWidth:t,clientHeight:l}=e;if(t>0&&l>0)return e;let r=e.closest("[data-game-viewport]");if(r)return r;let n=e.closest(".windowMainScreen");return null!=n?n:e})();if(!l)return;let{clientWidth:n,clientHeight:s}=l;if(n<=0||s<=0)return;let i=Math.min(n/e,s/t),o=e*i,c=t*i,u=window.devicePixelRatio||1;a.style.width="".concat(o,"px"),a.style.height="".concat(c,"px"),a.width=Math.floor(o*u),a.height=Math.floor(c*u),r.setTransform(u*i,0,0,u*i,0,0)};n();let s=a.parentElement,i=null==s?void 0:s.closest("[data-game-viewport]"),o=null==s?void 0:s.closest(".windowMainScreen"),c="undefined"!=typeof ResizeObserver?new ResizeObserver(n):null;return s&&c&&c.observe(s),i&&c&&i!==s&&c.observe(i),o&&c&&o!==s&&c.observe(o),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n),null==c||c.disconnect()}},[e,t]),l}},31697:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var a=l(37876),r=l(14232),n=l(70994),s=l(66893),i=l(88772),o=l(16924),c=l(90209),u=l(67817),d=l(33840),f=l(95220);let m=e=>{let{ghostSpeeds:t,setGhostSpeeds:l,gameSpeed:r,setGameSpeed:n}=e,s=e=>t=>{let a=parseFloat(t.target.value);l(t=>({...t,[e]:a}))};return(0,a.jsxs)("div",{className:"flex space-x-4 mt-2",children:[(0,a.jsxs)("label",{className:"flex flex-col items-center text-sm",children:[(0,a.jsxs)("span",{children:["Scatter: ",t.scatter.toFixed(1)]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:t.scatter,onChange:s("scatter"),className:"w-32"})]}),(0,a.jsxs)("label",{className:"flex flex-col items-center text-sm",children:[(0,a.jsxs)("span",{children:["Chase: ",t.chase.toFixed(1)]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"3",step:"0.1",value:t.chase,onChange:s("chase"),className:"w-32"})]}),(0,a.jsxs)("label",{className:"flex flex-col items-center text-sm",children:[(0,a.jsxs)("span",{children:["Game: ",r.toFixed(1)]}),(0,a.jsx)("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:r,onChange:e=>n(parseFloat(e.target.value)),className:"w-32"})]})]})},x=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,3,2,2,1,2,2,2,2,2,1,2,2,3,1],[1,2,1,2,1,2,1,1,1,2,1,2,1,2,1],[1,2,1,2,2,2,2,0,1,2,2,2,1,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],h=[{value:0,label:"Empty"},{value:1,label:"Wall"},{value:2,label:"Pellet"},{value:3,label:"Energizer"}],y=e=>{let{onPlay:t}=e,[l,n]=(0,r.useState)(()=>x.map(e=>e.slice())),[s,i]=(0,r.useState)(1),[o,c]=(0,r.useState)([]),[u,d]=(0,r.useState)(""),[f,m]=(0,r.useState)("Imported");return(0,r.useEffect)(()=>{let e=[];for(let t=0;t<window.localStorage.length;t++){let l=window.localStorage.key(t);l&&l.startsWith("pacmanMaze:")&&e.push(l.split(":")[1])}e.sort(),c(e)},[]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-2 space-x-2",children:h.map(e=>(0,a.jsx)("button",{onClick:()=>i(e.value),className:"px-2 py-1 border ".concat(s===e.value?"bg-gray-300":""),children:e.label},e.value))}),(0,a.jsx)("div",{className:"inline-block",style:{display:"grid",gridTemplateColumns:"repeat(".concat(l[0].length,", 20px)")},children:l.map((e,t)=>e.map((e,l)=>(0,a.jsxs)("div",{"data-testid":"cell-".concat(l,"-").concat(t),"data-tile":e,onClick:()=>{n(e=>{let a=e.map(e=>e.slice());return a[t][l]=s,a})},className:"w-5 h-5 border border-gray-800 flex items-center justify-center ".concat(1===e?"bg-blue-500":"bg-black"),children:[2===e&&(0,a.jsx)("div",{className:"w-1 h-1 bg-white rounded-full"}),3===e&&(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})]},"".concat(l,"-").concat(t))))}),(0,a.jsxs)("div",{className:"mt-2 space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{let e=window.prompt("Maze name?");e&&(window.localStorage.setItem("pacmanMaze:".concat(e),JSON.stringify(l)),c(t=>t.includes(e)?t:[...t,e].sort()))},className:"px-2 py-1 border",children:"Save Maze"}),(0,a.jsx)("button",{onClick:()=>{d(JSON.stringify(l,null,2))},className:"px-2 py-1 border",children:"Export JSON"}),(0,a.jsxs)("select",{"aria-label":"Load maze",onChange:e=>(e=>{if(!e)return;let t=window.localStorage.getItem("pacmanMaze:".concat(e));if(t)try{let e=JSON.parse(t);Array.isArray(e)&&n(e)}catch(e){}})(e.target.value),className:"border px-2 py-1",defaultValue:"",children:[(0,a.jsx)("option",{value:"",children:"Load..."}),o.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsx)("button",{onClick:()=>n(x.map(e=>e.slice())),className:"px-2 py-1 border",children:"Reset"}),t&&(0,a.jsx)("button",{onClick:()=>t(l),className:"px-2 py-1 border",children:"Play This Maze"})]}),(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsxs)("label",{className:"block text-sm",children:["Import name",(0,a.jsx)("input",{type:"text","aria-label":"Import name",value:f,onChange:e=>m(e.target.value),className:"ml-2 border px-2 py-1 text-sm"})]}),(0,a.jsx)("textarea",{"aria-label":"Maze JSON",value:u,onChange:e=>d(e.target.value),className:"w-full h-32 border px-2 py-1 text-xs font-mono"}),(0,a.jsx)("button",{onClick:()=>{if(u)try{let e=JSON.parse(u);if(!(e=>{if(!Array.isArray(e)||0===e.length)return!1;let t=Array.isArray(e[0])?e[0].length:0;return!!t&&e.every(e=>Array.isArray(e)&&e.length===t&&e.every(e=>[0,1,2,3].includes(e)))})(e))return;n(e);let t=(null==f?void 0:f.trim())||"Imported-".concat(Date.now());window.localStorage.setItem("pacmanMaze:".concat(t),JSON.stringify(e)),c(e=>e.includes(t)?e:[...e,t].sort())}catch(e){}},className:"px-2 py-1 border",children:"Import JSON"})]})]})};var p=l(40382);let g='a[href],area[href],input:not([disabled]),select:not([disabled]),textarea:not([disabled]),button:not([disabled]),iframe,object,embed,[tabindex]:not([tabindex="-1"]),[contenteditable]',v=e=>{let{isOpen:t,onClose:l,children:n,overlayRoot:s}=e,i=(0,r.useRef)(null),o=(0,r.useRef)(null),c=(0,r.useRef)(null),u=(0,r.useRef)(null);if(!c.current&&"undefined"!=typeof document){let e=document.createElement("div");c.current=e,document.body.appendChild(e)}let d=(0,r.useCallback)(()=>s?"string"==typeof s?document.getElementById(s):s:document.getElementById("__next")||document.body,[s]),f=(0,r.useCallback)(e=>{var t;if("Tab"!==e.key)return;let l=null==(t=i.current)?void 0:t.querySelectorAll(g);if(!l||0===l.length)return;let a=l[0],r=l[l.length-1],n=document.activeElement;e.shiftKey||n!==r?e.shiftKey&&n===a&&(e.preventDefault(),r.focus()):(e.preventDefault(),a.focus())},[]);return((0,r.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&(e.preventDefault(),l())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,l]),(0,r.useEffect)(()=>()=>{c.current&&(document.body.removeChild(c.current),c.current=null)},[]),(0,r.useEffect)(()=>{var e,l,a,r,n;if(u.current=d(),t){o.current=document.activeElement,null==(e=u.current)||e.setAttribute("inert","");let t=null==(l=i.current)?void 0:l.querySelectorAll(g);t&&t.length>0?t[0].focus():null==(a=i.current)||a.focus()}else null==(r=u.current)||r.removeAttribute("inert"),null==(n=o.current)||n.focus(),o.current=null;return()=>{var e;null==(e=u.current)||e.removeAttribute("inert")}},[t,d]),t&&c.current)?(0,p.createPortal)((0,a.jsx)("div",{role:"dialog","aria-modal":"true",ref:i,onKeyDown:f,tabIndex:-1,children:n}),c.current):null};var b=l(42318),w=l(98306);let S=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}],j={blinky:{x:13,y:0},pinky:{x:0,y:0},inky:{x:13,y:6},clyde:{x:0,y:6}},C=e=>e.map(e=>e.slice()),k=(e,t,l)=>!!e[l]&&void 0!==e[l][t]&&1!==e[l][t],N=(e,t,l)=>k(e,t,l),M=(e,t)=>{if(k(e,t.x,t.y))return{...t};for(let t=0;t<e.length;t+=1)for(let l=0;l<e[t].length;l+=1)if(k(e,l,t))return{x:l,y:t};return{...t}},T=(e,t,l)=>{var a,r;let n=null!=(r=null==(a=e[0])?void 0:a.length)?r:0;return 0!==n&&(0===t||t===n-1)&&k(e,t,l)},E=(e,t)=>{var l,a;let r=null!=(a=null==(l=e[0])?void 0:l.length)?a:0;return 0===r?t:t.x<-.25?{...t,x:r-.5}:t.x>r-.5+.25?{...t,x:.5}:t},A=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),P=(e,t)=>{let l=Math.abs(e.x%1-.5),a=Math.abs(e.y%1-.5);return l<=t&&a<=t},I=(e,t)=>{var l,a,r,n,s,i,o,c,u,d,f,m;let x=C(e.maze),h=null!=(i=null==(l=x[0])?void 0:l.length)?i:0,y=x.length,p=x.flat().filter(e=>2===e||3===e).length,g=M(x,null!=(o=e.pacStart)?o:{x:1,y:1}),v=M(x,null!=(c=e.ghostStart)?c:{x:7,y:3});return{maze:x,width:h,height:y,pac:{x:g.x+.5,y:g.y+.5,dir:{x:0,y:0},nextDir:{x:0,y:0},lives:3,extraLifeAwarded:!1},ghosts:["blinky","pinky","inky","clyde"].map((e,t)=>({name:e,x:v.x+.5,y:v.y+.5,dir:t%2==0?{x:0,y:-1}:{x:-1,y:0}})),mode:null!=(u=null==(a=t.scatterChaseSchedule[0])?void 0:a.mode)?u:"scatter",modeIndex:0,modeTimer:null!=(d=null==(r=t.scatterChaseSchedule[0])?void 0:r.duration)?d:0,frightenedTimer:0,frightenedCombo:0,pelletsRemaining:p,score:0,levelTime:0,nextFruitIndex:0,fruit:{active:!1,x:null!=(f=null==(n=e.fruit)?void 0:n.x)?f:Math.floor(h/2),y:null!=(m=null==(s=e.fruit)?void 0:s.y)?m:Math.floor(y/2),timer:0},fruitTimes:Array.isArray(e.fruitTimes)?e.fruitTimes.slice():[],status:"playing",spawns:{pac:g,ghosts:{blinky:v,pinky:v,inky:v,clyde:v}}}},L=(e,t,l,a)=>{var r,n,s,i,o,c,u;if("playing"!==e.status)return{state:e,events:{}};let d={},f=null!=(s=a.random)?s:w.random,m=e.maze,x={...e.pac},h=e.ghosts.map(e=>({...e}));t.direction&&(x.nextDir={...t.direction}),e.levelTime+=l;let y={x:Math.floor(x.x),y:Math.floor(x.y)},p=((e,t)=>{if(N(e,t.x,t.y))return t;for(let l of S){let a={x:t.x+l.x,y:t.y+l.y};if(N(e,a.x,a.y))return a}return t})(m,y);(p.x!==y.x||p.y!==y.y)&&(x={...x,x:p.x+.5,y:p.y+.5,dir:{x:0,y:0}},y={...p});let g=(e=>({x:Math.floor(e.x)+.5,y:Math.floor(e.y)+.5}))(x);if(x.nextDir&&(0!==x.nextDir.x||0!==x.nextDir.y)&&P(x,a.turnTolerance)){let e={x:y.x+x.nextDir.x,y:y.y+x.nextDir.y};N(m,e.x,e.y)&&(x={...x,dir:x.nextDir,nextDir:{x:0,y:0},x:g.x,y:g.y})}let v=a.pacSpeed*a.speedMultiplier*(T(m,y.x,y.y)?a.tunnelSpeed:1),b={x:x.x+x.dir.x*v*l,y:x.y+x.dir.y*v*l},k={x:Math.floor(b.x),y:Math.floor(b.y)},M={x:Math.floor((x=N(m,k.x,k.y)?{...x,...E(m,b)}:{...x,x:g.x,y:g.y,dir:{x:0,y:0}}).x),y:Math.floor(x.y)};if((null==(r=m[M.y])?void 0:r[M.x])===2||(null==(n=m[M.y])?void 0:n[M.x])===3){let t=m[M.y][M.x],l=C(m);l[M.y][M.x]=0,e.maze=l,e.pelletsRemaining-=1,2===t?(e.score+=10,d.pellet=!0):(e.score+=50,e.frightenedTimer=a.frightenedDuration,e.frightenedCombo=0,d.energizer=!0)}!x.extraLifeAwarded&&e.score>=1e4&&(x.extraLifeAwarded=!0,x.lives+=1);let I=e.mode;e.frightenedTimer>0?(e.frightenedTimer=Math.max(0,e.frightenedTimer-l),0===e.frightenedTimer?(e.mode=null!=(o=null==(i=a.scatterChaseSchedule[e.modeIndex])?void 0:i.mode)?o:"scatter",e.frightenedCombo=0):e.mode="fright"):(e.modeTimer-=l,e.modeTimer<=0&&e.modeIndex<a.scatterChaseSchedule.length-1&&(e.modeIndex+=1,e.modeTimer=a.scatterChaseSchedule[e.modeIndex].duration),e.mode=null!=(u=null==(c=a.scatterChaseSchedule[e.modeIndex])?void 0:c.mode)?u:"scatter");let L=I!==e.mode,z=a.levelIndex<a.randomModeLevel;h=h.map(t=>{let r={x:Math.floor(t.x),y:Math.floor(t.y)},n=(e.frightenedTimer>0?.7*a.ghostSpeeds.scatter:"scatter"===e.mode?a.ghostSpeeds.scatter:a.ghostSpeeds.chase)*a.speedMultiplier*(T(m,r.x,r.y)?a.tunnelSpeed:1),s=t.dir,i=L&&(0!==s.x||0!==s.y);if(i&&(s={x:-s.x,y:-s.y}),!i&&P(t,a.turnTolerance)){let l={x:-s.x,y:-s.y},a=S.filter(e=>(!!L||e.x!==l.x||e.y!==l.y)&&N(m,r.x+e.x,r.y+e.y));if(a.length||(a=S),e.frightenedTimer>0||z)s=a[Math.floor(f()*a.length)]||s;else{let l="scatter"===e.mode?j[t.name]||{x:r.x,y:r.y}:((e,t,l)=>{let a=Math.floor(t.x),r=Math.floor(t.y);switch(e.name){case"blinky":default:return{x:a,y:r};case"pinky":return{x:a+4*t.dir.x,y:r+4*t.dir.y};case"inky":{let n=l.find(e=>"blinky"===e.name)||e,s=Math.floor(n.x),i=Math.floor(n.y);return{x:2*(a+2*t.dir.x)-s,y:2*(r+2*t.dir.y)-i}}case"clyde":if(Math.hypot(a-Math.floor(e.x),r-Math.floor(e.y))>8)return{x:a,y:r};return j.clyde}})(t,x,h);a.sort((e,t)=>A({x:r.x+e.x,y:r.y+e.y},l)-A({x:r.x+t.x,y:r.y+t.y},l)),s=a[0]||s}}let o={x:t.x+s.x*n*l,y:t.y+s.y*n*l},c={x:Math.floor(o.x),y:Math.floor(o.y)};return N(m,c.x,c.y)?{...t,...E(m,o),dir:s}:{...t,dir:s}});let D={x:Math.floor(x.x),y:Math.floor(x.y)};return h.forEach(t=>{if(Math.floor(t.x)===D.x&&Math.floor(t.y)===D.y)if(e.frightenedTimer>0){let l=Math.pow(2,e.frightenedCombo);e.score+=200*l,e.frightenedCombo=Math.min(e.frightenedCombo+1,3),d.ghostEaten=t.name;let a=e.spawns.ghosts[t.name];t.x=a.x+.5,t.y=a.y+.5,t.dir={x:0,y:-1}}else if(x.lives-=1,d.lifeLost=!0,x.lives<=0)e.status="gameover",d.gameOver=!0;else{var l,r;x.x=e.spawns.pac.x+.5,x.y=e.spawns.pac.y+.5,x.dir={x:0,y:0},x.nextDir={x:0,y:0},h=h.map(t=>({...t,x:e.spawns.ghosts[t.name].x+.5,y:e.spawns.ghosts[t.name].y+.5,dir:{x:0,y:-1}})),e.modeIndex=0,e.modeTimer=null!=(r=null==(l=a.scatterChaseSchedule[0])?void 0:l.duration)?r:0,e.frightenedTimer=0}}),!e.fruit.active&&R(e)&&(e.fruit.active=!0,e.fruit.timer=a.fruitDuration),e.fruit.active&&(e.fruit.timer-=l,D.x===e.fruit.x&&D.y===e.fruit.y?(e.fruit.active=!1,e.score+=100,d.fruit=!0):e.fruit.timer<=0&&(e.fruit.active=!1)),e.pelletsRemaining<=0&&"playing"===e.status&&(e.status="complete",d.levelComplete=!0),{state:{...e,pac:x,ghosts:h},events:d}},R=e=>{let t=e.levelTime,l=e.nextFruitIndex,a=e.fruitTimes;return!!a&&!(l>=a.length)&&t>=a[l]&&(e.nextFruitIndex+=1,!0)},z=e=>0===e||1===e||2===e||3===e,D=e=>({name:e.name||"Untitled",maze:e.maze.map(e=>e.map(e=>e)),fruit:e.fruit,fruitTimes:Array.isArray(e.fruitTimes)?e.fruitTimes.filter(e=>"number"==typeof e&&e>=0):void 0,pacStart:e.pacStart,ghostStart:e.ghostStart}),O=1/120,B=[{mode:"scatter",duration:7},{mode:"chase",duration:20},{mode:"scatter",duration:7},{mode:"chase",duration:20},{mode:"scatter",duration:5},{mode:"chase",duration:20},{mode:"scatter",duration:5},{mode:"chase",duration:1/0}],F={classic:{label:"Classic",pacSpeed:4.5,ghostSpeeds:{scatter:3.8,chase:4.2},frightenedDuration:6},arcade:{label:"Arcade",pacSpeed:5.2,ghostSpeeds:{scatter:4.2,chase:4.8},frightenedDuration:5},hard:{label:"Hard",pacSpeed:5.8,ghostSpeeds:{scatter:4.8,chase:5.6},frightenedDuration:4}},G={name:"Classic",maze:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,3,2,2,1,2,2,2,2,2,1,2,2,3,1],[1,2,1,2,1,2,1,1,1,2,1,2,1,2,1],[1,2,1,2,2,2,2,0,1,2,2,2,1,2,1],[1,2,1,1,1,1,2,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],fruit:{x:7,y:3},fruitTimes:[10,30]},J=function(){var e,t,l,x;let{windowMeta:h}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},p=null==(e=null==h?void 0:h.isFocused)||e,g=(0,c.default)(),w=(0,u.default)(),S=(0,b.default)(),{playTone:j,muted:C,setMuted:k}=function(){let e=(0,r.useRef)(null),t=(0,r.useRef)(null),l=(0,r.useRef)(null),a=(0,r.useRef)({}),n=(0,r.useRef)({}),[s,i]=(0,d.default)("settings:audioMuted",!1),[o,c]=(0,r.useState)(1),[u,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let a=()=>{if(u||e.current)return;let a=window.AudioContext||window.webkitAudioContext;if(!a)return;let r=new a,n=r.createGain(),i=r.createDynamicsCompressor();n.connect(i),i.connect(r.destination),n.gain.value=s?0:o,e.current=r,t.current=n,l.current=i,f(!0)};return window.addEventListener("pointerdown",a,{once:!0}),window.addEventListener("keydown",a,{once:!0}),()=>{window.removeEventListener("pointerdown",a),window.removeEventListener("keydown",a),e.current&&(e.current.close(),e.current=null,t.current=null,l.current=null)}},[s,o,u]),(0,r.useEffect)(()=>{t.current&&(t.current.gain.value=s?0:o)},[s,o]);let m=(0,r.useCallback)(async t=>{let l=e.current;if(!l)return null;let a=await fetch(t),r=await a.arrayBuffer();return await l.decodeAudioData(r)},[]),x=(0,r.useCallback)(async function(l){let{pitchJitter:r=0,volume:n=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.current,o=t.current;if(!i||!o||s)return;let c=a.current[l];if(!c)try{if(!(c=await m("/audio/".concat(l,".mp3"))))return;a.current[l]=c}catch(e){return}let u=i.createBufferSource();if(u.buffer=c,r){let e=(2*Math.random()-1)*r*100;u.detune.value=e}let d=i.createGain();d.gain.value=n,u.connect(d),d.connect(o),u.start()},[m,s]),h=(0,r.useCallback)(async(l,a)=>{let r=e.current,s=t.current;if(r&&s)try{let e=await m(a);if(!e)return;let t=r.createBufferSource();t.buffer=e,t.loop=!0;let i=r.createGain();i.gain.value=0,t.connect(i),i.connect(s),t.start(),n.current[l]={source:t,gain:i}}catch(e){}},[m]),y=(0,r.useCallback)(t=>{let l=e.current;l&&Object.entries(n.current).forEach(e=>{let[a,r]=e,n=a!==t||s?0:o;r.gain.gain.cancelScheduledValues(l.currentTime),r.gain.gain.linearRampToValueAtTime(n,l.currentTime+1)})},[s,o]),p=(0,r.useCallback)(function(l){let{duration:a=.08,type:r="sine",volume:n=.5,attack:i=.01,release:o=.05}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=e.current,u=t.current;if(!c||!u||s)return;let d=c.createOscillator(),f=c.createGain();d.type=r,d.frequency.value=l,f.gain.value=0,d.connect(f),f.connect(u);let m=c.currentTime;f.gain.setValueAtTime(0,m),f.gain.linearRampToValueAtTime(n,m+i),f.gain.exponentialRampToValueAtTime(1e-4,m+a+o),d.start(m),d.stop(m+a+o+.02)},[s]);return{context:e.current,muted:s,setMuted:i,volume:o,setVolume:c,playSfx:x,playTone:p,addMusicLayer:h,setMusicState:y}}(),{scores:N,addScore:M}=(0,s.useLeaderboard)("pacman",10),[T,E]=(0,r.useState)([G]),[A,P]=(0,r.useState)(0),[R,J]=(0,r.useState)(null),[V,q]=(0,r.useState)(""),[K,_]=(0,r.useState)(!1),[H,U]=(0,r.useState)(!1),[W,X]=(0,r.useState)(""),[Q,Y]=(0,r.useState)(""),[Z,$]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(!1),[el,ea]=(0,r.useState)(""),[er,en]=(0,r.useState)([]),[es,ei]=(0,f.default)("pacman:difficulty","classic",e=>"string"==typeof e&&e in F),[eo,ec]=(0,f.default)("pacman:ghostSpeeds",F.classic.ghostSpeeds,e=>!!e&&"number"==typeof e.scatter&&"number"==typeof e.chase),[eu,ed]=(0,f.default)("pacman:gameSpeed",1,e=>"number"==typeof e&&e>0),[ef,em]=(0,f.default)("pacman:classicOnly",!1,e=>"boolean"==typeof e),[ex,eh]=(0,f.default)("pacman:randomLevels",!1,e=>"boolean"==typeof e),[ey,ep]=(0,f.default)("pacman:highScore",0,e=>"number"==typeof e),[eg,ev]=(0,r.useState)({score:0,lives:3,pellets:0,mode:"scatter",status:"playing"}),eb=(0,r.useRef)(null),ew=(0,r.useRef)(0),eS=(0,r.useRef)(0),ej=(0,r.useRef)(null),eC=(0,r.useRef)(null),ek=(0,o.default)(20*(null!=(t=null!=R?R:T[A])?t:G).maze[0].length,20*(null!=(l=null!=R?R:T[A])?l:G).maze.length),eN=(0,r.useRef)(null),eM=(0,r.useRef)(!1),eT=(0,r.useRef)(!1),eE=null!=(x=null!=R?R:T[A])?x:G,eA=(0,r.useMemo)(()=>{let e=ef?T.slice(0,1):T;if(!V)return e;let t=V.toLowerCase();return e.filter((e,l)=>(e.name||"Level ".concat(l+1)).toLowerCase().includes(t))},[T,V,ef]),eP=(0,r.useMemo)(()=>{var e;let t=null!=(e=F[es])?e:F.classic;return{speedMultiplier:eu,pacSpeed:t.pacSpeed,ghostSpeeds:eo,tunnelSpeed:.7,frightenedDuration:t.frightenedDuration,scatterChaseSchedule:B,randomModeLevel:2,levelIndex:A,fruitDuration:9,turnTolerance:.22}},[es,eo,eu,A]);(0,r.useEffect)(()=>{eC.current=eP},[eP]);let eI=(0,r.useCallback)(e=>{e.score>ey&&ep(e.score),ev(t=>{let l={score:e.score,lives:e.pac.lives,pellets:e.pelletsRemaining,mode:e.mode,status:e.status};return t.score===l.score&&t.lives===l.lives&&t.pellets===l.pellets&&t.mode===l.mode&&t.status===l.status?t:l})},[ey,ep]),eL=(0,r.useCallback)(function(e){var t;let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=D(e);a?J(r):(J(null),P(l)),eb.current=I(r,{...null!=(t=eC.current)?t:eP,levelIndex:l}),ew.current=0,eS.current=0,Y(""),X(""),_(!1),U(!1)},[]),eR=(0,r.useCallback)(()=>{eb.current=I(eE,eP),ew.current=0,eS.current=0,Y(""),X(""),U(!1),et(!1),ea(""),_(!0)},[eE,eP]),ez=(0,r.useCallback)(()=>{if(ef)return void eR();if(ex){let e=Math.floor(Math.random()*T.length);eL(T[e],e);return}let e=(A+1)%T.length;eL(T[e],e)},[ef,ex,T,A,eL,eR]),eD=(0,r.useCallback)(e=>{ej.current=e},[]);(0,i.default)({game:"pacman",isFocused:p,onInput:e=>{let{action:t,type:l}=e;if("keydown"===l){if("action"===t&&!K)return void _(!0);"up"===t&&eD({x:0,y:-1}),"down"===t&&eD({x:0,y:1}),"left"===t&&eD({x:-1,y:0}),"right"===t&&eD({x:1,y:0})}}}),(0,r.useEffect)(()=>{S.connected&&!eT.current&&(eT.current=!0),!S.connected&&eT.current&&(eT.current=!1,eM.current=!0)},[S.connected]),(0,r.useEffect)(()=>{if(!S.connected)return;let[e,t]=S.axes;Math.abs(e)>Math.abs(t)&&Math.abs(e)>.5?eD({x:Math.sign(e),y:0}):Math.abs(t)>.5&&eD({x:0,y:Math.sign(t)});let l=S.buttons||[];l[12]>.5&&eD({x:0,y:-1}),l[13]>.5&&eD({x:0,y:1}),l[14]>.5&&eD({x:-1,y:0}),l[15]>.5&&eD({x:1,y:0})},[S,eD]),(0,r.useEffect)(()=>{var e,t;ec(null!=(t=null==(e=F[es])?void 0:e.ghostSpeeds)?t:F.classic.ghostSpeeds)},[es,ec]),(0,r.useEffect)(()=>{eb.current||(eb.current=I(eE,eP))},[eE,eP]),(0,r.useEffect)(()=>{ek.current&&(eN.current=ek.current.getContext("2d"))},[ek]),(0,r.useEffect)(()=>{},[]),(0,r.useEffect)(()=>{fetch("/pacman-levels.json").then(e=>e.json()).then(e=>{e&&"object"==typeof e&&Array.isArray(e.levels)&&e.levels.every(e=>(e=>{var t,l;if(!e||"object"!=typeof e||!Array.isArray(e.maze)||0===e.maze.length)return!1;let a=null!=(l=null==(t=e.maze[0])?void 0:t.length)?l:0;if(0===a)return!1;for(let t of e.maze){if(!Array.isArray(t)||t.length!==a)return!1;for(let e of t)if(!z(e))return!1}return!e.fruit||"number"==typeof e.fruit.x&&"number"==typeof e.fruit.y})(e))&&(E(e.levels.map(e=>D(e))),eL(e.levels[0],0))}).catch(()=>{})},[eL]);let eO=(0,r.useCallback)(()=>{et(!0)},[]),eB=(0,r.useCallback)(async()=>{var e,t;M(el.trim().replace(/[\x00-\x1F\x7F]/g,"").slice(0,16)||"Player",null!=(t=null==(e=eb.current)?void 0:e.score)?t:0),et(!1),ea("")},[M,el]),eF=er.length?er:N,eG=(0,r.useCallback)((e,t)=>{e.pellet&&(null==j||j(520,{duration:.03,volume:.2})),e.energizer&&(null==j||j(300,{duration:.1,volume:.4}),X("Power pellet!")),e.ghostEaten&&(null==j||j(160,{duration:.12,volume:.5})),e.fruit&&(null==j||j(720,{duration:.08,volume:.4})),e.lifeLost&&(null==j||j(220,{duration:.2,volume:.5}),X("Life lost")),e.gameOver&&(null==j||j(120,{duration:.3,volume:.6}),Y("Game Over"),et(!1)),e.levelComplete&&(null==j||j(880,{duration:.2,volume:.5}),Y("Level complete!"),window.setTimeout(()=>{ez(),_(!0)},900)),eI(t)},[ez,j,eI]),eJ=(0,r.useCallback)((e,t)=>{let l=eN.current;if(!l)return;let a=20*e.width,r=20*e.height;l.clearRect(0,0,a,r);let n=l.createLinearGradient(0,0,a,r);n.addColorStop(0,"#050814"),n.addColorStop(.5,"#0a1330"),n.addColorStop(1,"#04040a"),l.fillStyle=n,l.fillRect(0,0,a,r),l.save(),l.globalAlpha=.12,l.strokeStyle="#1f2a44";for(let e=0;e<=a;e+=20)l.beginPath(),l.moveTo(e,0),l.lineTo(e,r),l.stroke();for(let e=0;e<=r;e+=20)l.beginPath(),l.moveTo(0,e),l.lineTo(a,e),l.stroke();l.restore();for(let a=0;a<e.height;a+=1)for(let r=0;r<e.width;r+=1)if(1===e.maze[a][r]){l.fillStyle="#0f2555",l.strokeStyle="#5ee7ff",l.lineWidth=1.8,l.shadowColor="rgba(94,231,255,0.55)",l.shadowBlur=8;let e=20*r,t=20*a;l.beginPath(),l.moveTo(e+4,t),l.lineTo(e+20-4,t),l.quadraticCurveTo(e+20,t,e+20,t+4),l.lineTo(e+20,t+20-4),l.quadraticCurveTo(e+20,t+20,e+20-4,t+20),l.lineTo(e+4,t+20),l.quadraticCurveTo(e,t+20,e,t+20-4),l.lineTo(e,t+4),l.quadraticCurveTo(e,t,e+4,t),l.closePath(),l.fill(),l.stroke(),l.shadowBlur=0}else if(2===e.maze[a][r])l.fillStyle="#f8fafc",l.shadowColor="rgba(248,250,252,0.8)",l.shadowBlur=6,l.beginPath(),l.arc(20*r+10,20*a+10,3,0,2*Math.PI),l.fill(),l.shadowBlur=0;else if(3===e.maze[a][r]){let e=g?1:1+.2*Math.sin(4*t);l.fillStyle="#fef9c3",l.shadowColor="rgba(254,249,195,0.9)",l.shadowBlur=12,l.beginPath(),l.arc(20*r+10,20*a+10,6*e,0,2*Math.PI),l.fill(),l.shadowBlur=0}e.fruit.active&&(l.fillStyle="#34d399",l.shadowColor="rgba(52,211,153,0.6)",l.shadowBlur=10,l.beginPath(),l.arc(20*e.fruit.x+10,20*e.fruit.y+10,6,0,2*Math.PI),l.fill(),l.shadowBlur=0);let s=e.pac,i=Math.atan2(s.dir.y,s.dir.x),o=g?.2:.2+.2*Math.sin(8*t);l.shadowColor="rgba(250,204,21,0.7)",l.shadowBlur=10,l.fillStyle="#facc15",l.beginPath(),l.moveTo(20*s.x,20*s.y),l.arc(20*s.x,20*s.y,8,i+o,i-o+2*Math.PI),l.closePath(),l.fill(),l.shadowBlur=0,e.ghosts.forEach(a=>{let r=20*a.x,n=20*a.y,s=e.frightenedTimer>0&&e.frightenedTimer<1.5&&!g&&Math.floor(6*t)%2==0;l.shadowColor=e.frightenedTimer>0?"rgba(29,78,216,0.6)":"rgba(148,163,184,0.5)",l.shadowBlur=8,l.fillStyle=e.frightenedTimer>0?s?"#fef08a":"#1d4ed8":"blinky"===a.name?"#ef4444":"pinky"===a.name?"#f9a8d4":"inky"===a.name?"#22d3ee":"#fb923c",l.beginPath(),l.arc(r,n,8,Math.PI,0),l.lineTo(r+10-2,n+10-2),l.lineTo(r-10+2,n+10-2),l.closePath(),l.fill(),l.shadowBlur=0;let i=Math.atan2(a.dir.y,a.dir.x);l.fillStyle="#f8fafc",l.strokeStyle="#0f172a",l.lineWidth=1,[{ox:-5,oy:-3},{ox:5,oy:-3}].forEach(e=>{let{ox:t,oy:a}=e;l.beginPath(),l.arc(r+t,n+a,4,0,2*Math.PI),l.fill(),l.stroke()}),l.fillStyle="#0f172a",[{ox:-5,oy:-3},{ox:5,oy:-3}].forEach(e=>{let{ox:t,oy:a}=e;l.beginPath(),l.arc(r+t+2.5*Math.cos(i),n+a+2.5*Math.sin(i),2,0,2*Math.PI),l.fill()})})},[g]);(0,s.useGameLoop)(e=>{if(!eb.current||!eN.current)return;let t=Math.min(Math.max(e,0),.1);ew.current+=t;let l=eb.current,a=ej.current;a&&(ej.current=null);let r=K&&!H&&"playing"===l.status;for(;r&&ew.current>=O;){let e=L(eb.current,{direction:a},O,eP);eb.current=e.state,ew.current-=O,eG(e.events,e.state)}eS.current+=t,eJ(eb.current,eS.current),eI(eb.current)},!0),(0,r.useEffect)(()=>{eM.current&&(eM.current=!1,H||window.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"})))},[H]);let eV=(0,r.useCallback)(e=>{eL({name:"Custom",maze:e,fruit:{x:Math.floor(e[0].length/2),y:Math.floor(e.length/2)},fruitTimes:[12,28]},0,!0),_(!0)},[eL]),eq=(0,a.jsxs)("div",{className:"space-y-3 text-sm text-slate-100",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs uppercase tracking-wide text-slate-300",children:"Difficulty"}),(0,a.jsx)("select",{value:es,onChange:e=>ei(e.target.value),className:"mt-1 w-full rounded bg-slate-800/80 px-2 py-1",children:Object.entries(F).map(e=>{let[t,l]=e;return(0,a.jsx)("option",{value:t,children:l.label},t)})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Sound"}),(0,a.jsx)("button",{type:"button",onClick:()=>k(!C),className:"rounded bg-slate-700 px-2 py-1",children:C?"Muted":"On"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Classic only"}),(0,a.jsx)("button",{type:"button",onClick:()=>em(!ef),className:"rounded bg-slate-700 px-2 py-1",children:ef?"Enabled":"Off"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Random levels"}),(0,a.jsx)("button",{type:"button",onClick:()=>eh(!ex),className:"rounded bg-slate-700 px-2 py-1",children:ex?"On":"Off"})]}),(0,a.jsx)("div",{className:"rounded bg-slate-900/60 p-2",children:(0,a.jsx)(m,{ghostSpeeds:eo,setGhostSpeeds:ec,gameSpeed:eu,setGameSpeed:ed})}),(0,a.jsxs)("button",{type:"button",onClick:()=>$(e=>!e),className:"w-full rounded bg-slate-700 px-2 py-1",children:[Z?"Hide":"Show"," Maze Editor"]})]}),eK=eg.lives,e_=eg.score,eH=eg.pellets,eU=eg.mode;return(0,a.jsxs)(n.default,{gameId:"pacman",stage:R?void 0:A+1,lives:eK,score:e_,highScore:ey,onPauseChange:U,onRestart:eR,pauseHotkeys:["Escape","p"],restartHotkeys:["r"],settingsPanel:eq,isFocused:p,editor:Z?(0,a.jsx)("div",{className:"rounded bg-slate-900/80 p-2 text-xs text-slate-100 shadow-lg",children:(0,a.jsx)(y,{onPlay:eV})}):null,children:[(0,a.jsxs)("div",{className:"relative h-full w-full flex flex-col bg-ub-cool-grey text-white",children:[(0,a.jsxs)("div",{className:"relative flex-1 w-full min-h-0 flex items-center justify-center",children:[(0,a.jsx)("canvas",{ref:ek,width:20*eE.maze[0].length,height:20*eE.maze.length,className:"bg-black rounded-md shadow-inner max-w-full max-h-full",role:"img","aria-label":"Pacman playfield"}),!K&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 text-white gap-4",onPointerDown:e=>{["INPUT","SELECT","TEXTAREA","BUTTON"].includes(e.target.tagName)||_(!0)},role:"button","aria-label":"Start game",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&_(!0)},children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Pacman"}),(0,a.jsx)("div",{className:"text-sm text-slate-200",children:"Press Space or tap to start"}),(0,a.jsx)("div",{className:"text-xs text-slate-300",children:"Arrow keys, swipe, or gamepad to move"}),(0,a.jsxs)("div",{className:"w-64 space-y-2",children:[(0,a.jsx)("input",{type:"text","aria-label":"Search levels",placeholder:"Search levels...",className:"w-full rounded bg-slate-800/80 px-2 py-1 text-sm",value:V,onChange:e=>q(e.target.value)}),(0,a.jsx)("select",{"aria-label":"Select level",value:A,onChange:e=>eL(T[Number(e.target.value)],Number(e.target.value)),className:"w-full rounded bg-slate-800/80 px-2 py-1 text-sm",children:eA.map((e,t)=>(0,a.jsx)("option",{value:T.indexOf(e),children:e.name||"Level ".concat(t+1)},"".concat(e.name,"-").concat(t)))})]}),(0,a.jsx)("button",{type:"button",onClick:()=>_(!0),className:"rounded bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900",children:"Start"}),eF.length>0&&(0,a.jsxs)("div",{className:"text-left text-xs",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Top Scores"}),(0,a.jsx)("ol",{className:"mt-1 space-y-1",children:eF.slice(0,5).map((e,t)=>(0,a.jsxs)("li",{children:[e.name,": ",e.score]},"".concat(e.name,"-").concat(t)))})]})]}),"gameover"===eg.status&&(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/70 text-white gap-2",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Game Over"}),(0,a.jsx)("button",{type:"button",onClick:eR,className:"rounded bg-emerald-500 px-4 py-2 text-sm font-semibold text-slate-900",children:"Restart"}),(0,a.jsx)("button",{type:"button",onClick:eO,className:"rounded bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-900",children:"Save score"})]})]}),(0,a.jsxs)("div",{className:"mt-3 flex flex-wrap items-center justify-center gap-3 px-3 pb-3 text-xs text-slate-200",children:[(0,a.jsxs)("div",{className:"rounded bg-slate-900/70 px-2 py-1",children:["Mode: ","fright"===eU?"Frightened":eU]}),(0,a.jsxs)("div",{className:"rounded bg-slate-900/70 px-2 py-1",children:["Pellets: ",eH]}),(0,a.jsxs)("div",{className:"rounded bg-slate-900/70 px-2 py-1",children:["Level: ",eE.name||"Level ".concat(A+1)]}),Q&&(0,a.jsx)("div",{className:"rounded bg-amber-500/80 px-2 py-1 text-slate-900",children:Q})]}),w&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(s.VirtualPad,{onDirection:eD})}),H&&(0,a.jsx)("div",{className:"mt-3 text-xs text-slate-300",children:"Paused - press Escape to resume"}),(0,a.jsx)("div",{className:"sr-only","aria-live":"polite",children:W})]}),(0,a.jsx)(v,{isOpen:ee,onClose:()=>et(!1),children:(0,a.jsxs)("div",{className:"rounded bg-slate-900 p-4 text-sm text-slate-100 shadow-lg",children:[(0,a.jsx)("h3",{className:"text-base font-semibold",children:"Save your score"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-300",children:"Enter a name for the leaderboard."}),(0,a.jsx)("input",{type:"text","aria-label":"Player name",value:el,onChange:e=>ea(e.target.value),className:"mt-3 w-full rounded bg-slate-800 px-2 py-1",maxLength:16,placeholder:"Player"}),(0,a.jsxs)("div",{className:"mt-3 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>et(!1),className:"rounded bg-slate-700 px-3 py-1",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:eB,className:"rounded bg-emerald-500 px-3 py-1 text-slate-900",children:"Save"})]})]})})]})}},33840:(e,t,l)=>{l.d(t,{default:()=>r});var a=l(14232);function r(e,t){let[l,r]=(0,a.useState)(()=>{try{let l=window.localStorage.getItem(e);return l?JSON.parse(l):t}catch(e){return t}});return(0,a.useEffect)(()=>{try{window.localStorage.setItem(e,JSON.stringify(l))}catch(e){}},[e,l]),[l,r]}},67817:(e,t,l)=>{l.d(t,{default:()=>n});var a=l(14232);let r=()=>"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window||navigator.maxTouchPoints>0;function n(){let[e,t]=(0,a.useState)(r);return(0,a.useEffect)(()=>{var e,l,a;let r=null==(e=(l=window).matchMedia)?void 0:e.call(l,"(pointer: coarse)");if(!r)return;let n=e=>{t(e.matches)};return null==(a=r.addEventListener)||a.call(r,"change",n),()=>{var e;null==(e=r.removeEventListener)||e.call(r,"change",n)}},[]),e}},88772:(e,t,l)=>{l.d(t,{default:()=>s});var a=l(14232),r=l(65422);let n={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",action:"Space",pause:"Escape"};function s(){let{onInput:e,game:t,isFocused:l=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,a.useRef)(n);(0,a.useEffect)(()=>{try{let e=window.localStorage.getItem(t?"".concat(t,":keymap"):"game-keymap");e&&(s.current={...n,...JSON.parse(e)})}catch(e){}},[t]),(0,a.useEffect)(()=>{let t=t=>{if(!(0,r.shouldHandleGameKey)(t,{isFocused:l}))return;let a=s.current,n=Object.keys(a).find(e=>a[e]===t.key);n&&e&&(e({action:n,type:t.type}),(0,r.consumeGameKey)(t))};return window.addEventListener("keydown",t),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",t),window.removeEventListener("keyup",t)}},[e,l])}}}]);