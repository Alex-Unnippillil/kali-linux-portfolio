"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3525],{13525:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var l=r(37876),a=r(14232);let n={maxRunSpeed:220,runAccel:2400,groundFriction:2800,airControlFactor:.55,gravity:2400,maxFallSpeed:900,jumpVelocity:-720,jumpCutMultiplier:.45,coyoteTime:.1,jumpBuffer:.12},o={deadZoneWidth:160,deadZoneHeight:90,followLerp:.12};function i(e,t){return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y}function s(e,t,r,l,a){let n={...e};if(0===t)return{rect:n,hit:!1,platformId:null};let o=Math.sign(t);n[a]+=t;let s=function(e,t,r){let l=Math.max(0,Math.floor(e.x/32)),a=Math.min(t.width-1,Math.floor((e.x+e.w)/32)),n=Math.max(0,Math.floor(e.y/32)),o=Math.min(t.height-1,Math.floor((e.y+e.h)/32)),s=[];for(let e=n;e<=o;e+=1)for(let r=l;r<=a;r+=1)1===t.tiles[e][r]&&s.push({x:32*r,y:32*e,w:32,h:32});return r.forEach(t=>{i(e,{x:t.x,y:t.y,w:t.width,h:t.height})&&s.push({x:t.x,y:t.y,w:t.width,h:t.height,platformId:t.id})}),s}(n,r,l),u=!1,c=null;return s.forEach(t=>{i(n,t)&&(u=!0,"x"===a?o>0?n.x=t.x-e.w:n.x=t.x+t.w:o>0?n.y=t.y-e.h:n.y=t.y+t.h,void 0!==t.platformId&&(c=t.platformId))}),{rect:n,hit:u,platformId:c}}var u=r(67817),c=r(65422);let d=[{name:"Training Grounds",grid:["######################","#....................#","#............C.......#","#....................#","#.....C......###.....#","#..................G.#","#.........###........#","#....................#","#..S..###......C.....#","#....................#","######################"]},{name:"Factory Lift",grid:["########################","#......................#","#....C.................#","#...........M..........#","#..................^...#","#......###......#####..#","#..................C..G#","#..S.......^...........#","#............###.......#","#......................#","########################"]}],h={w:20,h:28},m=1/60;function p(e){let t=d[e%d.length],r=function(e){if(!e.length)throw Error("Level grid cannot be empty");let t=e[0].length,r=e.length,l=Array.from({length:r},()=>Array(t).fill(0)),a=[],n={x:0,y:0},o={x:0,y:0},i=0,s=0;return e.forEach((e,r)=>{if(e.length!==t)throw Error("Level rows must have equal width");[...e].forEach((e,t)=>{let u=32*t,c=32*r;switch(e){case"#":l[r][t]=1;break;case"^":l[r][t]=2;break;case"C":l[r][t]=3,i+=1;break;case"G":l[r][t]=4,o={x:u,y:c};break;case"S":n={x:u,y:c};break;case"M":a.push({id:s++,x:u,y:c+32-16,width:64,height:16,originX:u,range:96,speed:70,dir:1,deltaX:0})}})}),{width:t,height:r,tiles:l,spawn:n,goal:o,coins:i,platforms:a}}(t.grid);return{levelIndex:e,levelName:t.name,state:{level:r,player:{x:r.spawn.x+(32-h.w)/2,y:r.spawn.y+(32-h.h),w:h.w,h:h.h,vx:0,vy:0,onGround:!1,onPlatformId:null,facing:1},time:0,coinsCollected:0,deaths:0,status:"running",respawnTimer:0,coyoteTimer:0,jumpBufferTimer:0,camera:{x:r.spawn.x,y:r.spawn.y},shake:{time:0,magnitude:0}}}}function f(){var e;let{windowMeta:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=null==(e=null==t?void 0:t.isFocused)||e,i=(0,u.default)(),f=(0,a.useRef)(null),y=(0,a.useRef)(null),x=(0,a.useRef)(0),v=(0,a.useRef)(0),g=(0,a.useRef)(!1),w=(0,a.useRef)(!1),b=(0,a.useRef)(!1),j=(0,a.useRef)({left:!1,right:!1,jumpHeld:!1,jumpPressed:!1,jumpReleased:!1}),k=(0,a.useRef)(null),M=(0,a.useRef)(0),[R,C]=(0,a.useState)({level:d[0].name,time:0,coins:{collected:0,total:0},deaths:0,status:"running",paused:!1}),P=(0,a.useRef)(p(0)),S=(0,a.useMemo)(()=>()=>{let e=f.current;if(!e)return;let{level:t}=P.current.state,r=window.devicePixelRatio||1;e.width=32*t.width*r*1,e.height=32*t.height*r*1,e.style.width="100%",e.style.height="100%";let l=e.getContext("2d");l.imageSmoothingEnabled=!1,l.setTransform(+r,0,0,+r,0,0)},[]);(0,a.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)");b.current=e.matches;let t=e=>{b.current=e.matches};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),(0,a.useEffect)(()=>{let e=f.current;if(!e)return;S();let t=()=>S();window.addEventListener("resize",t);let l=e=>{(0,c.shouldHandleGameKey)(e,{isFocused:r})&&(e.repeat||(["KeyA","ArrowLeft"].includes(e.code)&&(j.current.left=!0),["KeyD","ArrowRight"].includes(e.code)&&(j.current.right=!0),["Space","KeyW","ArrowUp"].includes(e.code)&&((0,c.consumeGameKey)(e),j.current.jumpHeld||(j.current.jumpPressed=!0),j.current.jumpHeld=!0),"KeyR"===e.code&&((0,c.consumeGameKey)(e),I()),("KeyP"===e.code||"Escape"===e.code)&&((0,c.consumeGameKey)(e),H())))},a=e=>{(0,c.shouldHandleGameKey)(e,{isFocused:r})&&(["KeyA","ArrowLeft"].includes(e.code)&&(j.current.left=!1),["KeyD","ArrowRight"].includes(e.code)&&(j.current.right=!1),["Space","KeyW","ArrowUp"].includes(e.code)&&(j.current.jumpHeld&&(j.current.jumpReleased=!0),j.current.jumpHeld=!1))};window.addEventListener("keydown",l),window.addEventListener("keyup",a);let i=t=>{let r=e.getContext("2d");if(!r)return;if(g.current){x.current=t,G(r,1),y.current=requestAnimationFrame(i);return}x.current||(x.current=t);let l=(t-x.current)/1e3;x.current=t,l=Math.min(l,.25),v.current+=l;let a=j.current;for(o.followLerp=b.current?.06:.12;v.current>=m;)k.current=T(P.current.state),P.current.state=function(e,t,r){var l,a,i;if("complete"===e.status)return{...e,time:e.time};let u={...e,player:{...e.player},level:e.level,camera:{...e.camera},shake:{...e.shake},status:e.status},c=e.level.platforms.map(e=>({...e,deltaX:0}));if(c.forEach(e=>{let t=e.x;e.x+=e.speed*e.dir*r,e.x>e.originX+e.range?(e.x=e.originX+e.range,e.dir=-1):e.x<e.originX-e.range&&(e.x=e.originX-e.range,e.dir=1),e.deltaX=e.x-t}),u.level={...e.level,platforms:c},"dead"===u.status){let t=Math.max(0,u.respawnTimer-r);return u.respawnTimer=t,0===t&&(u.player.x=e.level.spawn.x,u.player.y=e.level.spawn.y,u.player.vx=0,u.player.vy=0,u.status="running",u.coyoteTimer=0,u.jumpBufferTimer=0,u.player.onGround=!1,u.player.onPlatformId=null,u.shake.time=0),u}if(u.time+=r,u.coyoteTimer=u.player.onGround?n.coyoteTime:Math.max(0,u.coyoteTimer-r),t.jumpPressed?u.jumpBufferTimer=n.jumpBuffer:u.jumpBufferTimer=Math.max(0,u.jumpBufferTimer-r),null!==u.player.onPlatformId){let e=c.find(e=>e.id===u.player.onPlatformId);e&&(u.player.x+=e.deltaX)}let d=(t.left?-1:0)+ +!!t.right,h=n.runAccel*(u.player.onGround?1:n.airControlFactor);if(u.player.vx+=d*h*r,u.player.onGround&&0===d){let e=n.groundFriction*r*Math.sign(u.player.vx);Math.abs(e)>Math.abs(u.player.vx)?u.player.vx=0:u.player.vx-=e}u.player.vx>n.maxRunSpeed&&(u.player.vx=n.maxRunSpeed),u.player.vx<-n.maxRunSpeed&&(u.player.vx=-n.maxRunSpeed),u.player.vy+=n.gravity*r,u.player.vy>n.maxFallSpeed&&(u.player.vy=n.maxFallSpeed);let m=u.player.onGround||u.coyoteTimer>0;u.jumpBufferTimer>0&&m&&(u.player.vy=n.jumpVelocity,u.player.onGround=!1,u.coyoteTimer=0,u.jumpBufferTimer=0),t.jumpReleased&&u.player.vy<0&&(u.player.vy*=n.jumpCutMultiplier),0!==d&&(u.player.facing=d>0?1:-1);let p=function(e,t,r,l){let a={x:e.x,y:e.y,w:e.w,h:e.h},n=e.vx*l,o=e.vy*l,i=!1,u=null,c=s(a,n,t,r,"x");a.x=c.rect.x,c.hit&&(e.vx=0);let d=s(a,o,t,r,"y");return a.y=d.rect.y,d.hit&&(e.vy=0,o>0&&(i=!0,u=d.platformId)),{x:a.x,y:a.y,onGround:i,onPlatformId:u}}(u.player,u.level,c,r);u.player.x=p.x,u.player.y=p.y,u.player.onGround=p.onGround,u.player.onPlatformId=p.onPlatformId;let f=Math.floor((u.player.x+.5*u.player.w)/32),y=Math.floor((u.player.y+.8*u.player.h)/32),x=null==(l=u.level.tiles[y])?void 0:l[f],v=u.player.y>32*u.level.height+64;if(2===x||v)return u.deaths+=1,u.status="dead",u.respawnTimer=.35,u.shake={time:.2,magnitude:4},u;let g=Math.floor(u.player.x/32),w=Math.floor((u.player.x+u.player.w)/32),b=Math.floor(u.player.y/32),j=Math.floor((u.player.y+u.player.h)/32);for(let e=b;e<=j;e+=1)for(let t=g;t<=w;t+=1)(null==(i=u.level.tiles[e])?void 0:i[t])===3&&(u.level.tiles[e][t]=0,u.coinsCollected+=1);let k=Math.floor((u.player.x+u.player.w/2)/32),M=Math.floor((u.player.y+u.player.h/2)/32);(null==(a=u.level.tiles[M])?void 0:a[k])===4&&(u.status="complete");let R=u.player.x+u.player.w/2,C=u.player.y+u.player.h/2,P=.5*o.deadZoneWidth,S=.5*o.deadZoneHeight,T=u.camera.x,E=u.camera.y;R<u.camera.x-P?T=R+P:R>u.camera.x+P&&(T=R-P),C<u.camera.y-S?E=C+S:C>u.camera.y+S&&(E=C-S);let N=32*u.level.width,A=32*u.level.height,L=1.5*o.deadZoneWidth,G=1.5*o.deadZoneHeight;return T=Math.max(L,Math.min(N-L,T)),E=Math.max(G,Math.min(A-G,E)),u.camera.x+=(T-u.camera.x)*o.followLerp,u.camera.y+=(E-u.camera.y)*o.followLerp,u.shake.time>0&&(u.shake.time=Math.max(0,u.shake.time-r),0===u.shake.time&&(u.shake.magnitude=0)),u}(P.current.state,a,m),v.current-=m,a.jumpPressed=!1,a.jumpReleased=!1;G(r,v.current/m),K(t),y.current=requestAnimationFrame(i)};return y.current=requestAnimationFrame(i),()=>{y.current&&cancelAnimationFrame(y.current),window.removeEventListener("keydown",l),window.removeEventListener("keyup",a),window.removeEventListener("resize",t)}},[G,r,S,I,T,K,H]);let T=(0,a.useCallback)(e=>({player:{...e.player},camera:{...e.camera},level:e.level,coinsCollected:e.coinsCollected,deaths:e.deaths,status:e.status,time:e.time,shake:{...e.shake}}),[]),E=(0,a.useCallback)((e,t)=>{e.save(),e.fillStyle="#0f172a",e.fillRect(0,0,32*t.width,32*t.height),e.strokeStyle="rgba(255,255,255,0.05)";for(let r=0;r<=t.width;r+=1)e.beginPath(),e.moveTo(32*r,0),e.lineTo(32*r,32*t.height),e.stroke();for(let r=0;r<=t.height;r+=1)e.beginPath(),e.moveTo(0,32*r),e.lineTo(32*t.width,32*r),e.stroke();e.restore()},[]),N=(0,a.useCallback)((e,t)=>{for(let r=0;r<t.height;r+=1)for(let l=0;l<t.width;l+=1){let a=t.tiles[r][l],n=32*l,o=32*r;1===a?(e.fillStyle="#1f2937",e.fillRect(n,o,32,32),e.strokeStyle="#111827",e.strokeRect(n,o,32,32)):2===a?(e.fillStyle="#ef4444",e.beginPath(),e.moveTo(n+16,o),e.lineTo(n+32,o+32),e.lineTo(n,o+32),e.closePath(),e.fill()):3===a?(e.fillStyle="#f59e0b",e.fillRect(n+8,o+8,16,16)):4===a&&(e.fillStyle="#34d399",e.fillRect(n+6,o+6,20,20))}},[]),A=(0,a.useCallback)((e,t)=>{e.fillStyle="#6b7280",t.forEach(t=>{e.fillRect(t.x,t.y,t.width,t.height),e.strokeStyle="#111827",e.strokeRect(t.x,t.y,t.width,t.height)})},[]),L=(0,a.useCallback)((e,t,r,l)=>{e.fillStyle="#e5e7eb",e.fillRect(t,r,h.w,h.h),e.fillStyle="#111827";let a=1===l?t+h.w-6:t+2;e.fillRect(a,r+8,4,4)},[]),G=(0,a.useCallback)((e,t)=>{let r=P.current.state,l=k.current||r,a=(e,r)=>e+(r-e)*t,n=a(l.player.x,r.player.x),o=a(l.player.y,r.player.y),i=a(l.camera.x,r.camera.x),s=a(l.camera.y,r.camera.y),u=+(window.devicePixelRatio||1),c=b.current?0:r.shake.magnitude*(r.shake.time>0?r.shake.time/.2:0),d=c?(Math.random()-.5)*c:0,h=c?(Math.random()-.5)*c:0;e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#0c0f17",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(-i+e.canvas.width/(2*u),-s+e.canvas.height/(2*u)),e.translate(d,h),E(e,r.level),N(e,r.level),A(e,r.level.platforms),L(e,n,o,r.player.facing),e.restore()},[E,A,L,N]),K=(0,a.useCallback)(e=>{if(e-M.current<120)return;let{state:t}=P.current;C({level:P.current.levelName,time:t.time,coins:{collected:t.coinsCollected,total:t.level.coins},deaths:t.deaths,status:t.status,paused:g.current}),M.current=e},[]),I=(0,a.useCallback)(()=>{let e=p(P.current.levelIndex);e.state.deaths=P.current.state.deaths,P.current=e,v.current=0,x.current=0,S()},[S]),H=(0,a.useCallback)(()=>{g.current=!g.current,C(e=>({...e,paused:g.current}))},[]);(0,a.useEffect)(()=>{if(!r&&!g.current){w.current=!0,g.current=!0,C(e=>({...e,paused:!0}));return}r&&w.current&&(w.current=!1,g.current=!1,C(e=>({...e,paused:!1})))},[r]);let F=()=>{g.current||(j.current.jumpPressed=!0,j.current.jumpHeld=!0)},D=()=>{j.current.jumpHeld=!1,j.current.jumpReleased=!0};return(0,l.jsxs)("div",{className:"relative w-full h-full flex flex-col bg-slate-950 text-slate-100",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 px-3 py-2 text-xs bg-slate-900 border-b border-slate-800",children:[(0,l.jsx)("div",{className:"font-semibold",children:R.level}),(0,l.jsxs)("div",{children:["Time: ",function(e){let t=Math.floor(e),r=Math.floor((e-t)*1e3).toString().padStart(3,"0"),l=Math.floor(t/60).toString().padStart(2,"0"),a=(t%60).toString().padStart(2,"0");return"".concat(l,":").concat(a,".").concat(r)}(R.time)]}),(0,l.jsxs)("div",{children:["Coins: ",R.coins.collected,"/",R.coins.total]}),(0,l.jsxs)("div",{children:["Deaths: ",R.deaths]}),(0,l.jsxs)("div",{children:["Status: ","complete"===R.status?"Complete":R.paused?"Paused":"Running"]}),(0,l.jsxs)("div",{className:"ml-auto flex gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:I,className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700",children:"Restart"}),(0,l.jsx)("button",{type:"button",onClick:H,className:"px-2 py-1 rounded bg-slate-800 hover:bg-slate-700",children:R.paused?"Resume":"Pause"}),"complete"===R.status&&(0,l.jsx)("button",{type:"button",onClick:()=>{let e=p(Math.min(P.current.levelIndex+1,d.length-1));e.state.deaths=P.current.state.deaths,P.current=e,v.current=0,x.current=0,g.current=!1,S()},className:"px-2 py-1 rounded bg-emerald-700 hover:bg-emerald-600",children:"Next Level"})]})]}),(0,l.jsx)("div",{className:"flex-1 grid place-items-center p-2",children:(0,l.jsxs)("div",{className:"relative w-full h-full max-w-5xl max-h-[70vh] bg-slate-900 border border-slate-800 rounded",style:{aspectRatio:"".concat(32*P.current.state.level.width," / ").concat(32*P.current.state.level.height)},children:[(0,l.jsx)("canvas",{ref:f,className:"w-full h-full rounded select-none",style:{imageRendering:"pixelated"},role:"img","aria-label":"Platformer playfield",onPointerDown:i?F:void 0,onPointerUp:i?D:void 0,onPointerCancel:i?D:void 0}),(0,l.jsx)("div",{className:"absolute bottom-2 left-2 text-[10px] text-slate-300 bg-slate-900/70 px-2 py-1 rounded",children:"Controls: ←/A + →/D to move • Space/W/↑ to jump • R restart • P/Esc pause"})]})}),i&&(0,l.jsxs)("div",{className:"mb-4 flex flex-col items-center gap-3",children:[(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-lg",children:[(0,l.jsx)("div",{}),(0,l.jsx)("button",{type:"button",onPointerDown:F,onPointerUp:D,onPointerCancel:D,className:"h-12 w-12 rounded bg-slate-800 shadow-sm transition hover:bg-slate-700 focus:outline-none focus:ring","aria-label":"Jump",children:"⤒"}),(0,l.jsx)("div",{}),(0,l.jsx)("button",{type:"button",onPointerDown:()=>{j.current.left=!0},onPointerUp:()=>{j.current.left=!1},onPointerCancel:()=>{j.current.left=!1},className:"h-12 w-12 rounded bg-slate-800 shadow-sm transition hover:bg-slate-700 focus:outline-none focus:ring","aria-label":"Move left",children:"←"}),(0,l.jsx)("button",{type:"button",onPointerDown:()=>{j.current.right=!0},onPointerUp:()=>{j.current.right=!1},onPointerCancel:()=>{j.current.right=!1},className:"h-12 w-12 rounded bg-slate-800 shadow-sm transition hover:bg-slate-700 focus:outline-none focus:ring","aria-label":"Move right",children:"→"}),(0,l.jsx)("div",{})]}),(0,l.jsx)("div",{className:"text-xs text-slate-400",children:"Tap the canvas or use the jump button to hop."})]})]})}},65422:(e,t,r)=>{r.d(t,{consumeGameKey:()=>a,formatGameKey:()=>n,shouldHandleGameKey:()=>l});let l=function(e){let{isFocused:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(!t||(e=>{if(!e||!(e instanceof HTMLElement))return!1;let t=e.tagName;return"INPUT"===t||"TEXTAREA"===t||e.isContentEditable})(e.target))},a=e=>{(null==e?void 0:e.cancelable)&&e.preventDefault(),(null==e?void 0:e.stopPropagation)&&e.stopPropagation()},n=e=>{if(!e)return"";if(" "===e)return"Space";let t=e.toLowerCase();return"escape"===t?"Esc":"arrowup"===t?"ArrowUp":"arrowdown"===t?"ArrowDown":"arrowleft"===t?"ArrowLeft":"arrowright"===t?"ArrowRight":1===e.length?e.toUpperCase():e}},67817:(e,t,r)=>{r.d(t,{default:()=>n});var l=r(14232);let a=()=>"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)").matches:"ontouchstart"in window||navigator.maxTouchPoints>0;function n(){let[e,t]=(0,l.useState)(a);return(0,l.useEffect)(()=>{var e,r,l;let a=null==(e=(r=window).matchMedia)?void 0:e.call(r,"(pointer: coarse)");if(!a)return;let n=e=>{t(e.matches)};return null==(l=a.addEventListener)||l.call(a,"change",n),()=>{var e;null==(e=a.removeEventListener)||e.call(a,"change",n)}},[]),e}}}]);