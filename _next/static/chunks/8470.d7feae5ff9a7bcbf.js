(()=>{"use strict";let e={caseSensitive:!1,allowLargeFiles:!1,maxFileSizeBytes:1048576,skipBinary:!0},t=!1;self.onmessage=async i=>{let n=i.data||{};if((null==n?void 0:n.type)==="cancel"){t=!0;return}let{directoryHandle:s,query:l,options:r}=n;if(!s||!l)return void self.postMessage({type:"done"});t=!1;let a=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...e,...t}}(r),o=function(e,t){return t.caseSensitive?e:e.toLowerCase()}(l,a),f=0,c=0;async function*u(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("function"==typeof e.entries){for await(let[n,s]of e.entries()){if(t)break;let e=i?"".concat(i,"/").concat(n):n;"file"===s.kind?yield{handle:s,path:e}:"directory"===s.kind&&(yield*u(s,e))}return}if("function"==typeof e.values)for await(let n of e.values()){if(t)return;let e=n.name||"untitled",s=i?"".concat(i,"/").concat(e):e;"file"===n.kind?yield{handle:n,path:s}:"directory"===n.kind&&(yield*u(n,s))}}for await(let{handle:e,path:i}of u(s)){if(t)break;try{let t=await e.getFile();if(!a.allowLargeFiles&&t.size>a.maxFileSizeBytes){c+=1,f+=1,self.postMessage({type:"progress",scanned:f,skipped:c});continue}if(a.skipBinary){let e=await t.slice(0,4096).arrayBuffer();if(function(e){let t=new Uint8Array(e);if(!t.length)return!1;let i=0;for(let e of t){if(0===e)return!0;(e<7||e>13&&e<32)&&(i+=1)}return i/t.length>.2}(e)){c+=1,f+=1,self.postMessage({type:"progress",scanned:f,skipped:c});continue}}(await t.text()).split(/\r?\n/).forEach((e,t)=>{(function(e,t,i){return i.caseSensitive?e.includes(t):e.toLowerCase().includes(t)})(e,o,a)&&self.postMessage({type:"result",file:i,line:t+1,text:e})}),(f+=1)%5==0&&self.postMessage({type:"progress",scanned:f,skipped:c})}catch(e){c+=1}}self.postMessage({type:"done",scanned:f,skipped:c,cancelled:t})}})(),_N_E={};