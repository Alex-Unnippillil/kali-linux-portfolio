"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1263],{81263:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n=r(37876),l=r(14232),s=r(22277);let a=(e,t)=>{if("function"==typeof e.load_pgn){let r=e.load_pgn(t);return"boolean"!=typeof r||r}if("function"==typeof e.loadPgn){let r=e.loadPgn(t);return"boolean"!=typeof r||r}return!1},i=e=>e?e.split(/\n\s*\n(?=\[)/g).map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.split(/\r?\n/),r=t.filter(e=>e.trim().startsWith("[")),n=t.filter(e=>!e.trim().startsWith("["));return{headers:(e=>{let t={};for(let r of e){let e=r.match(/^\[(\w+)\s+"(.*)"\]$/);if(e){let[,r,n]=e;t[r]=n}}return t})(r),moves:(e=>{let t=e.replace(/\{[^}]*\}/g," ").replace(/\([^)]*\)/g," ").replace(/\$\d+/g," ").replace(/\d+\.(\.\.)?/g," ").replace(/1-0|0-1|1\/2-1\/2|\*/g," ").replace(/\s+/g," ").trim();return t?t.split(" ").filter(Boolean):[]})(n.join(" ")),raw:e}}):[],c=()=>{let e=0;return{next:()=>e+=1,isLatest:t=>t===e,reset:()=>{e=0}}},u={1:"♙",2:"♘",3:"♗",4:"♖",5:"♕",6:"♔","-1":"♟","-2":"♞","-3":"♝","-4":"♜","-5":"♛","-6":"♚"},o={1:"/pieces/wP.svg",2:"/pieces/wN.svg",3:"/pieces/wB.svg",4:"/pieces/wR.svg",5:"/pieces/wQ.svg",6:"/pieces/wK.svg","-1":"/pieces/bP.svg","-2":"/pieces/bN.svg","-3":"/pieces/bB.svg","-4":"/pieces/bR.svg","-5":"/pieces/bQ.svg","-6":"/pieces/bK.svg"},d={1:100,2:320,3:330,4:500,5:900,6:2e4},f="abcdefgh",h=e=>{if(!e||e.length<2)return null;let t=f.indexOf(e[0]),r=Number.parseInt(e.slice(1),10)-1;return t<0||r<0||r>7?null:16*r+t},m=e=>(136&e)==0,p=(e,t,r)=>Math.max(t,Math.min(r,e)),x=e=>{let t=Math.floor(e/1e3),r=Math.floor(t/60);return"".concat(r,":").concat(String(t%60).padStart(2,"0"))},g="chess-session-v1",b=(e,t)=>!!e&&!!t&&("function"==typeof e.load_pgn?e.load_pgn(t):"function"==typeof e.loadPgn&&e.loadPgn(t)),v=()=>{var e,t,v,y,w,k,j,S,N,C,M,R;let D=(0,l.useMemo)(()=>(()=>{try{let e=localStorage.getItem(g);if(!e)return null;let t=JSON.parse(e);if(!t||"object"!=typeof t)return null;return t}catch(e){return null}})(),[]),z=(0,l.useMemo)(()=>{var e;return null!=(e=null==D?void 0:D.settings)?e:{}},[D]),E=(0,l.useMemo)(()=>{var e;return null!=(e=null==D?void 0:D.game)?e:{}},[D]),P=(0,l.useRef)(!!(null==E?void 0:E.pgn)),A=(0,l.useRef)(!1),T=(0,l.useRef)(null),I=(0,l.useRef)(null),q=(0,l.useRef)({raf:null,needsRender:!1}),B=(0,l.useRef)(null),F=(0,l.useRef)({canvas:null,size:0,dpr:1,textureReady:!1}),O=(0,l.useRef)(null),L=(0,l.useRef)(64),W=(0,l.useRef)(1),Y=(0,l.useRef)("play"),_=(0,l.useRef)(!1),G=(0,l.useRef)(c()),U=(0,l.useRef)(c()),H=(0,l.useRef)(new Map),K=(0,l.useRef)(!1),J=(0,l.useRef)(null),Q=(0,l.useRef)(null),$=(0,l.useRef)(null),V=(0,l.useRef)(new s.Chess),X=(0,l.useRef)((()=>{let e=new Int8Array(128),t=[4,2,3,5,6,3,2,4];for(let r=0;r<8;r++)e[r]=+t[r],e[16+r]=1,e[96+r]=-1,e[112+r]=-1*t[r];return e})()),Z=(0,l.useRef)(1),ee=(0,l.useRef)(1),et=(0,l.useRef)(2),er=(0,l.useRef)(!1),en=(0,l.useRef)(!1),el=(0,l.useRef)(null),es=(0,l.useRef)(null),ea=(0,l.useRef)(0),ei=(0,l.useRef)(null),ec=(0,l.useRef)({}),eu=(0,l.useRef)([]),eo=(0,l.useRef)([]),ed=(0,l.useRef)([]),ef=(0,l.useRef)(null),eh=(0,l.useRef)({white:0,black:0,active:1,lastTick:"undefined"!=typeof performance?performance.now():Date.now(),resumeTarget:1}),[em,ep]=(0,l.useState)(null),[ex,eg]=(0,l.useState)(0),[eb,ev]=(0,l.useState)([]),[ey,ew]=(0,l.useState)("Your move"),[ek,ej]=(0,l.useState)(!1),[eS,eN]=(0,l.useState)(!1),[eC,eM]=(0,l.useState)(null==(e=z.sound)||e),[eR,eD]=(0,l.useState)(null!=(t=z.showHints)&&t),[ez,eE]=(0,l.useState)([]),[eP,eA]=(0,l.useState)(null==(v=z.showArrows)||v),[eT,eI]=(0,l.useState)(null==(y=z.showCoordinates)||y),[eq,eB]=(0,l.useState)(null!=(w=z.orientation)?w:"white"),[eF,eO]=(0,l.useState)(null!=(k=z.pieceSet)?k:"sprites"),[eL,eW]=(0,l.useState)(!1),[eY,e_]=(0,l.useState)(!1),[eG,eU]=(0,l.useState)([]),[eH,eK]=(0,l.useState)([]),[eJ,eQ]=(0,l.useState)(!1),[e$,eV]=(0,l.useState)(""),[eX,eZ]=(0,l.useState)(null!=(j=z.analysisDepth)?j:2),[e0,e1]=(0,l.useState)(null!=(S=z.aiDepth)?S:2),[e2,e5]=(0,l.useState)(!1),[e3,e6]=(0,l.useState)(null!=(N=z.playerSide)?N:1),[e4,e8]=(0,l.useState)(512),[e7,e9]=(0,l.useState)(null),[te,tt]=(0,l.useState)(null),[tr,tn]=(0,l.useState)("White"),[tl,ts]=(0,l.useState)({white:0,black:0}),[ta,ti]=(0,l.useState)(0),[tc,tu]=(0,l.useState)(0),[to,td]=(0,l.useState)(!1),[tf,th]=(0,l.useState)(""),[tm,tp]=(0,l.useState)("play"),[tx,tg]=(0,l.useState)([]),[tb,tv]=(0,l.useState)(0),[ty,tw]=(0,l.useState)(0),[tk,tj]=(0,l.useState)(""),[tS,tN]=(0,l.useState)(!1),[tC,tM]=(0,l.useState)(()=>Number(localStorage.getItem("chessPuzzleStreak")||0)),[tR,tD]=(0,l.useState)([]),[tz,tE]=(0,l.useState)(0),[tP,tA]=(0,l.useState)(0),[tT,tI]=(0,l.useState)(""),[tq,tB]=(0,l.useState)(!1),[tF,tO]=(0,l.useState)(null),[tL,tW]=(0,l.useState)(0),[tY,t_]=(0,l.useState)(()=>Number(localStorage.getItem("chessElo")||1200));(0,l.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)");td(e.matches);let t=()=>td(e.matches);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[tX]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let[t,r]=await Promise.all([fetch("/chess/puzzles.pgn"),fetch("/chess/openings.pgn")]),[n,l]=await Promise.all([t.ok?t.text():"",r.ok?r.text():""]);if(!e)return;tg(i(n).flatMap((e,t)=>{var r,n,l;let i=null!=(r=e.headers.FEN)?r:new s.Chess().fen(),c=null!=(n=i.split(" ")[1])?n:"w",u=new s.Chess;if(!a(u,e.raw))return[];let o=u.history({verbose:!0}).map(e=>({from:e.from,to:e.to,san:e.san,promotion:e.promotion})),d=null!=(l=e.headers.Event)?l:"Puzzle ".concat(t+1);return[{id:"puzzle-".concat(t+1),title:d,fen:i,sideToMove:c,solution:o}]})),tD(i(l).flatMap((e,t)=>{var r,n;let l=new s.Chess;if(!a(l,e.raw))return[];let i=l.history({verbose:!0}).map(e=>({from:e.from,to:e.to,san:e.san,promotion:e.promotion})),c=null!=(n=null!=(r=e.headers.Opening)?r:e.headers.Event)?n:"Opening ".concat(t+1);return[{id:"opening-".concat(t+1),name:c,moves:i}]}))}catch(t){if(!e)return;tg([]),tD([])}})(),()=>{e=!1}},[tX]),(0,l.useEffect)(()=>{er.current=ek},[ek]),(0,l.useEffect)(()=>{en.current=eS},[eS]),(0,l.useEffect)(()=>{ee.current=e3},[e3]),(0,l.useEffect)(()=>{et.current=e0},[e0]),(0,l.useEffect)(()=>{K.current=e2},[e2]),(0,l.useEffect)(()=>{Y.current=tm},[tm]),(0,l.useEffect)(()=>{if("play"===tm){if(_.current){_.current=!1;return}tj(""),tI(""),tB(!1),tw(0),tA(0),t9({autoplayAi:!0});return}"puzzle"===tm&&tx.length>0&&re(tb),"opening"===tm&&tR.length>0&&rt(tz)},[rt,re,tm,tz,tR.length,tb,tx.length,t9]);let tG=(0,l.useCallback)(()=>{el.current&&(clearTimeout(el.current),el.current=null),e5(!1)},[]),tU=(0,l.useCallback)(()=>{let e=q.current;e.needsRender=!0,e.raf||"undefined"==typeof requestAnimationFrame||(e.raf=requestAnimationFrame(()=>{var t;e.raf=null,null==(t=B.current)||t.call(B)}))},[]),tH=(0,l.useCallback)(()=>{ea.current+=1,es.current&&(clearTimeout(es.current),es.current=null)},[]),tK=(0,l.useCallback)(()=>{if(eC)try{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;ei.current||(ei.current=new e);let t=ei.current;"suspended"===t.state&&t.resume().catch(()=>{});let r=t.createOscillator(),n=t.createGain();r.type="sine",r.frequency.value=880,n.gain.value=.03,r.connect(n),n.connect(t.destination),r.start(),r.stop(t.currentTime+.06)}catch(e){}},[eC]),tJ=(0,l.useCallback)(()=>{let e=V.current,t=e.board(),r={p:1,n:2,b:3,r:4,q:5,k:6},n=new Int8Array(128);for(let e=0;e<8;e++)for(let l=0;l<8;l++){let s=t[e][l];if(!s)continue;let a=r[s.type],i="w"===s.color?1:-1;n[16*(7-e)+l]=i*a}X.current=n,Z.current="w"===e.turn()?1:-1,tn("w"===e.turn()?"White":"Black"),tX()},[tX]),tQ=(0,l.useCallback)(()=>{ti((e=>{let t=0;for(let r=0;r<128;r++){if(!m(r)){r+=7;continue}let n=e[r];if(!n)continue;let l=d[Math.abs(n)]||0;t+=n>0?l:-l}return t})(X.current))},[]),t$=(0,l.useCallback)(()=>{if(!eR)return void eE([]);let e=V.current;if(e.isGameOver())return void eE([]);let t=e.moves({verbose:!0}),r=[];for(let n of t){e.move(n);let t=e.isCheckmate();if(e.undo(),t){let e=h(n.to);null!==e&&r.push(e)}}eE(r)},[eR]),tV=(0,l.useCallback)(e=>{for(let t=0;t<128;t++){if(!m(t)){t+=7;continue}if(X.current[t]===6*e)return t}return null},[]),tX=(0,l.useCallback)(()=>{if(!V.current.isCheck())return void tt(null);tt(tV(Z.current))},[tV]);(0,l.useEffect)(()=>{tQ()},[tQ]),(0,l.useEffect)(()=>{let e;if(to)return void tu(ta);let t=()=>{tu(r=>{let n=ta-r;return 1>Math.abs(n)?ta:(e=requestAnimationFrame(t),r+.1*n)})};return e=requestAnimationFrame(t),()=>cancelAnimationFrame(e)},[ta,to]),(0,l.useEffect)(()=>{let e={},t=0;for(let r of[1,2,3,4,5,6])for(let n of[1,-1]){let l=String(n*r),s=new Image;s.onload=s.onerror=()=>{(t+=1)>=12&&eW(!0)},s.src=o[l],e[l]=s}ec.current=e},[]),(0,l.useEffect)(()=>{let e=new Image;e.onload=e.onerror=()=>{e_(!0),tU()},e.src="/chess/board-texture.svg",O.current=e},[tU]),(0,l.useEffect)(()=>{if(!Q.current||"undefined"==typeof ResizeObserver)return;let e=new ResizeObserver(e=>{for(let t of e){let e=Math.floor(Math.min(t.contentRect.width,t.contentRect.height));e>0&&e8(p(e,260,512))}});return e.observe(Q.current),()=>e.disconnect()},[]),(0,l.useEffect)(()=>{let e=J.current;if(!e)return;let t=()=>{let t=window.devicePixelRatio||1;W.current=t,L.current=e4/8,e.width=Math.round(e4*t),e.height=Math.round(e4*t),e.style.width="".concat(e4,"px"),e.style.height="".concat(e4,"px");let r=e.getContext("2d");r&&(r.setTransform(t,0,0,t,0,0),r.imageSmoothingEnabled=!0),tU()};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[e4,tU]),(0,l.useEffect)(()=>{let e=setInterval(()=>{er.current||en.current||t0()},250);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{tJ(),tQ(),t$()},[tJ,tQ,t$]),(0,l.useEffect)(()=>{if(A.current)return;if(!(null==E?void 0:E.pgn)||(tG(),tH(),V.current.reset(),!b(V.current,E.pgn))){A.current=!0;return}tJ(),eU(V.current.history()),ep(null),ev([]),ef.current=null,eu.current=[],eo.current=[],ed.current=[],tQ(),t$();let e=V.current.isGameOver();eN(e),en.current=e,(null==E?void 0:E.paused)?(er.current=!0,ej(!0),eh.current.active=null,ew("Paused.")):(er.current=!1,ej(!1),t1(Z.current),ew(Z.current===ee.current?"Your move":"AI thinking..."),Z.current===ee.current||en.current||er.current||(el.current=setTimeout(()=>{var e;return null==(e=T.current)?void 0:e.call(T)},to?100:260))),A.current=!0},[tH,e3,to,tG,E,tJ,tQ,t$]);let tZ=(0,l.useCallback)(()=>{try{let e={settings:{playerSide:e3,aiDepth:e0,analysisDepth:eX,sound:eC,showHints:eR,showArrows:eP,showCoordinates:eT,pieceSet:eF,orientation:eq},game:{pgn:V.current.pgn(),paused:ek}};localStorage.setItem(g,JSON.stringify(e))}catch(e){}},[e0,eX,eq,ek,eF,e3,eP,eT,eR,eC]);(0,l.useEffect)(()=>{A.current&&tZ()},[tZ,eG]),(0,l.useEffect)(()=>{let e=new Worker(r.tu(new URL(r.p+r.u(6610),r.b)));I.current=e;let t=H.current,n=e=>{let t=e.data;if(!t||"result"!==t.type&&"error"!==t.type)return;let{channel:r,requestId:n}=t;if(!("ai"===r?G.current:U.current).isLatest(n))return;let l="".concat(r,":").concat(n),s=H.current.get(l);s&&(s(t),H.current.delete(l))};return e.addEventListener("message",n),()=>{e.removeEventListener("message",n),e.terminate(),I.current=null,t.clear()}},[]),(0,l.useEffect)(()=>()=>{tG(),tH(),ei.current&&(ei.current.close().catch(()=>{}),ei.current=null)},[tH,tG]);let t0=()=>{if("play"!==Y.current)return;let e="undefined"!=typeof performance?performance.now():Date.now(),t=eh.current;if(null===t.active){t.lastTick=e;return}let r=Math.max(0,e-t.lastTick);t.lastTick=e,1===t.active?t.white+=r:t.black+=r,ts({white:t.white,black:t.black})},t1=e=>{if("play"!==Y.current)return;let t=eh.current;t.active=e,t.lastTick="undefined"!=typeof performance?performance.now():Date.now(),t.resumeTarget=e},t2=(e,t)=>{let r=L.current;eu.current.push({fx:(7&e)*r+r/2,fy:(7-(e>>4))*r+r/2,tx:(7&t)*r+r/2,ty:(7-(t>>4))*r+r/2,t:performance.now()}),tU()},t5=e=>{if(to)return;let t=L.current,r=(7&e)*t+t/2,n=(7-(e>>4))*t+t/2;for(let e=0;e<18;e++){let e=Math.random()*Math.PI*2,t=2+3*Math.random();eo.current.push({x:r,y:n,vx:Math.cos(e)*t,vy:Math.sin(e)*t,a:1,r:1+2*Math.random(),c:.5>Math.random()?"rgba(250, 204, 21,":"rgba(59, 130, 246,",t:performance.now()})}tU()},t3=(e,t,r)=>{if(to||!e)return;let n="undefined"!=typeof performance?performance.now():Date.now();ed.current.push({piece:e,from:t,to:r,start:n,duration:260}),tU()},t6=e=>{let t=900+200*et.current,r=1/(1+10**((t-tY)/400)),n=Math.round(tY+24*(("win"===e?1:.5*("draw"===e))-r));t_(n);try{localStorage.setItem("chessElo",String(n))}catch(e){}},t4=e=>{let t=V.current;if(t.isCheckmate()){let e=-("w"===t.turn()?1:-1)===ee.current;return"puzzle"===Y.current?ew("Puzzle solved. Checkmate!"):ew(e?"Checkmate! You win.":"Checkmate! You lose."),eN(!0),er.current=!0,ej(!0),t0(),eh.current.active=null,"play"===Y.current&&t6(e?"win":"loss"),!0}if(t.isDraw()){var r,n,l,s;let e="Draw.";return(null==(r=t.isStalemate)?void 0:r.call(t))?e="Draw by stalemate.":(null==(n=t.isThreefoldRepetition)?void 0:n.call(t))?e="Draw by threefold repetition.":(null==(l=t.isInsufficientMaterial)?void 0:l.call(t))?e="Draw by insufficient material.":(null==(s=t.isDraw)?void 0:s.call(t))&&(e="Draw."),ew("puzzle"===Y.current?"Puzzle drawn.":e),eN(!0),er.current=!0,ej(!0),t0(),eh.current.active=null,"play"===Y.current&&t6("draw"),!0}return t.isCheck()?(tX(),ew("play"===Y.current?Z.current===ee.current?"Check! Your move.":"Check! AI thinking...":"Check!")):(tX(),ew(e||"Your move")),!1},t8=(e,t)=>{let r=V.current.moves({verbose:!0}).filter(r=>r.from===e&&r.to===t);return r.length?r.find(e=>"q"===e.promotion)||r[0]:null},t7=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{announce:r=!0,triggerAi:n=!0,fromSqOverride:l=null,toSqOverride:s=null,auto:a=!1}=t;if(!e)return!1;let i=null!=l?l:h(e.from),c=null!=s?s:h(e.to);if(null===i||null===c)return!1;let u=X.current[i],o="string"==typeof e.flags?e.flags:"",d=o.includes("k")||o.includes("q"),f=o.includes("e"),m=!!e.captured||f,p=f?c+(1===Z.current?-16:16):c;if(t3(u,i,c),t2(i,c),m&&t5(p),d){let e=i>>4,t=o.includes("k")?16*e+7:16*e,r=o.includes("k")?16*e+5:16*e+3,n=X.current[t];n&&t3(n,t,r),t2(t,r)}let x=V.current.move(e);return!!x&&((tJ(),tU(),r&&(eU(e=>[...e,x.san]),tK()),ef.current={from:i,to:c},ep(null),ev([]),t0(),er.current||t1(Z.current),tQ(),t$(),t4((()=>{if("play"===Y.current)return Z.current===ee.current?"Your move":"AI thinking...";if("puzzle"===Y.current){let e=tx[tb];if(e){let t="w"===e.sideToMove?"White":"Black";return"".concat(e.title," — ").concat(t," to move.")}return"Puzzle mode."}if("opening"===Y.current){let e=tR[tz];return e?"Opening trainer: ".concat(e.name):"Opening trainer."}return"Your move"})()))?tG():("puzzle"!==Y.current||a||(e=>{let t=tx[tb];if(!t)return;let r=t.solution[ty];if(!r)return;if(e.from!==r.from||e.to!==r.to||(e.promotion||null)!==(r.promotion||null)){tj("Incorrect — try again."),ew("Puzzle move was incorrect."),V.current.undo(),tJ(),eU(e=>e.slice(0,-1)),ep(null),ev([]),eu.current=[],eo.current=[],ed.current=[],ef.current=null,tU();return}let n=ty+1;if(tj("Correct move."),n>=t.solution.length){tj("Puzzle solved!"),ew("Puzzle solved!"),eN(!0),en.current=!0,er.current=!0,ej(!0),tM(e=>{let t=e+1;try{localStorage.setItem("chessPuzzleStreak",String(t))}catch(e){}return t});return}let l=t.solution[n];l&&Z.current!==ee.current&&(setTimeout(()=>(e=>{if(!e)return;let t=t8(e.from,e.to);t&&t7(t,{announce:!0,triggerAi:!1,auto:!0})})(l),to?60:220),n+=1),tw(n)})(x),"opening"!==Y.current||a||(e=>{let t=tR[tz];if(!t)return;if(tq)return tI("This is outside the selected line.");let r=t.moves[tP];if(!r)return tI("Line complete. Keep playing from here.");if(e.from!==r.from||e.to!==r.to||(e.promotion||null)!==(r.promotion||null)){tI("This is still playable, but outside the selected line."),tB(!0);return}tI("On book.");let n=tP+1,l=t.moves[n];l&&Z.current!==ee.current&&(setTimeout(()=>(e=>{if(!e)return;let t=t8(e.from,e.to);t&&t7(t,{announce:!0,triggerAi:!1,auto:!0})})(l),to?60:220),n+=1),tA(n)})(x),n&&"play"===Y.current&&!er.current&&Z.current!==ee.current&&(tG(),el.current=setTimeout(()=>{var e;return null==(e=T.current)?void 0:e.call(T)},to?100:260))),!0)};T.current=()=>{tG(),er.current||en.current||Z.current===ee.current||K.current||(e5(!0),rr("ai",V.current.fen(),et.current,1,e=>{var t;if(e5(!1),"error"===e.type)return;let r=null;if(null==(t=e.suggestions)?void 0:t.length){let t=e.suggestions[0];r=t8(t.from,t.to)}if(!r){let e=V.current.moves({verbose:!0});r=e[Math.floor(Math.random()*e.length)]}t7(r,{announce:!0,triggerAi:!1})}))};let t9=(0,l.useCallback)(function(){let{autoplayAi:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoplayAi:!0};tG(),tH(),V.current.reset(),tJ(),ep(null),eg(0),ev([]),eu.current=[],eo.current=[],ed.current=[],e9(null),tt(null),th(""),tO(null),tW(0),eU([]),eK([]),eQ(!1),eV(""),eN(!1),en.current=!1,ef.current=null,eh.current={white:0,black:0,active:1,lastTick:"undefined"!=typeof performance?performance.now():Date.now(),resumeTarget:1},ts({white:0,black:0}),er.current=!1,ej(!1),t1(1),tQ(),t$(),tX(),e&&-1===ee.current?(ew("AI thinking..."),el.current=setTimeout(()=>{var e;return null==(e=T.current)?void 0:e.call(T)},to?100:260)):ew("Your move")},[tH,to,tG,tJ,tX,tQ,t$]),re=(0,l.useCallback)(e=>{let t=tx[e];if(!t||(tG(),tH(),V.current.reset(),!((e,t)=>!!e&&!!t&&"function"==typeof e.load&&e.load(t))(V.current,t.fen)))return;tJ(),eU([]),eK([]),eQ(!1),eV(""),eN(!1),en.current=!1,ef.current=null,eu.current=[],eo.current=[],ed.current=[],ep(null),ev([]),e9(null),tt(null),tw(0),tj(""),tN(!1),tI(""),tB(!1),th("");let r="w"===t.sideToMove?1:-1;ee.current=r,e6(r),eB(1===r?"white":"black"),eh.current.active=null,eh.current.white=0,eh.current.black=0,ts({white:0,black:0}),er.current=!1,ej(!1),ew("".concat(t.title," — ").concat(1===r?"White":"Black"," to move.")),tQ(),t$(),tX(),tU()},[tH,tx,tU,tG,tJ,tX,tQ,t$]),rt=(0,l.useCallback)(e=>{let t=tR[e];t&&(tG(),tH(),V.current.reset(),tJ(),eU([]),eK([]),eQ(!1),eV(""),eN(!1),en.current=!1,ef.current=null,eu.current=[],eo.current=[],ed.current=[],ep(null),ev([]),e9(null),tt(null),tA(0),tI("Follow the highlighted line to practice this opening."),tB(!1),th(""),ee.current=1,e6(1),eB("white"),eh.current.active=null,eh.current.white=0,eh.current.black=0,ts({white:0,black:0}),er.current=!1,ej(!1),ew("Opening trainer: ".concat(t.name)),tQ(),t$(),tX(),tU())},[tH,tR,tU,tG,tJ,tX,tQ,t$]);(0,l.useEffect)(()=>{if(P.current){P.current=!1;return}"play"===Y.current&&(eB(1===e3?"white":"black"),t9({autoplayAi:!0}))},[e3]);let rr=(0,l.useCallback)((e,t,r,n,l)=>{let s=I.current,a=("ai"===e?G.current:U.current).next(),i="".concat(e,":").concat(a);return(H.current.set(i,l),s)?s.postMessage({type:"suggest",channel:e,fen:t,depth:r,maxSuggestions:n,requestId:a}):(l({type:"error",channel:e,requestId:a,message:"Engine unavailable"}),H.current.delete(i)),a},[]);(0,l.useEffect)(()=>{B.current=()=>{var e,t;let r=J.current;if(!r)return;let n=r.getContext("2d");if(!n)return;let l=L.current,s="undefined"!=typeof performance?performance.now():Date.now(),a=F.current,i=W.current;if(!a.canvas||a.size!==e4||a.dpr!==i||a.textureReady!==eY){let t=null!=(e=a.canvas)?e:document.createElement("canvas");t.width=Math.round(e4*i),t.height=Math.round(e4*i);let r=t.getContext("2d");if(r){r.setTransform(i,0,0,i,0,0);for(let e=0;e<8;e++)for(let t=0;t<8;t++){let n=t*l,s=(7-e)*l,a=(e+t)%2==0,i=t-3.5,c=e-3.5,u=Math.max(0,1-Math.sqrt(i*i+c*c)/4.2);if(a){let e=Math.round(224+22*u);r.fillStyle="rgb(".concat(e,",").concat(e,",").concat(e+6,")")}else{let e=Math.round(58+45*u);r.fillStyle="rgb(".concat(e,",").concat(e+8,",").concat(e+22,")")}r.fillRect(n,s,l,l);let o=r.createLinearGradient(n,s,n,s+l);o.addColorStop(0,"rgba(255,255,255,0.08)"),o.addColorStop(1,"rgba(0,0,0,0.18)"),r.fillStyle=o,r.fillRect(n,s,l,l)}eY&&O.current&&(r.save(),r.globalAlpha=.25,r.drawImage(O.current,0,0,e4,e4),r.restore())}a.canvas=t,a.size=e4,a.dpr=i,a.textureReady=eY}n.clearRect(0,0,e4,e4),a.canvas&&n.drawImage(a.canvas,0,0,e4,e4);let c=[];ed.current=ed.current.filter(e=>{let t=e.duration||260,r=s-e.start,n=to?1:Math.min(1,r/t);return!(n>=1)&&(e.progress=n,c.push(e),!0)});let o=new Set(c.map(e=>e.to));for(let e=0;e<8;e++)for(let t=0;t<8;t++){let r=t*l,s=(7-e)*l,a=16*e+t;if(ef.current&&(a===ef.current.from||a===ef.current.to)&&(n.strokeStyle="rgba(255, 217, 102, 0.9)",n.lineWidth=3,n.strokeRect(r+1.5,s+1.5,l-3,l-3)),te===a&&(n.fillStyle="rgba(239, 68, 68, 0.25)",n.fillRect(r,s,l,l)),em===a)n.strokeStyle="rgba(102, 204, 255, 0.9)",n.lineWidth=2.5,n.strokeRect(r+2,s+2,l-4,l-4);else{let e=eb.find(e=>e.toSq===a);e&&(e.isCapture?(n.strokeStyle="rgba(239, 68, 68, 0.75)",n.lineWidth=3,n.beginPath(),n.arc(r+l/2,s+l/2,.32*l,0,2*Math.PI),n.stroke()):(n.fillStyle="rgba(102, 204, 255, 0.7)",n.beginPath(),n.arc(r+l/2,s+l/2,.16*l,0,2*Math.PI),n.fill()))}if(ex===a&&(n.strokeStyle="rgba(255, 255, 255, 0.6)",n.lineWidth=2,n.strokeRect(r+3,s+3,l-6,l-6)),ez.includes(a)&&(n.beginPath(),n.arc(r+l/2,s+l/2,l/6,0,2*Math.PI),n.fillStyle="rgba(64, 160, 255, 0.45)",n.fill()),e7===a&&em!==a){let e=n.createRadialGradient(r+l/2,s+l/2,l/8,r+l/2,s+l/2,l/2);e.addColorStop(0,"rgba(255,255,255,0.35)"),e.addColorStop(1,"rgba(255,213,128,0.18)"),n.fillStyle=e,n.fillRect(r,s,l,l),n.strokeStyle="rgba(255, 223, 128, 0.9)",n.lineWidth=2,n.strokeRect(r+1,s+1,l-2,l-2)}let i=X.current[a];if(i&&!o.has(a)){let e=ec.current[String(i)];"sprites"===eF&&e&&eL?(n.save(),n.shadowColor="rgba(0,0,0,0.35)",n.shadowBlur=12,n.drawImage(e,r+4,s+4,l-8,l-8),n.restore()):(n.font="".concat(l-10,"px serif"),n.textAlign="center",n.textBaseline="middle",n.fillStyle=i>0?"#111":"#f8f8f8",n.fillText(u[String(i)],r+l/2,s+l/2))}}if(eT){n.font="".concat(Math.max(10,.18*l),'px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace'),n.textAlign="left",n.textBaseline="bottom",n.fillStyle="rgba(255,255,255,0.65)";for(let e=0;e<8;e++){let t="white"===eq?f[e]:f[7-e],r=e*l+6;n.fillText(t,r,e4-6)}n.textAlign="right",n.textBaseline="top";for(let e=0;e<8;e++){let t="white"===eq?e+1:8-e,r=(7-e)*l+6;n.fillText(String(t),e4-6,r)}}if(eP)for(let e of(eu.current=eu.current.filter(e=>s-e.t<1e3),eu.current)){let t=(s-e.t)/1e3,r=to?.5:Math.max(0,1-t);n.strokeStyle="rgba(255, 200, 80, ".concat(r,")"),n.lineWidth=4,n.beginPath(),n.moveTo(e.fx,e.fy),n.lineTo(e.tx,e.ty),n.stroke();let l=Math.atan2(e.ty-e.fy,e.tx-e.fx);n.beginPath(),n.moveTo(e.tx,e.ty),n.lineTo(e.tx-12*Math.cos(l-Math.PI/6),e.ty-12*Math.sin(l-Math.PI/6)),n.lineTo(e.tx-12*Math.cos(l+Math.PI/6),e.ty-12*Math.sin(l+Math.PI/6)),n.closePath(),n.fillStyle="rgba(255, 200, 80, ".concat(r,")"),n.fill()}else eu.current=[];for(let e of(eo.current=eo.current.filter(e=>s-e.t<500),eo.current)){let t=(s-e.t)/1e3,r=e.x+e.vx*t,l=e.y+e.vy*t,a=to?.7:Math.max(0,1-2*t);n.fillStyle="".concat(e.c).concat(a,")"),n.beginPath(),n.arc(r,l,e.r,0,2*Math.PI),n.fill()}for(let e of c){let r=1-Math.pow(1-(null!=(t=e.progress)?t:0),3),s=7&e.from,a=e.from>>4,i=7&e.to,c=e.to>>4,o=s*l,d=(7-a)*l,f=o+(i*l-o)*r,h=d+((7-c)*l-d)*r,m=ec.current[String(e.piece)];"sprites"===eF&&m&&eL?(n.save(),n.shadowColor="rgba(0,0,0,0.35)",n.shadowBlur=14,n.globalAlpha=.9,n.drawImage(m,f+4,h+4,l-8,l-8),n.restore()):(n.font="".concat(l-10,"px serif"),n.textAlign="center",n.textBaseline="middle",n.fillStyle=e.piece>0?"#111":"#f8f8f8",n.fillText(u[String(e.piece)],f+l/2,h+l/2))}ed.current=c,(c.length>0||eP&&eu.current.length>0||eo.current.length>0)&&tU()}},[e4,eY,te,ex,e7,ez,eb,eq,eF,tF,to,tU,em,eP,eL,eT]),(0,l.useEffect)(()=>{tU()},[e4,eY,te,ex,e7,ez,eb,eq,eF,to,tU,em,eP,eT,eL]);let rn=e=>{if(er.current||en.current||Z.current!==ee.current||tF)return;eg(e);let t=Z.current;if(null!==em){let r=eb.filter(t=>t.toSq===e).slice().sort((e,t)=>{var r,n;let l={q:0,r:1,b:2,n:3};return(null!=(r=l[e.promotion])?r:99)-(null!=(n=l[t.promotion])?n:99)});if(r.length>1){tO({fromSq:em,toSq:e,moves:r,side:t}),tW(0);return}if(1===r.length)return void t7(r[0],{announce:!0,triggerAi:!0});ep(null),ev([])}else X.current[e]*t>0&&(ep(e),ev(V.current.moves({square:(e=>f[7&e]+((e>>4)+1))(e),verbose:!0}).map(e=>({...e,fromSq:h(e.from),toSq:h(e.to),isCapture:!!e.captured||"string"==typeof e.flags&&e.flags.includes("e")})).filter(e=>null!==e.fromSq&&null!==e.toSq)))},rl=e=>{let t=J.current;if(!t)return null;let r=t.getBoundingClientRect(),n=r.width,l=r.height;if(!n||!l)return null;let s=Math.floor((e.clientX-r.left)/n*8),a=7-Math.floor((e.clientY-r.top)/l*8);return("black"===eq&&(s=7-s,a=7-a),s<0||s>7||a<0||a>7)?null:16*a+s},rs=(0,l.useMemo)(()=>{let e=[];for(let t=0;t<eG.length;t+=2)e.push("".concat(t/2+1,". ").concat(eG[t]).concat(eG[t+1]?" "+eG[t+1]:""));return e},[eG]),ra=ey.includes("Checkmate")?"bg-red-600/80 text-white":ey.includes("Check")?"bg-amber-400/80 text-slate-900":ey.includes("Paused")?"bg-slate-600/80 text-white":"bg-slate-800/70 text-slate-100",ri=x(tl.white),rc=x(tl.black),ru="white"===eq?"White":"Black",ro=(ta/100).toFixed(2),rd=eH.slice(0,5),rf=1/(1+Math.exp(-tc/200))*100,rh=1===e3?"White":"Black",rm="white"===eq?"rotate(0deg)":"rotate(180deg)",rp=tx[tb],rx=tR[tz],rg=null!=(C=null==tF?void 0:tF.moves)?C:[],rb=tF?{left:(7&tF.toSq)*L.current,top:(7-(tF.toSq>>4))*L.current}:null,rv="rounded-full border border-slate-700/70 bg-slate-900/70 px-3 py-1.5 font-semibold uppercase tracking-wide text-slate-200 transition-colors duration-150 hover:border-sky-400 hover:bg-slate-800/80 focus:outline-none focus:ring-2 focus:ring-sky-400 disabled:cursor-not-allowed disabled:opacity-50";return(0,n.jsx)("div",{className:"h-full w-full select-none bg-ub-cool-grey p-2 text-white",children:(0,n.jsxs)("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-6 lg:flex-row",children:[(0,n.jsxs)("div",{className:"flex flex-1 flex-col items-center gap-4",children:[(0,n.jsx)("div",{ref:Q,className:"w-full",children:(0,n.jsx)("div",{className:"mx-auto flex justify-center",children:(0,n.jsxs)("div",{className:"relative",style:{width:e4,height:e4,transform:rm,transformOrigin:"center"},children:[(0,n.jsx)("canvas",{ref:J,width:512,height:512,onClick:e=>{var t;null==(t=J.current)||t.focus();let r=rl(e);null!==r&&rn(r)},onMouseMove:e=>{if(tF)return;let t=rl(e);null!==t?e9(t):e9(null)},onMouseLeave:()=>e9(null),onTouchStart:e=>{var t,r;let n=null==(t=e.touches)?void 0:t[0];if(!n)return;e.preventDefault(),null==(r=J.current)||r.focus();let l=rl(n);null!==l&&rn(l)},onKeyDown:e=>{if(er.current||en.current||Z.current!==ee.current)return;if(tF){if("Escape"===e.key){e.preventDefault(),tO(null);return}if("ArrowRight"===e.key){e.preventDefault(),tW(e=>(e+1)%tF.moves.length);return}if("ArrowLeft"===e.key){e.preventDefault(),tW(e=>(e-1+tF.moves.length)%tF.moves.length);return}if("Enter"===e.key||" "===e.key){e.preventDefault();let t=tF.moves[tL];tO(null),t7(t,{announce:!0,triggerAi:!0});return}}if("Escape"===e.key){e.preventDefault(),ep(null),ev([]);return}let t=ex,r="white"===eq?16:-16,n="white"===eq?1:-1;if("ArrowUp"===e.key)t+=r;else if("ArrowDown"===e.key)t-=r;else if("ArrowLeft"===e.key)t-=n;else if("ArrowRight"===e.key)t+=n;else if("Enter"===e.key||" "===e.key){e.preventDefault(),rn(ex);return}t!==ex&&m(t)&&(e.preventDefault(),eg(t))},tabIndex:0,"aria-label":"Chess board","aria-describedby":"chess-board-instructions",className:"touch-none rounded-2xl border border-slate-700 bg-gradient-to-br from-slate-800 via-slate-900 to-black shadow-[0_30px_60px_rgba(0,0,0,0.45)] outline-none transition-transform duration-500 ease-out focus-visible:ring-2 focus-visible:ring-sky-400",style:{width:e4,height:e4}}),tF?(0,n.jsxs)("div",{className:"absolute z-20 rounded-xl border border-slate-700 bg-slate-900/95 p-2 shadow-lg backdrop-blur",style:{left:null!=(M=null==rb?void 0:rb.left)?M:0,top:null!=(R=null==rb?void 0:rb.top)?R:0},role:"dialog","aria-label":"Choose promotion piece",children:[(0,n.jsx)("div",{className:"mb-2 text-xs uppercase tracking-wide text-slate-400",children:"Promote to"}),(0,n.jsx)("div",{className:"flex gap-2",children:rg.map((e,t)=>(0,n.jsx)("button",{type:"button",className:"flex h-10 w-10 items-center justify-center rounded-lg border text-xl transition ".concat(t===tL?"border-sky-400 bg-slate-800 text-sky-200":"border-slate-700 bg-slate-900 text-slate-200"),onClick:()=>(e=>{e&&(tO(null),t7(e,{announce:!0,triggerAi:!0}))})(e),autoFocus:t===tL,children:u[String((tF.side||1)*("n"===e.promotion?2:"b"===e.promotion?3:"r"===e.promotion?4:5))]},"".concat(e.promotion,"-").concat(t)))})]}):null]})})}),(0,n.jsx)("p",{id:"chess-board-instructions",className:"sr-only",children:"Use arrow keys to move the cursor, Enter or Space to select a piece or destination, and Escape to clear your selection."}),(0,n.jsx)("input",{type:"file",accept:".pgn",ref:$,onChange:e=>{var t;let r=null==(t=e.target.files)?void 0:t[0];if(!r)return;let n=new FileReader;n.onload=()=>(e=>{if(!e)return;if("play"!==Y.current&&(_.current=!0,tp("play")),t9({autoplayAi:!1}),th(""),!b(V.current,e)){th("Invalid PGN. Please check the file and try again."),ew("PGN load failed."),t9({autoplayAi:!0});return}let t=V.current.history({verbose:!0});V.current.reset(),tJ(),eU([]),er.current=!0,ej(!0),eh.current.active=null,eh.current.white=0,eh.current.black=0,eh.current.resumeTarget=1,ts({white:0,black:0}),ew("Replaying PGN...");let r=ea.current+1;ea.current=r;let n=0,l=()=>{if(ea.current!==r)return;if(n>=t.length){er.current=!1,ej(!1),t1(Z.current),t4("Your move");return}let e=t[n++],s=V.current.move(e);if(!s)return;let a=h(e.from),i=h(e.to);if(null===a||null===i)return;let c=X.current[a],u="string"==typeof e.flags?e.flags:"",o=u.includes("e"),d=u.includes("k")||u.includes("q"),f=o?i+(1===Z.current?-16:16):i;if(t3(c,a,i),t2(a,i),(e.captured||o)&&t5(f),d){let e=a>>4,t=u.includes("k")?16*e+7:16*e,r=u.includes("k")?16*e+5:16*e+3,n=X.current[t];n&&t3(n,t,r),t2(t,r)}tJ(),ef.current={from:a,to:i},eU(e=>[...e,s.san]),tQ(),t$(),tK(),t4(void 0),es.current=setTimeout(l,500)};l()})(String(n.result||"")),n.readAsText(r),e.target.value=""},className:"hidden","aria-label":"PGN file input"}),(0,n.jsxs)("div",{className:"flex flex-wrap justify-center gap-2 text-xs sm:text-sm",children:[(0,n.jsx)("button",{className:rv,onClick:()=>{"play"===tm&&t9(),"puzzle"===tm&&re(tb),"opening"===tm&&rt(tz)},type:"button",children:"play"===tm?"Reset":"Restart"}),(0,n.jsx)("button",{className:rv,onClick:()=>{"play"===Y.current&&(tG(),tH(),0!==V.current.history().length&&(V.current.undo(),tJ(),eU(e=>e.slice(0,-1)),"b"===V.current.turn()&&V.current.history().length>0&&(V.current.undo(),tJ(),eU(e=>e.slice(0,-1))),ep(null),ev([]),eu.current=[],eo.current=[],ed.current=[],ef.current=null,tt(null),tQ(),t$(),eh.current.white=0,eh.current.black=0,eh.current.lastTick="undefined"!=typeof performance?performance.now():Date.now(),eh.current.resumeTarget=Z.current,ts({white:eh.current.white,black:eh.current.black}),Z.current!==ee.current?(er.current=!0,ej(!0),eh.current.active=null,ew("Undo complete. Resume when ready — AI to move.")):(er.current=!1,ej(!1),t1(Z.current),ew("Your move"))))},type:"button",disabled:"play"!==tm,children:"Undo"}),(0,n.jsx)("button",{className:rv,onClick:()=>{"play"===Y.current&&ej(e=>{var t,r;if(e){let e=null!=(r=eh.current.resumeTarget)?r:Z.current;t1(e),ew(e===ee.current?"Your move":"AI thinking..."),e===ee.current||en.current||(el.current=setTimeout(()=>{var e;return null==(e=T.current)?void 0:e.call(T)},to?120:260))}else tG(),t0(),eh.current.resumeTarget=null!=(t=eh.current.active)?t:Z.current,eh.current.active=null,ew("Paused.");return!e})},type:"button",disabled:"play"!==tm,children:ek?"Resume":"Pause"}),(0,n.jsx)("button",{className:rv,onClick:()=>eM(e=>!e),type:"button",children:eC?"Sound On":"Sound Off"})]})]}),(0,n.jsx)("aside",{className:"w-full flex-shrink-0 rounded-2xl border border-slate-700 bg-gradient-to-br from-slate-900/80 via-slate-900/60 to-slate-800/40 p-5 shadow-[0_20px_45px_rgba(0,0,0,0.55)] backdrop-blur-md lg:w-80",children:(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold uppercase tracking-wide text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83E\uDDED"}),(0,n.jsx)("span",{children:"Mode"})]}),(0,n.jsx)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs sm:text-sm",children:[{key:"play",label:"Play"},{key:"puzzle",label:"Puzzles"},{key:"opening",label:"Openings"}].map(e=>(0,n.jsx)("button",{className:"".concat(rv," ").concat(tm===e.key?"border-sky-400 bg-slate-800/80 text-sky-200":""),onClick:()=>tp(e.key),type:"button",children:e.label},e.key))}),(0,n.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"Switch between classic play, tactical puzzles, and opening drills."})]}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold uppercase tracking-wide text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"♟️"}),(0,n.jsx)("span",{children:"Game State"})]}),(0,n.jsx)("div",{className:"mt-3 rounded-lg px-3 py-2 text-center text-sm font-semibold shadow-inner ".concat(ra),"aria-live":"polite",children:ey}),(0,n.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3 text-sm text-slate-200",children:[(0,n.jsxs)("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/50 p-3 shadow-inner",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-slate-400",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDD4A️"}),(0,n.jsx)("span",{children:"White"})]}),(0,n.jsx)("div",{className:"mt-1 text-2xl font-mono text-slate-100",children:ri})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/50 p-3 shadow-inner",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-xs uppercase tracking-wide text-slate-400",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDDE1️"}),(0,n.jsx)("span",{children:"Black"})]}),(0,n.jsx)("div",{className:"mt-1 text-2xl font-mono text-slate-100",children:rc})]})]}),(0,n.jsxs)("div",{className:"mt-3 text-xs text-slate-400",children:["Turn: ",(0,n.jsx)("span",{className:"font-semibold text-slate-200",children:tr})]}),(0,n.jsxs)("div",{className:"mt-1 text-xs text-slate-400",children:["You: ",(0,n.jsx)("span",{className:"font-semibold text-slate-200",children:rh})]}),(0,n.jsxs)("div",{className:"mt-1 text-xs text-slate-400",children:["Orientation:"," ",(0,n.jsx)("span",{className:"font-semibold text-slate-200",children:ru})]})]}),"puzzle"===tm?(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83E\uDDE9"}),(0,n.jsx)("span",{children:"Puzzle"})]}),rp?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mt-2 text-sm font-semibold text-slate-100",children:rp.title}),(0,n.jsxs)("div",{className:"mt-1 text-xs text-slate-400",children:["Streak:"," ",(0,n.jsx)("span",{className:"font-semibold text-slate-200",children:tC})]}),(0,n.jsx)("div",{className:"mt-2 text-xs text-slate-300","aria-live":"polite",children:tk||"Find the best move."}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs sm:text-sm",children:[(0,n.jsx)("button",{className:rv,onClick:()=>tv(e=>tx.length?(e-1+tx.length)%tx.length:0),type:"button",disabled:!tx.length,children:"Previous"}),(0,n.jsx)("button",{className:rv,onClick:()=>tv(e=>tx.length?(e+1)%tx.length:0),type:"button",disabled:!tx.length,children:"Next"}),(0,n.jsx)("button",{className:rv,onClick:()=>{tN(!0);let e=tx[tb];e&&tj("Solution: ".concat(e.solution.map(e=>e.san).join(" ")))},type:"button",children:"Show Solution"})]}),tS?(0,n.jsx)("div",{className:"mt-2 rounded-lg border border-slate-700/60 bg-slate-900/50 p-2 text-xs text-slate-200",children:rp.solution.map(e=>e.san).join(" ")}):null]}):(0,n.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"No puzzles loaded."})]}):null,"opening"===tm?(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDCDA"}),(0,n.jsx)("span",{children:"Opening Trainer"})]}),rx?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mt-2 text-sm font-semibold text-slate-100",children:rx.name}),(0,n.jsx)("div",{className:"mt-2 text-xs text-slate-300","aria-live":"polite",children:tT||"Follow the recommended line."}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs sm:text-sm",children:[(0,n.jsx)("button",{className:rv,onClick:()=>tE(e=>tR.length?(e-1+tR.length)%tR.length:0),type:"button",disabled:!tR.length,children:"Previous"}),(0,n.jsx)("button",{className:rv,onClick:()=>tE(e=>tR.length?(e+1)%tR.length:0),type:"button",disabled:!tR.length,children:"Next"})]})]}):(0,n.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"No openings loaded."})]}):null,(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83C\uDF9B️"}),(0,n.jsx)("span",{children:"Player Setup"})]}),(0,n.jsxs)("label",{className:"mt-2 flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-slate-400",htmlFor:"chess-side",children:[(0,n.jsx)("span",{children:"Play As"}),(0,n.jsxs)("select",{id:"chess-side",className:"rounded-lg border border-slate-700/70 bg-slate-900/70 px-2 py-1 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400",value:e3,onChange:e=>e6(Number(e.target.value)),disabled:"play"!==tm,children:[(0,n.jsx)("option",{value:1,children:"White"}),(0,n.jsx)("option",{value:-1,children:"Black"})]})]}),(0,n.jsxs)("label",{className:"mt-3 flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-slate-400",htmlFor:"chess-ai-depth",children:[(0,n.jsx)("span",{children:"AI Depth"}),(0,n.jsx)("select",{id:"chess-ai-depth",className:"rounded-lg border border-slate-700/70 bg-slate-900/70 px-2 py-1 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400",value:e0,onChange:e=>e1(Number(e.target.value)),disabled:"play"!==tm,children:[1,2,3,4].map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsx)("p",{className:"mt-2 text-xs text-slate-400",children:"play"===tm?"Changing sides restarts the game. The AI moves first when you choose Black.":"Player settings are locked while training modes are active."})]}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDCC8"}),(0,n.jsx)("span",{children:"Evaluation"})]}),(0,n.jsx)("div",{className:"mt-3 h-3 w-full overflow-hidden rounded-full bg-slate-800/60",role:"progressbar","aria-label":"Evaluation score","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":Number(rf.toFixed(0)),children:(0,n.jsx)("div",{className:"h-full ".concat(tc>=0?"bg-emerald-400":"bg-rose-400"),style:{width:"".concat(rf,"%")}})}),(0,n.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs text-slate-300",children:[(0,n.jsxs)("span",{children:["Score ",ro]}),(0,n.jsxs)("span",{children:["ELO ",tY]})]})]}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDCCB"}),(0,n.jsx)("span",{children:"Move List"})]}),(0,n.jsx)("div",{className:"mt-2 max-h-40 overflow-y-auto rounded-xl border border-slate-700/60 bg-slate-900/40 p-3 text-sm leading-relaxed shadow-inner","aria-label":"Move list",children:rs.length>0?(0,n.jsx)("ol",{className:"space-y-1",children:rs.map((e,t)=>(0,n.jsx)("li",{className:"font-mono ".concat(t===rs.length-1?"text-sky-300":"text-slate-200"),children:e},t))}):(0,n.jsx)("p",{className:"text-xs italic text-slate-400",children:"No moves yet — make your first move to begin the story."})})]}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDCA1"}),(0,n.jsx)("span",{children:"Engine Tips"})]}),(0,n.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Use the embedded engine for on-demand guidance. Higher depths explore more replies."}),(0,n.jsxs)("label",{className:"mt-3 flex items-center gap-3 text-xs font-semibold uppercase tracking-wide text-slate-400",htmlFor:"chess-depth",children:[(0,n.jsx)("span",{children:"Depth"}),(0,n.jsx)("select",{id:"chess-depth",className:"rounded-lg border border-slate-700/70 bg-slate-900/70 px-2 py-1 text-sm text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-400",value:eX,onChange:e=>eZ(Number(e.target.value)),children:[1,2,3,4,5].map(e=>(0,n.jsx)("option",{value:e,children:e},e))})]}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs sm:text-sm",children:[(0,n.jsx)("button",{className:rv,onClick:()=>{eQ(!0),eV(""),eK([]),rr("analysis",V.current.fen(),eX,5,e=>{if("error"===e.type){eV(e.message||"Analysis failed."),eQ(!1);return}eK(e.suggestions||[]),eQ(!1)})},type:"button",disabled:eJ,"aria-busy":eJ,children:eJ?"Analyzing...":"Analyze"}),(0,n.jsx)("button",{className:rv,onClick:()=>{var e;null==(e=navigator.clipboard)||e.writeText(V.current.pgn())},type:"button",children:"Copy PGN"}),(0,n.jsx)("button",{className:rv,onClick:()=>{var e;null==(e=$.current)||e.click()},type:"button",children:"Load PGN"})]}),tf?(0,n.jsx)("div",{className:"mt-2 rounded-lg border border-rose-500/60 bg-rose-500/10 px-3 py-2 text-xs text-rose-200",children:tf}):null,e$?(0,n.jsx)("div",{className:"mt-2 rounded-lg border border-rose-500/60 bg-rose-500/10 px-3 py-2 text-xs text-rose-200",children:e$}):null,(0,n.jsx)("ul",{className:"mt-3 space-y-2 text-sm text-slate-200","aria-live":"polite",children:rd.length>0?rd.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-center justify-between rounded-xl border border-slate-700/60 bg-slate-900/50 px-3 py-2 shadow-inner",children:[(0,n.jsxs)("span",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sky-300","aria-hidden":!0,children:"⚡"}),(0,n.jsx)("span",{children:e.san})]}),(0,n.jsx)("span",{className:"font-mono text-xs text-slate-300",children:(e.evaluation/100).toFixed(2)})]},"".concat(e.san,"-").concat(t))):(0,n.jsx)("li",{className:"text-xs italic text-slate-400",children:"Run analysis to reveal tactical ideas."})})]}),(0,n.jsxs)("section",{children:[(0,n.jsxs)("h2",{className:"flex items-center gap-2 text-lg font-semibold text-slate-200",children:[(0,n.jsx)("span",{"aria-hidden":!0,children:"⚙️"}),(0,n.jsx)("span",{children:"Options"})]}),(0,n.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2 text-xs sm:text-sm",children:[(0,n.jsxs)("button",{className:rv,onClick:()=>{e9(null),eB(e=>"white"===e?"black":"white")},type:"button",children:["Flip to ","white"===eq?"Black":"White"," view"]}),(0,n.jsx)("button",{className:rv,onClick:()=>eA(e=>!e),type:"button",children:eP?"Hide Arrows":"Show Arrows"}),(0,n.jsx)("button",{className:rv,onClick:()=>eO(e=>"sprites"===e?"unicode":"sprites"),type:"button",children:"sprites"===eF?"Use Unicode":"Use SVG Pieces"}),(0,n.jsx)("button",{className:rv,onClick:()=>eD(e=>!e),type:"button",children:eR?"Hide Mate-in-1":"Show Mate-in-1"}),(0,n.jsx)("button",{className:rv,onClick:()=>eI(e=>!e),type:"button",children:eT?"Hide Coordinates":"Show Coordinates"})]})]})]})})]})})}}}]);