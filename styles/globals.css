@import './tokens.css';

html {
  font-size: calc(100% * var(--font-multiplier));
  background-color: var(--bg);
  color: var(--text);
  scrollbar-color: var(--border) transparent;
}

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  font-size: var(--font-step-0);
  line-height: var(--line-height-body);
  min-height: 100%;
  filter: brightness(calc(0.55 + (var(--qs-brightness, 75) / 100) * 0.45));
  transition:
    background-color var(--motion-medium) cubic-bezier(0.2, 0.8, 0.2, 1),
    color var(--motion-medium) cubic-bezier(0.2, 0.8, 0.2, 1),
    filter var(--motion-medium) cubic-bezier(0.2, 0.8, 0.2, 1);
  accent-color: var(--primary);
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: rgba(8, 15, 30, calc((100 - var(--qs-brightness, 75)) / 150));
  background: color-mix(
    in oklch,
    var(--overlay-soft) calc((100 - var(--qs-brightness, 75)) * 1%),
    transparent
  );
  mix-blend-mode: multiply;
  transition: background-color var(--motion-medium) cubic-bezier(0.2, 0.8, 0.2, 1);
  z-index: 999;
}

::selection {
  background: color-mix(in oklch, var(--primary) 55%, var(--surface-2));
  color: var(--primary-contrast);
}

*:focus-visible {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
}

h1 {
  font-size: var(--font-step-4);
  line-height: var(--line-height-display);
  letter-spacing: -0.01em;
}

h2 {
  font-size: var(--font-step-3);
  line-height: var(--line-height-display);
  letter-spacing: -0.005em;
}

h3 {
  font-size: var(--font-step-2);
  line-height: calc(var(--line-height-display) + 0.05);
}

h4 {
  font-size: var(--font-step-1);
  line-height: calc(var(--line-height-display) + 0.08);
}

small {
  font-size: var(--font-step--1);
}

code,
pre,
tt,
kbd,
samp {
  font-family: var(--font-mono);
}

[role='log'],
.log-surface {
  font-family: var(--font-mono);
  font-variant-ligatures: none;
  tab-size: 2;
}

.window {
  box-shadow: var(--shadow-2);
}

.window[data-active='true'] {
  box-shadow: var(--shadow-3);
}

.window[data-active='true'] .window-title {
  color: color-mix(in oklch, var(--primary) 75%, var(--text) 25%);
}

.window[data-active='false'] .window-title {
  color: color-mix(in oklch, var(--text-muted) 80%, transparent);
}

.window-titlebar {
  height: var(--window-titlebar-height);
  padding: 0 var(--window-horizontal-padding);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  user-select: none;
  cursor: grab;
}

.window-titlebar [data-window-control] {
  width: var(--window-control-size);
  height: var(--window-control-size);
  border-radius: var(--radius-round);
  display: grid;
  place-items: center;
  cursor: pointer;
  touch-action: manipulation;
}

.window-titlebar,
.dock,
.menubar {
  background: var(--surface-2);
  box-shadow: var(--shadow-1);
}

html[data-theme='neon'] {
  --bg: hsl(300 100% 7%);
  --surface: hsl(300 90% 10%);
  --surface-2: hsl(300 80% 14%);
  --surface-3: hsl(300 70% 20%);
  --text: hsl(300 20% 95%);
  --text-muted: hsl(300 18% 68%);
  --primary: hsl(120 90% 60%);
  --primary-contrast: hsl(300 20% 10%);
  --accent: hsl(300 96% 65%);
  --danger: hsl(338 90% 62%);
  --border: hsl(300 40% 40% / 0.55);
  --shadow-color: hsl(300 40% 10% / 0.65);
}

@supports (color: oklch(0% 0 0)) {
  html[data-theme='neon'] {
    --bg: oklch(16% 0.2 320);
    --surface: oklch(20% 0.23 320);
    --surface-2: oklch(26% 0.25 320);
    --surface-3: oklch(32% 0.25 320);
    --text: oklch(94% 0.03 320);
    --text-muted: oklch(72% 0.08 320);
    --primary: oklch(78% 0.25 135);
    --primary-contrast: oklch(24% 0.09 320);
    --accent: oklch(75% 0.3 330);
    --danger: oklch(68% 0.24 20);
    --border: oklch(36% 0.08 320 / 0.55);
    --shadow-color: oklch(22% 0.08 320 / 0.7);
  }
}

html[data-theme='matrix'] {
  --bg: hsl(140 100% 4%);
  --surface: hsl(140 75% 6%);
  --surface-2: hsl(140 60% 8%);
  --surface-3: hsl(140 55% 12%);
  --text: hsl(120 100% 70%);
  --text-muted: hsl(120 45% 48%);
  --primary: hsl(120 100% 62%);
  --primary-contrast: hsl(140 60% 5%);
  --accent: hsl(120 90% 62%);
  --danger: hsl(8 80% 60%);
  --border: hsl(140 50% 28% / 0.6);
  --shadow-color: hsl(140 65% 10% / 0.65);
}

@supports (color: oklch(0% 0 0)) {
  html[data-theme='matrix'] {
    --bg: oklch(10% 0.09 145);
    --surface: oklch(14% 0.09 145);
    --surface-2: oklch(18% 0.1 145);
    --surface-3: oklch(24% 0.1 145);
    --text: oklch(78% 0.12 140);
    --text-muted: oklch(62% 0.08 140);
    --primary: oklch(82% 0.16 145);
    --primary-contrast: oklch(16% 0.06 145);
    --accent: oklch(80% 0.15 145);
    --danger: oklch(68% 0.2 25);
    --border: oklch(28% 0.08 145 / 0.6);
    --shadow-color: oklch(18% 0.08 145 / 0.65);
  }
}

@keyframes ambientGlowDrift {
  0% {
    transform: rotate(0deg) scale(1);
    opacity: 0.5;
  }
  35% {
    transform: rotate(6deg) scale(1.06);
    opacity: 0.7;
  }
  68% {
    transform: rotate(-4deg) scale(1.04);
    opacity: 0.62;
  }
  100% {
    transform: rotate(2deg) scale(1.02);
    opacity: 0.55;
  }
}

.taskbar-badge {
  position: absolute;
  top: -0.45rem;
  right: -0.5rem;
  min-width: 1.25rem;
  height: 1.25rem;
  padding: 0 0.35rem;
  border-radius: 9999px;
  background: var(--taskbar-badge-bg, #3b82f6);
  color: var(--taskbar-badge-fg, #020817);
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  box-shadow: 0 12px 28px -18px rgba(15, 23, 42, 0.92), 0 0 0 1px rgba(255, 255, 255, 0.18);
  font-variant-numeric: tabular-nums;
  transform-origin: center;
  transition: transform 140ms ease-out, opacity 140ms ease-out;
  z-index: 2;
}

.taskbar-badge--count {
  min-width: 1.5rem;
  height: 1.5rem;
  padding: 0 0.45rem;
  font-size: 0.68rem;
  box-shadow: 0 12px 28px -18px rgba(15, 23, 42, 0.92), 0 0 0 1px rgba(255, 255, 255, 0.16);
}

.taskbar-badge--count > span {
  display: inline-block;
  font-weight: 700;
}

.taskbar-badge--dot {
  width: 0.6rem;
  height: 0.6rem;
  min-width: 0;
  padding: 0;
  box-shadow: 0 0 0 2px rgba(8, 15, 26, 0.72), 0 6px 16px -10px rgba(15, 23, 42, 0.9), 0 0 0 1px rgba(255, 255, 255, 0.2);
}

.taskbar-badge--ring {
  width: 1.85rem;
  height: 1.85rem;
  min-width: 1.85rem;
  padding: 0;
  background: transparent;
  color: var(--taskbar-badge-bg, #3b82f6);
  font-size: 0.6rem;
  font-weight: 600;
  box-shadow: none;
}

.taskbar-badge--ring::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: conic-gradient(
    var(--taskbar-badge-bg, #3b82f6) var(--taskbar-badge-progress, 0deg),
    rgba(255, 255, 255, 0.08) var(--taskbar-badge-progress, 0deg)
  );
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.14), 0 10px 24px -16px rgba(15, 23, 42, 0.85);
}

.taskbar-badge--ring::after {
  content: '';
  position: absolute;
  inset: 0.38rem;
  border-radius: inherit;
  background: var(--taskbar-badge-track, rgba(8, 15, 26, 0.82));
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
}

.taskbar-badge__value {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 1.05rem;
  color: var(--taskbar-badge-bg, #3b82f6);
  font-weight: 700;
  letter-spacing: 0.02em;
}

.taskbar-badge--pulse {
  animation: taskbarBadgePulse 1.8s ease-in-out infinite;
}

@keyframes taskbarBadgePulse {
  0%,
  100% {
    transform: scale(1);
    box-shadow:
      0 12px 28px -18px rgba(15, 23, 42, 0.9),
      0 0 0 1px rgba(255, 255, 255, 0.18),
      0 0 0 0 var(--taskbar-badge-glow, rgba(59, 130, 246, 0.4));
  }
  50% {
    transform: scale(1.08);
    box-shadow:
      0 12px 28px -16px rgba(15, 23, 42, 0.95),
      0 0 0 1px rgba(255, 255, 255, 0.24),
      0 0 12px 6px var(--taskbar-badge-glow, rgba(59, 130, 246, 0.4));
  }
}

@media (prefers-reduced-motion: reduce) {
  .taskbar-badge--pulse {
    animation: none;
  }
}

.reduce-motion .taskbar-badge--pulse {
  animation: none;
}

[data-focus-mode] .taskbar-badge {
  display: none !important;
}

@keyframes ambientGridPan {
  0% {
    background-position: 0px 0px, 0px 0px;
  }
  50% {
    background-position: 80px 40px, -60px 30px;
  }
  100% {
    background-position: 0px 0px, 0px 0px;
  }
}

@keyframes ambientNoisePulse {
  0% {
    opacity: 0.1;
  }
  50% {
    opacity: 0.2;
  }
  100% {
    opacity: 0.12;
  }
}

::-webkit-scrollbar {
  width: 6px;
  height: 6px;
  background-color: transparent;
}

::-webkit-scrollbar-thumb {
  background-color: var(--kali-border, var(--color-border));
  border-radius: 6px;
}
