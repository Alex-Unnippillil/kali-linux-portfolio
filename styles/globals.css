@import './tokens.css';

/* Accessible theme color palette meeting WCAG AA contrast ratios */
:root {
  /* Base colors */
  --color-bg: #0b121a; /* kali background */
  --color-text: #f5faff; /* text on dark backgrounds */
  /* Brand accents */
  --color-primary: #0f94d2; /* kali blue accent */
  --color-secondary: #111b24; /* complementary dark */
  --color-accent: #0f94d2; /* accent matches primary */
  --color-error: #ff4d6d; /* alert and error states */
  --kali-blue: var(--color-primary);
  /* Utility colors */
  --color-muted: #1a2533; /* muted surfaces */
  --color-surface: #111b24; /* panel surfaces */
  --color-inverse: #000000; /* inverse of text */
  --color-border: var(--kali-border); /* subtle borders */
  --color-terminal: var(--kali-terminal-green); /* terminal green */
  --color-success: var(--color-terminal);
  --color-warning: #f5b74d;
  --color-danger: #f87272;
  --color-dark: #09121c; /* card back */
  --color-focus-ring: var(--color-accent);
  --color-selection: var(--color-accent);
  --color-control-accent: var(--color-accent);
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 82%, transparent 18%);
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 94%, var(--color-bg) 6%);
  --color-overlay-strong: color-mix(in srgb, var(--kali-bg) 82%, transparent 18%);
  --color-overlay-soft: color-mix(in srgb, var(--kali-bg) 65%, transparent 35%);
  --color-info: #38bdf8;
  --color-severity-low: #16a34a;
  --color-severity-medium: #ca8a04;
  --color-severity-high: #ea580c;
  --color-severity-critical: #ef4444;
  --kali-text: var(--color-text);
  --kali-text-muted: color-mix(in srgb, var(--color-text) 82%, var(--color-bg) 18%);
  --kali-text-subtle: color-mix(in srgb, var(--color-text) 68%, var(--color-bg) 32%);
  --kali-text-faint: color-mix(in srgb, var(--color-text) 58%, var(--color-bg) 42%);
  --kali-surface: color-mix(in srgb, var(--color-surface) 92%, transparent);
  --kali-overlay: color-mix(in srgb, var(--color-surface) 82%, rgba(255, 255, 255, 0.08));
  --kali-control: var(--color-control-accent);
  --kali-control-surface: color-mix(in srgb, var(--kali-control) 18%, var(--kali-surface));
  --kali-control-overlay: color-mix(in srgb, var(--kali-control) 24%, var(--kali-overlay));
  --qs-brightness: 75;
  --qs-volume: 70;
  accent-color: var(--color-control-accent);
}

body {
  background: var(--kali-bg);
  color: var(--kali-text);
  filter: brightness(calc(0.65 + (var(--qs-brightness, 75) / 100) * 0.35));
  transition: filter 200ms ease-out;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: rgba(8, 15, 30, calc((100 - var(--qs-brightness, 75)) / 220));
  mix-blend-mode: multiply;
  transition: background-color 200ms ease-out;
  z-index: 50;
}

/* Light theme */
html[data-theme='light'] {
  --color-bg: #f8fafc;
  --color-text: #0f172a;
  --color-primary: #2563eb;
  --color-secondary: #e2e8f0;
  --color-accent: #38bdf8;
  --color-error: #ef4444;
  --color-muted: #e2e8f0;
  --color-surface: #ffffff;
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 82%, #e2e8f0 18%);
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 94%, #e2e8f0 6%);
  --color-inverse: #0f172a;
  --color-border: #cbd5f5;
  --color-terminal: #1d4ed8;
  --color-dark: #e2e8f0;
  --color-overlay-strong: rgba(248, 250, 252, 0.9);
  --color-overlay-soft: rgba(248, 250, 252, 0.7);
  --color-info: #0284c7;
  --color-severity-low: #16a34a;
  --color-severity-medium: #ca8a04;
  --color-severity-high: #ea580c;
  --color-severity-critical: #dc2626;
}

/* Dark theme */
html[data-theme='dark'] {
  --color-bg: #000000;
  --color-text: #e5e5e5;
  --color-primary: #1e88e5;
  --color-secondary: #121212;
  --color-accent: #bb86fc;
  --color-error: #ff6b6b;
  --color-muted: #1f1f1f;
  --color-surface: #121212;
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 84%, transparent 16%);
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 92%, var(--color-bg) 8%);
  --color-inverse: #ffffff;
  --color-border: #333333;
  --color-terminal: #00ff00;
  --color-dark: #0a0a0a;
  --color-overlay-strong: rgba(0, 0, 0, 0.8);
  --color-overlay-soft: rgba(0, 0, 0, 0.55);
  --color-info: #38bdf8;
  --color-severity-low: #22c55e;
  --color-severity-medium: #eab308;
  --color-severity-high: #f97316;
  --color-severity-critical: #f87171;
}

/* Neon theme */
html[data-theme='neon'] {
  --color-bg: #000000;
  --color-text: #ffffff;
  --color-primary: #39ff14;
  --color-secondary: #1a1a1a;
  --color-accent: #ff00ff;
  --color-error: #ff5cf4;
  --color-muted: #222222;
  --color-surface: #111111;
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 75%, transparent 25%);
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 88%, var(--color-bg) 12%);
  --color-inverse: #ffffff;
  --color-border: #333333;
  --color-terminal: #39ff14;
  --color-dark: #000000;
  --color-overlay-strong: rgba(0, 0, 0, 0.85);
  --color-overlay-soft: rgba(0, 0, 0, 0.6);
  --color-info: #38bdf8;
  --color-severity-low: #16a34a;
  --color-severity-medium: #ca8a04;
  --color-severity-high: #ea580c;
  --color-severity-critical: #ef4444;
}

/* Matrix theme */
html[data-theme='matrix'] {
  --color-bg: #000000;
  --color-text: #00ff00;
  --color-primary: #00ff00;
  --color-secondary: #001100;
  --color-accent: #00ff00;
  --color-error: #ff4d4d;
  --color-muted: #003300;
  --color-surface: #001100;
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 70%, transparent 30%);
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 88%, var(--color-bg) 12%);
  --color-inverse: #ffffff;
  --color-border: #003300;
  --color-terminal: #00ff00;
  --color-dark: #000000;
  --color-overlay-strong: rgba(0, 0, 0, 0.85);
  --color-overlay-soft: rgba(0, 0, 0, 0.6);
  --color-info: #38bdf8;
  --color-severity-low: #16a34a;
  --color-severity-medium: #ca8a04;
  --color-severity-high: #ea580c;
  --color-severity-critical: #ef4444;

}

html[data-theme='ubuntu'] {
  --color-bg: #12070f;
  --color-text: #f8fafc;
  --color-primary: #f97316;
  --color-secondary: #1f0b19;
  --color-accent: #fb923c;
  --color-error: #fb7185;
  --color-muted: #2a0f24;
  --color-surface: #1f0b19;
  --color-surface-muted: color-mix(in srgb, var(--color-surface) 78%, rgba(255, 255, 255, 0.08));
  --color-surface-raised: color-mix(in srgb, var(--color-surface) 88%, #12070f 12%);
  --color-inverse: #ffffff;
  --color-border: #3b1c2f;
  --color-terminal: #f97316;
  --color-dark: #12070f;
  --color-overlay-strong: rgba(18, 7, 15, 0.9);
  --color-overlay-soft: rgba(18, 7, 15, 0.65);
  --color-info: #38bdf8;
  --color-severity-low: #22c55e;
  --color-severity-medium: #eab308;
  --color-severity-high: #f97316;
  --color-severity-critical: #ef4444;
}

::selection {
  background: color-mix(in srgb, var(--color-primary) 65%, var(--kali-bg));
  color: var(--kali-text);
}

*:focus-visible {
  outline: 2px solid var(--color-focus-ring);
  outline-offset: 2px;
}

html {
  scrollbar-color: var(--kali-border, var(--color-border)) transparent;
}

@keyframes ambientGlowDrift {
  0% {
    transform: rotate(0deg) scale(1);
    opacity: 0.5;
  }
  35% {
    transform: rotate(6deg) scale(1.06);
    opacity: 0.7;
  }
  68% {
    transform: rotate(-4deg) scale(1.04);
    opacity: 0.62;
  }
  100% {
    transform: rotate(2deg) scale(1.02);
    opacity: 0.55;
  }
}

.taskbar-badge {
  position: absolute;
  top: -0.45rem;
  right: -0.5rem;
  min-width: 1.25rem;
  height: 1.25rem;
  padding: 0 0.35rem;
  border-radius: 9999px;
  background: var(--taskbar-badge-bg, #3b82f6);
  color: var(--taskbar-badge-fg, #020817);
  font-size: 0.65rem;
  font-weight: 700;
  letter-spacing: 0.01em;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  box-shadow: 0 12px 28px -18px rgba(15, 23, 42, 0.92), 0 0 0 1px rgba(255, 255, 255, 0.18);
  font-variant-numeric: tabular-nums;
  transform-origin: center;
  transition: transform 140ms ease-out, opacity 140ms ease-out;
  z-index: 2;
}

.taskbar-app-button {
  transition: transform 160ms ease, box-shadow 160ms ease, background-color 160ms ease, color 160ms ease;
}

.taskbar-app-button::after {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: 0.6rem;
  opacity: 0;
  pointer-events: none;
  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.35), 0 8px 18px rgba(8, 145, 178, 0.25);
  transition: opacity 180ms ease;
}

.taskbar-app-button:hover::after,
.taskbar-app-button:focus-visible::after {
  opacity: 1;
}

.taskbar-app-button[data-active='true']::after {
  opacity: 1;
  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45), 0 10px 22px rgba(8, 145, 178, 0.35);
}

.taskbar-app-icon {
  transition: transform 150ms ease, filter 150ms ease;
  filter: drop-shadow(0 4px 10px rgba(8, 15, 28, 0.35));
}

/* Simon buzz/shake */
@keyframes simon-buzz {
  0% {
    transform: translate3d(0, 0, 0);
  }
  10% {
    transform: translate3d(-2px, 1px, 0);
  }
  20% {
    transform: translate3d(2px, -1px, 0);
  }
  30% {
    transform: translate3d(-2px, -1px, 0);
  }
  40% {
    transform: translate3d(2px, 1px, 0);
  }
  50% {
    transform: translate3d(-1px, 0, 0);
  }
  60% {
    transform: translate3d(1px, 0, 0);
  }
  70% {
    transform: translate3d(-1px, 1px, 0);
  }
  80% {
    transform: translate3d(1px, -1px, 0);
  }
  90% {
    transform: translate3d(-1px, -1px, 0);
  }
  100% {
    transform: translate3d(0, 0, 0);
  }
}

.buzz {
  animation: simon-buzz 300ms ease-in-out 1;
}

@media (prefers-reduced-motion: reduce) {
  .buzz {
    animation: none;
  }
}

.taskbar-badge--count {
  min-width: 1.5rem;
  height: 1.5rem;
  padding: 0 0.45rem;
  font-size: 0.68rem;
  box-shadow: 0 12px 28px -18px rgba(15, 23, 42, 0.92), 0 0 0 1px rgba(255, 255, 255, 0.16);
}

.taskbar-badge--count > span {
  display: inline-block;
  font-weight: 700;
}

.taskbar-badge--dot {
  width: 0.6rem;
  height: 0.6rem;
  min-width: 0;
  padding: 0;
  box-shadow: 0 0 0 2px rgba(8, 15, 26, 0.72), 0 6px 16px -10px rgba(15, 23, 42, 0.9), 0 0 0 1px rgba(255, 255, 255, 0.2);
}

.taskbar-badge--ring {
  width: 1.85rem;
  height: 1.85rem;
  min-width: 1.85rem;
  padding: 0;
  background: transparent;
  color: var(--taskbar-badge-bg, #3b82f6);
  font-size: 0.6rem;
  font-weight: 600;
  box-shadow: none;
}

.taskbar-badge--ring::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: conic-gradient(
    var(--taskbar-badge-bg, #3b82f6) var(--taskbar-badge-progress, 0deg),
    rgba(255, 255, 255, 0.08) var(--taskbar-badge-progress, 0deg)
  );
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.14), 0 10px 24px -16px rgba(15, 23, 42, 0.85);
}

.taskbar-badge--ring::after {
  content: '';
  position: absolute;
  inset: 0.38rem;
  border-radius: inherit;
  background: var(--taskbar-badge-track, rgba(8, 15, 26, 0.82));
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.12);
}

.taskbar-badge__value {
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 1.05rem;
  color: var(--taskbar-badge-bg, #3b82f6);
  font-weight: 700;
  letter-spacing: 0.02em;
}

.taskbar-badge--pulse {
  animation: taskbarBadgePulse 1.8s ease-in-out infinite;
}

@keyframes taskbarBadgePulse {
  0%,
  100% {
    transform: scale(1);
    box-shadow:
      0 12px 28px -18px rgba(15, 23, 42, 0.9),
      0 0 0 1px rgba(255, 255, 255, 0.18),
      0 0 0 0 var(--taskbar-badge-glow, rgba(59, 130, 246, 0.4));
  }
  50% {
    transform: scale(1.08);
    box-shadow:
      0 12px 28px -16px rgba(15, 23, 42, 0.95),
      0 0 0 1px rgba(255, 255, 255, 0.24),
      0 0 12px 6px var(--taskbar-badge-glow, rgba(59, 130, 246, 0.4));
  }
}

@media (prefers-reduced-motion: reduce) {
  .taskbar-badge--pulse {
    animation: none;
  }
}

.reduce-motion .taskbar-badge--pulse {
  animation: none;
}

[data-focus-mode] .taskbar-badge {
  display: none !important;
}

@keyframes ambientGridPan {
  0% {
    background-position: 0px 0px, 0px 0px;
  }
  50% {
    background-position: 80px 40px, -60px 30px;
  }
  100% {
    background-position: 0px 0px, 0px 0px;
  }
}

@keyframes ambientNoisePulse {
  0% {
    opacity: 0.1;
  }
  50% {
    opacity: 0.2;
  }
  100% {
    opacity: 0.12;
  }
}

::-webkit-scrollbar {
  width: 6px;
  height: 6px;
  background-color: transparent;
}

::-webkit-scrollbar-thumb {
  background-color: var(--kali-border, var(--color-border));
  border-radius: 6px;
}
