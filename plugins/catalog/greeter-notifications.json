{
  "id": "greeter-notifications",
  "sandbox": "worker",
  "code": "const PLACEHOLDER='…';\nlet policy={forwardingEnabled:false,privacyMode:true,showPreview:true};\nconst emit=(message)=>self.postMessage(message);\nconst sanitize=(value,allowPreview=true)=>{if(value==null)return'';if(!allowPreview)return PLACEHOLDER;let text=String(value);text=text.replace(/(\\b(?:pass(?:word|code)?|secret|token|key|otp|pin|code)\\b\\s*(?:[:=]\\s*)?)([^\\s,;]+)/gi,(_,prefix)=>prefix+PLACEHOLDER);text=text.replace(/https?:\\/\\/\\S+/gi,PLACEHOLDER);text=text.replace(/\\b[a-f0-9]{12,}\\b/gi,PLACEHOLDER);text=text.replace(/\\b\\d{6}\\b/g,PLACEHOLDER);text=text.replace(/[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}/g,PLACEHOLDER);return text;};\nconst request=()=>self.postMessage({type:'request-notifications'});\nemit('[greeter] Binding to org.freedesktop.Notifications…');\nrequest();\nself.onmessage=(event)=>{const data=event.data||{};if(data.type==='notification-policy'){policy={forwardingEnabled:!!data.forwardingEnabled,privacyMode:!!data.privacyMode,showPreview:!!data.showPreview};if(!policy.forwardingEnabled){emit('Forwarding disabled by user policy.');}request();return;}if(data.type==='notifications'){if(!data.forwarded){emit('Greeter feed is empty — forwarding disabled.');return;}const entries=Array.isArray(data.payload)?data.payload:[];const previewAllowed=(policy.privacyMode||data.privacyMode)?(policy.showPreview&&data.showPreview!==false):true;if(entries.length===0){emit('No unread notifications to display.');}else{entries.slice(0,5).forEach((notification)=>{const app=notification.appId||'unknown';const title=sanitize(notification.title,previewAllowed);const body=notification.body?sanitize(notification.body,previewAllowed):'';const summary=body?app+': '+title+' — '+body:app+': '+title;emit(summary);});}if(policy.privacyMode||data.privacyMode){emit('Privacy mode enforced — sensitive text redacted.');}else{emit('Privacy mode off — showing full previews.');}return;}};"
}
